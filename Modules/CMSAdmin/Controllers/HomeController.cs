
#region Copyright
// 
// Aries TCO, Inc.® - http://www.ariestco.com
// Copyright (c) 2002-2014
// by Aries TCO, Inc.
// 
// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated 
// documentation files (the "Software"), to deal in the Software without restriction, including without limitation 
// the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and 
// to permit persons to whom the Software is furnished to do so, subject to the following conditions:
// 
// The above copyright notice and this permission notice shall be included in all copies or substantial portions 
// of the Software.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED 
// TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL 
// THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF 
// CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
// DEALINGS IN THE SOFTWARE.
#endregion




using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;
using System.IO;
using System.Data;
using System.Web.Script.Serialization;
using Newtonsoft.Json;
using AriesGlobal;
using AriesDBConnector;
using AriesDBManager;
using AriesCMSInteractions;
using AriesCMSDefinition;
using ACMSDBView;

namespace AriesCMS.Modules.CMSAdmin.Controllers
{
    public partial class HomeController : Controller
    {
        ACMSDBView.WebSitePageViewModel oPage = new WebSitePageViewModel();
        //
        // GET: /Default/
        string sModuleBase = "~/Modules/CMSAdmin";
        string sBasePage = "/Views/Screens/Index.cshtml";
        string _sViewToLoad = "";
        AriesCMS.Helpers.SiteCoreHelper oSystem = new Helpers.SiteCoreHelper();
        int[] iAccessRolesAllowed = new int[1] { 1 };




        public void Set_ViewBag_UserInfo()
        {
            try
            {
                ViewBag.iSiteID = oSystem.rsGlobalVeriables.SiteID;
                ViewBag.User_UserName = oSystem.CurrentUser.UserView.User.sUserName;


                if (oSystem.CurrentUser.AuthenticatedUser == true)
                {
                    ViewBag.bLoggedIn = oSystem.CurrentUser.UserView.UserLoggedIn;
                    ViewBag.User_UserName = oSystem.CurrentUser.UserView.User.sUserName;
                    ViewBag.client_userid = oSystem.CurrentUser.UserView.User.ID;

                    ViewBag.client_username = oSystem.CurrentUser.UserView.User.sUserName;
                    ViewBag.client_firstname = oSystem.CurrentUser.UserView.User.sFName;
                    ViewBag.client_lastname = oSystem.CurrentUser.UserView.User.sLName;
                    ViewBag.client_userisloggedin = "true";

                    oSystem.SetValue_SiteDynamics("client_userisloggedin", "true");
                    oSystem.SetValue_SiteDynamics("client_useride", oSystem.CurrentUser.UserView.User.ID.ToString());
                    oSystem.SetValue_SiteDynamics("client_username", oSystem.CurrentUser.UserView.User.sUserName);
                    oSystem.SetValue_SiteDynamics("client_firstname", oSystem.CurrentUser.UserView.User.sFName);
                    oSystem.SetValue_SiteDynamics("client_lastname", oSystem.CurrentUser.UserView.User.sLName);

                    if (oSystem.CurrentUser.UserView.User.iPrimaryRole <= 1)
                    {
                        oSystem.SetValue_SiteDynamics("client_LogInUrl", HttpContext.Request.Url.Scheme + "://" + HttpContext.Request.Url.Authority + "/" + "admin");
                        ViewBag.client_LogInUrl = HttpContext.Request.Url.Scheme + "://" + HttpContext.Request.Url.Authority + "/" + "admin";
                    }
                    else
                    {
                        oSystem.SetValue_SiteDynamics("client_LogInUrl", HttpContext.Request.Url.Scheme + "://" + HttpContext.Request.Url.Authority + "/" + "portal");
                        ViewBag.client_LogInUrl = HttpContext.Request.Url.Scheme + "://" + HttpContext.Request.Url.Authority + "/" + "portal";
                    }
                }
                else
                {
                    ViewBag.bLoggedIn = false;

                    ViewBag.client_username = "Guest";
                    ViewBag.client_firstname = " ";
                    ViewBag.client_lastname = " ";
                    ViewBag.client_userisloggedin = "false";
                    ViewBag.client_userid = "0";

                    oSystem.SetValue_SiteDynamics("client_userisloggedin", "false");
                    oSystem.SetValue_SiteDynamics("client_useride", "0");
                    oSystem.SetValue_SiteDynamics("client_username", " ");
                    oSystem.SetValue_SiteDynamics("client_firstname", " ");
                    oSystem.SetValue_SiteDynamics("client_lastname", " ");
                    oSystem.SetValue_SiteDynamics("client_LogInUrl", HttpContext.Request.Url.Scheme + "://" + HttpContext.Request.Url.Authority + "/");
                    ViewBag.client_LogInUrl = HttpContext.Request.Url.Scheme + "://" + HttpContext.Request.Url.Authority + "/";

                }
                Set_CustomViewBag_UserInfo();
            }
            catch
            {
            }
        }
        public void Set_ViewBag_UserInfo_Defaults()
        {
            try
            {
                ViewBag.bLoggedIn = false;

                ViewBag.client_username = "Guest";
                ViewBag.client_firstname = " ";
                ViewBag.client_lastname = " ";
                ViewBag.client_userisloggedin = "false";
                ViewBag.client_userid = "0";

                oSystem.SetValue_SiteDynamics("client_userisloggedin", "false");
                oSystem.SetValue_SiteDynamics("client_useride", "0");
                oSystem.SetValue_SiteDynamics("client_username", " ");
                oSystem.SetValue_SiteDynamics("client_firstname", " ");
                oSystem.SetValue_SiteDynamics("client_lastname", " ");
                oSystem.SetValue_SiteDynamics("client_LogInUrl", HttpContext.Request.Url.Scheme + "://" + HttpContext.Request.Url.Authority + "/");
                ViewBag.client_LogInUrl = HttpContext.Request.Url.Scheme + "://" + HttpContext.Request.Url.Authority + "/";

                Set_CustomViewBag_UserInfo_Defaults();
            }
            catch
            {
            }
        }

        public void Set_ViewBag_Global()
        {
            try
            {
                ViewBag.iSiteID = oSystem.rsGlobalVeriables.SiteID;
                ViewBag.sPageViewsByMonth = "0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0";
                ViewBag.sPagesViewedByMonth = "";

                ViewBag.sSiteVisits = "0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0";
                ViewBag.MasterLayout = oSystem.rsGlobalVeriables.MasterDefaultLayout;

                Set_CustomViewBag_Global();
            }
            catch
            {
            }
        }
        public void Set_ViewBag_Global_Defaults()
        {
            try
            {
                ViewBag.iSiteID = oSystem.rsGlobalVeriables.SiteID;
                ViewBag.sPageViewsByMonth = "0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0";
                ViewBag.sPagesViewedByMonth = "";

                ViewBag.sSiteVisits = "0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0";
                ViewBag.MasterLayout = oSystem.rsGlobalVeriables.MasterDefaultLayout;

                Set_CustomViewBag_Global_Defaults();
            }
            catch
            {
            }
        }


        public void Set_Client_NavSettings(string _Function)
        {
            try
            {
                string sPanel_Dashboard = "0";
                string sPanel_ContentManagement = "1";
                string sPanel_Reports = "2";
                string sPanel_Blogging = "3";
                string sPanel_Appearance = "4";
                string sPanel_SystemManagement = "5";
                string sPanel_Community = "6";
                string sPanel_SalesMarketing = "7";
                string sPanel_JobBoard = "8";


                if (!String.IsNullOrEmpty(_Function))
                {
                    switch (_Function)
                    {
                        #region defaul nav
                        case "Index":
                            Session["_NavNodeIndex"] = sPanel_Dashboard;
                            ViewBag.iActiveNode = sPanel_Dashboard;
                            break;
                        case "AdminTestRegistration":
                            Session["_NavNodeIndex"] = sPanel_Dashboard;
                            ViewBag.iActiveNode = sPanel_Dashboard;
                            break;
                        case "UserLogIn":
                            Session["_NavNodeIndex"] = sPanel_Dashboard;
                            ViewBag.iActiveNode = sPanel_Dashboard;
                            break;
                        case "UserLogOff":
                            Session["_NavNodeIndex"] = sPanel_Dashboard;
                            ViewBag.iActiveNode = sPanel_Dashboard;
                            break;
                        case "EditMyProfile":
                            Session["_NavNodeIndex"] = sPanel_Dashboard;
                            ViewBag.iActiveNode = sPanel_Dashboard;
                            break;
                        case "ProfileUpdate":
                            Session["_NavNodeIndex"] = sPanel_Dashboard;
                            ViewBag.iActiveNode = sPanel_Dashboard;
                            break;
                        case "FilesManager_ListPop":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "FilesManager_List":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "UploadFiles":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "GetDirectoryFilesView":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "Countries_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Countries_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Countries_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Countries_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Countries_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "CountryLanguages_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "CountryLanguages_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "CountryLanguages_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "CountryLanguages_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "CountryLanguages_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Roles_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Roles_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Roles_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Roles_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Roles_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "States_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "States_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "States_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "States_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "States_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "SystemMaster_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "SystemMaster_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "SystemMaster_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "SystemMaster_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "SystemMaster_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "SystemModules_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "SystemModules_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "SystemModules_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "SystemModules_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "SystemModules_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "UserRoles_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "UserRoles_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "UserRoles_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "UserRoles_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "UserRoles_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Users_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Users_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Users_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Users_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Users_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "UsersAltAuth_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "UsersAltAuth_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "UsersAltAuth_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "UsersAltAuth_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "UsersAltAuth_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "UsersProperties_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "UsersProperties_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "UsersProperties_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "UsersProperties_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "UsersProperties_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteAlbums":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteAlbumContent":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSite_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSite_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSite_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSite_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSite_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteBlog_List":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlog_Details":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlog_Create":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlog_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlog_Delete":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogComments_List":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogComments_Details":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogComments_Create":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogComments_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogComments_Delete":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogCommentsProperties_List":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogCommentsProperties_Details":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogCommentsProperties_Create":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogCommentsProperties_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogCommentsProperties_Delete":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogEntry_List":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogEntry_Details":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogEntry_Create":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogEntry_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogEntry_Delete":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogEntryProperties_List":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogEntryProperties_Details":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogEntryProperties_Create":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogEntryProperties_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogEntryProperties_Delete":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogProperties_List":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogProperties_Details":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogProperties_Create":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogProperties_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogProperties_Delete":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteEvents_List":
                            Session["_NavNodeIndex"] = sPanel_Reports;
                            ViewBag.iActiveNode = sPanel_Reports;
                            break;
                        case "WebSiteEvents_Details":
                            Session["_NavNodeIndex"] = sPanel_Reports;
                            ViewBag.iActiveNode = sPanel_Reports;
                            break;
                        case "WebSiteEvents_Create":
                            Session["_NavNodeIndex"] = sPanel_Reports;
                            ViewBag.iActiveNode = sPanel_Reports;
                            break;
                        case "WebSiteEvents_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Reports;
                            ViewBag.iActiveNode = sPanel_Reports;
                            break;
                        case "WebSiteEvents_Delete":
                            Session["_NavNodeIndex"] = sPanel_Reports;
                            ViewBag.iActiveNode = sPanel_Reports;
                            break;
                        case "WebSiteExtAppIntegrationSettings_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteExtAppIntegrationSettings_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteExtAppIntegrationSettings_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteExtAppIntegrationSettings_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteExtAppIntegrationSettings_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteModules_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteModules_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteModules_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteModules_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteModules_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteNavigation_List":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteNavigation_Details":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteNavigation_Create":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteNavigation_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteNavigation_Delete":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePage_List":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePage_Details":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePage_Create":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePage_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePage_Delete":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageProperties_List":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageProperties_Details":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageProperties_Create":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageProperties_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageProperties_Delete":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageRoles_List":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageRoles_Details":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageRoles_Create":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageRoles_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageRoles_Delete":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageTemplates_List":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplates_Details":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplates_Create":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplates_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplates_Delete":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplatesPage_List":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplatesPage_Details":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplatesPage_Create":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplatesPage_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplatesPage_Delete":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplateZones_List":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplateZones_Details":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplateZones_Create":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplateZones_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplateZones_Delete":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageZoneContent_List":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageZoneContent_Details":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageZoneContent_Create":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageZoneContent_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageZoneContent_Delete":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteProperties_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteProperties_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteProperties_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteProperties_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteProperties_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteScreenRoles_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteScreenRoles_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteScreenRoles_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteScreenRoles_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteScreenRoles_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteScreen_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteScreen_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteScreen_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteScreen_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteScreen_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteRole_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteRole_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteRole_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteRole_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteRole_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteNavigationRoles_List":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteNavigationRoles_Details":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteNavigationRoles_Create":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteNavigationRoles_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteNavigationRoles_Delete":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteBlogRoles_List":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogRoles_Details":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogRoles_Create":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogRoles_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogRoles_Delete":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogEntryRole_List":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogEntryRole_Details":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogEntryRole_Create":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogEntryRole_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSiteBlogEntryRole_Delete":
                            Session["_NavNodeIndex"] = sPanel_Blogging;
                            ViewBag.iActiveNode = sPanel_Blogging;
                            break;
                        case "WebSitePageZone_List":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageZone_Details":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageZone_Create":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageZone_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageZone_Delete":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageTemplateZonesContent_List":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplateZonesContent_Details":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplateZonesContent_Create":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplateZonesContent_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "WebSitePageTemplateZonesContent_Delete":
                            Session["_NavNodeIndex"] = sPanel_Appearance;
                            ViewBag.iActiveNode = sPanel_Appearance;
                            break;
                        case "Roles_Access_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Roles_Access_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Roles_Access_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Roles_Access_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "Roles_Access_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteIPFilters_List":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteIPFilters_Details":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteIPFilters_Create":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteIPFilters_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteIPFilters_Delete":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "ReportOverview":
                            Session["_NavNodeIndex"] = sPanel_Reports;
                            ViewBag.iActiveNode = sPanel_Reports;
                            break;
                        case "ReportRefferalURLs":
                            Session["_NavNodeIndex"] = sPanel_Reports;
                            ViewBag.iActiveNode = sPanel_Reports;
                            break;
                        case "ReportRptSiteVisitors":
                            Session["_NavNodeIndex"] = sPanel_Reports;
                            ViewBag.iActiveNode = sPanel_Reports;
                            break;
                        case "ReportRptHitStatistics":
                            Session["_NavNodeIndex"] = sPanel_Reports;
                            ViewBag.iActiveNode = sPanel_Reports;
                            break;
                        case "WebSiteAnnouncements":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteAnnouncements_List":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteAnnouncements_Details":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteAnnouncements_Create":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteAnnouncements_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteAnnouncements_Delete":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteForum":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForum_List":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForum_Details":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForum_Create":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForum_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForum_Delete":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumiAnnouncements":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumiAnnouncements_List":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumiAnnouncements_Details":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumiAnnouncements_Create":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumiAnnouncements_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumiAnnouncements_Delete":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopiAnnouncements":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopiAnnouncements_List":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopiAnnouncements_Details":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopiAnnouncements_Create":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopiAnnouncements_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopiAnnouncements_Delete":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicEvents":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicEvents_List":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicEvents_Details":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicEvents_Create":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicEvents_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicEvents_Delete":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicPosts":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicPosts_List":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicPosts_Details":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicPosts_Create":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicPosts_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicPosts_Delete":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicPostsResponses":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicPostsResponses_List":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicPostsResponses_Details":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicPostsResponses_Create":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicPostsResponses_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopicPostsResponses_Delete":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopics":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopics_List":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopics_Details":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopics_Create":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopics_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSiteForumTopics_Delete":
                            Session["_NavNodeIndex"] = sPanel_Community;
                            ViewBag.iActiveNode = sPanel_Community;
                            break;
                        case "WebSite_Leads":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSite_Leads_List":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSite_Leads_Details":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSite_Leads_Create":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSite_Leads_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSite_Leads_Delete":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteAdvertisementGroup":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteAdvertisementGroup_List":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteAdvertisementGroup_Details":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteAdvertisementGroup_Create":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteAdvertisementGroup_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteAdvertisementGroup_Delete":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteAdGroupAds":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteAdGroupAds_List":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteAdGroupAds_Details":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteAdGroupAds_Create":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteAdGroupAds_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteAdGroupAds_Delete":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSitePageComments":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageComments_List":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageComments_Details":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageComments_Create":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageComments_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageComments_Delete":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageiAnnouncements":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageiAnnouncements_List":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageiAnnouncements_Details":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageiAnnouncements_Create":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageiAnnouncements_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageiAnnouncements_Delete":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteJobApplicant":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobApplicant_List":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobApplicant_Details":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobApplicant_Create":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobApplicant_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobApplicant_Delete":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobEvents":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobEvents_List":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobEvents_Details":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobEvents_Create":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobEvents_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobEvents_Delete":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobs":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobs_List":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobs_Details":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobs_Create":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobs_AddUpdate":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSiteJobs_Delete":
                            Session["_NavNodeIndex"] = sPanel_JobBoard;
                            ViewBag.iActiveNode = sPanel_JobBoard;
                            break;
                        case "WebSitePage_History":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageTemplatesPage_History":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSitePageTemplateZones_History":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSitePageZoneContent_History":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteEventCalendar":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteEventCalendarPictures":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteEventCalendarSponsors":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSiteEventCalendarUsers":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageZone_History":
                            Session["_NavNodeIndex"] = sPanel_ContentManagement;
                            ViewBag.iActiveNode = sPanel_ContentManagement;
                            break;
                        case "WebSitePageTemplateZonesContent_History":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSite_Messaging":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSite_Messaging_History":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteMemberShips":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteSponsors":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteSponsorShipTypes":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteMemberCats":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteMembers":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteMemberShipsCategories":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSitePartners":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSitePartnerTypes":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteAffiliates":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteAffiliateTypes":
                            Session["_NavNodeIndex"] = sPanel_SystemManagement;
                            ViewBag.iActiveNode = sPanel_SystemManagement;
                            break;
                        case "WebSiteEMailCampaign":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteEMailCampaignMembers":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteEMailCampaignMessage":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebSiteEMailCampaignLists":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebMarketingLists":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "WebMarketingListsMembers":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "ProcessPaymentPost":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        case "PaymentProcessing":
                            Session["_NavNodeIndex"] = sPanel_SalesMarketing;
                            ViewBag.iActiveNode = sPanel_SalesMarketing;
                            break;
                        #endregion
                        default:
                            Session["_NavNodeIndex"] = sPanel_Dashboard;
                            ViewBag.iActiveNode = sPanel_Dashboard;
                            break;
                    }

                    Set_CustomClient_NavSettings(_Function);
                }
            }
            catch
            {

            }
        }


        public ActionResult Index()
        {
            Set_Client_NavSettings("Index");
            Set_ViewBag_UserInfo_Defaults();
            Set_ViewBag_Global_Defaults();

            oSystem.OpenDataConnection();
            if (oSystem.IsIPAllowed_ByConfig(oSystem.VisitorHTTPValues.VisitorIPAddress()))
            {
                if (oSystem.GetCurrentUser())
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView.UserLoggedIn == true)
                        {
                            if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                            {
                                Set_ViewBag_UserInfo();
                                oPage.DataModelsPrimary = oSystem;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = "~/Modules/CMSAdmin/Views/Dashboard/AdminDashboard.cshtml";
                            }
                            else
                            {
                                ACMSDBView.UserAuthentication oUserAuth = new ACMSDBView.UserAuthentication();
                                oPage.DataModelsPrimary = oUserAuth;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = false;
                                oPage.PartialViewToLoad = "~/Modules/CMSAdmin/Views/Authentication/UserLogIn.cshtml";
                            }
                        }
                        else
                        {
                            ACMSDBView.UserAuthentication oUserAuth = new ACMSDBView.UserAuthentication();
                            oPage.DataModelsPrimary = oUserAuth;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = false;
                            oPage.PartialViewToLoad = "~/Modules/CMSAdmin/Views/Authentication/UserLogIn.cshtml";
                        }
                    }
                    else
                    {
                        ACMSDBView.UserAuthentication oUserAuth = new ACMSDBView.UserAuthentication();
                        oPage.DataModelsPrimary = oUserAuth;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = false;
                        oPage.PartialViewToLoad = "~/Modules/CMSAdmin/Views/Authentication/UserLogIn.cshtml";
                    }
                }
                else
                {
                    ACMSDBView.UserAuthentication oUserAuth = new ACMSDBView.UserAuthentication();
                    oPage.DataModelsPrimary = oUserAuth;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = false;
                    oPage.PartialViewToLoad = "~/Modules/CMSAdmin/Views/Authentication/UserLogIn.cshtml";
                }
                oSystem.CloseDataConnection();//Forms
            }
            else
            {
                oSystem.CloseDataConnection();
                return Redirect("~/");
            }
            return View(sModuleBase + sBasePage, oPage);
        }


        [HttpPost]
        public ActionResult UserLogIn(ACMSDBView.UserAuthentication oUserAuth)
        {
            Set_Client_NavSettings("UserLogIn");
            Set_ViewBag_UserInfo_Defaults();
            Set_ViewBag_Global_Defaults();
            if (oUserAuth != null)
            {
                if (!String.IsNullOrEmpty(oUserAuth.UserName))
                {
                    if (!String.IsNullOrEmpty(oUserAuth.Password))
                    {
                        oSystem.OpenDataConnection();

                        if (oSystem.IsIPAllowed_ByConfig(oSystem.VisitorHTTPValues.VisitorIPAddress()))
                        {
                            if (oSystem.cnCon.ConnectionStatus == ConnectionStatusTypes.Open)
                            {
                                oSystem.CurrentUser = new ACMSUser.UserSecurity(oSystem.cnCon);
                                if (oSystem.CurrentUser.LogIn(oUserAuth, oSystem.rsGlobalVeriables))
                                {
                                    if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                                    {
                                        if (oUserAuth.SaveLogIn)
                                        {
                                            oSystem.SaveLogIn();
                                        }
                                        oSystem.SetCurrentUser();
                                        oSystem.SetUserLoggedIn();
                                        oUserAuth.AccessGranted = true;

                                        Set_ViewBag_Global();
                                        Set_ViewBag_UserInfo();
                                        oSystem.SetUserLoggedIn();

                                        oPage.DataModelsPrimary = oSystem;
                                        oPage.DataModelsSub.Add(oSystem);
                                        oPage.AuthenticatedUser = true;
                                        oPage.PartialViewToLoad = "~/Modules/CMSAdmin/Views/Dashboard/AdminDashboard.cshtml";

                                    }
                                    else
                                    {
                                        ViewBag.sResponseMessage = "Sorry you don't have access to this area, please contact your administrator for help!";
                                        oPage.DataModelsPrimary = oUserAuth;
                                        oPage.DataModelsSub.Add(oSystem);
                                        oPage.AuthenticatedUser = true;
                                        ViewBag.bLoginError = true;
                                        oPage.PartialViewToLoad = "~/Modules/CMSAdmin/Views/Authentication/UserLogIn.cshtml";
                                    }
                                }
                                else
                                {
                                    ViewBag.sResponseMessage = "Sorry I could not match your credentials!";
                                    oPage.DataModelsPrimary = oUserAuth;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    ViewBag.bLoginError = true;
                                    oPage.PartialViewToLoad = "~/Modules/CMSAdmin/Views/Authentication/UserLogIn.cshtml";
                                }

                                oSystem.CloseDataConnection();
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                RedirectToAction("ErrorPage");
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return Redirect("~/");
                        }
                    }
                    else
                    {
                        ViewBag.sPassword = "Invalid password!";
                        oPage.DataModelsPrimary = oUserAuth;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        ViewBag.bLoginError = true;
                        oPage.PartialViewToLoad = "~/Modules/CMSAdmin/Views/Authentication/UserLogIn.cshtml";
                    }
                }
                else
                {
                    ViewBag.sUserName = "Invalid user name!";
                    oPage.DataModelsPrimary = oUserAuth;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    ViewBag.bLoginError = true;
                    oPage.PartialViewToLoad = "~/Modules/CMSAdmin/Views/Authentication/UserLogIn.cshtml";
                }
            }
            else
            {
                ViewBag.sResponseMessage = "Please enter a valid user name and password!";
                oPage.DataModelsPrimary = oUserAuth;
                oPage.DataModelsSub.Add(oSystem);
                oPage.AuthenticatedUser = true;
                ViewBag.bLoginError = true;
                oPage.PartialViewToLoad = "~/Modules/CMSAdmin/Views/Authentication/UserLogIn.cshtml";
            }

            oSystem.CloseDataConnection();

            return View(sModuleBase + sBasePage, oPage);
        }

        public ActionResult UserLogOff()
        {
            Set_Client_NavSettings("UserLogOff");

            oSystem.OpenDataConnection();
            Set_ViewBag_UserInfo_Defaults();
            Set_ViewBag_Global_Defaults();

            oSystem.GetCurrentUser();
            oSystem.UserLoggOff();

            //Session["_iUserID"] = "";
            //Session["_sUserAccessKey"] = "";

            oSystem.CurrentUser = null;

            oSystem.CloseDataConnection();

            ACMSDBView.UserAuthentication oUserAuth = new UserAuthentication();
            oPage.DataModelsPrimary = oUserAuth;
            oPage.DataModelsSub.Add(oSystem);
            oPage.AuthenticatedUser = true;
            oPage.PartialViewToLoad = sModuleBase + "/Views/Authentication/UserLogIn.cshtml";
            oSystem.CloseDataConnection();//Forms
            return View(sModuleBase + sBasePage, oPage);

        }

        public ActionResult EditMyProfile()
        {
            Set_Client_NavSettings("EditMyProfile");
            //string sView = Request.UrlReferrer.ToString();
            oSystem.OpenDataConnection();
            Set_ViewBag_UserInfo_Defaults();
            Set_ViewBag_Global_Defaults();

            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CurrentUser != null)
                {
                    Set_ViewBag_UserInfo();

                    if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                    {
                        Set_ViewBag_UserInfo();
                        Set_ViewBag_Global();

                        ACMSDBView.UserViewModel recRecord = new UserViewModel(oSystem.cnCon);
                        recRecord.User = oSystem.CurrentUser.UserView.User;
                        recRecord.CurrentPassword = oSystem.CurrentUser.UserView.User.sPassword;

                        recRecord.GetUserProperties(oSystem.cnCon, oSystem.CurrentUser.UserView.User.ID);
                        recRecord.Get_Roles(oSystem.cnCon);
                        recRecord.Get_States(oSystem.cnCon);
                        recRecord.Get_WebSiteMemberShips(oSystem.cnCon);

                        ViewBag.iParentID = recRecord.User.iParentID;
                        ViewBag.sParentID = recRecord.User.sParentID;

                        oSystem.CloseDataConnection();

                        oPage.DataModelsPrimary = recRecord;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                        oSystem.CloseDataConnection();//Forms
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        ACMSDBView.UserAuthentication oUserAuth = new UserAuthentication();
                        oPage.DataModelsPrimary = oUserAuth;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                        oSystem.CloseDataConnection();//Forms
                        return View(sModuleBase + sBasePage, oPage);
                    }
                }
                else
                {
                    ACMSDBView.UserAuthentication oUserAuth = new UserAuthentication();
                    oPage.DataModelsPrimary = oUserAuth;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                    oSystem.CloseDataConnection();//Forms
                    return View(sModuleBase + sBasePage, oPage);
                }
            }
            else
            {
                ACMSDBView.UserAuthentication oUserAuth = new UserAuthentication();
                oPage.DataModelsPrimary = oUserAuth;
                oPage.DataModelsSub.Add(oSystem);
                oPage.AuthenticatedUser = true;
                oPage.PartialViewToLoad = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                oSystem.CloseDataConnection();//Forms
                return View(sModuleBase + sBasePage, oPage);
            }

        }

        [HttpPost]
        public ActionResult ProfileUpdate(FormCollection fc, HttpPostedFileBase UploadFiles1, ACMSDBView.UserViewModel _rec)
        {
            Set_Client_NavSettings("ProfileUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            string sFileUploadResults = "";

            bool bFileUploadError1 = false;

            string sImageURL1 = "";
            string sPrefix = "";
            if (oSystem.GetCurrentUser())
            {
                ViewBag.iSiteID = oSystem.rsGlobalVeriables.SiteID;

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();

                    string sLocalDefaultView = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.User.iParentID;
                            ViewBag.sParentID = _rec.User.sParentID;

                            if (_rec.User.ID > 0)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                #region Upload file - Image Thumbnail
                                try
                                {
                                    if (UploadFiles1 != null)
                                    {
                                        if (UploadFiles1.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                            {
                                                string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    sImageURL1 = "Uploads/" + UploadFiles1.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                    _rec.User.sAvitarImgURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                    _rec.User.sAvitarImgURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                    bFileUploadError1 = false;
                                }
                                #endregion


                                if (String.IsNullOrEmpty(_rec.User.sPassword))
                                {
                                    _rec.User.sPassword = _rec.CurrentPassword;
                                }
                                else
                                {
                                    _rec.User.sPassword = oSystem.rsGlobalVeriables.oEncryption.Encrypt(_rec.User.sPassword);
                                    _rec.CurrentPassword = _rec.User.sPassword;
                                }

                                DINT_Users dbInteraction = new DINT_Users(oSystem.cnCon);

                                _rec.User.dtLastUpdated = DateTime.Now;

                                dbInteraction.Update_SQL(_rec.User);

                                _rec.Get_Roles(oSystem.cnCon);
                                _rec.Get_States(oSystem.cnCon);

                                oSystem.CloseDataConnection();
                                #endregion

                                oPage.DataModelsPrimary = _rec;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;

                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                ViewBag.bError = true;
                                ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";


                                oPage.DataModelsPrimary = _rec;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();//Forms
                                return View(sModuleBase + sBasePage, oPage);
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();//Forms

                            return View(sModuleBase + sBasePage, oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();//Forms
                        return View(sModuleBase + sBasePage, oPage);
                    }
                }
                else
                {
                    oSystem.CloseDataConnection();//Forms
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();//Forms
                return RedirectToAction("Index");
            }
        }



        string sPaymentProcessingScreen = "/Views/Forms/PaymentProcessing.cshtml";
        public ActionResult PaymentProcessing()
        {
            Set_Client_NavSettings("PaymentProcessing");
            //string sView = Request.UrlReferrer.ToString();
            oSystem.OpenDataConnection();
            Set_ViewBag_UserInfo_Defaults();
            Set_ViewBag_Global_Defaults();
            ViewBag.bGoodCharge = false;
            ViewBag.bError = false;

            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CurrentUser != null)
                {
                    Set_ViewBag_UserInfo();

                    if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                    {
                        Set_ViewBag_UserInfo();
                        Set_ViewBag_Global();

                        AriesCMS.Models.UserBillingInfo oNewCharge = new Models.UserBillingInfo();
                        oNewCharge.AddressInfo = new Models.UserAddressInfo();

                        oNewCharge.Build_ExpMonth();
                        oNewCharge.Build_ExpYear();

                        oSystem.CurrentUser.UserView.Get_States(oSystem.cnCon);
                        oNewCharge.AddressInfo.States = oSystem.CurrentUser.UserView.States;

                        oSystem.CurrentUser.UserView.Get_Countries(oSystem.cnCon);
                        oNewCharge.AddressInfo.Countries = oSystem.CurrentUser.UserView.Countries;


                        oPage.DataModelsPrimary = oNewCharge;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = sModuleBase + sPaymentProcessingScreen;
                        oSystem.CloseDataConnection();//Forms
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return Redirect("~/admin/home");
                    }
                }
                else
                {
                    oSystem.CloseDataConnection();
                    return Redirect("~/admin/home");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return Redirect("~/admin/home");
            }

        }

        [HttpPost]
        public ActionResult ProcessPaymentPost(FormCollection fc, AriesCMS.Models.UserBillingInfo oRec)
        {
            Set_Client_NavSettings("ProcessPaymentPost");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            ViewBag.bGoodCharge = false;
            ViewBag.bError = false;


            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            string sFileUploadResults = "";

            bool bFileUploadError1 = false;

            string sImageURL1 = "";
            string sPrefix = "";
            if (oSystem.GetCurrentUser())
            {
                ViewBag.iSiteID = oSystem.rsGlobalVeriables.SiteID;

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();

                    //Validate and process charge here

                    #region Peform credt card processing
                    AriesCMS.Models.ChargeRecord oChargeObject = new Models.ChargeRecord();

                    oChargeObject.FirstName = oRec.FirstName;
                    oChargeObject.LastName = oRec.LastName;
                    oChargeObject.EMail = oRec.EMail;
                    oChargeObject.PhoneNumber = oRec.Phone;

                    oChargeObject.PaymentID = "1";
                    oChargeObject.CardNumber = oRec.CreditCardNumber;
                    oChargeObject.CardNumberMask = "";
                    oChargeObject.CVV = oRec.CreditCardCVV;
                    oChargeObject.Tax = "0.00";
                    oChargeObject.Subtotal = "0.00";
                    //oChargeObject.Subtotal = oSystem.rec_WebSiteMemberShips.dCost.ToString();
                    oChargeObject.ShippingCharge = "0.00";
                    oChargeObject.ChargeAmount = oRec.ChargeAmount.ToString("#.00");
                    oChargeObject.ChargeDescription = "Test Charge";
                    oChargeObject.CardType = "";
                    oChargeObject.ExpirationDate = oRec.CreditCardExpDateMonth + "/20/" + oRec.CreditCardExpDateYear;
                    oChargeObject.Month = oRec.CreditCardExpDateMonth;
                    oChargeObject.Year = oRec.CreditCardExpDateYear;

                    oChargeObject.ClientIPAddress = oSystem.VisitorHTTPValues.VisitorIPAddress();

                    oChargeObject.Address = oRec.AddressInfo.AddressLine1;
                    oChargeObject.City = oRec.AddressInfo.City;
                    oChargeObject.State = oRec.AddressInfo.State;
                    oChargeObject.Country = "USA";
                    oChargeObject.PostalCode = oRec.AddressInfo.PostalCode;

                    oChargeObject.IsCMSForm = "";
                    oChargeObject.ChargeResponse = "";
                    oChargeObject.SourceForm = "";
                    oChargeObject.SuccessPageURL = "";

                    // Good record creating now process credit card to enable account
                    AriesCMS.Helpers.CreditCardProcessing.PayPalProcess oCCProcessing = new Helpers.CreditCardProcessing.PayPalProcess(oSystem._sClientID, oSystem._sClientSecret, oSystem._sClientPassword);

                    bool bChargeResults = false;
                    string sChargeResults = "";

                    string _EventSubject = "Test Transaction";
                    string _EventLog = "Test Transaction";
                    int _iSiteID = 1;
                    string _sSiteID = "Default";
                    int _iTypeID = 3;
                    string _sTypeID = "Event Log";
                    string _Notes = "Test Transaction";
                    string _UserCookieID = oSystem.UserCookie.CookieID.ToString();
                    string _UserIP = oSystem.VisitorHTTPValues.VisitorIPAddress();

                    oSystem.LogUserSiteActivity(_EventSubject, _EventLog, _iSiteID, _sSiteID, _iTypeID, _sTypeID, _Notes, _UserCookieID, _UserIP);

                    try
                    {
                        bChargeResults = oCCProcessing.Authorize2(ref oChargeObject);
                    }
                    catch (Exception ssq)
                    {
                        sChargeResults += " " + ssq.ToString();
                    }
                    sChargeResults += oChargeObject.ChargeResponse;


                    _EventSubject = "Test Transaction";
                    _EventLog = "Test Transaction " + " result was Charge: " + bChargeResults + " response message from merchant bank was: " + sChargeResults;
                    _iSiteID = 1;
                    _sSiteID = "Default";
                    _iTypeID = 3;
                    _sTypeID = "Event Log";
                    _Notes = "Test Transaction " + " result was Charge: " + bChargeResults + " response message from merchant bank was: " + sChargeResults;
                    _UserCookieID = oSystem.UserCookie.CookieID.ToString();
                    _UserIP = oSystem.VisitorHTTPValues.VisitorIPAddress();

                    oSystem.LogUserSiteActivity(_EventSubject, _EventLog, _iSiteID, _sSiteID, _iTypeID, _sTypeID, _Notes, _UserCookieID, _UserIP);


                    if (bChargeResults)
                    {

                        ViewBag.bGoodCharge = true;
                        ViewBag.bError = false;


                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.bGoodCharge = false;
                        ViewBag.ErrorMessage = "Your pruchase failed! " + "Your credit card was declined.  Here is the message we got from the bank: " + sChargeResults;

                    }
                    #endregion


                    oRec.Build_ExpMonth();
                    oRec.Build_ExpYear();

                    oSystem.CurrentUser.UserView.Get_States(oSystem.cnCon);
                    oRec.AddressInfo.States = oSystem.CurrentUser.UserView.States;

                    oSystem.CurrentUser.UserView.Get_Countries(oSystem.cnCon);
                    oRec.AddressInfo.Countries = oSystem.CurrentUser.UserView.Countries;


                    oPage.DataModelsPrimary = oRec;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = sModuleBase + sPaymentProcessingScreen;
                    oSystem.CloseDataConnection();//Forms
                    return View(sModuleBase + sBasePage, oPage);
                }
                else
                {
                    oSystem.CloseDataConnection();//Forms
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();//Forms
                return RedirectToAction("Index");
            }
        }








        [HttpPost]
        [ValidateInput(false)]
        public JsonResult UpdateContent(string _ContentID, string _Content)
        {
            string sBaseULR = HttpContext.Request.Url.Scheme + "://" + HttpContext.Request.Url.Authority + "/";
            string sCurrentURL = HttpContext.Request.UrlReferrer.OriginalString.ToString();
            var oResponse = Json(new { RESPONSE = "ERROR" });
            try
            {
                if (!String.IsNullOrEmpty(_ContentID))
                {
                    if (!String.IsNullOrEmpty(_Content))
                    {
                        if (oSystem.GetCurrentUser())
                        {
                            string sNav = "";
                            sNav = HttpContext.Request.UrlReferrer.OriginalString.ToString();
                            sNav = sNav.Replace(sBaseULR, "");
                            if (String.IsNullOrEmpty(sNav))
                            {
                                sNav = "/";
                            }

                            _Content = _Content.Replace(sBaseULR, "~/");

                            ViewBag.iSiteID = oSystem.rsGlobalVeriables.SiteID;
                            int[] iAccessRolesAllowed = new int[3] { 1, 2, 3 };
                            if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                            {
                                #region Process Update
                                string[] sCommand = _ContentID.Split('-');
                                if (sCommand.Length > 1)
                                {
                                    int iRecID = System.Convert.ToInt32(sCommand[1]);
                                    if (iRecID > 0)
                                    {
                                        List<DataParameter> lstParameters = new List<DataParameter>();
                                        DataParameter pParameter = new DataParameter("ID", iRecID.ToString(), "int", 0, "ID", " = ", "");
                                        lstParameters.Add(pParameter);

                                        switch (sCommand[0])
                                        {
                                            case "c"://content
                                                #region WebSitePageZone
                                                DINT_WebSitePageZone dbWebSitePageZone = new DINT_WebSitePageZone(oSystem.cnCon);
                                                List<DEF_WebSitePageZone.RecordObject> dbSearch_WebSitePageZone;
                                                dbSearch_WebSitePageZone = dbWebSitePageZone.Get(lstParameters);
                                                if (dbSearch_WebSitePageZone != null)
                                                {
                                                    if (dbSearch_WebSitePageZone.Count > 0)
                                                    {
                                                        if (dbSearch_WebSitePageZone[0].ID == iRecID)
                                                        {
                                                            dbSearch_WebSitePageZone[0].iUpdatedByID = oSystem.CurrentUser.UserView.User.ID;
                                                            dbSearch_WebSitePageZone[0].sUpdatedByID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName;
                                                            dbSearch_WebSitePageZone[0].dtLastUpdated = DateTime.Now;
                                                            dbSearch_WebSitePageZone[0].sContent = _Content;

                                                            dbWebSitePageZone.Update_SQL(dbSearch_WebSitePageZone[0]);
                                                        }
                                                    }
                                                }
                                                #endregion
                                                break;
                                            case "tc"://template content
                                                #region WebSitePageTemplateZones
                                                DINT_WebSiteNavigation obj_WebSiteNavigation_tc = new DINT_WebSiteNavigation(oSystem.cnCon);
                                                List<DataParameter> lstParameters_tc = new List<DataParameter>();

                                                DataParameter pParameter_tc = new DataParameter("sNavigationIdentifyer", "'" + sNav + "'", "string", 13, "sNavigationIdentifyer", " = ", "");
                                                lstParameters_tc.Add(pParameter_tc);
                                                pParameter_tc = new DataParameter("bDisabled", "'" + "false" + "'", "bool", 23, "bDisabled", " = ", " AND ");
                                                lstParameters_tc.Add(pParameter_tc);

                                                List<DEF_WebSiteNavigation.RecordObject> lstNav = obj_WebSiteNavigation_tc.Get(lstParameters_tc);
                                                if (lstNav != null)
                                                {
                                                    if (lstNav.Count > 0)
                                                    {
                                                        #region
                                                        bool bContentFoundAndUpdated = false;
                                                        lstParameters_tc = new List<DataParameter>();
                                                        pParameter_tc = new DataParameter("iZoneID", "'" + iRecID.ToString() + "'", "int", 0, "iZoneID", " = ", "");
                                                        lstParameters_tc.Add(pParameter_tc);

                                                        pParameter_tc = new DataParameter("iParentID", "'" + lstNav[0].iPageID.ToString() + "'", "int", 0, "iParentID", " = ", " AND ");
                                                        lstParameters_tc.Add(pParameter_tc);

                                                        DINT_WebSitePageZone dbWebSitePageZone_tc = new DINT_WebSitePageZone(oSystem.cnCon);
                                                        List<DEF_WebSitePageZone.RecordObject> dbSearch_WebSitePageZone_tc;
                                                        dbSearch_WebSitePageZone_tc = dbWebSitePageZone_tc.Get(lstParameters_tc);
                                                        if (dbSearch_WebSitePageZone_tc != null)
                                                        {
                                                            if (dbSearch_WebSitePageZone_tc.Count > 0)
                                                            {
                                                                if (dbSearch_WebSitePageZone_tc[0].iZoneID == iRecID)
                                                                {
                                                                    #region
                                                                    bContentFoundAndUpdated = true;
                                                                    dbSearch_WebSitePageZone_tc[0].iUpdatedByID = oSystem.CurrentUser.UserView.User.ID;
                                                                    dbSearch_WebSitePageZone_tc[0].sUpdatedByID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName;
                                                                    dbSearch_WebSitePageZone_tc[0].dtLastUpdated = DateTime.Now;
                                                                    dbSearch_WebSitePageZone_tc[0].sContent = _Content;

                                                                    dbWebSitePageZone_tc.Update_SQL(dbSearch_WebSitePageZone_tc[0]);
                                                                    #endregion
                                                                }
                                                                else
                                                                {
                                                                    bContentFoundAndUpdated = false;
                                                                }
                                                            }
                                                        }

                                                        if (bContentFoundAndUpdated == false)
                                                        {
                                                            DINT_WebSitePageTemplateZones dbWebSitePageTemplateZones = new DINT_WebSitePageTemplateZones(oSystem.cnCon);
                                                            List<DEF_WebSitePageTemplateZones.RecordObject> dbSearch_WebSitePageTemplateZones;
                                                            dbSearch_WebSitePageTemplateZones = dbWebSitePageTemplateZones.Get(lstParameters);
                                                            if (dbSearch_WebSitePageTemplateZones != null)
                                                            {
                                                                if (dbSearch_WebSitePageTemplateZones.Count > 0)
                                                                {
                                                                    if (dbSearch_WebSitePageTemplateZones[0].ID == iRecID)
                                                                    {
                                                                        #region
                                                                        DEF_WebSitePageZone.RecordObject oNew_WebSitePageZone = new DEF_WebSitePageZone.RecordObject();
                                                                        oNew_WebSitePageZone.iParentID = lstNav[0].iPageID;
                                                                        oNew_WebSitePageZone.sParentID = lstNav[0].sPageID;
                                                                        oNew_WebSitePageZone.sControl = Guid.NewGuid().ToString();
                                                                        oNew_WebSitePageZone.dtDateCreated = DateTime.Now;
                                                                        oNew_WebSitePageZone.dtLastUpdated = DateTime.Now;
                                                                        oNew_WebSitePageZone.bLoadPartialPage = false;
                                                                        oNew_WebSitePageZone.iCreatedByID = oSystem.CurrentUser.UserView.User.ID;
                                                                        oNew_WebSitePageZone.sCreatedByID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName;
                                                                        oNew_WebSitePageZone.iUpdatedByID = oSystem.CurrentUser.UserView.User.ID;
                                                                        oNew_WebSitePageZone.sUpdatedByID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName;
                                                                        oNew_WebSitePageZone.sName = "";
                                                                        oNew_WebSitePageZone.iZoneID = dbSearch_WebSitePageTemplateZones[0].ID;
                                                                        oNew_WebSitePageZone.sZoneID = dbSearch_WebSitePageTemplateZones[0].sName;
                                                                        oNew_WebSitePageZone.sContent = _Content;

                                                                        dbWebSitePageZone_tc.Insert_SQL(oNew_WebSitePageZone);
                                                                        #endregion
                                                                    }
                                                                }
                                                            }
                                                        }
                                                        #endregion
                                                    }
                                                }
                                                #endregion
                                                break;
                                            case "zc"://zone content
                                                #region WebSitePageZoneContent
                                                DINT_WebSitePageZoneContent dbWebSitePageZoneContent = new DINT_WebSitePageZoneContent(oSystem.cnCon);
                                                List<DEF_WebSitePageZoneContent.RecordObject> dbSearch_WebSitePageZoneContent = dbWebSitePageZoneContent.Get(lstParameters);
                                                if (dbSearch_WebSitePageZoneContent != null)
                                                {
                                                    if (dbSearch_WebSitePageZoneContent.Count > 0)
                                                    {
                                                        if (dbSearch_WebSitePageZoneContent[0].ID == iRecID)
                                                        {
                                                            dbSearch_WebSitePageZoneContent[0].iUpdatedByID = oSystem.CurrentUser.UserView.User.ID;
                                                            dbSearch_WebSitePageZoneContent[0].sUpdatedByID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName;
                                                            dbSearch_WebSitePageZoneContent[0].dtLastUpdated = DateTime.Now;
                                                            dbSearch_WebSitePageZoneContent[0].sContent = _Content;

                                                            dbWebSitePageZoneContent.Update_SQL(dbSearch_WebSitePageZoneContent[0]);
                                                        }
                                                    }
                                                }
                                                #endregion
                                                break;
                                            case "tzc"://template zone content
                                                #region WebSitePageTemplateZonesContent                                                
                                                DINT_WebSiteNavigation obj_WebSiteNavigation_tzc = new DINT_WebSiteNavigation(oSystem.cnCon);
                                                List<DataParameter> lstParameters_tzc = new List<DataParameter>();

                                                DataParameter pParameter_tzc = new DataParameter("sNavigationIdentifyer", "'" + sNav + "'", "string", 13, "sNavigationIdentifyer", " = ", "");
                                                lstParameters_tzc.Add(pParameter_tzc);
                                                pParameter_tzc = new DataParameter("bDisabled", "'" + "false" + "'", "bool", 23, "bDisabled", " = ", " AND ");
                                                lstParameters_tzc.Add(pParameter_tzc);

                                                List<DEF_WebSiteNavigation.RecordObject> lstNav_tzc = obj_WebSiteNavigation_tzc.Get(lstParameters_tzc);
                                                if (lstNav_tzc != null)
                                                {
                                                    if (lstNav_tzc.Count > 0)
                                                    {
                                                        #region
                                                        bool bContentFoundAndUpdated = false;
                                                        lstParameters_tzc = new List<DataParameter>();
                                                        pParameter_tzc = new DataParameter("iContentZoneID", iRecID.ToString(), "int", 0, "iContentZoneID", " = ", "");
                                                        lstParameters_tzc.Add(pParameter);

                                                        pParameter_tzc = new DataParameter("iParentID", lstNav_tzc[0].iPageID.ToString(), "int", 0, "iParentID", " = ", " AND ");
                                                        lstParameters_tzc.Add(pParameter_tzc);

                                                        DINT_WebSitePageZoneContent dbWebSitePageZoneContent_tzc = new DINT_WebSitePageZoneContent(oSystem.cnCon);
                                                        List<DEF_WebSitePageZoneContent.RecordObject> dbSearch_WebSitePageZoneContent_tzc;
                                                        dbSearch_WebSitePageZoneContent_tzc = dbWebSitePageZoneContent_tzc.Get(lstParameters_tzc);
                                                        if (dbSearch_WebSitePageZoneContent_tzc != null)
                                                        {
                                                            if (dbSearch_WebSitePageZoneContent_tzc.Count > 0)
                                                            {
                                                                if (dbSearch_WebSitePageZoneContent_tzc[0].iContentZoneID == iRecID)
                                                                {
                                                                    #region
                                                                    bContentFoundAndUpdated = true;
                                                                    dbSearch_WebSitePageZoneContent_tzc[0].iUpdatedByID = oSystem.CurrentUser.UserView.User.ID;
                                                                    dbSearch_WebSitePageZoneContent_tzc[0].sUpdatedByID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName;
                                                                    dbSearch_WebSitePageZoneContent_tzc[0].dtLastUpdated = DateTime.Now;
                                                                    dbSearch_WebSitePageZoneContent_tzc[0].sContent = _Content;

                                                                    dbWebSitePageZoneContent_tzc.Update_SQL(dbSearch_WebSitePageZoneContent_tzc[0]);
                                                                    #endregion
                                                                }
                                                                else
                                                                {
                                                                    bContentFoundAndUpdated = false;
                                                                }
                                                            }
                                                        }

                                                        if (bContentFoundAndUpdated == false)
                                                        {
                                                            DINT_WebSitePageTemplateZonesContent dbWebSitePageTemplateZonesContent = new DINT_WebSitePageTemplateZonesContent(oSystem.cnCon);
                                                            List<DEF_WebSitePageTemplateZonesContent.RecordObject> dbSearch_WebSitePageTemplateZonesContent;
                                                            dbSearch_WebSitePageTemplateZonesContent = dbWebSitePageTemplateZonesContent.Get(lstParameters);
                                                            if (dbSearch_WebSitePageTemplateZonesContent != null)
                                                            {
                                                                if (dbSearch_WebSitePageTemplateZonesContent.Count > 0)
                                                                {
                                                                    if (dbSearch_WebSitePageTemplateZonesContent[0].ID == iRecID)
                                                                    {
                                                                        #region
                                                                        DEF_WebSitePageZoneContent.RecordObject oNew_WebSitePageZoneContent = new DEF_WebSitePageZoneContent.RecordObject();
                                                                        oNew_WebSitePageZoneContent.iParentID = lstNav_tzc[0].iPageID;
                                                                        oNew_WebSitePageZoneContent.sParentID = lstNav_tzc[0].sPageID;
                                                                        oNew_WebSitePageZoneContent.sControl = Guid.NewGuid().ToString();
                                                                        oNew_WebSitePageZoneContent.dtDateCreated = DateTime.Now;
                                                                        oNew_WebSitePageZoneContent.dtLastUpdated = DateTime.Now;
                                                                        oNew_WebSitePageZoneContent.bLoadPartialPage = false;
                                                                        oNew_WebSitePageZoneContent.iCreatedByID = oSystem.CurrentUser.UserView.User.ID;
                                                                        oNew_WebSitePageZoneContent.sCreatedByID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName;
                                                                        oNew_WebSitePageZoneContent.iUpdatedByID = oSystem.CurrentUser.UserView.User.ID;
                                                                        oNew_WebSitePageZoneContent.sUpdatedByID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName;
                                                                        oNew_WebSitePageZoneContent.sName = "";
                                                                        oNew_WebSitePageZoneContent.iZoneID = dbSearch_WebSitePageTemplateZonesContent[0].iContentZoneID;
                                                                        oNew_WebSitePageZoneContent.sZoneID = dbSearch_WebSitePageTemplateZonesContent[0].sContentZoneID;
                                                                        oNew_WebSitePageZoneContent.iContentZoneID = dbSearch_WebSitePageTemplateZonesContent[0].ID;
                                                                        oNew_WebSitePageZoneContent.sContentZoneID = dbSearch_WebSitePageTemplateZonesContent[0].sName;
                                                                        oNew_WebSitePageZoneContent.sContent = _Content;

                                                                        dbWebSitePageZoneContent_tzc.Insert_SQL(oNew_WebSitePageZoneContent);
                                                                        #endregion
                                                                    }
                                                                }
                                                            }
                                                        }
                                                        #endregion




                                                    }
                                                }
                                                #endregion
                                                break;
                                        }
                                        oResponse = Json(new { RESPONSE = "SUCCESS" });
                                    }
                                }
                                #endregion
                            }
                        }
                    }
                }
            }
            catch
            {

            }
            oSystem.CloseDataConnection();//Forms
            return oResponse;
        }


        [HttpPost]
        [ValidateInput(false)]
        public JsonResult UpdateTemplateContent(string _ContentID, string _Content)
        {
            string sBaseULR = HttpContext.Request.Url.Scheme + "://" + HttpContext.Request.Url.Authority + "/";
            string sCurrentURL = HttpContext.Request.UrlReferrer.OriginalString.ToString();
            var oResponse = Json(new { RESPONSE = "ERROR" });
            try
            {
                if (!String.IsNullOrEmpty(_ContentID))
                {
                    if (!String.IsNullOrEmpty(_Content))
                    {
                        if (oSystem.GetCurrentUser())
                        {

                            _Content = _Content.Replace(sBaseULR, "~/");

                            ViewBag.iSiteID = oSystem.rsGlobalVeriables.SiteID;
                            int[] iAccessRolesAllowed = new int[3] { 1, 2, 3 };
                            if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                            {
                                #region Process Update
                                string[] sCommand = _ContentID.Split('-');
                                if (sCommand.Length > 1)
                                {
                                    int iRecID = System.Convert.ToInt32(sCommand[1]);
                                    if (iRecID > 0)
                                    {
                                        List<DataParameter> lstParameters = new List<DataParameter>();
                                        DataParameter pParameter = new DataParameter("ID", iRecID.ToString(), "int", 0, "ID", " = ", "");
                                        lstParameters.Add(pParameter);

                                        switch (sCommand[0])
                                        {
                                            case "c"://content
                                                #region WebSitePageZone
                                                DINT_WebSitePageZone dbWebSitePageZone = new DINT_WebSitePageZone(oSystem.cnCon);
                                                List<DEF_WebSitePageZone.RecordObject> dbSearch_WebSitePageZone;
                                                dbSearch_WebSitePageZone = dbWebSitePageZone.Get(lstParameters);
                                                if (dbSearch_WebSitePageZone != null)
                                                {
                                                    if (dbSearch_WebSitePageZone.Count > 0)
                                                    {
                                                        if (dbSearch_WebSitePageZone[0].ID == iRecID)
                                                        {
                                                            #region WebSitePageTemplateZones
                                                            lstParameters = new List<DataParameter>();
                                                            pParameter = new DataParameter("ID", dbSearch_WebSitePageZone[0].iZoneID.ToString(), "int", 0, "ID", " = ", "");
                                                            lstParameters.Add(pParameter);

                                                            DINT_WebSitePageTemplateZones dbWebSitePageTemplateZones_c = new DINT_WebSitePageTemplateZones(oSystem.cnCon);
                                                            List<DEF_WebSitePageTemplateZones.RecordObject> dbSearch_WebSitePageTemplateZones_c;
                                                            dbSearch_WebSitePageTemplateZones_c = dbWebSitePageTemplateZones_c.Get(lstParameters);
                                                            if (dbSearch_WebSitePageTemplateZones_c != null)
                                                            {
                                                                if (dbSearch_WebSitePageTemplateZones_c.Count > 0)
                                                                {
                                                                    if (dbSearch_WebSitePageTemplateZones_c[0].ID == dbSearch_WebSitePageZone[0].iZoneID)
                                                                    {
                                                                        dbSearch_WebSitePageTemplateZones_c[0].iUpdatedByID = oSystem.CurrentUser.UserView.User.ID;
                                                                        dbSearch_WebSitePageTemplateZones_c[0].sUpdatedByID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName;
                                                                        dbSearch_WebSitePageTemplateZones_c[0].dtLastUpdated = DateTime.Now;
                                                                        dbSearch_WebSitePageTemplateZones_c[0].sDefaultValue = _Content;

                                                                        dbWebSitePageTemplateZones_c.Update_SQL(dbSearch_WebSitePageTemplateZones_c[0]);
                                                                    }
                                                                }
                                                            }
                                                            #endregion
                                                        }
                                                    }
                                                }
                                                #endregion
                                                break;
                                            case "tc"://template content
                                                #region WebSitePageTemplateZones
                                                DINT_WebSitePageTemplateZones dbWebSitePageTemplateZones = new DINT_WebSitePageTemplateZones(oSystem.cnCon);
                                                List<DEF_WebSitePageTemplateZones.RecordObject> dbSearch_WebSitePageTemplateZones;
                                                dbSearch_WebSitePageTemplateZones = dbWebSitePageTemplateZones.Get(lstParameters);
                                                if (dbSearch_WebSitePageTemplateZones != null)
                                                {
                                                    if (dbSearch_WebSitePageTemplateZones.Count > 0)
                                                    {
                                                        if (dbSearch_WebSitePageTemplateZones[0].ID == iRecID)
                                                        {
                                                            dbSearch_WebSitePageTemplateZones[0].iUpdatedByID = oSystem.CurrentUser.UserView.User.ID;
                                                            dbSearch_WebSitePageTemplateZones[0].sUpdatedByID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName;
                                                            dbSearch_WebSitePageTemplateZones[0].dtLastUpdated = DateTime.Now;
                                                            dbSearch_WebSitePageTemplateZones[0].sDefaultValue = _Content;

                                                            dbWebSitePageTemplateZones.Update_SQL(dbSearch_WebSitePageTemplateZones[0]);
                                                        }
                                                    }
                                                }
                                                #endregion
                                                break;
                                            case "zc"://zone content
                                                #region WebSitePageZoneContent
                                                DINT_WebSitePageZoneContent dbWebSitePageZoneContent = new DINT_WebSitePageZoneContent(oSystem.cnCon);
                                                List<DEF_WebSitePageZoneContent.RecordObject> dbSearch_WebSitePageZoneContent = dbWebSitePageZoneContent.Get(lstParameters);
                                                if (dbSearch_WebSitePageZoneContent != null)
                                                {
                                                    if (dbSearch_WebSitePageZoneContent.Count > 0)
                                                    {
                                                        if (dbSearch_WebSitePageZoneContent[0].ID == iRecID)
                                                        {
                                                            #region WebSitePageTemplateZonesContent
                                                            lstParameters = new List<DataParameter>();
                                                            pParameter = new DataParameter("ID", dbSearch_WebSitePageZoneContent[0].iContentZoneID.ToString(), "int", 0, "ID", " = ", "");
                                                            lstParameters.Add(pParameter);

                                                            DINT_WebSitePageTemplateZonesContent dbWebSitePageTemplateZonesContent_zc = new DINT_WebSitePageTemplateZonesContent(oSystem.cnCon);
                                                            List<DEF_WebSitePageTemplateZonesContent.RecordObject> dbSearch_WebSitePageTemplateZonesContent_zc;
                                                            dbSearch_WebSitePageTemplateZonesContent_zc = dbWebSitePageTemplateZonesContent_zc.Get(lstParameters);
                                                            if (dbSearch_WebSitePageTemplateZonesContent_zc != null)
                                                            {
                                                                if (dbSearch_WebSitePageTemplateZonesContent_zc.Count > 0)
                                                                {
                                                                    if (dbSearch_WebSitePageTemplateZonesContent_zc[0].ID == dbSearch_WebSitePageZoneContent[0].iContentZoneID)
                                                                    {
                                                                        dbSearch_WebSitePageTemplateZonesContent_zc[0].iUpdatedByID = oSystem.CurrentUser.UserView.User.ID;
                                                                        dbSearch_WebSitePageTemplateZonesContent_zc[0].sUpdatedByID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName;
                                                                        dbSearch_WebSitePageTemplateZonesContent_zc[0].dtLastUpdated = DateTime.Now;
                                                                        dbSearch_WebSitePageTemplateZonesContent_zc[0].sDefaultValue = _Content;

                                                                        dbWebSitePageTemplateZonesContent_zc.Update_SQL(dbSearch_WebSitePageTemplateZonesContent_zc[0]);
                                                                    }
                                                                }
                                                            }
                                                            #endregion
                                                        }
                                                    }
                                                }
                                                #endregion
                                                break;
                                            case "tzc"://template zone content
                                                #region WebSitePageTemplateZonesContent
                                                DINT_WebSitePageTemplateZonesContent dbWebSitePageTemplateZonesContent = new DINT_WebSitePageTemplateZonesContent(oSystem.cnCon);
                                                List<DEF_WebSitePageTemplateZonesContent.RecordObject> dbSearch_WebSitePageTemplateZonesContent;
                                                dbSearch_WebSitePageTemplateZonesContent = dbWebSitePageTemplateZonesContent.Get(lstParameters);
                                                if (dbSearch_WebSitePageTemplateZonesContent != null)
                                                {
                                                    if (dbSearch_WebSitePageTemplateZonesContent.Count > 0)
                                                    {
                                                        if (dbSearch_WebSitePageTemplateZonesContent[0].ID == iRecID)
                                                        {
                                                            dbSearch_WebSitePageTemplateZonesContent[0].iUpdatedByID = oSystem.CurrentUser.UserView.User.ID;
                                                            dbSearch_WebSitePageTemplateZonesContent[0].sUpdatedByID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName;
                                                            dbSearch_WebSitePageTemplateZonesContent[0].dtLastUpdated = DateTime.Now;
                                                            dbSearch_WebSitePageTemplateZonesContent[0].sDefaultValue = _Content;

                                                            dbWebSitePageTemplateZonesContent.Update_SQL(dbSearch_WebSitePageTemplateZonesContent[0]);
                                                        }
                                                    }
                                                }
                                                #endregion
                                                break;
                                        }
                                        oResponse = Json(new { RESPONSE = "SUCCESS" });
                                    }
                                }
                                #endregion
                            }
                        }
                    }
                }
            }
            catch
            {

            }
            oSystem.CloseDataConnection();//Forms
            return oResponse;
        }

        [HttpPost]
        [ValidateInput(false)]
        public JsonResult AddNewPageFrontPage(string _PageName, string _PageNav, string _TemplateID, string _TemplateName,
            string _TemplatePageID, string _TemplatePageName, string _LanguageID, string _LanguageName)
        {
            string sBaseULR = HttpContext.Request.Url.Scheme + "://" + HttpContext.Request.Url.Authority + "/";
            string sCurrentURL = HttpContext.Request.UrlReferrer.OriginalString.ToString();
            var oResponse = Json(new { RESPONSE = "ERROR" });
            try
            {
                if (oSystem.OpenDataConnection())
                {
                    if (oSystem.GetCurrentUser())
                    {
                        DINT_WebSitePage dbWebSitePage = new DINT_WebSitePage(oSystem.cnCon);

                        DEF_WebSitePage.RecordObject oNew_WebSitePage = new DEF_WebSitePage.RecordObject();
                        oNew_WebSitePage.iParentID = 1;
                        oNew_WebSitePage.sParentID = "Default";
                        oNew_WebSitePage.sControl = Guid.NewGuid().ToString();
                        oNew_WebSitePage.dtDateCreated = DateTime.Now;
                        oNew_WebSitePage.dtLastUpdated = DateTime.Now;
                        oNew_WebSitePage.bLoadPartialPage = false;
                        oNew_WebSitePage.iCreatedByID = oSystem.CurrentUser.UserView.User.ID;
                        oNew_WebSitePage.sCreatedByID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName;
                        oNew_WebSitePage.iUpdatedByID = oSystem.CurrentUser.UserView.User.ID;
                        oNew_WebSitePage.sUpdatedByID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName;
                        oNew_WebSitePage.sPageName = _PageName;
                        oNew_WebSitePage.sPageTitle = _PageName;
                        oNew_WebSitePage.bIsLive = true;
                        oNew_WebSitePage.iSiteTemplateID = System.Convert.ToInt32(_TemplateID);
                        oNew_WebSitePage.sSiteTemplateID = _TemplateName;
                        oNew_WebSitePage.iSiteTemplatePageID = System.Convert.ToInt32(_TemplatePageID);
                        oNew_WebSitePage.sSiteTemplatePageID = _TemplatePageName;
                        oNew_WebSitePage.iLanguageID = System.Convert.ToInt32(_LanguageID);
                        oNew_WebSitePage.sLanguageID = _LanguageName;

                        oNew_WebSitePage.dtEnd = DateTime.Parse("01/01/1901");
                        oNew_WebSitePage.dtStart = DateTime.Parse("01/01/1901");

                        dbWebSitePage.Insert_SQL(oNew_WebSitePage);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + oNew_WebSitePage.sControl + "'", "string", 0, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePage.RecordObject> lstWebSitePage = dbWebSitePage.Get(lstParameters);

                        if (lstWebSitePage != null)
                        {
                            if (lstWebSitePage.Count > 0)
                            {
                                DINT_WebSiteNavigation dbWebSiteNavigation = new DINT_WebSiteNavigation(oSystem.cnCon);

                                DEF_WebSiteNavigation.RecordObject oNew_WebSiteNavigation = new DEF_WebSiteNavigation.RecordObject();
                                oNew_WebSiteNavigation.iParentID = 1;
                                oNew_WebSiteNavigation.sParentID = "Default";
                                oNew_WebSiteNavigation.sControl = Guid.NewGuid().ToString();
                                oNew_WebSiteNavigation.dtDateCreated = DateTime.Now;
                                oNew_WebSiteNavigation.dtLastUpdated = DateTime.Now;
                                oNew_WebSiteNavigation.iCreatedByID = oSystem.CurrentUser.UserView.User.ID;
                                oNew_WebSiteNavigation.sCreatedByID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName;
                                oNew_WebSiteNavigation.iUpdatedByID = oSystem.CurrentUser.UserView.User.ID;
                                oNew_WebSiteNavigation.sUpdatedByID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName;

                                oNew_WebSiteNavigation.iPageID = lstWebSitePage[0].ID;
                                oNew_WebSiteNavigation.sPageID = lstWebSitePage[0].sPageName;

                                oNew_WebSiteNavigation.sNavigationIdentifyer = _PageNav;
                                oNew_WebSiteNavigation.sDisplayName = lstWebSitePage[0].sPageName;

                                oNew_WebSiteNavigation.bHidden = false;
                                oNew_WebSiteNavigation.bDisabled = false;
                                oNew_WebSiteNavigation.bRestrictAccess = false;

                                dbWebSiteNavigation.Insert_SQL(oNew_WebSiteNavigation);


                                oResponse = Json(new { RESPONSE = "SUCCESS" });
                            }
                        }
                    }
                }
            }
            catch
            {

            }
            oSystem.CloseDataConnection();//Forms
            return oResponse;
        }




        [HttpPost]
        public JsonResult Get_Countries()
        {
            Set_ViewBag_UserInfo_Defaults();
            string sRESPONSE = "false";
            string sRESPONSEMESSAGE = "Error";

            List<DEF_Countries.RecordObject> lstSearch_Results = null;
            try
            {
                if (oSystem.OpenDataConnection())
                {
                    if (oSystem.GetCurrentUser())
                    {
                        Set_ViewBag_Global();
                        Set_ViewBag_UserInfo();

                        if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                        {
                            #region
                            List<DataParameter> lstParameters = new List<DataParameter>();
                            DataParameter pParameter = null;

                            DINT_Countries dbCountries = new DINT_Countries(oSystem.cnCon);


                            lstSearch_Results = dbCountries.Get(lstParameters);

                            sRESPONSE = "true";
                            sRESPONSEMESSAGE = "Data Loaded!";
                            #endregion
                        }
                        else
                        {
                            sRESPONSE = "false";
                            sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                        }
                    }
                    else
                    {
                        sRESPONSE = "false";
                        sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                    }
                }
                else
                {
                    sRESPONSE = "false";
                    sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                }
            }
            catch (Exception s)
            {
                sRESPONSE = "false";
                sRESPONSEMESSAGE = s.ToString();
            }
            oSystem.CloseDataConnection();
            var oResponse = Json(new { RESPONSE = sRESPONSE, MESSAGE = sRESPONSEMESSAGE, DATA = lstSearch_Results });
            return oResponse;
        }

        [HttpPost]
        public JsonResult Get_CountryStates(string _CountryID)
        {
            Set_ViewBag_UserInfo_Defaults();
            string sRESPONSE = "false";
            string sRESPONSEMESSAGE = "Error";

            if (String.IsNullOrEmpty(_CountryID))
            {
                _CountryID = "213";//Default to US
            }

            List<DEF_States.RecordObject> lstSearch_Results = null;
            try
            {
                if (oSystem.OpenDataConnection())
                {
                    if (oSystem.GetCurrentUser())
                    {
                        Set_ViewBag_Global();
                        Set_ViewBag_UserInfo();

                        if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                        {
                            #region
                            List<DataParameter> lstParameters = new List<DataParameter>();
                            DataParameter pParameter = null;

                            DINT_States dbStates = new DINT_States(oSystem.cnCon);

                            pParameter = new DataParameter("iCountryID", "'" + _CountryID + "'", "int", 9, "iCountryID", " = ", "");
                            lstParameters.Add(pParameter);

                            lstSearch_Results = dbStates.Get(lstParameters);

                            sRESPONSE = "true";
                            sRESPONSEMESSAGE = "Data Loaded!";
                            #endregion
                        }
                        else
                        {
                            sRESPONSE = "false";
                            sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                        }
                    }
                    else
                    {
                        sRESPONSE = "false";
                        sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                    }
                }
                else
                {
                    sRESPONSE = "false";
                    sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                }
            }
            catch (Exception s)
            {
                sRESPONSE = "false";
                sRESPONSEMESSAGE = s.ToString();
            }
            oSystem.CloseDataConnection();
            var oResponse = Json(new { RESPONSE = sRESPONSE, MESSAGE = sRESPONSEMESSAGE, DATA = lstSearch_Results });
            return oResponse;
        }

        [HttpPost]
        public JsonResult Get_CountriesLanguages(string _CountryID)
        {
            Set_ViewBag_UserInfo_Defaults();
            string sRESPONSE = "false";
            string sRESPONSEMESSAGE = "Error";

            if (String.IsNullOrEmpty(_CountryID))
            {
                _CountryID = "213";//Default to US
            }

            List<DEF_CountryLanguages.RecordObject> lstSearch_Results = null;
            try
            {
                if (oSystem.OpenDataConnection())
                {
                    if (oSystem.GetCurrentUser())
                    {
                        Set_ViewBag_Global();
                        Set_ViewBag_UserInfo();

                        if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                        {
                            #region
                            List<DataParameter> lstParameters = new List<DataParameter>();
                            DataParameter pParameter = null;

                            DINT_CountryLanguages dbCountryLanguages = new DINT_CountryLanguages(oSystem.cnCon);

                            pParameter = new DataParameter("iCountryID", "'" + _CountryID + "'", "int", 6, "iCountryID", " = ", "");
                            lstParameters.Add(pParameter);

                            lstSearch_Results = dbCountryLanguages.Get(lstParameters);

                            sRESPONSE = "true";
                            sRESPONSEMESSAGE = "Data Loaded!";
                            #endregion
                        }
                        else
                        {
                            sRESPONSE = "false";
                            sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                        }
                    }
                    else
                    {
                        sRESPONSE = "false";
                        sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                    }
                }
                else
                {
                    sRESPONSE = "false";
                    sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                }
            }
            catch (Exception s)
            {
                sRESPONSE = "false";
                sRESPONSEMESSAGE = s.ToString();
            }
            oSystem.CloseDataConnection();
            var oResponse = Json(new { RESPONSE = sRESPONSE, MESSAGE = sRESPONSEMESSAGE, DATA = lstSearch_Results });
            return oResponse;
        }



        #region Reports
        string sReportOverview = "/views/Forms/RptOverview.cshtml";

        public ActionResult ReportOverview()
        {
            Set_Client_NavSettings("ReportOverview");
            //string sView = Request.UrlReferrer.ToString();
            oSystem.OpenDataConnection();
            Set_ViewBag_UserInfo_Defaults();
            Set_ViewBag_Global_Defaults();

            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CurrentUser != null)
                {
                    Set_ViewBag_UserInfo();

                    if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                    {
                        Set_ViewBag_UserInfo();
                        Set_ViewBag_Global();




                        oSystem.CloseDataConnection();

                        oPage.DataModelsPrimary = oSystem;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = sModuleBase + sReportOverview;
                        oSystem.CloseDataConnection();//Forms
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        ACMSDBView.UserAuthentication oUserAuth = new UserAuthentication();
                        oPage.DataModelsPrimary = oUserAuth;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                        oSystem.CloseDataConnection();//Forms
                        return View(sModuleBase + sBasePage, oPage);
                    }
                }
                else
                {
                    ACMSDBView.UserAuthentication oUserAuth = new UserAuthentication();
                    oPage.DataModelsPrimary = oUserAuth;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                    oSystem.CloseDataConnection();//Forms
                    return View(sModuleBase + sBasePage, oPage);
                }
            }
            else
            {
                ACMSDBView.UserAuthentication oUserAuth = new UserAuthentication();
                oPage.DataModelsPrimary = oUserAuth;
                oPage.DataModelsSub.Add(oSystem);
                oPage.AuthenticatedUser = true;
                oPage.PartialViewToLoad = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                oSystem.CloseDataConnection();//Forms
                return View(sModuleBase + sBasePage, oPage);
            }

        }


        string sRptRefferalURLs = "/views/Forms/RptRefferalURLs.cshtml";

        public ActionResult ReportRefferalURLs(string _DateFrom = "", string _DateTo = "")
        {
            Set_Client_NavSettings("ReportRefferalURLs");
            //string sView = Request.UrlReferrer.ToString();
            oSystem.OpenDataConnection();
            Set_ViewBag_UserInfo_Defaults();
            Set_ViewBag_Global_Defaults();

            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CurrentUser != null)
                {
                    Set_ViewBag_UserInfo();

                    if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                    {
                        Set_ViewBag_UserInfo();
                        Set_ViewBag_Global();




                        oSystem.CloseDataConnection();

                        oPage.DataModelsPrimary = oSystem;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = sModuleBase + sRptRefferalURLs;
                        oSystem.CloseDataConnection();//Forms
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        ACMSDBView.UserAuthentication oUserAuth = new UserAuthentication();
                        oPage.DataModelsPrimary = oUserAuth;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                        oSystem.CloseDataConnection();//Forms
                        return View(sModuleBase + sBasePage, oPage);
                    }
                }
                else
                {
                    ACMSDBView.UserAuthentication oUserAuth = new UserAuthentication();
                    oPage.DataModelsPrimary = oUserAuth;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                    oSystem.CloseDataConnection();//Forms
                    return View(sModuleBase + sBasePage, oPage);
                }
            }
            else
            {
                ACMSDBView.UserAuthentication oUserAuth = new UserAuthentication();
                oPage.DataModelsPrimary = oUserAuth;
                oPage.DataModelsSub.Add(oSystem);
                oPage.AuthenticatedUser = true;
                oPage.PartialViewToLoad = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                oSystem.CloseDataConnection();//Forms
                return View(sModuleBase + sBasePage, oPage);
            }

        }


        string sRptSiteVisitors = "/views/Forms/RptSiteVisitors.cshtml";

        public ActionResult ReportRptSiteVisitors(string _DateFrom = "", string _DateTo = "")
        {
            Set_Client_NavSettings("ReportRptSiteVisitors");
            //string sView = Request.UrlReferrer.ToString();
            oSystem.OpenDataConnection();
            Set_ViewBag_UserInfo_Defaults();
            Set_ViewBag_Global_Defaults();

            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CurrentUser != null)
                {
                    Set_ViewBag_UserInfo();

                    if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                    {
                        Set_ViewBag_UserInfo();
                        Set_ViewBag_Global();




                        oSystem.CloseDataConnection();

                        oPage.DataModelsPrimary = oSystem;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = sModuleBase + sRptSiteVisitors;
                        oSystem.CloseDataConnection();//Forms
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        ACMSDBView.UserAuthentication oUserAuth = new UserAuthentication();
                        oPage.DataModelsPrimary = oUserAuth;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                        oSystem.CloseDataConnection();//Forms
                        return View(sModuleBase + sBasePage, oPage);
                    }
                }
                else
                {
                    ACMSDBView.UserAuthentication oUserAuth = new UserAuthentication();
                    oPage.DataModelsPrimary = oUserAuth;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                    oSystem.CloseDataConnection();//Forms
                    return View(sModuleBase + sBasePage, oPage);
                }
            }
            else
            {
                ACMSDBView.UserAuthentication oUserAuth = new UserAuthentication();
                oPage.DataModelsPrimary = oUserAuth;
                oPage.DataModelsSub.Add(oSystem);
                oPage.AuthenticatedUser = true;
                oPage.PartialViewToLoad = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                oSystem.CloseDataConnection();//Forms
                return View(sModuleBase + sBasePage, oPage);
            }

        }


        string sRptHitStatistics = "/views/Forms/RptSiteVisitors.cshtml";

        public ActionResult ReportRptHitStatistics(string _DateFrom = "", string _DateTo = "")
        {
            Set_Client_NavSettings("ReportRptHitStatistics");
            //string sView = Request.UrlReferrer.ToString();
            oSystem.OpenDataConnection();
            Set_ViewBag_UserInfo_Defaults();
            Set_ViewBag_Global_Defaults();

            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CurrentUser != null)
                {
                    Set_ViewBag_UserInfo();

                    if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                    {
                        Set_ViewBag_UserInfo();
                        Set_ViewBag_Global();




                        oSystem.CloseDataConnection();

                        oPage.DataModelsPrimary = oSystem;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = sModuleBase + sRptHitStatistics;
                        oSystem.CloseDataConnection();//Forms
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        ACMSDBView.UserAuthentication oUserAuth = new UserAuthentication();
                        oPage.DataModelsPrimary = oUserAuth;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                        oSystem.CloseDataConnection();//Forms
                        return View(sModuleBase + sBasePage, oPage);
                    }
                }
                else
                {
                    ACMSDBView.UserAuthentication oUserAuth = new UserAuthentication();
                    oPage.DataModelsPrimary = oUserAuth;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                    oSystem.CloseDataConnection();//Forms
                    return View(sModuleBase + sBasePage, oPage);
                }
            }
            else
            {
                ACMSDBView.UserAuthentication oUserAuth = new UserAuthentication();
                oPage.DataModelsPrimary = oUserAuth;
                oPage.DataModelsSub.Add(oSystem);
                oPage.AuthenticatedUser = true;
                oPage.PartialViewToLoad = sModuleBase + "/Views/Forms/UserProfileEditor.cshtml";
                oSystem.CloseDataConnection();//Forms
                return View(sModuleBase + sBasePage, oPage);
            }

        }
        #endregion

        #region ACM View Maps
        string sFileManagerList = "/views/Screens/FileManagerList.cshtml";
        string sFileManagerFilePoP = "/views/Screens/FileManagerListPop.cshtml";
        string sCountries_Details = "/views/Forms/Countries_Details.cshtml";
        string sCountries_List = "/views/Forms/Countries_List.cshtml";
        string sRoles_Details = "/views/Forms/Roles_Details.cshtml";
        string sRoles_List = "/views/Forms/Roles_List.cshtml";
        string sStates_Details = "/views/Forms/States_Details.cshtml";
        string sStates_List = "/views/Forms/States_List.cshtml";
        string sSystemMaster_Details = "/views/Forms/SystemMaster_Details.cshtml";
        string sSystemMaster_List = "/views/Forms/SystemMaster_List.cshtml";
        string sSystemModules_Details = "/views/Forms/SystemModules_Details.cshtml";
        string sSystemModules_List = "/views/Forms/SystemModules_List.cshtml";
        string sUserRoles_Details = "/views/Forms/UserRoles_Details.cshtml";
        string sUserRoles_List = "/views/Forms/UserRoles_List.cshtml";
        string sUsers_Details = "/views/Forms/Users_Details.cshtml";
        string sUsers_List = "/views/Forms/Users_List.cshtml";
        string sUsersAltAuth_Details = "/views/Forms/UsersAltAuth_Details.cshtml";
        string sUsersAltAuth_List = "/views/Forms/UsersAltAuth_List.cshtml";
        string sUsersProperties_Details = "/views/Forms/UsersProperties_Details.cshtml";
        string sUsersProperties_List = "/views/Forms/Countries_Details.cshtml";
        string sWebSite_Details = "/views/Forms/WebSite_Details.cshtml";
        string sWebSite_List = "/views/Forms/WebSite_List.cshtml";
        string sWebSiteBlog_Details = "/views/Forms/WebSiteBlog_Details.cshtml";
        string sWebSiteBlog_List = "/views/Forms/WebSiteBlog_List.cshtml";
        string sWebSiteBlogComments_Details = "/views/Forms/WebSiteBlogComments_Details.cshtml";
        string sWebSiteBlogComments_List = "/views/Forms/WebSiteBlogComments_List.cshtml";
        string sWebSiteBlogCommentsProperties_Details = "/views/Forms/WebSiteBlogCommentsProperties_Details.cshtml";
        string sWebSiteBlogCommentsProperties_List = "/views/Forms/WebSiteBlogCommentsProperties_List.cshtml";
        string sWebSiteBlogEntry_Details = "/views/Forms/WebSiteBlogEntry_Details.cshtml";
        string sWebSiteBlogEntry_List = "/views/Forms/WebSiteBlogEntry_List.cshtml";
        string sWebSiteBlogEntryProperties_Details = "/views/Forms/WebSiteBlogEntryProperties_Details.cshtml";
        string sWebSiteBlogEntryProperties_List = "/views/Forms/WebSiteBlogEntryProperties_List.cshtml";
        string sWebSiteBlogProperties_Details = "/views/Forms/WebSiteBlogProperties_Details.cshtml";
        string sWebSiteBlogProperties_List = "/views/Forms/WebSiteBlogProperties_List.cshtml";
        string sWebSiteExtAppIntegrationSettings_Details = "/views/Forms/WebSiteExtAppIntegrationSettings_Details.cshtml";
        string sWebSiteExtAppIntegrationSettings_List = "/views/Forms/WebSiteExtAppIntegrationSettings_List.cshtml";
        string sWebSiteModules_Details = "/views/Forms/WebSiteModules_Details.cshtml";
        string sWebSiteModules_List = "/views/Forms/WebSiteModules_List.cshtml";
        string sWebSiteNavigation_Details = "/views/Forms/WebSiteNavigation_Details.cshtml";
        string sWebSiteNavigation_List = "/views/Forms/WebSiteNavigation_List.cshtml";
        string sWebSitePage_Details = "/views/Forms/WebSitePage_Details.cshtml";
        string sWebSitePage_List = "/views/Forms/WebSitePage_List.cshtml";
        string sWebSitePageProperties_Details = "/views/Forms/WebSitePageProperties_Details.cshtml";
        string sWebSitePageProperties_List = "/views/Forms/WebSitePageProperties_List.cshtml";
        string sWebSitePageRoles_Details = "/views/Forms/WebSitePageRoles_Details.cshtml";
        string sWebSitePageRoles_List = "/views/Forms/WebSitePageRoles_List.cshtml";

        string sWebSitePageTemplates_Details = "/views/Forms/WebSitePageTemplates_Details.cshtml";
        string sWebSitePageTemplates_List = "/views/Forms/WebSitePageTemplates_List.cshtml";
        string sWebSitePageTemplateZones_Details = "/views/Forms/WebSitePageTemplateZones_Details.cshtml";
        string sWebSitePageTemplateZones_DetailsWYSIWYG = "/views/Forms/WebSitePageTemplateZones_Details.cshtml";
        string sWebSitePageTemplateZones_List = "/views/Forms/WebSitePageTemplateZones_List.cshtml";
        string sWebSitePageZoneContent_Details = "/views/Forms/WebSitePageZoneContent_Details.cshtml";
        string sWebSitePageZoneContent_List = "/views/Forms/WebSitePageZoneContent_List.cshtml";


        string sWebSiteProperties_Details = "/views/Forms/WebSiteProperties_Details.cshtml";
        string sWebSiteProperties_List = "/views/Forms/WebSiteProperties_List.cshtml";
        string sWebSiteEvents_Details = "/views/Forms/WebSiteEvents_Details.cshtml";
        string sWebSiteEvents_List = "/views/Forms/WebSiteEvents_List.cshtml";
        string sWebSiteRole_Details = "/views/Forms/WebSiteRole_Details.cshtml";
        string sWebSiteRole_List = "/views/Forms/WebSiteRole_List.cshtml";
        string sWebSiteBlogEntryRole_Details = "/views/Forms/WebSiteBlogEntryRole_Details.cshtml";
        string sWebSiteBlogEntryRole_List = "/views/Forms/WebSiteBlogEntryRole_List.cshtml";
        string sWebSiteBlogRoles_Details = "/views/Forms/WebSiteBlogRoles_Details.cshtml";
        string sWebSiteBlogRoles_List = "/views/Forms/WebSiteBlogRoles_List.cshtml";
        string sWebSiteNavigationRoles_Details = "/views/Forms/WebSiteNavigationRoles_Details.cshtml";
        string sWebSiteNavigationRoles_List = "/views/Forms/WebSiteNavigationRoles_List.cshtml";
        string sWebSiteScreen_Details = "/views/Forms/WebSiteScreen_Details.cshtml";
        string sWebSiteScreen_List = "/views/Forms/WebSiteScreen_List.cshtml";
        string sWebSiteScreenRoles_Details = "/views/Forms/WebSiteScreenRoles_Details.cshtml";
        string sWebSiteScreenRoles_List = "/views/Forms/WebSiteScreenRoles_List.cshtml";

        string sWebSitePageZone_Details = "/views/Forms/WebSitePageZone_Details.cshtml";
        string sWebSitePageZone_List = "/views/Forms/WebSitePageZone_List.cshtml";
        string sWebSitePageTemplateZonesContent_Details = "/views/Forms/WebSitePageTemplateZonesContent_Details.cshtml";
        string sWebSitePageTemplateZonesContent_List = "/views/Forms/WebSitePageTemplateZonesContent_List.cshtml";

        string sCountryLanguages_Details = "/views/Forms/CountryLanguages_Details.cshtml";
        string sCountryLanguages_List = "/views/Forms/CountryLanguages_List.cshtml";
        #endregion

        #region ACM Form Actions
        #region FileManager
        string sFileUploadResults = "";
        public ActionResult FilesManager_ListPop(string sMessage)
        {
            Set_Client_NavSettings("FilesManager_ListPop");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();

            if (oSystem.GetCurrentUser())
            {
                ViewBag.iSiteID = oSystem.rsGlobalVeriables.SiteID;

                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.FileUploadResults = sMessage;
                    string sLocalDefaultView = sModuleBase + sFileManagerFilePoP;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    return View(_sViewToLoad);
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult FilesManager_List(string sMessage)
        {
            Set_Client_NavSettings("FilesManager_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.FileUploadResults = sMessage;
                    string sLocalDefaultView = sModuleBase + sFileManagerList;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    return View(_sViewToLoad);
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public JsonResult GetFolderBase()
        {
            List<AriesCMS.Models.FileManagerList> oListing = new List<Models.FileManagerList>();
            try
            {
                string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
                string sRootPath = Request.PhysicalApplicationPath.ToString();

                if (oSystem.GetCurrentUser())
                {
                    ViewBag.iSiteID = oSystem.rsGlobalVeriables.SiteID;

                    if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                    {
                        #region Process
                        ViewBag.bLoggedIn = true;

                        int iIDCounter = 0;

                        string[] oDirectories = Directory.GetDirectories(sRootPath + "Themes");

                        AriesCMS.Models.FileManagerList oNewItem = new Models.FileManagerList();
                        oNewItem.ID = iIDCounter.ToString();
                        oNewItem.IsFolder = true;
                        oNewItem.URI = sRootPath + "Themes";
                        oNewItem.sName = "Themes";
                        oListing.Add(oNewItem);

                        oNewItem = new Models.FileManagerList();
                        oNewItem.ID = iIDCounter.ToString();
                        oNewItem.IsFolder = true;
                        oNewItem.URI = sRootPath + "Scripts";
                        oNewItem.sName = "Scripts";
                        oListing.Add(oNewItem);

                        #endregion
                    }
                }
                string sJsonString = JsonConvert.SerializeObject(oListing);
                var oResponse = JsonConvert.DeserializeObject(sJsonString);
                return Json(sJsonString);
            }
            catch
            {
                var oResponse = Json(oListing);
                return oResponse;
            }
        }
        public JsonResult GetDirectoryChildItems(string _sPath)
        {
            List<AriesCMS.Models.FileManagerList> oListing = new List<Models.FileManagerList>();
            try
            {
                string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
                string sRootPath = Request.PhysicalApplicationPath.ToString();

                if (oSystem.GetCurrentUser())
                {
                    ViewBag.iSiteID = oSystem.rsGlobalVeriables.SiteID;

                    if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                    {
                        #region Process
                        ViewBag.bLoggedIn = true;

                        int iIDCounter = 0;

                        string[] oDirectories = Directory.GetDirectories(_sPath);

                        foreach (string oDir in oDirectories)
                        {
                            iIDCounter++;

                            AriesCMS.Models.FileManagerList oNewItem = new Models.FileManagerList();
                            oNewItem.ID = iIDCounter.ToString();
                            oNewItem.IsFolder = true;
                            oNewItem.URI = oDir;

                            string sFolderName = oDir;
                            int iIndexOf = sFolderName.LastIndexOf('\\');
                            sFolderName = sFolderName.Remove(0, iIndexOf + 1);

                            oNewItem.sName = sFolderName;
                            oListing.Add(oNewItem);
                        }


                        ViewBag.iTotalRecordCount = oListing.Count;

                        #endregion
                    }
                }
                string sJsonString = JsonConvert.SerializeObject(oListing);
                var oResponse = JsonConvert.DeserializeObject(sJsonString);
                return Json(sJsonString);
            }
            catch
            {
                var oResponse = Json(oListing);
                return oResponse;
            }
        }
        public JsonResult GetDirectoryFiles(string _sPath)
        {
            List<AriesCMS.Models.FileManagerList> oListing = new List<Models.FileManagerList>();
            try
            {
                string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
                string sRootPath = Request.PhysicalApplicationPath.ToString();

                if (oSystem.GetCurrentUser())
                {
                    ViewBag.iSiteID = oSystem.rsGlobalVeriables.SiteID;

                    if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                    {
                        #region Process
                        ViewBag.bLoggedIn = true;

                        int iIDCounter = 0;

                        string sRootFolder = _sPath;

                        string sFileBaseURL = _sPath.Replace(sRootPath, "");
                        sFileBaseURL = sFileBaseURL.Replace("\\", "/");



                        string[] oFiles = Directory.GetFiles(_sPath);

                        foreach (string oF in oFiles)
                        {
                            iIDCounter++;

                            string sFileName = oF;
                            int iIndexOf = sFileName.LastIndexOf('\\');
                            sFileName = sFileName.Remove(0, iIndexOf + 1);

                            AriesCMS.Models.FileManagerList oNewItem = new Models.FileManagerList();
                            oNewItem.ID = iIDCounter.ToString();
                            oNewItem.IsFolder = false;
                            oNewItem.sName = sFileName;
                            oNewItem.URI = oF;
                            oNewItem.URL = sBaseULR + sFileBaseURL + "/" + sFileName;
                            #region Check for image file
                            try
                            {
                                if (sFileName.Contains(".png"))
                                {
                                    oNewItem.IsImage = true;
                                }
                                else if (sFileName.Contains(".jpg"))
                                {
                                    oNewItem.IsImage = true;
                                }
                                else if (sFileName.Contains(".gif"))
                                {
                                    oNewItem.IsImage = true;
                                }
                                else if (sFileName.Contains(".bmp"))
                                {
                                    oNewItem.IsImage = true;
                                }
                                else if (sFileName.Contains(".ico"))
                                {
                                    oNewItem.IsImage = true;
                                }

                            }
                            catch
                            {
                            }
                            #endregion
                            oListing.Add(oNewItem);
                        }


                        ViewBag.iTotalRecordCount = oListing.Count;

                        #endregion
                    }
                }
                string sJsonString = JsonConvert.SerializeObject(oListing);
                var oResponse = JsonConvert.DeserializeObject(sJsonString);
                return Json(sJsonString);
            }
            catch
            {
                var oResponse = Json(oListing);
                return oResponse;
            }
        }

        //public ActionResult UploadFiles(FormCollection oForms)
        //{
        //    try
        //    {
        //        if (Request != null)
        //        {
        //            HttpPostedFileBase oFile = Request.Files["UploadFiles"];
        //            if (oFile != null)
        //            {
        //                if (oFile.ContentLength > 0)
        //                {
        //                    if (!String.IsNullOrEmpty(oFile.FileName))
        //                    {
        //                        byte[] bytFile = new byte[oFile.ContentLength];
        //                        oFile.InputStream.Read(bytFile, 0, System.Convert.ToInt32(oFile.ContentLength));

        //                    }
        //                }
        //            }
        //        }
        //    }
        //    catch
        //    {
        //    }
        //    return RedirectToAction("FilesManager_List");
        //}

        [HttpPost]
        public ActionResult UploadFiles(FormCollection fc, HttpPostedFileBase UploadFiles, string _Base = "")
        {
            Set_Client_NavSettings("UploadFiles");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            try
            {

                if (oSystem.GetCurrentUser())
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                }

                if (String.IsNullOrEmpty(_Base))
                {
                    try
                    {
                        _Base = fc["hlblCurrentFolderPath"].ToString();
                    }
                    catch
                    {
                    }
                }


                if (UploadFiles != null)
                {
                    if (UploadFiles.ContentLength > 0)
                    {
                        if (!String.IsNullOrEmpty(UploadFiles.FileName))
                        {
                            string sOriginalFileName = Path.GetFileName(UploadFiles.FileName);
                            FileInfo oFLCheck = new FileInfo(sRootPath + "Themes/" + sOriginalFileName);
                            if (!oFLCheck.Exists)
                            {
                                if (!String.IsNullOrEmpty(_Base))
                                {
                                    UploadFiles.SaveAs(_Base + "\\" + sOriginalFileName);
                                    sFileUploadResults = "File Uploaded! - " + _Base + "\\" + sOriginalFileName;
                                }
                                else
                                {
                                    UploadFiles.SaveAs(sRootPath + "Themes\\" + sOriginalFileName);
                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalFileName;
                                }
                            }
                            else
                            {
                                sFileUploadResults = "Sorry there is already a file with the same name present!";
                            }
                        }
                    }
                }
            }
            catch
            {
            }
            if (sRefURL.Contains("FilesManager_ListPop"))
            {
                return RedirectToAction("FilesManager_ListPop", new { sMessage = sFileUploadResults });
            }
            else
            {
                return RedirectToAction("FilesManager_List", new { sMessage = sFileUploadResults });
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult GetDirectoryFilesView(string _sPath)
        {
            Set_Client_NavSettings("GetDirectoryFilesView");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            List<AriesCMS.Models.FileManagerList> oListing = new List<Models.FileManagerList>();
            string sLocalDefaultView = sModuleBase + sFileManagerList;
            try
            {
                string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
                string sRootPath = Request.PhysicalApplicationPath.ToString();

                if (oSystem.GetCurrentUser())
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();

                    if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                    {
                        #region Process
                        #region If View is not set try to get it
                        if (String.IsNullOrEmpty(_sViewToLoad))
                        {
                            if (Session["_sView"] != null)
                            {
                                _sViewToLoad = Session["_sView"].ToString();
                            }
                            else
                            {
                                _sViewToLoad = sLocalDefaultView;
                            }
                        }
                        #endregion

                        int iIDCounter = 0;

                        string sRootFolder = _sPath;

                        string sFileBaseURL = _sPath.Replace(sRootPath, "");
                        sFileBaseURL = sFileBaseURL.Replace("\\", "/");



                        string[] oFiles = Directory.GetFiles(_sPath);

                        foreach (string oF in oFiles)
                        {
                            iIDCounter++;

                            string sFileName = oF;
                            int iIndexOf = sFileName.LastIndexOf('\\');
                            sFileName = sFileName.Remove(0, iIndexOf + 1);

                            AriesCMS.Models.FileManagerList oNewItem = new Models.FileManagerList();
                            oNewItem.ID = iIDCounter.ToString();
                            oNewItem.IsFolder = false;
                            oNewItem.sName = sFileName;
                            oNewItem.URI = oF;
                            oNewItem.URL = sBaseULR + sFileBaseURL + "/" + sFileName;
                            oListing.Add(oNewItem);
                        }


                        ViewBag.iTotalRecordCount = oListing.Count;

                        #endregion
                    }
                }

                return View(_sViewToLoad, oListing);
            }
            catch
            {
                return View(sLocalDefaultView, oListing);
            }
        }

        [HttpPost]
        public ActionResult FilesManager_AddUpdate(DEF_Countries.RecordObject _rec)
        {
            Set_Client_NavSettings("FilesManager_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form Countries
        public ActionResult Countries_List(FormCollection fc, string Search, int page = 1)
        {
            Set_Client_NavSettings("Countries_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sCountries_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_Countries dbInteraction = new DINT_Countries(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_Countries.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();

                    if (!String.IsNullOrEmpty(Search))
                    {
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sName", "'%" + Search + "%'", "string", 4, "sName", " LIKE ", "");
                        lstParameters.Add(pParameter);

                        pParameter = new DataParameter("sAbbreviation", "'%" + Search + "%'", "string", 5, "sAbbreviation", " LIKE ", " OR ");
                        lstParameters.Add(pParameter);

                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_Countries.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult Countries_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("Countries_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sCountries_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based Pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Countries dbInteraction = new DINT_Countries(oSystem.cnCon);
                        List<DEF_Countries.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Countries.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);


                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region Key based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Countries dbInteraction = new DINT_Countries(oSystem.cnCon);
                        List<DEF_Countries.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Countries.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);


                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult Countries_Create()
        {
            Set_Client_NavSettings("Countries_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sCountries_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_Countries.RecordObject recRecord = new DEF_Countries.RecordObject();

                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        public ActionResult Countries_AddUpdate(DEF_Countries.RecordObject _rec)
        {
            Set_Client_NavSettings("Countries_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sCountries_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_Countries dbInteraction = new DINT_Countries(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtDateUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("Countries_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_Countries dbInteraction = new DINT_Countries(oSystem.cnCon);

                                    _rec.dtDateUpdated = DateTime.Now;


                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("Countries_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult Countries_Delete(int id)
        {
            Set_Client_NavSettings("Countries_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_Countries dbInteraction = new DINT_Countries(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_Countries.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Countries.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("Countries_List");
                    }
                    else
                    {
                        return RedirectToAction("Countries_List");
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form CountryLanguages
        public ActionResult CountryLanguages_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("CountryLanguages_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sCountryLanguages_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_CountryLanguages dbInteraction = new DINT_CountryLanguages(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_CountryLanguages.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();

                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sName", "'" + Search + "'", "string", 10, "sName", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_CountryLanguages.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult CountryLanguages_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("CountryLanguages_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sCountryLanguages_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_CountryLanguages dbInteraction = new DINT_CountryLanguages(oSystem.cnCon);
                        List<DEF_CountryLanguages.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_CountryLanguages.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.CountryLanguagesViewModel recRecord = new ACMSDBView.CountryLanguagesViewModel();
                                recRecord.CountryLanguages = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.CountryLanguages.iCountryID;
                                ViewBag.sParentID = recRecord.CountryLanguages.sCountryID;


                                recRecord.Get_Countries(oSystem.cnCon);

                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_CountryLanguages dbInteraction = new DINT_CountryLanguages(oSystem.cnCon);
                        List<DEF_CountryLanguages.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_CountryLanguages.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.CountryLanguagesViewModel recRecord = new ACMSDBView.CountryLanguagesViewModel();
                                recRecord.CountryLanguages = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.CountryLanguages.iCountryID;
                                ViewBag.sParentID = recRecord.CountryLanguages.sCountryID;

                                recRecord.Get_Countries(oSystem.cnCon);


                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult CountryLanguages_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("CountryLanguages_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sCountryLanguages_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    //DEF_CountryLanguages.RecordObject recRecord = new DEF_CountryLanguages.RecordObject();
                    ACMSDBView.CountryLanguagesViewModel recRecord = new ACMSDBView.CountryLanguagesViewModel();

                    recRecord.CountryLanguages.iCountryID = _iParentID;
                    recRecord.CountryLanguages.sCountryID = _sParentID;

                    recRecord.Get_Countries(oSystem.cnCon);

                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);




                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        public ActionResult CountryLanguages_AddUpdate(ACMSDBView.CountryLanguagesViewModel _rec)
        {
            Set_Client_NavSettings("CountryLanguages_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sCountryLanguages_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.CountryLanguages.ID == null) || (_rec.CountryLanguages.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.CountryLanguages.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.CountryLanguages.iCountryID;
                            ViewBag.sParentID = _rec.CountryLanguages.sCountryID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_CountryLanguages dbInteraction = new DINT_CountryLanguages(oSystem.cnCon);

                                _rec.CountryLanguages.sControl = Guid.NewGuid().ToString();
                                _rec.CountryLanguages.dtDateCreated = DateTime.Now;
                                _rec.CountryLanguages.dtDateUpdated = DateTime.Now;

                                _rec.Get_Countries(oSystem.cnCon);

                                foreach (SelectListItem oV in _rec.Countries)
                                {
                                    if (oV.Value == _rec.CountryLanguages.iCountryID.ToString())
                                    {
                                        _rec.CountryLanguages.sCountryID = oV.Text;
                                    }
                                }
                                dbInteraction.Insert_SQL(_rec.CountryLanguages);


                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("CountryLanguages_Details", new { key = _rec.CountryLanguages.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.CountryLanguages.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_CountryLanguages dbInteraction = new DINT_CountryLanguages(oSystem.cnCon);

                                    _rec.CountryLanguages.dtDateUpdated = DateTime.Now;

                                    _rec.Get_Countries(oSystem.cnCon);

                                    foreach (SelectListItem oV in _rec.Countries)
                                    {
                                        if (oV.Value == _rec.CountryLanguages.iCountryID.ToString())
                                        {
                                            _rec.CountryLanguages.sCountryID = oV.Text;
                                        }
                                    }


                                    dbInteraction.Update_SQL(_rec.CountryLanguages);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("CountryLanguages_Details", new { id = _rec.CountryLanguages.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult CountryLanguages_Delete(int id)
        {
            Set_Client_NavSettings("CountryLanguages_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_CountryLanguages dbInteraction = new DINT_CountryLanguages(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_CountryLanguages.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_CountryLanguages.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iCountryID;
                                        ViewBag.sParentID = recRecord.sCountryID;
                                        iParentID = recRecord.iCountryID;
                                        sParentID = recRecord.sCountryID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("CountryLanguages_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("CountryLanguages_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }


        [HttpPost]
        public JsonResult GetCountryLanguages()
        {
            try
            {
                if (oSystem.OpenDataConnection())
                {
                    DINT_CountryLanguages dbInteraction = new DINT_CountryLanguages(oSystem.cnCon);

                    List<DEF_CountryLanguages.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();

                    //DataParameter pParameter = new DataParameter("iParentID", "'" + _ParentID + "'", "int", 1, "iParentID", " = ", "");
                    //lstParameters.Add(pParameter);

                    dbSearch = dbInteraction.Get(lstParameters);
                    List<SelectListItem> CountryLanguages = new List<SelectListItem>();

                    if (dbSearch != null)
                    {
                        foreach (DEF_CountryLanguages.RecordObject oV in dbSearch)
                        {
                            CountryLanguages.Add(new SelectListItem { Selected = false, Text = oV.sCountryID + " " + oV.sName, Value = oV.ID.ToString() });
                        }


                    }


                    var oResponse = Json(CountryLanguages);
                    return oResponse;
                }
                var oResponseError = Json(new { RESPONSE = "ERROR" });
                return oResponseError;
            }
            catch
            {
                var oResponseError1 = Json(new { RESPONSE = "ERROR" });
                return oResponseError1;
            }
        }
        #endregion

        #region Form Roles
        public ActionResult Roles_List(FormCollection fc, string Search, int page = 1)
        {
            Set_Client_NavSettings("Roles_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sRoles_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_Roles dbInteraction = new DINT_Roles(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_Roles.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sName", "'%" + Search + "%'", "string", 10, "sName", " LIKE ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iRow + iMaxRows);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_Roles.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult Roles_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("Roles_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Roles dbInteraction = new DINT_Roles(oSystem.cnCon);
                        List<DEF_Roles.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.RolesViewModel recRecord = new RolesViewModel();
                                recRecord.Roles = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                recRecord.Build_AccessLvels();
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Roles dbInteraction = new DINT_Roles(oSystem.cnCon);
                        List<DEF_Roles.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.RolesViewModel recRecord = new RolesViewModel();
                                recRecord.Roles = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                recRecord.Build_AccessLvels();
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult Roles_Create()
        {
            Set_Client_NavSettings("Roles_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    ACMSDBView.RolesViewModel recRecord = new RolesViewModel();
                    recRecord.Build_AccessLvels();

                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        public ActionResult Roles_AddUpdate(ACMSDBView.RolesViewModel _rec)
        {
            Set_Client_NavSettings("Roles_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if (_rec.Roles != null)
                        {
                            if ((_rec.Roles.ID == null) || (_rec.Roles.ID == 0))
                            {
                                ViewBag.bAddNew = true;
                                _rec.Roles.ID = -1;
                                ModelState.Remove("ID");
                            }

                            if (ModelState.IsValid)
                            {
                                if (ViewBag.bAddNew == true)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();

                                    DINT_Roles dbInteraction = new DINT_Roles(oSystem.cnCon);

                                    _rec.Roles.sControl = Guid.NewGuid().ToString();
                                    _rec.Roles.dtDateCreated = DateTime.Now;
                                    _rec.Roles.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Insert_SQL(_rec.Roles);

                                    _rec.Build_AccessLvels();

                                    oSystem.CloseDataConnection();
                                    //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                    #endregion
                                    return RedirectToAction("Roles_Details", new { key = _rec.Roles.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_sViewToLoad, _rec);
                                    //return View(_rec);
                                }
                                else
                                {
                                    if (_rec.Roles.ID > 0)
                                    {
                                        #region
                                        ViewBag.bError = false;
                                        ViewBag.bAddNew = false;
                                        ViewBag.bSaved = true;
                                        ViewBag.sErrorMessage = "";
                                        oSystem.OpenDataConnection();


                                        DINT_Roles dbInteraction = new DINT_Roles(oSystem.cnCon);

                                        _rec.Roles.dtLastUpdated = DateTime.Now;

                                        dbInteraction.Update_SQL(_rec.Roles);

                                        _rec.Build_AccessLvels();

                                        oSystem.CloseDataConnection();
                                        #endregion
                                        //return View(_sViewToLoad, _rec);
                                        return RedirectToAction("Roles_Details", new { id = _rec.Roles.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                        //return View(_rec);
                                    }
                                    else
                                    {
                                        ViewBag.bError = true;
                                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                        oPage.DataModelsPrimary = _rec;
                                        oPage.DataModelsSub.Add(oSystem);
                                        oPage.AuthenticatedUser = true;
                                        oPage.PartialViewToLoad = _sViewToLoad;
                                        return View(sModuleBase + sBasePage, oPage);

                                    }
                                }
                            }
                            else
                            {
                                ViewBag.bError = true;
                                ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                                oPage.DataModelsPrimary = _rec;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult Roles_Delete(int id)
        {
            Set_Client_NavSettings("Roles_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_Roles dbInteraction = new DINT_Roles(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_Roles.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Roles.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("Roles_List");
                    }
                    else
                    {
                        return RedirectToAction("Roles_List");
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form Roles_Access

        string sRoles_Access_Details = "/views/Forms/Roles_Access_Details.cshtml";
        string sRoles_Access_List = "/views/Forms/Roles_Access_List.cshtml";

        public ActionResult Roles_Access_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("Roles_Access_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sRoles_Access_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_Roles_Access dbInteraction = new DINT_Roles_Access(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_Roles_Access.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        //if (_iParentID > 0)
                        //{
                        //    DataParameter pParameter = new DataParameter("sTitle", "'%" + Search + "%'", "string", 11, "sTitle", " LIKE ", " AND ");
                        //    lstParameters.Add(pParameter);
                        //    iTotalRows = dbInteraction.GetRowCount(lstParameters);
                        //}
                        //else
                        //{
                        //    DataParameter pParameter = new DataParameter("sTitle", "'%" + Search + "%'", "string", 11, "sTitle", " LIKE ", "");
                        //    lstParameters.Add(pParameter);
                        //    iTotalRows = dbInteraction.GetRowCount(lstParameters);
                        //}
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_Roles_Access.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Roles_Access_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("Roles_Access_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sRoles_Access_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Roles_Access dbInteraction = new DINT_Roles_Access(oSystem.cnCon);
                        List<DEF_Roles_Access.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Roles_Access.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;

                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Roles_Access dbInteraction = new DINT_Roles_Access(oSystem.cnCon);
                        List<DEF_Roles_Access.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Roles_Access.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Roles_Access_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("Roles_Access_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sRoles_Access_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_Roles_Access.RecordObject recRecord = new DEF_Roles_Access.RecordObject();

                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;


                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public ActionResult Roles_Access_AddUpdate(DEF_Roles_Access.RecordObject _rec)
        {
            Set_Client_NavSettings("Roles_Access_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sRoles_Access_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_Roles_Access dbInteraction = new DINT_Roles_Access(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                //List<DataParameter> lstParameters = new List<DataParameter>();
                                //DataParameter pParameter = new DataParameter("sControl", "'" + _rec.WebSitePage.sControl.ToString() + "'", "sControl", 3, "sControl", " = ", "");
                                //lstParameters.Add(pParameter);

                                //List<DEF_Roles_Access.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                                //if (dbSearch != null)
                                //{
                                //  if (dbSearch.Count > 0)
                                //  {
                                //      _rec = dbSearch[0];
                                //      ViewBag.iParentID = _rec.iParentID;
                                //      ViewBag.sParentID = _rec.sParentID;
                                //  }
                                //}


                                oSystem.CloseDataConnection();
                                //return RedirectToAction("Roles_Access_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                #endregion
                                return RedirectToAction("Roles_Access_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_Roles_Access dbInteraction = new DINT_Roles_Access(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;
                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("Roles_Access_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    oSystem.CloseDataConnection();
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);
                                }
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Roles_Access_Delete(int id)
        {
            Set_Client_NavSettings("Roles_Access_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_Roles_Access dbInteraction = new DINT_Roles_Access(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_Roles_Access.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Roles_Access.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        //iParentID = recRecord.iParentID;
                                        //sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();
                        return RedirectToAction("Roles_Access_List", new { _iParentID = iParentID, _sParentID = sParentID });
                        //return RedirectToAction("Roles_Access_List");
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("Roles_Access_List", new { _iParentID = iParentID, _sParentID = sParentID });
                        //return RedirectToAction("Roles_Access_List");
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form States
        public ActionResult States_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("States_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sStates_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_States dbInteraction = new DINT_States(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_States.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iCountryID", "'" + _iParentID + "'", "int", 8, "iCountryID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;
                        DataParameter pParameter = new DataParameter("sName", "'" + Search + "'", "string", 4, "sName", " = ", "");
                        lstParameters.Add(pParameter);
                        lstParameters = new List<DataParameter>();
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_States.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult States_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("States_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sStates_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_States dbInteraction = new DINT_States(oSystem.cnCon);
                        List<DEF_States.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.StateViewModel recRecord = new StateViewModel();
                                recRecord.State = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.State.iCountryID;
                                ViewBag.sParentID = recRecord.State.sCountryID;

                                recRecord.Get_Countries(oSystem.cnCon);

                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_States dbInteraction = new DINT_States(oSystem.cnCon);
                        List<DEF_States.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.StateViewModel recRecord = new StateViewModel();
                                recRecord.State = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.State.iCountryID;
                                ViewBag.sParentID = recRecord.State.sCountryID;
                                recRecord.Get_Countries(oSystem.cnCon);
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult States_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("States_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sStates_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    ACMSDBView.StateViewModel recRecord = new StateViewModel();
                    recRecord.State = new DEF_States.RecordObject();
                    recRecord.Get_Countries(oSystem.cnCon);

                    recRecord.State.iCountryID = _iParentID;
                    recRecord.State.sCountryID = _sParentID;

                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        public ActionResult States_AddUpdate(ACMSDBView.StateViewModel _rec)
        {
            Set_Client_NavSettings("States_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sStates_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.State.ID == null) || (_rec.State.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.State.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.State.iCountryID;
                            ViewBag.sParentID = _rec.State.sCountryID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_States dbInteraction = new DINT_States(oSystem.cnCon);

                                _rec.State.sControl = Guid.NewGuid().ToString();
                                _rec.State.dtDateCreated = DateTime.Now;
                                _rec.State.dtDateUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.State);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("States_Details", new { key = _rec.State.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.State.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_States dbInteraction = new DINT_States(oSystem.cnCon);

                                    _rec.State.dtDateUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.State);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("States_Details", new { id = _rec.State.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";


                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult States_Delete(int id)
        {
            Set_Client_NavSettings("States_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_States dbInteraction = new DINT_States(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_States.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_States.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iCountryID;
                                        ViewBag.sParentID = recRecord.sCountryID;
                                        iParentID = recRecord.iCountryID;
                                        sParentID = recRecord.sCountryID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("States_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("States_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form SystemMaster
        public ActionResult SystemMaster_List(FormCollection fc, string Search, int page = 1)
        {
            Set_Client_NavSettings("SystemMaster_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sSystemMaster_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_SystemMaster dbInteraction = new DINT_SystemMaster(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_SystemMaster.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sName", "'" + Search + "'", "string", 8, "sName", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_SystemMaster.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult SystemMaster_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("SystemMaster_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sSystemMaster_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_SystemMaster dbInteraction = new DINT_SystemMaster(oSystem.cnCon);
                        List<DEF_SystemMaster.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_SystemMaster.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_SystemMaster dbInteraction = new DINT_SystemMaster(oSystem.cnCon);
                        List<DEF_SystemMaster.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_SystemMaster.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult SystemMaster_Create()
        {
            Set_Client_NavSettings("SystemMaster_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sSystemMaster_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_SystemMaster.RecordObject recRecord = new DEF_SystemMaster.RecordObject();

                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        public ActionResult SystemMaster_AddUpdate(DEF_SystemMaster.RecordObject _rec)
        {
            Set_Client_NavSettings("SystemMaster_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sSystemMaster_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_SystemMaster dbInteraction = new DINT_SystemMaster(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("SystemMaster_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_SystemMaster dbInteraction = new DINT_SystemMaster(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("SystemMaster_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult SystemMaster_Delete(int id)
        {
            Set_Client_NavSettings("SystemMaster_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_SystemMaster dbInteraction = new DINT_SystemMaster(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_SystemMaster.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_SystemMaster.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("SystemMaster_List");
                    }
                    else
                    {
                        return RedirectToAction("SystemMaster_List");
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form SystemModules
        public ActionResult SystemModules_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("SystemModules_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sSystemModules_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_SystemModules dbInteraction = new DINT_SystemModules(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_SystemModules.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();

                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }
                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sName", "'" + Search + "'", "string", 10, "sName", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_SystemModules.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult SystemModules_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("SystemModules_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sSystemModules_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_SystemModules dbInteraction = new DINT_SystemModules(oSystem.cnCon);
                        List<DEF_SystemModules.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_SystemModules.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);


                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_SystemModules dbInteraction = new DINT_SystemModules(oSystem.cnCon);
                        List<DEF_SystemModules.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_SystemModules.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);


                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult SystemModules_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("SystemModules_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sSystemModules_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_SystemModules.RecordObject recRecord = new DEF_SystemModules.RecordObject();
                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;

                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);


                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        public ActionResult SystemModules_AddUpdate(DEF_SystemModules.RecordObject _rec)
        {
            Set_Client_NavSettings("SystemModules_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sSystemModules_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_SystemModules dbInteraction = new DINT_SystemModules(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("SystemModules_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_SystemModules dbInteraction = new DINT_SystemModules(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("SystemModules_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult SystemModules_Delete(int id)
        {
            Set_Client_NavSettings("SystemModules_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_SystemModules dbInteraction = new DINT_SystemModules(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_SystemModules.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_SystemModules.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("SystemModules_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("SystemModules_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form UserRoles
        public ActionResult UserRoles_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("UserRoles_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUserRoles_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_UserRoles dbInteraction = new DINT_UserRoles(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_UserRoles.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sRoleID", "'%" + Search + "%'", "string", 11, "sRoleID", " LIKE ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_UserRoles.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult UserRoles_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("UserRoles_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUserRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        ACMSDBView.UserRolesViewModel recRecord = new UserRolesViewModel();
                        if (recRecord.GetView(oSystem.cnCon, id))
                        {
                            if (recRecord.SecurityRoles == null)
                            {
                                recRecord.Get_Roles(oSystem.cnCon);
                            }
                            else if (recRecord.SecurityRoles.Count <= 0)
                            {
                                recRecord.Get_Roles(oSystem.cnCon);
                            }

                            ViewBag.iParentID = recRecord.UserRole.iParentID;
                            ViewBag.sParentID = recRecord.UserRole.sParentID;
                            oSystem.CloseDataConnection();
                            oPage.DataModelsPrimary = recRecord;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UserRoles dbInteraction = new DINT_UserRoles(oSystem.cnCon);
                        List<DEF_UserRoles.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.UserRolesViewModel recRecord = new UserRolesViewModel();
                                recRecord.UserRole = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                recRecord.Get_Roles(oSystem.cnCon);

                                ViewBag.iParentID = recRecord.UserRole.iParentID;
                                ViewBag.sParentID = recRecord.UserRole.sParentID;
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult UserRoles_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("UserRoles_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUserRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    ACMSDBView.UserRolesViewModel recRecord = new ACMSDBView.UserRolesViewModel();
                    recRecord.UserRole = new DEF_UserRoles.RecordObject();
                    recRecord.UserRole.iParentID = _iParentID;
                    recRecord.UserRole.sParentID = _sParentID;

                    recRecord.Get_Roles(oSystem.cnCon);

                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        public ActionResult UserRoles_AddUpdate(ACMSDBView.UserRolesViewModel _rec)
        {
            Set_Client_NavSettings("UserRoles_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUserRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.UserRole.ID == null) || (_rec.UserRole.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.UserRole.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.UserRole.iParentID;
                            ViewBag.sParentID = _rec.UserRole.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_UserRoles dbInteraction = new DINT_UserRoles(oSystem.cnCon);

                                _rec.UserRole.sControl = Guid.NewGuid().ToString();
                                _rec.UserRole.dtDateCreated = DateTime.Now;
                                _rec.UserRole.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.UserRole);

                                _rec.Get_Roles(oSystem.cnCon);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("UserRoles_Details", new { key = _rec.UserRole.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.UserRole.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_UserRoles dbInteraction = new DINT_UserRoles(oSystem.cnCon);

                                    _rec.UserRole.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.UserRole);

                                    _rec.Get_Roles(oSystem.cnCon);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("UserRoles_Details", new { id = _rec.UserRole.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult UserRoles_Delete(int id)
        {
            Set_Client_NavSettings("UserRoles_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_UserRoles dbInteraction = new DINT_UserRoles(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_UserRoles.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UserRoles.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("UserRoles_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("UserRoles_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form Users
        public ActionResult Users_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("Users_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.IsAdmin = false;
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsers_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();

                    if (oSystem.CurrentUser.UserView.User.ID == 1)
                    {
                        ViewBag.IsAdmin = true;
                    }

                    DINT_Users dbInteraction = new DINT_Users(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_Users.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    //if (_iParentID > 0)
                    //{
                    //    DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    //    lstParameters.Add(pParameter);
                    //}

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;
                        lstParameters = new List<DataParameter>();

                        DataParameter pParameter = new DataParameter("sUserName", "'%" + Search + "%'", "string", 11, "sUserName", " LIKE ", "");
                        lstParameters.Add(pParameter);

                        pParameter = new DataParameter("sFName", "'%" + Search + "%'", "string", 14, "sFName", " LIKE ", " OR ");
                        lstParameters.Add(pParameter);

                        pParameter = new DataParameter("sLName", "'%" + Search + "%'", "string", 16, "sLName", " LIKE ", " OR ");
                        lstParameters.Add(pParameter);


                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_Users.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult Users_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("Users_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Users dbInteraction = new DINT_Users(oSystem.cnCon);
                        List<DEF_Users.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.UserViewModel recRecord = new UserViewModel(oSystem.cnCon);
                                recRecord.User = dbSearch[0];
                                recRecord.CurrentPassword = dbSearch[0].sPassword;
                                recRecord.GetUserProperties(oSystem.cnCon, dbSearch[0].ID);

                                recRecord.Get_Roles(oSystem.cnCon);
                                recRecord.Get_States(oSystem.cnCon);
                                recRecord.Get_WebSiteMemberShips(oSystem.cnCon);

                                ViewBag.iParentID = recRecord.User.iParentID;
                                ViewBag.sParentID = recRecord.User.sParentID;

                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Users dbInteraction = new DINT_Users(oSystem.cnCon);
                        List<DEF_Users.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.UserViewModel recRecord = new UserViewModel(oSystem.cnCon);

                                recRecord.User = dbSearch[0];
                                recRecord.CurrentPassword = dbSearch[0].sPassword;
                                recRecord.GetUserProperties(oSystem.cnCon, dbSearch[0].ID);


                                recRecord.Get_Roles(oSystem.cnCon);
                                recRecord.Get_States(oSystem.cnCon);
                                recRecord.Get_WebSiteMemberShips(oSystem.cnCon);

                                ViewBag.iParentID = recRecord.User.iParentID;
                                ViewBag.sParentID = recRecord.User.sParentID;

                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult Users_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("Users_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    ACMSDBView.UserViewModel recRecord = new ACMSDBView.UserViewModel(oSystem.cnCon);
                    recRecord.BuildAnanymousUser();
                    recRecord.User.iParentID = _iParentID;
                    recRecord.User.sParentID = _sParentID;

                    recRecord.User.dtDateOfBirth = DateTime.Parse("01/01/1901");
                    recRecord.User.dtLastLoggedIn = DateTime.Parse("01/01/1901");
                    recRecord.User.dtMembershipExpOn = DateTime.Parse("01/01/1901");

                    recRecord.Get_Roles(oSystem.cnCon);
                    recRecord.Get_States(oSystem.cnCon);
                    recRecord.Get_WebSiteMemberShips(oSystem.cnCon);

                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult Users_AddUpdate(FormCollection fc, HttpPostedFileBase UploadFiles1, ACMSDBView.UserViewModel _rec)
        {
            Set_Client_NavSettings("Users_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            string sFileUploadResults = "";

            bool bFileUploadError1 = false;

            string sImageURL1 = "";
            string sPrefix = "";
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.User.ID == null) || (_rec.User.ID <= 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.User.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.User.iParentID;
                            ViewBag.sParentID = _rec.User.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_Users dbInteraction = new DINT_Users(oSystem.cnCon);

                                #region Upload file - Image Thumbnail
                                try
                                {
                                    if (UploadFiles1 != null)
                                    {
                                        if (UploadFiles1.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                            {
                                                string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    sImageURL1 = "Uploads/" + UploadFiles1.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                    _rec.User.sAvitarImgURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                    _rec.User.sAvitarImgURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                _rec.User.sControl = Guid.NewGuid().ToString();
                                _rec.User.dtDateCreated = DateTime.Now;
                                _rec.User.dtLastUpdated = DateTime.Now;

                                _rec.User.sPassword = oSystem.rsGlobalVeriables.oEncryption.Encrypt(_rec.User.sPassword);
                                _rec.CurrentPassword = _rec.User.sPassword;

                                dbInteraction.Insert_SQL(_rec.User);

                                _rec.Get_Roles(oSystem.cnCon);
                                _rec.Get_States(oSystem.cnCon);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("Users_Details", new { key = _rec.User.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.User.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_Users dbInteraction = new DINT_Users(oSystem.cnCon);

                                    #region Upload file - Image Thumbnail
                                    try
                                    {
                                        if (UploadFiles1 != null)
                                        {
                                            if (UploadFiles1.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                                {
                                                    string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                        sImageURL1 = "Uploads/" + UploadFiles1.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                        _rec.User.sAvitarImgURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                        _rec.User.sAvitarImgURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    _rec.User.dtLastUpdated = DateTime.Now;

                                    if (String.IsNullOrEmpty(_rec.User.sPassword))
                                    {
                                        _rec.User.sPassword = _rec.CurrentPassword;
                                    }
                                    else
                                    {
                                        _rec.User.sPassword = oSystem.rsGlobalVeriables.oEncryption.Encrypt(_rec.User.sPassword);
                                        _rec.CurrentPassword = _rec.User.sPassword;
                                    }

                                    dbInteraction.Update_SQL(_rec.User);

                                    _rec.Get_Roles(oSystem.cnCon);
                                    _rec.Get_States(oSystem.cnCon);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("Users_Details", new { id = _rec.User.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult Users_Delete(int id)
        {
            Set_Client_NavSettings("Users_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_Users dbInteraction = new DINT_Users(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_Users.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Users.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("Users_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("Users_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form UsersChatSessions

        string sUsersChatSessions_Details = "/views/Forms/UsersChatSessions_Details.cshtml";
        string sUsersChatSessions_List = "/views/Forms/UsersChatSessions_List.cshtml";


        public ActionResult UsersChatSessions_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("UsersChatSessions");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersChatSessions_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_UsersChatSessions dbInteraction = new DINT_UsersChatSessions(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_UsersChatSessions.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_UsersChatSessions.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult UsersChatSessions_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("UsersChatSessions");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersChatSessions_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UsersChatSessions dbInteraction = new DINT_UsersChatSessions(oSystem.cnCon);
                        List<DEF_UsersChatSessions.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersChatSessions.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UsersChatSessions dbInteraction = new DINT_UsersChatSessions(oSystem.cnCon);
                        List<DEF_UsersChatSessions.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersChatSessions.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult UsersChatSessions_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("UsersChatSessions");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersChatSessions_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_UsersChatSessions.RecordObject recRecord = new DEF_UsersChatSessions.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public ActionResult UsersChatSessions_AddUpdate(DEF_UsersChatSessions.RecordObject _rec)
        {
            Set_Client_NavSettings("UsersChatSessions");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersChatSessions_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_UsersChatSessions dbInteraction = new DINT_UsersChatSessions(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("UsersChatSessions_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_UsersChatSessions dbInteraction = new DINT_UsersChatSessions(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("UsersChatSessions_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult UsersChatSessions_Delete(int id)
        {
            Set_Client_NavSettings("UsersChatSessions");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_UsersChatSessions dbInteraction = new DINT_UsersChatSessions(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_UsersChatSessions.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersChatSessions.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("UsersChatSessions_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("UsersChatSessions_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form UsersChats

        string sUsersChats_Details = "/views/Forms/UsersChats_Details.cshtml";
        string sUsersChats_List = "/views/Forms/UsersChats_List.cshtml";

        public ActionResult UsersChats_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersChats_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_UsersChats dbInteraction = new DINT_UsersChats(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_UsersChats.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        if (_iParentID > 0)
                        {
                            DataParameter pParameter = new DataParameter("sTitle", "'%" + Search + "%'", "string", 11, "sTitle", " LIKE ", " AND ");
                            lstParameters.Add(pParameter);
                            iTotalRows = dbInteraction.GetRowCount(lstParameters);
                        }
                        else
                        {
                            DataParameter pParameter = new DataParameter("sTitle", "'%" + Search + "%'", "string", 11, "sTitle", " LIKE ", "");
                            lstParameters.Add(pParameter);
                            iTotalRows = dbInteraction.GetRowCount(lstParameters);
                        }
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_UsersChats.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult UsersChats_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersChats_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UsersChats dbInteraction = new DINT_UsersChats(oSystem.cnCon);
                        List<DEF_UsersChats.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersChats.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UsersChats dbInteraction = new DINT_UsersChats(oSystem.cnCon);
                        List<DEF_UsersChats.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersChats.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }


        public ActionResult UsersChats_Create(int _iParentID = 0, string _sParentID = "")
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersChats_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_UsersChats.RecordObject recRecord = new DEF_UsersChats.RecordObject();

                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;


                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult UsersChats_AddUpdate(DEF_UsersChats.RecordObject _rec)
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersChats_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_UsersChats dbInteraction = new DINT_UsersChats(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                //List<DataParameter> lstParameters = new List<DataParameter>();
                                //DataParameter pParameter = new DataParameter("sControl", "'" + _rec.WebSitePage.sControl.ToString() + "'", "sControl", 3, "sControl", " = ", "");
                                //lstParameters.Add(pParameter);

                                //List<DEF_UsersChats.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                                //if (dbSearch != null)
                                //{
                                //  if (dbSearch.Count > 0)
                                //  {
                                //      _rec = dbSearch[0];
                                //      ViewBag.iParentID = _rec.iParentID;
                                //      ViewBag.sParentID = _rec.sParentID;
                                //  }
                                //}


                                oSystem.CloseDataConnection();
                                //return RedirectToAction("UsersChats_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                #endregion
                                return RedirectToAction("UsersChats_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_UsersChats dbInteraction = new DINT_UsersChats(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;
                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("UsersChats_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    oSystem.CloseDataConnection();
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);
                                }
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult UsersChats_Delete(int id)
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_UsersChats dbInteraction = new DINT_UsersChats(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_UsersChats.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersChats.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        //iParentID = recRecord.iParentID;
                                        //sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();
                        return RedirectToAction("UsersChats_List", new { _iParentID = iParentID, _sParentID = sParentID });
                        //return RedirectToAction("UsersChats_List");
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("UsersChats_List", new { _iParentID = iParentID, _sParentID = sParentID });
                        //return RedirectToAction("UsersChats_List");
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form UsersChatMembers

        string sUsersChatMembers_Details = "/views/Forms/UsersChatMembers_Details.cshtml";
        string sUsersChatMembers_List = "/views/Forms/UsersChatMembers_List.cshtml";


        public ActionResult UsersChatMembers_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("UsersChatMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersChatMembers_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_UsersChatMembers dbInteraction = new DINT_UsersChatMembers(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_UsersChatMembers.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_UsersChatMembers.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult UsersChatMembers_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("UsersChatMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersChatMembers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UsersChatMembers dbInteraction = new DINT_UsersChatMembers(oSystem.cnCon);
                        List<DEF_UsersChatMembers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersChatMembers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UsersChatMembers dbInteraction = new DINT_UsersChatMembers(oSystem.cnCon);
                        List<DEF_UsersChatMembers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersChatMembers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult UsersChatMembers_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("UsersChatMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersChatMembers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_UsersChatMembers.RecordObject recRecord = new DEF_UsersChatMembers.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public ActionResult UsersChatMembers_AddUpdate(DEF_UsersChatMembers.RecordObject _rec)
        {
            Set_Client_NavSettings("UsersChatMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersChatMembers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_UsersChatMembers dbInteraction = new DINT_UsersChatMembers(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("UsersChatMembers_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_UsersChatMembers dbInteraction = new DINT_UsersChatMembers(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("UsersChatMembers_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult UsersChatMembers_Delete(int id)
        {
            Set_Client_NavSettings("UsersChatMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_UsersChatMembers dbInteraction = new DINT_UsersChatMembers(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_UsersChatMembers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersChatMembers.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("UsersChatMembers_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("UsersChatMembers_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form UsersLogs

        string sUsersLogs_Details = "/views/Forms/UsersLogs_Details.cshtml";
        string sUsersLogs_List = "/views/Forms/UsersLogs_List.cshtml";

        public ActionResult UsersLogs_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersLogs_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_UsersLogs dbInteraction = new DINT_UsersLogs(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_UsersLogs.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;

                    if (_iParentID > 0)
                    {
                        pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        if (_iParentID > 0)
                        {
                            pParameter = new DataParameter("sTitle", "'%" + Search + "%'", "string", 11, "sTitle", " LIKE ", " AND ");
                            lstParameters.Add(pParameter);
                            iTotalRows = dbInteraction.GetRowCount(lstParameters);
                        }
                        else
                        {
                            pParameter = new DataParameter("sTitle", "'%" + Search + "%'", "string", 11, "sTitle", " LIKE ", "");
                            lstParameters.Add(pParameter);
                            iTotalRows = dbInteraction.GetRowCount(lstParameters);
                        }
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_UsersLogs.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult UsersLogs_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersLogs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UsersLogs dbInteraction = new DINT_UsersLogs(oSystem.cnCon);
                        List<DEF_UsersLogs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersLogs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UsersLogs dbInteraction = new DINT_UsersLogs(oSystem.cnCon);
                        List<DEF_UsersLogs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersLogs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        //
        public ActionResult UsersLogs_Create(int _iParentID = 0, string _sParentID = "")
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersLogs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_UsersLogs.RecordObject recRecord = new DEF_UsersLogs.RecordObject();

                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;


                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public ActionResult UsersLogs_AddUpdate(DEF_UsersLogs.RecordObject _rec)
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersLogs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_UsersLogs dbInteraction = new DINT_UsersLogs(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                //List<DataParameter> lstParameters = new List<DataParameter>();
                                //DataParameter pParameter = new DataParameter("sControl", "'" + _rec.WebSitePage.sControl.ToString() + "'", "sControl", 3, "sControl", " = ", "");
                                //lstParameters.Add(pParameter);

                                //List<DEF_UsersLogs.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                                //if (dbSearch != null)
                                //{
                                //  if (dbSearch.Count > 0)
                                //  {
                                //      _rec = dbSearch[0];
                                //      ViewBag.iParentID = _rec.iParentID;
                                //      ViewBag.sParentID = _rec.sParentID;
                                //  }
                                //}


                                oSystem.CloseDataConnection();
                                //return RedirectToAction("UsersLogs_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                #endregion
                                return RedirectToAction("UsersLogs_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_UsersLogs dbInteraction = new DINT_UsersLogs(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;
                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("UsersLogs_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    oSystem.CloseDataConnection();
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);
                                }
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult UsersLogs_Delete(int id)
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_UsersLogs dbInteraction = new DINT_UsersLogs(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_UsersLogs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersLogs.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        //iParentID = recRecord.iParentID;
                                        //sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();
                        return RedirectToAction("UsersLogs_List", new { _iParentID = iParentID, _sParentID = sParentID });
                        //return RedirectToAction("UsersLogs_List");
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("UsersLogs_List", new { _iParentID = iParentID, _sParentID = sParentID });
                        //return RedirectToAction("UsersLogs_List");
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form UsersMessages

        string sUsersMessages_Details = "/views/Forms/UsersMessages_Details.cshtml";
        string sUsersMessages_List = "/views/Forms/UsersMessages_List.cshtml";

        public ActionResult UsersMessages_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersMessages_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_UsersMessages dbInteraction = new DINT_UsersMessages(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_UsersMessages.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;

                    if (_iParentID > 0)
                    {
                        pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        if (_iParentID > 0)
                        {
                            pParameter = new DataParameter("sTitle", "'%" + Search + "%'", "string", 11, "sTitle", " LIKE ", " AND ");
                            lstParameters.Add(pParameter);
                            iTotalRows = dbInteraction.GetRowCount(lstParameters);
                        }
                        else
                        {
                            pParameter = new DataParameter("sTitle", "'%" + Search + "%'", "string", 11, "sTitle", " LIKE ", "");
                            lstParameters.Add(pParameter);
                            iTotalRows = dbInteraction.GetRowCount(lstParameters);
                        }
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_UsersMessages.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult UsersMessages_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersMessages_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UsersMessages dbInteraction = new DINT_UsersMessages(oSystem.cnCon);
                        List<DEF_UsersMessages.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersMessages.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UsersMessages dbInteraction = new DINT_UsersMessages(oSystem.cnCon);
                        List<DEF_UsersMessages.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersMessages.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult UsersMessages_Create(int _iParentID = 0, string _sParentID = "")
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersMessages_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_UsersMessages.RecordObject recRecord = new DEF_UsersMessages.RecordObject();

                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;


                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult UsersMessages_AddUpdate(DEF_UsersMessages.RecordObject _rec)
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersMessages_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_UsersMessages dbInteraction = new DINT_UsersMessages(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                //List<DataParameter> lstParameters = new List<DataParameter>();
                                //DataParameter pParameter = new DataParameter("sControl", "'" + _rec.WebSitePage.sControl.ToString() + "'", "sControl", 3, "sControl", " = ", "");
                                //lstParameters.Add(pParameter);

                                //List<DEF_UsersMessages.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                                //if (dbSearch != null)
                                //{
                                //  if (dbSearch.Count > 0)
                                //  {
                                //      _rec = dbSearch[0];
                                //      ViewBag.iParentID = _rec.iParentID;
                                //      ViewBag.sParentID = _rec.sParentID;
                                //  }
                                //}


                                oSystem.CloseDataConnection();
                                //return RedirectToAction("UsersMessages_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                #endregion
                                return RedirectToAction("UsersMessages_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_UsersMessages dbInteraction = new DINT_UsersMessages(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;
                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("UsersMessages_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    oSystem.CloseDataConnection();
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);
                                }
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult UsersMessages_Delete(int id)
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_UsersMessages dbInteraction = new DINT_UsersMessages(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_UsersMessages.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersMessages.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        //iParentID = recRecord.iParentID;
                                        //sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();
                        return RedirectToAction("UsersMessages_List", new { _iParentID = iParentID, _sParentID = sParentID });
                        //return RedirectToAction("UsersMessages_List");
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("UsersMessages_List", new { _iParentID = iParentID, _sParentID = sParentID });
                        //return RedirectToAction("UsersMessages_List");
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form UsersPosts

        string sUsersPosts_Details = "/views/Forms/UsersPosts_Details.cshtml";
        string sUsersPosts_List = "/views/Forms/UsersPosts_List.cshtml";


        public ActionResult UsersPosts_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersPosts_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_UsersPosts dbInteraction = new DINT_UsersPosts(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_UsersPosts.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;

                    if (_iParentID > 0)
                    {
                        pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        if (_iParentID > 0)
                        {
                            pParameter = new DataParameter("sSubject", "'%" + Search + "%'", "string", 11, "sSubject", " LIKE ", " AND ");
                            lstParameters.Add(pParameter);
                            iTotalRows = dbInteraction.GetRowCount(lstParameters);
                        }
                        else
                        {
                            pParameter = new DataParameter("sSubject", "'%" + Search + "%'", "string", 11, "sSubject", " LIKE ", "");
                            lstParameters.Add(pParameter);
                            iTotalRows = dbInteraction.GetRowCount(lstParameters);
                        }
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_UsersPosts.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult UsersPosts_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersPosts_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UsersPosts dbInteraction = new DINT_UsersPosts(oSystem.cnCon);
                        List<DEF_UsersPosts.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersPosts.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UsersPosts dbInteraction = new DINT_UsersPosts(oSystem.cnCon);
                        List<DEF_UsersPosts.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersPosts.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult UsersPosts_Create(int _iParentID = 0, string _sParentID = "")
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersPosts_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_UsersPosts.RecordObject recRecord = new DEF_UsersPosts.RecordObject();

                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;


                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult UsersPosts_AddUpdate(DEF_UsersPosts.RecordObject _rec)
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersPosts_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_UsersPosts dbInteraction = new DINT_UsersPosts(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                //List<DataParameter> lstParameters = new List<DataParameter>();
                                //DataParameter pParameter = new DataParameter("sControl", "'" + _rec.WebSitePage.sControl.ToString() + "'", "sControl", 3, "sControl", " = ", "");
                                //lstParameters.Add(pParameter);

                                //List<DEF_UsersPosts.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                                //if (dbSearch != null)
                                //{
                                //  if (dbSearch.Count > 0)
                                //  {
                                //      _rec = dbSearch[0];
                                //      ViewBag.iParentID = _rec.iParentID;
                                //      ViewBag.sParentID = _rec.sParentID;
                                //  }
                                //}


                                oSystem.CloseDataConnection();
                                //return RedirectToAction("UsersPosts_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                #endregion
                                return RedirectToAction("UsersPosts_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_UsersPosts dbInteraction = new DINT_UsersPosts(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;
                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("UsersPosts_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    oSystem.CloseDataConnection();
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);
                                }
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult UsersPosts_Delete(int id)
        {
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_UsersPosts dbInteraction = new DINT_UsersPosts(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_UsersPosts.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersPosts.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        //iParentID = recRecord.iParentID;
                                        //sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();
                        //return RedirectToAction("UsersPosts_List", new { _iParentID = iParentID, _sParentID = sParentID });
                        return RedirectToAction("UsersPosts_List");
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        //return RedirectToAction("UsersPosts_List", new { _iParentID = iParentID, _sParentID = sParentID });
                        return RedirectToAction("UsersPosts_List");
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form UsersAltAuth
        public ActionResult UsersAltAuth_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("UsersAltAuth_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersAltAuth_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_UsersAltAuth dbInteraction = new DINT_UsersAltAuth(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_UsersAltAuth.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sAuthValue1", "'" + Search + "'", "string", 10, "sAuthValue1", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_UsersAltAuth.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult UsersAltAuth_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("UsersAltAuth_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersAltAuth_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UsersAltAuth dbInteraction = new DINT_UsersAltAuth(oSystem.cnCon);
                        List<DEF_UsersAltAuth.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersAltAuth.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UsersAltAuth dbInteraction = new DINT_UsersAltAuth(oSystem.cnCon);
                        List<DEF_UsersAltAuth.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersAltAuth.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult UsersAltAuth_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("UsersAltAuth_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersAltAuth_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_UsersAltAuth.RecordObject recRecord = new DEF_UsersAltAuth.RecordObject();
                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;

                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult UsersAltAuth_AddUpdate(DEF_UsersAltAuth.RecordObject _rec)
        {
            Set_Client_NavSettings("UsersAltAuth_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersAltAuth_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_UsersAltAuth dbInteraction = new DINT_UsersAltAuth(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("UsersAltAuth_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_UsersAltAuth dbInteraction = new DINT_UsersAltAuth(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("UsersAltAuth_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult UsersAltAuth_Delete(int id)
        {
            Set_Client_NavSettings("UsersAltAuth_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_UsersAltAuth dbInteraction = new DINT_UsersAltAuth(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_UsersAltAuth.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersAltAuth.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("UsersAltAuth_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("UsersAltAuth_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form UsersProperties
        public ActionResult UsersProperties_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("UsersProperties_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersProperties_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_UsersProperties dbInteraction = new DINT_UsersProperties(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_UsersProperties.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sFieldName", "'" + Search + "'", "string", 10, "sFieldName", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_UsersProperties.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }


                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult UsersProperties_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("UsersProperties_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UsersProperties dbInteraction = new DINT_UsersProperties(oSystem.cnCon);
                        List<DEF_UsersProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UsersProperties dbInteraction = new DINT_UsersProperties(oSystem.cnCon);
                        List<DEF_UsersProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }


                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult UsersProperties_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("UsersProperties_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_UsersProperties.RecordObject recRecord = new DEF_UsersProperties.RecordObject();
                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;


                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);


                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult UsersProperties_AddUpdate(DEF_UsersProperties.RecordObject _rec)
        {
            Set_Client_NavSettings("UsersProperties_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUsersProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_UsersProperties dbInteraction = new DINT_UsersProperties(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("UsersProperties_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_UsersProperties dbInteraction = new DINT_UsersProperties(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("UsersProperties_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";


                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }

            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult UsersProperties_Delete(int id)
        {
            Set_Client_NavSettings("UsersProperties_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_UsersProperties dbInteraction = new DINT_UsersProperties(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_UsersProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UsersProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("UsersProperties_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("UsersProperties_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebMarketingLists

        string sWebMarketingLists_Details = "/views/Forms/WebMarketingLists_Details.cshtml";
        string sWebMarketingLists_List = "/views/Forms/WebMarketingLists_List.cshtml";


        public ActionResult WebMarketingLists_List(FormCollection fc, string Search, int page = 1)
        {
            Set_Client_NavSettings("WebMarketingLists");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebMarketingLists_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebMarketingLists dbInteraction = new DINT_WebMarketingLists(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebMarketingLists.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebMarketingLists.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebMarketingLists_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebMarketingLists");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebMarketingLists_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebMarketingLists dbInteraction = new DINT_WebMarketingLists(oSystem.cnCon);
                        List<DEF_WebMarketingLists.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebMarketingLists.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebMarketingLists dbInteraction = new DINT_WebMarketingLists(oSystem.cnCon);
                        List<DEF_WebMarketingLists.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebMarketingLists.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebMarketingLists_Create()

        {
            Set_Client_NavSettings("WebMarketingLists");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process




                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebMarketingLists_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebMarketingLists.RecordObject recRecord = new DEF_WebMarketingLists.RecordObject();








                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public ActionResult WebMarketingLists_AddUpdate(DEF_WebMarketingLists.RecordObject _rec)
        {
            Set_Client_NavSettings("WebMarketingLists");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebMarketingLists_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {




                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebMarketingLists dbInteraction = new DINT_WebMarketingLists(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebMarketingLists_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebMarketingLists dbInteraction = new DINT_WebMarketingLists(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebMarketingLists_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebMarketingLists_Delete(int id)
        {
            Set_Client_NavSettings("WebMarketingLists");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebMarketingLists dbInteraction = new DINT_WebMarketingLists(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebMarketingLists.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebMarketingLists.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {




                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebMarketingLists_List");


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebMarketingLists_List");

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebMarketingListsMembers

        string sWebMarketingListsMembers_Details = "/views/Forms/WebMarketingListsMembers_Details.cshtml";
        string sWebMarketingListsMembers_List = "/views/Forms/WebMarketingListsMembers_List.cshtml";


        public ActionResult WebMarketingListsMembers_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebMarketingListsMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebMarketingListsMembers_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebMarketingListsMembers dbInteraction = new DINT_WebMarketingListsMembers(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebMarketingListsMembers.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebMarketingListsMembers.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebMarketingListsMembers_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebMarketingListsMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebMarketingListsMembers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebMarketingListsMembers dbInteraction = new DINT_WebMarketingListsMembers(oSystem.cnCon);
                        List<DEF_WebMarketingListsMembers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebMarketingListsMembers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebMarketingListsMembers dbInteraction = new DINT_WebMarketingListsMembers(oSystem.cnCon);
                        List<DEF_WebMarketingListsMembers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebMarketingListsMembers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebMarketingListsMembers_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebMarketingListsMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebMarketingListsMembers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebMarketingListsMembers.RecordObject recRecord = new DEF_WebMarketingListsMembers.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public ActionResult WebMarketingListsMembers_AddUpdate(DEF_WebMarketingListsMembers.RecordObject _rec)
        {
            Set_Client_NavSettings("WebMarketingListsMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebMarketingListsMembers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebMarketingListsMembers dbInteraction = new DINT_WebMarketingListsMembers(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebMarketingListsMembers_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebMarketingListsMembers dbInteraction = new DINT_WebMarketingListsMembers(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebMarketingListsMembers_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebMarketingListsMembers_Delete(int id)
        {
            Set_Client_NavSettings("WebMarketingListsMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebMarketingListsMembers dbInteraction = new DINT_WebMarketingListsMembers(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebMarketingListsMembers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebMarketingListsMembers.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebMarketingListsMembers_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebMarketingListsMembers_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }


        [HttpPost]
        public JsonResult WebMarketingListsMembers_AddNewUser(int _ID, int _LeadID, int _UserID)
        {
            Set_ViewBag_UserInfo_Defaults();
            string sRESPONSE = "false";
            string sRESPONSEMESSAGE = "Error";
            try
            {
                if (oSystem.OpenDataConnection())
                {
                    #region
                    if (oSystem.GetCurrentUser())
                    {
                        if (_ID > 0)
                        {
                            if ((_LeadID > 0) || (_UserID > 0))
                            {
                                try
                                {
                                    DINT_WebMarketingListsMembers dbWebMarketingListsMembers = new DINT_WebMarketingListsMembers(oSystem.cnCon);

                                    DEF_WebMarketingListsMembers.RecordObject oListMember = new DEF_WebMarketingListsMembers.RecordObject();
                                    oListMember.iParentID = _ID;
                                    oListMember.sParentID = "";
                                    oListMember.sControl = Guid.NewGuid().ToString();
                                    oListMember.sSync = Guid.NewGuid().ToString();
                                    oListMember.dtDateCreated = DateTime.Now;
                                    oListMember.dtLastUpdated = DateTime.Now;
                                    oListMember.dtLastsendouton = DateTime.Parse("01/01/1901");
                                    oListMember.dtsentouton = DateTime.Parse("01/01/1901");

                                    oListMember.iCreatedByID = oSystem.CurrentUser.UserView.User.ID;
                                    oListMember.sCreatedByID = oSystem.CurrentUser.UserView.User.sUserName;
                                    oListMember.iUpdatedByID = oSystem.CurrentUser.UserView.User.ID;
                                    oListMember.sUpdatedByID = oSystem.CurrentUser.UserView.User.sUserName;

                                    oListMember.bClicked = false;
                                    oListMember.bDisabled = false;
                                    oListMember.bHidden = false;
                                    oListMember.bNegative = false;
                                    oListMember.bOpenned = false;
                                    oListMember.bReceived = false;
                                    oListMember.bSent = false;
                                    oListMember.bSuspended = false;


                                    List<DataParameter> lstParameters = new List<DataParameter>();
                                    DataParameter pParameter = null;

                                    if (_LeadID > 0)
                                    {
                                        DINT_WebSite_Leads dbWebSite_Leads = new DINT_WebSite_Leads(oSystem.cnCon);
                                        List<DEF_WebSite_Leads.RecordObject> lstWebSite_Leads_Search = null;

                                        pParameter = new DataParameter("ID", "'" + _LeadID + "'", "int", 0, "ID", " = ", "");
                                        lstParameters.Add(pParameter);

                                        lstWebSite_Leads_Search = dbWebSite_Leads.Get(lstParameters);
                                        if (lstWebSite_Leads_Search != null)
                                        {
                                            if (lstWebSite_Leads_Search.Count > 0)
                                            {
                                                oListMember.iLeadID = lstWebSite_Leads_Search[0].ID;
                                                oListMember.sLeadID = lstWebSite_Leads_Search[0].sPrimaryEMail;
                                                oListMember.iUserID = lstWebSite_Leads_Search[0].iUserID;
                                                oListMember.sUserID = lstWebSite_Leads_Search[0].sUserID;
                                                oListMember.sFName = lstWebSite_Leads_Search[0].sFName;
                                                oListMember.sLName = lstWebSite_Leads_Search[0].sLName;
                                                oListMember.sEMail = lstWebSite_Leads_Search[0].sPrimaryEMail;
                                                oListMember.sAvitarURL = lstWebSite_Leads_Search[0].sAvitarImgURL;
                                                oListMember.sCellPhone = lstWebSite_Leads_Search[0].sPrimaryPhone;

                                                dbWebMarketingListsMembers.Insert_SQL(oListMember);

                                                sRESPONSE = "true";
                                                sRESPONSEMESSAGE = "Profile found and sent!";
                                            }
                                        }
                                    }
                                    else if (_UserID > 0)
                                    {
                                        DINT_Users dbUsers = new DINT_Users(oSystem.cnCon);
                                        List<DEF_Users.RecordObject> lstUser_Search = null;

                                        pParameter = new DataParameter("ID", "'" + _UserID + "'", "int", 0, "ID", " = ", "");
                                        lstParameters.Add(pParameter);

                                        lstUser_Search = dbUsers.Get(lstParameters);
                                        if (lstUser_Search != null)
                                        {
                                            if (lstUser_Search.Count > 0)
                                            {
                                                if (lstUser_Search[0].bOptInMarketing == false)
                                                {
                                                    oListMember.iLeadID = 0;
                                                    oListMember.sLeadID = "";
                                                    oListMember.iUserID = lstUser_Search[0].ID;
                                                    oListMember.sUserID = lstUser_Search[0].sPrimaryEMail;
                                                    oListMember.sFName = lstUser_Search[0].sFName;
                                                    oListMember.sLName = lstUser_Search[0].sLName;
                                                    oListMember.sEMail = lstUser_Search[0].sPrimaryEMail;
                                                    oListMember.sAvitarURL = lstUser_Search[0].sAvitarImgURL;
                                                    oListMember.sCellPhone = lstUser_Search[0].sPrimaryPhone;

                                                    dbWebMarketingListsMembers.Insert_SQL(oListMember);

                                                    sRESPONSE = "true";
                                                    sRESPONSEMESSAGE = "Profile found and sent!";
                                                }
                                            }
                                        }
                                    }

                                }
                                catch
                                {
                                    sRESPONSE = "false";
                                    sRESPONSEMESSAGE = "Sorry could not find your information!";
                                }

                            }
                            else
                            {
                                sRESPONSE = "false";
                                sRESPONSEMESSAGE = "Error, Invalid User ID or Lead ID!";
                            }
                        }
                        else
                        {
                            sRESPONSE = "false";
                            sRESPONSEMESSAGE = "Error, invalid List ID!";
                        }
                    }
                    else
                    {
                        sRESPONSE = "false";
                        sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                    }
                    #endregion
                }
            }
            catch (Exception s)
            {
                sRESPONSEMESSAGE += " Exception: " + s.ToString();
            }
            oSystem.CloseDataConnection();
            var oResponse = Json(new { RESPONSE = sRESPONSE, MESSAGE = sRESPONSEMESSAGE });
            return oResponse;
        }

        [HttpPost]
        public JsonResult WebMarketingListsMembers_RemoveUser(int _ID, int _LeadID, int _UserID)
        {
            Set_ViewBag_UserInfo_Defaults();
            string sRESPONSE = "false";
            string sRESPONSEMESSAGE = "Error";
            try
            {
                if (oSystem.OpenDataConnection())
                {
                    #region
                    if (oSystem.GetCurrentUser())
                    {
                        if (_ID > 0)
                        {
                            if ((_LeadID > 0) || (_UserID > 0))
                            {
                                try
                                {

                                    List<DataParameter> lstParameters = new List<DataParameter>();
                                    DataParameter pParameter = null;

                                    DINT_WebMarketingListsMembers dbWebMarketingListsMembers = new DINT_WebMarketingListsMembers(oSystem.cnCon);
                                    List<DEF_WebMarketingListsMembers.RecordObject> lstWebMarketingListsMembers = null;

                                    if (_LeadID > 0)
                                    {

                                        pParameter = new DataParameter("iParentID", "'" + _ID + "'", "int", 0, "iParentID", " = ", "");
                                        lstParameters.Add(pParameter);
                                        pParameter = new DataParameter("iLeadID", "'" + _LeadID + "'", "int", 0, "iLeadID", " = ", " and ");
                                        lstParameters.Add(pParameter);

                                        lstWebMarketingListsMembers = dbWebMarketingListsMembers.Get(lstParameters);


                                    }
                                    else if (_UserID > 0)
                                    {

                                        pParameter = new DataParameter("iParentID", "'" + _ID + "'", "int", 0, "iParentID", " = ", "");
                                        lstParameters.Add(pParameter);
                                        pParameter = new DataParameter("iLeadID", "'" + _LeadID + "'", "int", 0, "iLeadID", " = ", " and ");
                                        lstParameters.Add(pParameter);

                                        lstWebMarketingListsMembers = dbWebMarketingListsMembers.Get(lstParameters);

                                    }

                                    if (lstWebMarketingListsMembers != null)
                                    {
                                        if (lstWebMarketingListsMembers.Count > 0)
                                        {
                                            dbWebMarketingListsMembers.Delete_SQL(lstWebMarketingListsMembers[0]);
                                            sRESPONSE = "true";
                                            sRESPONSEMESSAGE = "Record Removed!";
                                        }
                                    }
                                }
                                catch
                                {
                                    sRESPONSE = "false";
                                    sRESPONSEMESSAGE = "Sorry could not find your information!";
                                }

                            }
                            else
                            {
                                sRESPONSE = "false";
                                sRESPONSEMESSAGE = "Error, Invalid User ID or Lead ID!";
                            }
                        }
                        else
                        {
                            sRESPONSE = "false";
                            sRESPONSEMESSAGE = "Error, invalid List ID!";
                        }
                    }
                    else
                    {
                        sRESPONSE = "false";
                        sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                    }
                    #endregion
                }
            }
            catch (Exception s)
            {
                sRESPONSEMESSAGE += " Exception: " + s.ToString();
            }
            oSystem.CloseDataConnection();
            var oResponse = Json(new { RESPONSE = sRESPONSE, MESSAGE = sRESPONSEMESSAGE });
            return oResponse;
        }

        [HttpPost]
        public JsonResult WebMarketingListsMembers_AddAllLeads(int _ID)
        {
            Set_ViewBag_UserInfo_Defaults();
            string sRESPONSE = "false";
            string sRESPONSEMESSAGE = "Error";
            try
            {
                if (oSystem.OpenDataConnection())
                {
                    #region
                    if (oSystem.GetCurrentUser())
                    {
                        if (_ID > 0)
                        {
                            try
                            {
                                List<DataParameter> lstParameters = new List<DataParameter>();
                                DataParameter pParameter = null;

                                DINT_WebMarketingListsMembers dbWebMarketingListsMembers = new DINT_WebMarketingListsMembers(oSystem.cnCon);

                                DINT_WebSite_Leads dbWebSite_Leads = new DINT_WebSite_Leads(oSystem.cnCon);
                                List<DEF_WebSite_Leads.RecordObject> lstWebSite_Leads_Search = null;


                                lstWebSite_Leads_Search = dbWebSite_Leads.Get();
                                if (lstWebSite_Leads_Search != null)
                                {
                                    if (lstWebSite_Leads_Search.Count > 0)
                                    {

                                        foreach (DEF_WebSite_Leads.RecordObject oLead in lstWebSite_Leads_Search)
                                        {
                                            DEF_WebMarketingListsMembers.RecordObject oListMember = new DEF_WebMarketingListsMembers.RecordObject();
                                            oListMember.iParentID = _ID;
                                            oListMember.sParentID = "";
                                            oListMember.sControl = Guid.NewGuid().ToString();
                                            oListMember.sSync = Guid.NewGuid().ToString();
                                            oListMember.dtDateCreated = DateTime.Now;
                                            oListMember.dtLastUpdated = DateTime.Now;
                                            oListMember.dtLastsendouton = DateTime.Parse("01/01/1901");
                                            oListMember.dtsentouton = DateTime.Parse("01/01/1901");

                                            oListMember.iCreatedByID = oSystem.CurrentUser.UserView.User.ID;
                                            oListMember.sCreatedByID = oSystem.CurrentUser.UserView.User.sUserName;
                                            oListMember.iUpdatedByID = oSystem.CurrentUser.UserView.User.ID;
                                            oListMember.sUpdatedByID = oSystem.CurrentUser.UserView.User.sUserName;

                                            oListMember.bClicked = false;
                                            oListMember.bDisabled = false;
                                            oListMember.bHidden = false;
                                            oListMember.bNegative = false;
                                            oListMember.bOpenned = false;
                                            oListMember.bReceived = false;
                                            oListMember.bSent = false;
                                            oListMember.bSuspended = false;


                                            oListMember.iLeadID = oLead.ID;
                                            oListMember.sLeadID = oLead.sPrimaryEMail;
                                            oListMember.iUserID = oLead.iUserID;
                                            oListMember.sUserID = oLead.sUserID;
                                            oListMember.sFName = oLead.sFName;
                                            oListMember.sLName = oLead.sLName;
                                            oListMember.sEMail = oLead.sPrimaryEMail;
                                            oListMember.sAvitarURL = oLead.sAvitarImgURL;
                                            oListMember.sCellPhone = oLead.sPrimaryPhone;

                                            dbWebMarketingListsMembers.Insert_SQL(oListMember);
                                        }

                                        sRESPONSE = "true";
                                        sRESPONSEMESSAGE = "Profile found and sent!";

                                    }
                                    else
                                    {
                                        sRESPONSE = "false";
                                        sRESPONSEMESSAGE = "Error, No leads to add!";
                                    }
                                }
                                else
                                {
                                    sRESPONSE = "false";
                                    sRESPONSEMESSAGE = "Error, No leads to add!";
                                }

                            }
                            catch
                            {
                                sRESPONSE = "false";
                                sRESPONSEMESSAGE = "Sorry could not find your information!";
                            }
                        }
                        else
                        {
                            sRESPONSE = "false";
                            sRESPONSEMESSAGE = "Error, invalid List ID!";
                        }
                    }
                    else
                    {
                        sRESPONSE = "false";
                        sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                    }
                    #endregion
                }
            }
            catch (Exception s)
            {
                sRESPONSEMESSAGE += " Exception: " + s.ToString();
            }
            oSystem.CloseDataConnection();
            var oResponse = Json(new { RESPONSE = sRESPONSE, MESSAGE = sRESPONSEMESSAGE });
            return oResponse;
        }


        [HttpPost]
        public JsonResult WebMarketingListsMembers_AddAllUsers(int _ID)
        {
            Set_ViewBag_UserInfo_Defaults();
            string sRESPONSE = "false";
            string sRESPONSEMESSAGE = "Error";
            try
            {
                if (oSystem.OpenDataConnection())
                {
                    #region
                    if (oSystem.GetCurrentUser())
                    {
                        if (_ID > 0)
                        {
                            try
                            {
                                List<DataParameter> lstParameters = new List<DataParameter>();
                                DataParameter pParameter = null;

                                DINT_WebMarketingListsMembers dbWebMarketingListsMembers = new DINT_WebMarketingListsMembers(oSystem.cnCon);



                                DINT_Users dbUsers = new DINT_Users(oSystem.cnCon);
                                List<DEF_Users.RecordObject> lstUser_Search = null;

                                //pParameter = new DataParameter("ID", "'" + _UserID + "'", "int", 0, "ID", " = ", "");
                                //lstParameters.Add(pParameter);

                                lstUser_Search = dbUsers.Get(lstParameters);
                                if (lstUser_Search != null)
                                {
                                    if (lstUser_Search.Count > 0)
                                    {
                                        foreach (DEF_Users.RecordObject oUser in lstUser_Search)
                                        {
                                            if (oUser.bOptInMarketing == true)
                                            {
                                                DEF_WebMarketingListsMembers.RecordObject oListMember = new DEF_WebMarketingListsMembers.RecordObject();
                                                oListMember.iParentID = _ID;
                                                oListMember.sParentID = "";
                                                oListMember.sControl = Guid.NewGuid().ToString();
                                                oListMember.sSync = Guid.NewGuid().ToString();
                                                oListMember.dtDateCreated = DateTime.Now;
                                                oListMember.dtLastUpdated = DateTime.Now;
                                                oListMember.dtLastsendouton = DateTime.Parse("01/01/1901");
                                                oListMember.dtsentouton = DateTime.Parse("01/01/1901");

                                                oListMember.iCreatedByID = oSystem.CurrentUser.UserView.User.ID;
                                                oListMember.sCreatedByID = oSystem.CurrentUser.UserView.User.sUserName;
                                                oListMember.iUpdatedByID = oSystem.CurrentUser.UserView.User.ID;
                                                oListMember.sUpdatedByID = oSystem.CurrentUser.UserView.User.sUserName;

                                                oListMember.bClicked = false;
                                                oListMember.bDisabled = false;
                                                oListMember.bHidden = false;
                                                oListMember.bNegative = false;
                                                oListMember.bOpenned = false;
                                                oListMember.bReceived = false;
                                                oListMember.bSent = false;
                                                oListMember.bSuspended = false;
                                                oListMember.iLeadID = 0;
                                                oListMember.sLeadID = "";
                                                oListMember.iUserID = oUser.ID;
                                                oListMember.sUserID = oUser.sPrimaryEMail;
                                                oListMember.sFName = oUser.sFName;
                                                oListMember.sLName = oUser.sLName;
                                                oListMember.sEMail = oUser.sPrimaryEMail;
                                                oListMember.sAvitarURL = oUser.sAvitarImgURL;
                                                oListMember.sCellPhone = oUser.sPrimaryPhone;

                                                dbWebMarketingListsMembers.Insert_SQL(oListMember);
                                            }
                                        }
                                        sRESPONSE = "true";
                                        sRESPONSEMESSAGE = "Profile found and sent!";
                                    }
                                }

                            }
                            catch
                            {
                                sRESPONSE = "false";
                                sRESPONSEMESSAGE = "Sorry could not find your information!";
                            }
                        }
                        else
                        {
                            sRESPONSE = "false";
                            sRESPONSEMESSAGE = "Error, invalid List ID!";
                        }
                    }
                    else
                    {
                        sRESPONSE = "false";
                        sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                    }
                    #endregion
                }
            }
            catch (Exception s)
            {
                sRESPONSEMESSAGE += " Exception: " + s.ToString();
            }
            oSystem.CloseDataConnection();
            var oResponse = Json(new { RESPONSE = sRESPONSE, MESSAGE = sRESPONSEMESSAGE });
            return oResponse;
        }


        [HttpPost]
        public JsonResult WebMarketingListsMembers_SearchForUser(string _Search)
        {
            List<DEF_Users.RecordObject> oSearchResults_User = new List<DEF_Users.RecordObject>();
            List<DEF_WebSite_Leads.RecordObject> oSearchResults_Lead = new List<DEF_WebSite_Leads.RecordObject>();
            Set_ViewBag_UserInfo_Defaults();
            string sRESPONSE = "false";
            string sRESPONSEMESSAGE = "Error";

            if (oSystem.OpenDataConnection())
            {
                #region
                if (oSystem.GetCurrentUser())
                {
                    try
                    {

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = null;
                        bool bIsNumber = false;
                        bool bIsDate = false;
                        #region check data type
                        try
                        {
                            int iTemp = System.Convert.ToInt32(_Search);
                            bIsNumber = true;
                        }
                        catch
                        {

                        }
                        try
                        {
                            DateTime dtTemp = System.Convert.ToDateTime(_Search);
                            bIsDate = true;
                        }
                        catch
                        {

                        }
                        #endregion



                        DINT_Users dbUsers = new DINT_Users(oSystem.cnCon);
                        #region Search User
                        lstParameters = new List<DataParameter>();
                        pParameter = null;
                        pParameter = new DataParameter("sPrimaryEMail", "'" + _Search + "'", "string", 11, "sPrimaryEMail", " = ", "");
                        lstParameters.Add(pParameter);

                        if (bIsNumber)
                        {
                            pParameter = new DataParameter("ID", "'" + _Search + "'", "int", 11, "ID", " = ", " or ");
                            lstParameters.Add(pParameter);
                        }

                        if (bIsDate)
                        {
                            pParameter = new DataParameter("dtMembershipExpOn", "'" + _Search + "'", "DateTime", 11, "dtMembershipExpOn", " = ", " or ");
                            lstParameters.Add(pParameter);

                            pParameter = new DataParameter("dtLastLoggedIn", "'" + _Search + "'", "DateTime", 11, "dtLastLoggedIn", " = ", " or ");
                            lstParameters.Add(pParameter);

                            pParameter = new DataParameter("dtDateOfBirth", "'" + _Search + "'", "DateTime", 11, "dtDateOfBirth", " = ", " or ");
                            lstParameters.Add(pParameter);

                            pParameter = new DataParameter("dtDateCreated", "'" + _Search + "'", "DateTime", 11, "dtDateCreated", " = ", " or ");
                            lstParameters.Add(pParameter);
                        }


                        pParameter = new DataParameter("sFName", "'" + _Search + "'", "string", 11, "sPrimaryEMail", " = ", " or ");
                        lstParameters.Add(pParameter);

                        pParameter = new DataParameter("sMName", "'" + _Search + "'", "string", 11, "sPrimaryEMail", " = ", " or ");
                        lstParameters.Add(pParameter);

                        pParameter = new DataParameter("sLName", "'" + _Search + "'", "string", 11, "sPrimaryEMail", " = ", " or ");
                        lstParameters.Add(pParameter);

                        pParameter = new DataParameter("sScreenName", "'" + _Search + "'", "string", 11, "sPrimaryEMail", " = ", " or ");
                        lstParameters.Add(pParameter);
                        #endregion
                        oSearchResults_User = dbUsers.Get(lstParameters);

                        #region Set Search Results
                        if (oSearchResults_User != null)
                        {
                            if (oSearchResults_User.Count > 0)
                            {

                                sRESPONSE = "true";
                                sRESPONSEMESSAGE = "results found!";

                            }
                            else
                            {
                                sRESPONSE = "false";
                                sRESPONSEMESSAGE = "Sorry could not find any records!";
                            }
                        }
                        else
                        {
                            sRESPONSE = "false";
                            sRESPONSEMESSAGE = "Sorry could not find any records!";
                        }
                        #endregion

                        DINT_WebSite_Leads dbWebSite_Leads = new DINT_WebSite_Leads(oSystem.cnCon);
                        #region Search Leads
                        lstParameters = new List<DataParameter>();
                        pParameter = null;
                        pParameter = new DataParameter("sPrimaryEMail", "'" + _Search + "'", "string", 11, "sPrimaryEMail", " = ", "");
                        lstParameters.Add(pParameter);

                        if (bIsNumber)
                        {
                            pParameter = new DataParameter("ID", "'" + _Search + "'", "int", 11, "ID", " = ", " or ");
                            lstParameters.Add(pParameter);
                        }

                        if (bIsDate)
                        {
                            pParameter = new DataParameter("dtDateCreated", "'" + _Search + "'", "DateTime", 11, "dtDateCreated", " = ", " or ");
                            lstParameters.Add(pParameter);
                        }


                        pParameter = new DataParameter("sFName", "'" + _Search + "'", "string", 11, "sPrimaryEMail", " = ", " or ");
                        lstParameters.Add(pParameter);

                        pParameter = new DataParameter("sMName", "'" + _Search + "'", "string", 11, "sPrimaryEMail", " = ", " or ");
                        lstParameters.Add(pParameter);

                        pParameter = new DataParameter("sLName", "'" + _Search + "'", "string", 11, "sPrimaryEMail", " = ", " or ");
                        lstParameters.Add(pParameter);

                        pParameter = new DataParameter("sScreenName", "'" + _Search + "'", "string", 11, "sPrimaryEMail", " = ", " or ");
                        lstParameters.Add(pParameter);
                        #endregion

                        oSearchResults_Lead = dbWebSite_Leads.Get(lstParameters);

                        #region Add to search results
                        if (oSearchResults_Lead != null)
                        {
                            if (oSearchResults_Lead.Count > 0)
                            {

                                sRESPONSE = "true";
                                sRESPONSEMESSAGE = "results found!";

                            }
                        }
                        #endregion
                    }
                    catch
                    {
                        sRESPONSE = "false";
                        sRESPONSEMESSAGE = "Sorry could not find any records!";
                    }
                }
                else
                {
                    sRESPONSE = "false";
                    sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                }
                #endregion

            }

            oSystem.CloseDataConnection();
            var oResponse = Json(new { RESPONSE = sRESPONSE, MESSAGE = sRESPONSEMESSAGE, DATA = oSearchResults_User, DATA2 = oSearchResults_Lead });
            return oResponse;
        }
        #endregion

        #region Form UserShareEvents

        string sUserShareEvents_Details = "/views/Forms/UserShareEvents_Details.cshtml";
        string sUserShareEvents_List = "/views/Forms/UserShareEvents_List.cshtml";


        public ActionResult UserShareEvents_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("UserShareEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUserShareEvents_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_UserShareEvents dbInteraction = new DINT_UserShareEvents(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_UserShareEvents.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_UserShareEvents.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult UserShareEvents_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("UserShareEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUserShareEvents_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UserShareEvents dbInteraction = new DINT_UserShareEvents(oSystem.cnCon);
                        List<DEF_UserShareEvents.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UserShareEvents.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_UserShareEvents dbInteraction = new DINT_UserShareEvents(oSystem.cnCon);
                        List<DEF_UserShareEvents.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UserShareEvents.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult UserShareEvents_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("UserShareEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUserShareEvents_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_UserShareEvents.RecordObject recRecord = new DEF_UserShareEvents.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public ActionResult UserShareEvents_AddUpdate(DEF_UserShareEvents.RecordObject _rec)
        {
            Set_Client_NavSettings("UserShareEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUserShareEvents_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_UserShareEvents dbInteraction = new DINT_UserShareEvents(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("UserShareEvents_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_UserShareEvents dbInteraction = new DINT_UserShareEvents(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("UserShareEvents_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult UserShareEvents_Delete(int id)
        {
            Set_Client_NavSettings("UserShareEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_UserShareEvents dbInteraction = new DINT_UserShareEvents(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_UserShareEvents.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_UserShareEvents.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("UserShareEvents_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("UserShareEvents_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSite
        public ActionResult WebSite_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSite_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSite dbInteraction = new DINT_WebSite(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSite.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sName", "'" + Search + "'", "string", 10, "sName", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSite.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSite_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSite_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSite dbInteraction = new DINT_WebSite(oSystem.cnCon);
                        List<DEF_WebSite.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSite.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                ACMSDBView.WebSiteViewModel recRecordView = new WebSiteViewModel();
                                recRecordView.GetView(oSystem.cnCon, recRecord.ID);

                                DINT_Roles dbRoles = new DINT_Roles(oSystem.cnCon);
                                recRecordView.Build_SecurityRoles(dbRoles.Get());

                                DINT_WebSiteBlog dbWebSiteBlog = new DINT_WebSiteBlog(oSystem.cnCon);
                                List<DataParameter> lsWebSiteBlog = new List<DataParameter>();
                                DataParameter pWebSiteBlog_Parameter = new DataParameter("iParentID", "'" + recRecord.ID + "'", "int", 1, "iParentID", " = ", "");
                                lsWebSiteBlog.Add(pWebSiteBlog_Parameter);
                                recRecordView.Build_SiteBloggs(dbWebSiteBlog.Get(lsWebSiteBlog));

                                DINT_WebSitePageTemplates dbWebSitePageTemplates = new DINT_WebSitePageTemplates(oSystem.cnCon);
                                List<DataParameter> lsWebSitePageTemplates = new List<DataParameter>();
                                DataParameter pWebSitePageTemplates_Parameter = new DataParameter("iParentID", "'" + recRecord.ID + "'", "int", 1, "iParentID", " = ", "");
                                lsWebSitePageTemplates.Add(pWebSitePageTemplates_Parameter);
                                recRecordView.Build_SiteTemplates(dbWebSitePageTemplates.Get(lsWebSitePageTemplates));

                                recRecordView.Get_WebSite_Messaging(oSystem.cnCon);

                                ViewBag.iParentID = recRecordView.WebSite.iParentID;
                                ViewBag.sParentID = recRecordView.WebSite.sParentID;

                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecordView;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSite dbInteraction = new DINT_WebSite(oSystem.cnCon);
                        List<DEF_WebSite.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSite.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                ACMSDBView.WebSiteViewModel recRecordView = new WebSiteViewModel();
                                recRecordView.GetView(oSystem.cnCon, recRecord.ID);

                                DINT_Roles dbRoles = new DINT_Roles(oSystem.cnCon);
                                recRecordView.Build_SecurityRoles(dbRoles.Get());

                                DINT_WebSiteBlog dbWebSiteBlog = new DINT_WebSiteBlog(oSystem.cnCon);
                                List<DataParameter> lsWebSiteBlog = new List<DataParameter>();
                                DataParameter pWebSiteBlog_Parameter = new DataParameter("iParentID", "'" + recRecord.ID + "'", "int", 1, "iParentID", " = ", "");
                                lsWebSiteBlog.Add(pWebSiteBlog_Parameter);
                                recRecordView.Build_SiteBloggs(dbWebSiteBlog.Get(lsWebSiteBlog));

                                DINT_WebSitePageTemplates dbWebSitePageTemplates = new DINT_WebSitePageTemplates(oSystem.cnCon);
                                List<DataParameter> lsWebSitePageTemplates = new List<DataParameter>();
                                DataParameter pWebSitePageTemplates_Parameter = new DataParameter("iParentID", "'" + recRecord.ID + "'", "int", 1, "iParentID", " = ", "");
                                lsWebSitePageTemplates.Add(pWebSitePageTemplates_Parameter);
                                recRecordView.Build_SiteTemplates(dbWebSitePageTemplates.Get(lsWebSitePageTemplates));


                                ViewBag.iParentID = recRecordView.WebSite.iParentID;
                                ViewBag.sParentID = recRecordView.WebSite.sParentID;


                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecordView;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSite_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSite_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";

                    ACMSDBView.WebSiteViewModel recRecord = new WebSiteViewModel();
                    recRecord.WebSite = new DEF_WebSite.RecordObject();

                    recRecord.WebSite.iParentID = _iParentID;
                    recRecord.WebSite.sParentID = _sParentID;


                    recRecord.Get_SecurityRoles(oSystem.cnCon);

                    recRecord.Build_SiteBloggs(null);
                    recRecord.Build_SiteTemplates(null);

                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSite_AddUpdate(ACMSDBView.WebSiteViewModel _rec)
        {
            Set_Client_NavSettings("WebSite_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSite.ID == null) || (_rec.WebSite.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSite.ID = -1;
                            //ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSite.iParentID;
                            ViewBag.sParentID = _rec.WebSite.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSite dbInteraction = new DINT_WebSite(oSystem.cnCon);

                                _rec.WebSite.sControl = Guid.NewGuid().ToString();
                                _rec.WebSite.dtDateCreated = DateTime.Now;
                                _rec.WebSite.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSite);

                                _rec.Get_SecurityRoles(oSystem.cnCon);
                                _rec.Get_SiteBloggs(oSystem.cnCon, _rec.WebSite.ID);
                                _rec.Get_SiteTemplates(oSystem.cnCon, _rec.WebSite.ID);


                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSite_Details", new { key = _rec.WebSite.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.WebSite.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();

                                    DINT_WebSite dbInteraction = new DINT_WebSite(oSystem.cnCon);
                                    _rec.WebSite.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSite);

                                    _rec.Get_SecurityRoles(oSystem.cnCon);
                                    _rec.Get_SiteBloggs(oSystem.cnCon, _rec.WebSite.ID);
                                    _rec.Get_SiteTemplates(oSystem.cnCon, _rec.WebSite.ID);



                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSite_Details", new { id = _rec.WebSite.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSite_Delete(int id)
        {
            Set_Client_NavSettings("WebSite_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSite dbInteraction = new DINT_WebSite(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSite.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSite.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSite_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSite_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteAnnouncements

        string sWebSiteAnnouncements_Details = "/views/Forms/WebSiteAnnouncements_Details.cshtml";
        string sWebSiteAnnouncements_List = "/views/Forms/WebSiteAnnouncements_List.cshtml";


        public ActionResult WebSiteAnnouncements_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAnnouncements_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteAnnouncements dbInteraction = new DINT_WebSiteAnnouncements(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteAnnouncements.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteAnnouncements.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAnnouncements_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAnnouncements_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteAnnouncements dbInteraction = new DINT_WebSiteAnnouncements(oSystem.cnCon);
                        List<DEF_WebSiteAnnouncements.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteAnnouncements.RecordObject recRecord = dbSearch[0];
                                AriesCMS.Models.WebSiteAnnouncementsDBView recRecord = new Models.WebSiteAnnouncementsDBView();
                                recRecord.WebSiteAnnouncements = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);
                                recRecord.Get_WebSiteAnnouncementsType(oSystem.cnCon);

                                ViewBag.iParentID = recRecord.WebSiteAnnouncements.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteAnnouncements.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteAnnouncements dbInteraction = new DINT_WebSiteAnnouncements(oSystem.cnCon);
                        List<DEF_WebSiteAnnouncements.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteAnnouncements.RecordObject recRecord = dbSearch[0];
                                AriesCMS.Models.WebSiteAnnouncementsDBView recRecord = new Models.WebSiteAnnouncementsDBView();
                                recRecord.WebSiteAnnouncements = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);
                                recRecord.Get_WebSiteAnnouncementsType(oSystem.cnCon);

                                ViewBag.iParentID = recRecord.WebSiteAnnouncements.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteAnnouncements.sParentID;




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteAnnouncements_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAnnouncements_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    //DEF_WebSiteAnnouncements.RecordObject recRecord = new DEF_WebSiteAnnouncements.RecordObject();
                    AriesCMS.Models.WebSiteAnnouncementsDBView recRecord = new Models.WebSiteAnnouncementsDBView();


                    recRecord.Get_WebSiteQuestionair(oSystem.cnCon);
                    recRecord.Get_WebSiteAnnouncementsType(oSystem.cnCon);

                    recRecord.WebSiteAnnouncements.iParentID = _iParentID;
                    recRecord.WebSiteAnnouncements.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteAnnouncements_AddUpdate(FormCollection fc, HttpPostedFileBase UploadFiles1, HttpPostedFileBase UploadFiles2, HttpPostedFileBase UploadFiles3, AriesCMS.Models.WebSiteAnnouncementsDBView _rec)
        {
            Set_Client_NavSettings("WebSiteAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            string sFileUploadResults = "";

            bool bFileUploadError1 = false;
            bool bFileUploadError2 = false;
            bool bFileUploadError3 = false;
            string sImageURL1 = "";
            string sImageURL2 = "";
            string sImageURL3 = "";
            string sPrefix = "";


            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAnnouncements_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteAnnouncements.ID == null) || (_rec.WebSiteAnnouncements.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteAnnouncements.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSiteAnnouncements.iParentID;
                            ViewBag.sParentID = _rec.WebSiteAnnouncements.sParentID;

                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteAnnouncements dbInteraction = new DINT_WebSiteAnnouncements(oSystem.cnCon);

                                #region Upload file - Image Thumbnail
                                try
                                {
                                    if (UploadFiles1 != null)
                                    {
                                        if (UploadFiles1.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                            {
                                                string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                    _rec.WebSiteAnnouncements.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                    _rec.WebSiteAnnouncements.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Medium
                                try
                                {
                                    if (UploadFiles2 != null)
                                    {
                                        if (UploadFiles2.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                            {
                                                string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    sImageURL2 = "Uploads/" + UploadFiles2.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                    _rec.WebSiteAnnouncements.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                    _rec.WebSiteAnnouncements.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Large
                                try
                                {
                                    if (UploadFiles3 != null)
                                    {
                                        if (UploadFiles3.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                            {
                                                string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    sImageURL3 = "Uploads/" + UploadFiles3.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                    _rec.WebSiteAnnouncements.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                    UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                    _rec.WebSiteAnnouncements.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                    bFileUploadError1 = false;
                                }
                                #endregion


                                _rec.WebSiteAnnouncements.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteAnnouncements.dtDateCreated = DateTime.Now;
                                _rec.WebSiteAnnouncements.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteAnnouncements);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteAnnouncements_Details", new { key = _rec.WebSiteAnnouncements.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteAnnouncements.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteAnnouncements dbInteraction = new DINT_WebSiteAnnouncements(oSystem.cnCon);


                                    #region Upload file - Image Thumbnail
                                    try
                                    {
                                        if (UploadFiles1 != null)
                                        {
                                            if (UploadFiles1.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                                {
                                                    string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                        sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                        _rec.WebSiteAnnouncements.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                        _rec.WebSiteAnnouncements.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Medium
                                    try
                                    {
                                        if (UploadFiles2 != null)
                                        {
                                            if (UploadFiles2.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                                {
                                                    string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                        sImageURL2 = "Uploads/" + UploadFiles2.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                        _rec.WebSiteAnnouncements.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                        _rec.WebSiteAnnouncements.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Large
                                    try
                                    {
                                        if (UploadFiles3 != null)
                                        {
                                            if (UploadFiles3.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                                {
                                                    string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                        sImageURL3 = "Uploads/" + UploadFiles3.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                        _rec.WebSiteAnnouncements.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                        UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                        _rec.WebSiteAnnouncements.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion


                                    _rec.WebSiteAnnouncements.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteAnnouncements);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteAnnouncements_Details", new { id = _rec.WebSiteAnnouncements.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAnnouncements_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteAnnouncements dbInteraction = new DINT_WebSiteAnnouncements(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteAnnouncements.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAnnouncements.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteAnnouncements_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteAnnouncements_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteAnnouncementsType

        string sWebSiteAnnouncementsType_Details = "/views/Forms/WebSiteAnnouncementsType_Details.cshtml";
        string sWebSiteAnnouncementsType_List = "/views/Forms/WebSiteAnnouncementsType_List.cshtml";


        public ActionResult WebSiteAnnouncementsType_List(FormCollection fc, string Search, int page = 1)
        {
            Set_Client_NavSettings("WebSiteAnnouncementsType");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAnnouncementsType_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteAnnouncementsType dbInteraction = new DINT_WebSiteAnnouncementsType(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteAnnouncementsType.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteAnnouncementsType.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAnnouncementsType_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteAnnouncementsType");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAnnouncementsType_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteAnnouncementsType dbInteraction = new DINT_WebSiteAnnouncementsType(oSystem.cnCon);
                        List<DEF_WebSiteAnnouncementsType.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAnnouncementsType.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteAnnouncementsType dbInteraction = new DINT_WebSiteAnnouncementsType(oSystem.cnCon);
                        List<DEF_WebSiteAnnouncementsType.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAnnouncementsType.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAnnouncementsType_Create()
        {
            Set_Client_NavSettings("WebSiteAnnouncementsType");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process




                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAnnouncementsType_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteAnnouncementsType.RecordObject recRecord = new DEF_WebSiteAnnouncementsType.RecordObject();








                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }


        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteAnnouncementsType_AddUpdate(FormCollection fc, HttpPostedFileBase UploadFiles1, HttpPostedFileBase UploadFiles2, HttpPostedFileBase UploadFiles3, DEF_WebSiteAnnouncementsType.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteAnnouncementsType");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            string sFileUploadResults = "";

            bool bFileUploadError1 = false;
            bool bFileUploadError2 = false;
            bool bFileUploadError3 = false;
            string sImageURL1 = "";
            string sImageURL2 = "";
            string sImageURL3 = "";
            string sPrefix = "";


            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAnnouncementsType_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteAnnouncementsType dbInteraction = new DINT_WebSiteAnnouncementsType(oSystem.cnCon);

                                #region Upload file - Image Thumbnail
                                try
                                {
                                    if (UploadFiles1 != null)
                                    {
                                        if (UploadFiles1.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                            {
                                                string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                    _rec.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                    _rec.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Medium
                                try
                                {
                                    if (UploadFiles2 != null)
                                    {
                                        if (UploadFiles2.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                            {
                                                string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    sImageURL2 = "Uploads/" + UploadFiles2.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                    _rec.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                    _rec.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Large
                                try
                                {
                                    if (UploadFiles3 != null)
                                    {
                                        if (UploadFiles3.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                            {
                                                string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    sImageURL3 = "Uploads/" + UploadFiles3.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                    _rec.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                    UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                    _rec.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteAnnouncementsType_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteAnnouncementsType dbInteraction = new DINT_WebSiteAnnouncementsType(oSystem.cnCon);


                                    #region Upload file - Image Thumbnail
                                    try
                                    {
                                        if (UploadFiles1 != null)
                                        {
                                            if (UploadFiles1.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                                {
                                                    string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                        sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                        _rec.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                        _rec.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Medium
                                    try
                                    {
                                        if (UploadFiles2 != null)
                                        {
                                            if (UploadFiles2.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                                {
                                                    string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                        sImageURL2 = "Uploads/" + UploadFiles2.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                        _rec.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                        _rec.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Large
                                    try
                                    {
                                        if (UploadFiles3 != null)
                                        {
                                            if (UploadFiles3.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                                {
                                                    string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                        sImageURL3 = "Uploads/" + UploadFiles3.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                        _rec.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                        UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                        _rec.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion


                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteAnnouncementsType_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAnnouncementsType_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteAnnouncementsType");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteAnnouncementsType dbInteraction = new DINT_WebSiteAnnouncementsType(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteAnnouncementsType.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAnnouncementsType.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {




                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteAnnouncementsType_List");


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteAnnouncementsType_List");

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteAlbums

        string sWebSiteAlbums_Details = "/views/Forms/WebSiteAlbums_Details.cshtml";
        string sWebSiteAlbums_List = "/views/Forms/WebSiteAlbums_List.cshtml";


        public ActionResult WebSiteAlbums_List(FormCollection fc, string Search, int page = 1)

        {
            Set_Client_NavSettings("WebSiteAlbums");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAlbums_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteAlbums dbInteraction = new DINT_WebSiteAlbums(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteAlbums.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteAlbums.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAlbums_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteAlbums");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAlbums_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteAlbums dbInteraction = new DINT_WebSiteAlbums(oSystem.cnCon);
                        List<DEF_WebSiteAlbums.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAlbums.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteAlbums dbInteraction = new DINT_WebSiteAlbums(oSystem.cnCon);
                        List<DEF_WebSiteAlbums.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAlbums.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteAlbums_Create()

        {
            Set_Client_NavSettings("WebSiteAlbums");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process




                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAlbums_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteAlbums.RecordObject recRecord = new DEF_WebSiteAlbums.RecordObject();


                    recRecord.dtLastPhotosAdded = DateTime.Parse("01/01/1901");
                    recRecord.dtDateOfAlbum = DateTime.Parse("01/01/1901");





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteAlbums_AddUpdate(DEF_WebSiteAlbums.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteAlbums");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAlbums_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {




                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteAlbums dbInteraction = new DINT_WebSiteAlbums(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteAlbums_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteAlbums dbInteraction = new DINT_WebSiteAlbums(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteAlbums_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAlbums_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteAlbums");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteAlbums dbInteraction = new DINT_WebSiteAlbums(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteAlbums.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAlbums.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {




                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteAlbums_List");


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteAlbums_List");

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteAlbumContent

        string sWebSiteAlbumContent_Details = "/views/Forms/WebSiteAlbumContent_Details.cshtml";
        string sWebSiteAlbumContent_List = "/views/Forms/WebSiteAlbumContent_List.cshtml";


        public ActionResult WebSiteAlbumContent_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteAlbumContent");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAlbumContent_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteAlbumContent dbInteraction = new DINT_WebSiteAlbumContent(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteAlbumContent.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteAlbumContent.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAlbumContent_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteAlbumContent");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAlbumContent_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteAlbumContent dbInteraction = new DINT_WebSiteAlbumContent(oSystem.cnCon);
                        List<DEF_WebSiteAlbumContent.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteAlbumContent.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteAlbumContentViewModel recRecord = new WebSiteAlbumContentViewModel();
                                recRecord.WebSiteAlbumContent = dbSearch[0];

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteAlbumContent.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteAlbumContent.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteAlbumContent dbInteraction = new DINT_WebSiteAlbumContent(oSystem.cnCon);
                        List<DEF_WebSiteAlbumContent.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteAlbumContent.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteAlbumContentViewModel recRecord = new WebSiteAlbumContentViewModel();
                                recRecord.WebSiteAlbumContent = dbSearch[0];

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteAlbumContent.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteAlbumContent.sParentID;




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAlbumContent_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteAlbumContent");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAlbumContent_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    //DEF_WebSiteAlbumContent.RecordObject recRecord = new DEF_WebSiteAlbumContent.RecordObject();
                    ACMSDBView.WebSiteAlbumContentViewModel recRecord = new WebSiteAlbumContentViewModel();


                    recRecord.WebSiteAlbumContent.iParentID = _iParentID;
                    recRecord.WebSiteAlbumContent.sParentID = _sParentID;

                    recRecord.WebSiteAlbumContent.dtDateOfPhoto = DateTime.Parse("01/01/1901");




                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteAlbumContent_AddUpdate(FormCollection fc, HttpPostedFileBase UploadFiles1, ACMSDBView.WebSiteAlbumContentViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteAlbumContent");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();


            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            string sFileUploadResults = "";

            bool bFileUploadError1 = false;
            string sImageURL1 = "";
            string sPrefix = "";


            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAlbumContent_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteAlbumContent.ID == null) || (_rec.WebSiteAlbumContent.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteAlbumContent.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSiteAlbumContent.iParentID;
                            ViewBag.sParentID = _rec.WebSiteAlbumContent.sParentID;

                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteAlbumContent dbInteraction = new DINT_WebSiteAlbumContent(oSystem.cnCon);

                                #region Upload file - Image Thumbnail
                                try
                                {
                                    if (UploadFiles1 != null)
                                    {
                                        if (UploadFiles1.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                            {
                                                string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                    _rec.WebSiteAlbumContent.sContent = sImageURL1;
                                                    _rec.WebSiteAlbumContent.sThumbNail = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                    _rec.WebSiteAlbumContent.sContent = sImageURL1;
                                                    _rec.WebSiteAlbumContent.sThumbNail = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                _rec.WebSiteAlbumContent.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteAlbumContent.dtDateCreated = DateTime.Now;
                                _rec.WebSiteAlbumContent.dtLastUpdated = DateTime.Now;
                                _rec.WebSiteAlbumContent.dtLastAnswer = DateTime.Now;
                                _rec.WebSiteAlbumContent.dtLastView = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteAlbumContent);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteAlbumContent_Details", new { key = _rec.WebSiteAlbumContent.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteAlbumContent.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteAlbumContent dbInteraction = new DINT_WebSiteAlbumContent(oSystem.cnCon);
                                    _rec.WebSiteAlbumContent.dtLastUpdated = DateTime.Now;

                                    #region Upload file - Image Thumbnail
                                    try
                                    {
                                        if (UploadFiles1 != null)
                                        {
                                            if (UploadFiles1.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                                {
                                                    string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                        sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                        _rec.WebSiteAlbumContent.sContent = sImageURL1;
                                                        _rec.WebSiteAlbumContent.sThumbNail = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                        _rec.WebSiteAlbumContent.sContent = sImageURL1;
                                                        _rec.WebSiteAlbumContent.sThumbNail = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    dbInteraction.Update_SQL(_rec.WebSiteAlbumContent);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteAlbumContent_Details", new { id = _rec.WebSiteAlbumContent.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAlbumContent_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteAlbumContent");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteAlbumContent dbInteraction = new DINT_WebSiteAlbumContent(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteAlbumContent.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAlbumContent.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteAlbumContent_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteAlbumContent_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteBlog
        public ActionResult WebSiteBlog_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteBlog_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlog_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteBlog dbInteraction = new DINT_WebSiteBlog(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteBlog.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sTitle", "'%" + Search + "%'", "string", 10, "sTitle", " LIKE ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteBlog.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlog_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteBlog_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlog_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        ACMSDBView.WebSiteBlogViewModel recRecord = new WebSiteBlogViewModel();
                        if (recRecord.GetView(oSystem.cnCon, id))
                        {
                            ViewBag.iParentID = recRecord.Blog.iParentID;
                            ViewBag.sParentID = recRecord.Blog.sParentID;


                            if (recRecord.Blog.iSiteTemplateID > 0)
                            {
                                recRecord.Get_SiteTemplatesZonez(oSystem.cnCon, recRecord.Blog.iSiteTemplateID);
                                recRecord.Get_SiteTemplatesPages(oSystem.cnCon, recRecord.Blog.iSiteTemplateID);
                            }
                            else if (recRecord.SiteTemplates.Count > 0)
                            {
                                recRecord.Get_SiteTemplatesZonez(oSystem.cnCon, System.Convert.ToInt32(recRecord.SiteTemplates[1].Value));
                                recRecord.Get_SiteTemplatesPages(oSystem.cnCon, System.Convert.ToInt32(recRecord.SiteTemplates[1].Value));
                            }
                            else
                            {
                                recRecord.Build_TemplateZonesItems(null);
                                recRecord.Build_SiteTemplatesPages(null);
                            }



                            oSystem.CloseDataConnection();
                            oPage.DataModelsPrimary = recRecord;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteBlog dbInteraction = new DINT_WebSiteBlog(oSystem.cnCon);
                        List<DEF_WebSiteBlog.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.WebSiteBlogViewModel recRecord = new WebSiteBlogViewModel();
                                recRecord.Blog = dbSearch[0];
                                recRecord.Get_BloggersLists(oSystem.cnCon);
                                if (recRecord.Blog == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.Blog.iParentID;
                                ViewBag.sParentID = recRecord.Blog.sParentID;


                                if (recRecord.Blog.iSiteTemplateID > 0)
                                {
                                    recRecord.Get_SiteTemplatesPages(oSystem.cnCon, recRecord.Blog.iSiteTemplateID);
                                    if (recRecord.Blog.iSiteTemplatePageID > 0)
                                    {
                                        recRecord.Get_SiteTemplatesZonez(oSystem.cnCon, recRecord.Blog.iSiteTemplatePageID);
                                    }
                                }
                                else if (recRecord.SiteTemplates.Count > 0)
                                {
                                    recRecord.Get_SiteTemplatesZonez(oSystem.cnCon, System.Convert.ToInt32(recRecord.SiteTemplates[1].Value));
                                    if (recRecord.Blog.iSiteTemplatePageID > 0)
                                    {
                                        recRecord.Get_SiteTemplatesZonez(oSystem.cnCon, recRecord.Blog.iSiteTemplatePageID);
                                    }
                                }
                                else
                                {
                                    recRecord.Build_TemplateZonesItems(null);
                                    recRecord.Build_SiteTemplatesPages(null);
                                }


                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlog_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteBlog_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlog_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    ACMSDBView.WebSiteBlogViewModel recRecord = new WebSiteBlogViewModel();
                    recRecord.Blog = new DEF_WebSiteBlog.RecordObject();
                    recRecord.Blog.iParentID = _iParentID;
                    recRecord.Blog.sParentID = _sParentID;

                    recRecord.Get_BloggersLists(oSystem.cnCon, _iParentID);
                    recRecord.Get_SiteTemplatesList(oSystem.cnCon, _iParentID);

                    if (recRecord.Blog.iSiteTemplateID > 0)
                    {
                        recRecord.Get_SiteTemplatesPages(oSystem.cnCon, recRecord.Blog.iSiteTemplateID);
                    }
                    else if (recRecord.SiteTemplates.Count > 0)
                    {
                        recRecord.Get_SiteTemplatesPages(oSystem.cnCon, System.Convert.ToInt32(recRecord.SiteTemplates[1].Value));
                    }

                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteBlog_AddUpdate(ACMSDBView.WebSiteBlogViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteBlog_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlog_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.Blog.ID == null) || (_rec.Blog.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.Blog.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.Blog.iParentID;
                            ViewBag.sParentID = _rec.Blog.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteBlog dbInteraction = new DINT_WebSiteBlog(oSystem.cnCon);

                                _rec.Blog.sControl = Guid.NewGuid().ToString();
                                _rec.Blog.dtDateCreated = DateTime.Now;
                                _rec.Blog.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.Blog);

                                _rec.Get_BloggersLists(oSystem.cnCon);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSiteBlog_Details", new { key = _rec.Blog.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.Blog.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteBlog dbInteraction = new DINT_WebSiteBlog(oSystem.cnCon);

                                    _rec.Blog.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.Blog);

                                    //_rec.Get_BloggersLists(oSystem.cnCon);


                                    //if (_rec.Blog.iSiteTemplateID > 0)
                                    //{
                                    //    _rec.Get_SiteTemplatesZonez(oSystem.cnCon, _rec.Blog.iSiteTemplateID);
                                    //}
                                    //else
                                    //{
                                    //    _rec.Build_TemplateZonesItems(null);
                                    //}

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSiteBlog_Details", new { id = _rec.Blog.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlog_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteBlog_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteBlog dbInteraction = new DINT_WebSiteBlog(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteBlog.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlog.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteBlog_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteBlog_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteBlogComments
        public ActionResult WebSiteBlogComments_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteBlogComments_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogComments_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();

                    DINT_WebSiteBlogComments dbInteraction = new DINT_WebSiteBlogComments(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteBlogComments.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sComment", "'%" + Search + "%'", "string", 12, "sComment", " LIKE ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteBlogComments.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogComments_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteBlogComments_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogComments_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        ACMSDBView.WebSiteBlogCommentsViewModel recRecord = new WebSiteBlogCommentsViewModel();

                        if (recRecord.GetView(oSystem.cnCon, id))
                        {
                            ViewBag.iParentID = recRecord.WebSiteBlogComments.iParentID;
                            ViewBag.sParentID = recRecord.WebSiteBlogComments.sParentID;

                            oSystem.CloseDataConnection();
                            oPage.DataModelsPrimary = recRecord;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteBlogComments dbInteraction = new DINT_WebSiteBlogComments(oSystem.cnCon);
                        List<DEF_WebSiteBlogComments.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.WebSiteBlogCommentsViewModel recRecord = new WebSiteBlogCommentsViewModel();
                                recRecord.WebSiteBlogComments = dbSearch[0];
                                if (recRecord.WebSiteBlogComments == null)
                                {
                                    return HttpNotFound();
                                }
                                recRecord.Get_ParentComment(oSystem.cnCon);
                                ViewBag.iParentID = recRecord.WebSiteBlogComments.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteBlogComments.sParentID;

                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);


                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogComments_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteBlogComments_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogComments_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";

                    ACMSDBView.WebSiteBlogCommentsViewModel recRecord = new WebSiteBlogCommentsViewModel();
                    recRecord.WebSiteBlogComments = new DEF_WebSiteBlogComments.RecordObject();
                    recRecord.WebSiteBlogComments.iParentID = _iParentID;
                    recRecord.WebSiteBlogComments.sParentID = _sParentID;

                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);


                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteBlogComments_AddUpdate(ACMSDBView.WebSiteBlogCommentsViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteBlogComments_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogComments_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteBlogComments.ID == null) || (_rec.WebSiteBlogComments.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteBlogComments.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSiteBlogComments.iParentID;
                            ViewBag.sParentID = _rec.WebSiteBlogComments.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteBlogComments dbInteraction = new DINT_WebSiteBlogComments(oSystem.cnCon);

                                _rec.WebSiteBlogComments.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteBlogComments.dtDateCreated = DateTime.Now;
                                _rec.WebSiteBlogComments.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteBlogComments);

                                _rec.Get_ParentComment(oSystem.cnCon);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSiteBlogComments_Details", new { key = _rec.WebSiteBlogComments.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.WebSiteBlogComments.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteBlogComments dbInteraction = new DINT_WebSiteBlogComments(oSystem.cnCon);

                                    _rec.WebSiteBlogComments.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteBlogComments);

                                    _rec.Get_ParentComment(oSystem.cnCon);
                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSiteBlogComments_Details", new { id = _rec.WebSiteBlogComments.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogComments_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteBlogComments_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteBlogComments dbInteraction = new DINT_WebSiteBlogComments(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteBlogComments.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlogComments.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteBlogComments_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteBlogComments_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteBlogCommentsProperties
        public ActionResult WebSiteBlogCommentsProperties_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteBlogCommentsProperties_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogCommentsProperties_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteBlogCommentsProperties dbInteraction = new DINT_WebSiteBlogCommentsProperties(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteBlogCommentsProperties.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sFieldName", "'" + Search + "'", "string", 10, "sFieldName", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteBlogCommentsProperties.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogCommentsProperties_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteBlogCommentsProperties_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogCommentsProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteBlogCommentsProperties dbInteraction = new DINT_WebSiteBlogCommentsProperties(oSystem.cnCon);
                        List<DEF_WebSiteBlogCommentsProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlogCommentsProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteBlogCommentsProperties dbInteraction = new DINT_WebSiteBlogCommentsProperties(oSystem.cnCon);
                        List<DEF_WebSiteBlogCommentsProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlogCommentsProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogCommentsProperties_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteBlogCommentsProperties_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogCommentsProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteBlogCommentsProperties.RecordObject recRecord = new DEF_WebSiteBlogCommentsProperties.RecordObject();
                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;

                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteBlogCommentsProperties_AddUpdate(DEF_WebSiteBlogCommentsProperties.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteBlogCommentsProperties_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogCommentsProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteBlogCommentsProperties dbInteraction = new DINT_WebSiteBlogCommentsProperties(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSiteBlogCommentsProperties_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteBlogCommentsProperties dbInteraction = new DINT_WebSiteBlogCommentsProperties(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;
                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSiteBlogCommentsProperties_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogCommentsProperties_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteBlogCommentsProperties_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteBlogCommentsProperties dbInteraction = new DINT_WebSiteBlogCommentsProperties(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteBlogCommentsProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlogCommentsProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteBlogCommentsProperties_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteBlogCommentsProperties_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteBlogEntry
        public ActionResult WebSiteBlogEntry_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteBlogEntry_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogEntry_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteBlogEntry dbInteraction = new DINT_WebSiteBlogEntry(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteBlogEntry.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sTitle", "'" + Search + "'", "string", 10, "sTitle", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteBlogEntry.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogEntry_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteBlogEntry_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogEntry_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteBlogEntry dbInteraction = new DINT_WebSiteBlogEntry(oSystem.cnCon);
                        List<DEF_WebSiteBlogEntry.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteBlogEntry.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteBlogEntryViewModel recRecord = new WebSiteBlogEntryViewModel();
                                recRecord.WebSiteBlogEntry = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }


                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);

                                ViewBag.iParentID = recRecord.WebSiteBlogEntry.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteBlogEntry.sParentID;
                                oSystem.CloseDataConnection();


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteBlogEntry dbInteraction = new DINT_WebSiteBlogEntry(oSystem.cnCon);
                        List<DEF_WebSiteBlogEntry.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteBlogEntry.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteBlogEntryViewModel recRecord = new WebSiteBlogEntryViewModel();
                                recRecord.WebSiteBlogEntry = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }


                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);

                                ViewBag.iParentID = recRecord.WebSiteBlogEntry.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteBlogEntry.sParentID;
                                oSystem.CloseDataConnection();


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogEntry_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteBlogEntry_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogEntry_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";


                    ACMSDBView.WebSiteBlogEntryViewModel recRecord = new WebSiteBlogEntryViewModel();
                    //DEF_WebSiteBlogEntry.RecordObject recRecord = new DEF_WebSiteBlogEntry.RecordObject();


                    recRecord.WebSiteBlogEntry.iParentID = _iParentID;
                    recRecord.WebSiteBlogEntry.sParentID = _sParentID;
                    recRecord.WebSiteBlogEntry.dtStart = DateTime.Parse("01/01/1901");
                    recRecord.WebSiteBlogEntry.dtEnd = DateTime.Parse("01/01/1901");

                    recRecord.Get_WebSiteQuestionair(oSystem.cnCon);


                    recRecord.WebSiteBlogEntry.iLanguageID = 205;
                    recRecord.WebSiteBlogEntry.sLanguageID = "United States English";


                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteBlogEntry_AddUpdate(FormCollection fc, HttpPostedFileBase UploadFiles1, ACMSDBView.WebSiteBlogEntryViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteBlogEntry_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            string sFileUploadResults = "";

            bool bFileUploadError1 = false;
            string sImageURL1 = "";
            string sPrefix = "";

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogEntry_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteBlogEntry.ID == null) || (_rec.WebSiteBlogEntry.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteBlogEntry.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSiteBlogEntry.iParentID;
                            ViewBag.sParentID = _rec.WebSiteBlogEntry.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteBlogEntry dbInteraction = new DINT_WebSiteBlogEntry(oSystem.cnCon);

                                #region Upload file - Image Thumbnail
                                try
                                {
                                    if (UploadFiles1 != null)
                                    {
                                        if (UploadFiles1.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                            {
                                                string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                    _rec.WebSiteBlogEntry.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                    _rec.WebSiteBlogEntry.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                _rec.WebSiteBlogEntry.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteBlogEntry.dtDateCreated = DateTime.Now;
                                _rec.WebSiteBlogEntry.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteBlogEntry);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSiteBlogEntry_Details", new { key = _rec.WebSiteBlogEntry.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.WebSiteBlogEntry.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteBlogEntry dbInteraction = new DINT_WebSiteBlogEntry(oSystem.cnCon);

                                    #region Upload file - Image Thumbnail
                                    try
                                    {
                                        if (UploadFiles1 != null)
                                        {
                                            if (UploadFiles1.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                                {
                                                    string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                        sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                        _rec.WebSiteBlogEntry.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                        _rec.WebSiteBlogEntry.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    _rec.WebSiteBlogEntry.dtLastUpdated = DateTime.Now;
                                    dbInteraction.Update_SQL(_rec.WebSiteBlogEntry);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSiteBlogEntry_Details", new { id = _rec.WebSiteBlogEntry.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";


                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogEntry_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteBlogEntry_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteBlogEntry dbInteraction = new DINT_WebSiteBlogEntry(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteBlogEntry.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlogEntry.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;

                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteBlogEntry_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteBlogEntry_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteBlogEvents

        string sWebSiteBlogEvents_Details = "/views/Forms/WebSiteBlogEvents_Details.cshtml";
        string sWebSiteBlogEvents_List = "/views/Forms/WebSiteBlogEvents_List.cshtml";


        public ActionResult WebSiteBlogEvents_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteBlogEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogEvents_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteBlogEvents dbInteraction = new DINT_WebSiteBlogEvents(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteBlogEvents.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteBlogEvents.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteBlogEvents_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteBlogEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogEvents_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteBlogEvents dbInteraction = new DINT_WebSiteBlogEvents(oSystem.cnCon);
                        List<DEF_WebSiteBlogEvents.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlogEvents.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteBlogEvents dbInteraction = new DINT_WebSiteBlogEvents(oSystem.cnCon);
                        List<DEF_WebSiteBlogEvents.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlogEvents.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteBlogEvents_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteBlogEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogEvents_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteBlogEvents.RecordObject recRecord = new DEF_WebSiteBlogEvents.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }


        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteBlogEvents_AddUpdate(DEF_WebSiteBlogEvents.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteBlogEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogEvents_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteBlogEvents dbInteraction = new DINT_WebSiteBlogEvents(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteBlogEvents_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteBlogEvents dbInteraction = new DINT_WebSiteBlogEvents(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteBlogEvents_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteBlogEvents_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteBlogEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteBlogEvents dbInteraction = new DINT_WebSiteBlogEvents(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteBlogEvents.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlogEvents.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteBlogEvents_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteBlogEvents_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteBlogEntryProperties
        public ActionResult WebSiteBlogEntryProperties_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteBlogEntryProperties_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogEntryProperties_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteBlogEntryProperties dbInteraction = new DINT_WebSiteBlogEntryProperties(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteBlogEntryProperties.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sFieldName", "'" + Search + "'", "string", 10, "sFieldName", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteBlogEntryProperties.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogEntryProperties_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteBlogEntryProperties_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogEntryProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteBlogEntryProperties dbInteraction = new DINT_WebSiteBlogEntryProperties(oSystem.cnCon);
                        List<DEF_WebSiteBlogEntryProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlogEntryProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteBlogEntryProperties dbInteraction = new DINT_WebSiteBlogEntryProperties(oSystem.cnCon);
                        List<DEF_WebSiteBlogEntryProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlogEntryProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogEntryProperties_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteBlogEntryProperties_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogEntryProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteBlogEntryProperties.RecordObject recRecord = new DEF_WebSiteBlogEntryProperties.RecordObject();
                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;

                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteBlogEntryProperties_AddUpdate(DEF_WebSiteBlogEntryProperties.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteBlogEntryProperties_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogEntryProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteBlogEntryProperties dbInteraction = new DINT_WebSiteBlogEntryProperties(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSiteBlogEntryProperties_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteBlogEntryProperties dbInteraction = new DINT_WebSiteBlogEntryProperties(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;
                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSiteBlogEntryProperties_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogEntryProperties_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteBlogEntryProperties_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteBlogEntryProperties dbInteraction = new DINT_WebSiteBlogEntryProperties(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteBlogEntryProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlogEntryProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteBlogEntryProperties_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteBlogEntryProperties_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteBlogProperties
        public ActionResult WebSiteBlogProperties_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteBlogProperties_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogProperties_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteBlogProperties dbInteraction = new DINT_WebSiteBlogProperties(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteBlogProperties.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sFieldName", "'" + Search + "'", "string", 10, "sFieldName", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteBlogProperties.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogProperties_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteBlogProperties_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteBlogProperties dbInteraction = new DINT_WebSiteBlogProperties(oSystem.cnCon);
                        List<DEF_WebSiteBlogProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlogProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteBlogProperties dbInteraction = new DINT_WebSiteBlogProperties(oSystem.cnCon);
                        List<DEF_WebSiteBlogProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlogProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogProperties_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteBlogProperties_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteBlogProperties.RecordObject recRecord = new DEF_WebSiteBlogProperties.RecordObject();
                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;

                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);


                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteBlogProperties_AddUpdate(DEF_WebSiteBlogProperties.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteBlogProperties_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteBlogProperties dbInteraction = new DINT_WebSiteBlogProperties(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSiteBlogProperties_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteBlogProperties dbInteraction = new DINT_WebSiteBlogProperties(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;
                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSiteBlogProperties_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogProperties_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteBlogProperties_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteBlogProperties dbInteraction = new DINT_WebSiteBlogProperties(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteBlogProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlogProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteBlogProperties_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteBlogProperties_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteEvents
        public ActionResult WebSiteEvents_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteEvents_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEvents_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteEvents dbInteraction = new DINT_WebSiteEvents(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteEvents.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sEvent", "'%" + Search + "%'", "string", 12, "sEvent", " LIKE ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteEvents.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteEvents_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteEvents_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEvents_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEvents dbInteraction = new DINT_WebSiteEvents(oSystem.cnCon);
                        List<DEF_WebSiteEvents.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEvents.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", key, "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEvents dbInteraction = new DINT_WebSiteEvents(oSystem.cnCon);
                        List<DEF_WebSiteEvents.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEvents.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteEvents_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteEvents_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEvents_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteEvents.RecordObject recRecord = new DEF_WebSiteEvents.RecordObject();

                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;

                    oSystem.CloseDataConnection();
                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteEvents_AddUpdate(DEF_WebSiteEvents.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteEvents_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEvents_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteEvents dbInteraction = new DINT_WebSiteEvents(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSiteEvents_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteEvents dbInteraction = new DINT_WebSiteEvents(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;
                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSiteEvents_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteEvents_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteEvents_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteEvents dbInteraction = new DINT_WebSiteEvents(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteEvents.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEvents.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteEvents_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteEvents_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteExtAppIntegrationSettings
        public ActionResult WebSiteExtAppIntegrationSettings_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteExtAppIntegrationSettings_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteExtAppIntegrationSettings_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteExtAppIntegrationSettings dbInteraction = new DINT_WebSiteExtAppIntegrationSettings(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteExtAppIntegrationSettings.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sApplicationKey", "'" + Search + "'", "string", 23, "sApplicationKey", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteExtAppIntegrationSettings.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteExtAppIntegrationSettings_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteExtAppIntegrationSettings_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteExtAppIntegrationSettings_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteExtAppIntegrationSettings dbInteraction = new DINT_WebSiteExtAppIntegrationSettings(oSystem.cnCon);
                        List<DEF_WebSiteExtAppIntegrationSettings.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteExtAppIntegrationSettings.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteExtAppIntegrationSettings dbInteraction = new DINT_WebSiteExtAppIntegrationSettings(oSystem.cnCon);
                        List<DEF_WebSiteExtAppIntegrationSettings.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteExtAppIntegrationSettings.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteExtAppIntegrationSettings_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteExtAppIntegrationSettings_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteExtAppIntegrationSettings_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteExtAppIntegrationSettings.RecordObject recRecord = new DEF_WebSiteExtAppIntegrationSettings.RecordObject();
                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;
                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteExtAppIntegrationSettings_AddUpdate(DEF_WebSiteExtAppIntegrationSettings.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteExtAppIntegrationSettings_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteExtAppIntegrationSettings_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteExtAppIntegrationSettings dbInteraction = new DINT_WebSiteExtAppIntegrationSettings(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSiteExtAppIntegrationSettings_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteExtAppIntegrationSettings dbInteraction = new DINT_WebSiteExtAppIntegrationSettings(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;
                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSiteExtAppIntegrationSettings_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";


                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteExtAppIntegrationSettings_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteExtAppIntegrationSettings_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteExtAppIntegrationSettings dbInteraction = new DINT_WebSiteExtAppIntegrationSettings(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteExtAppIntegrationSettings.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteExtAppIntegrationSettings.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteExtAppIntegrationSettings_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteExtAppIntegrationSettings_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteForum

        string sWebSiteForum_Details = "/views/Forms/WebSiteForum_Details.cshtml";
        string sWebSiteForum_List = "/views/Forms/WebSiteForum_List.cshtml";


        public ActionResult WebSiteForum_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteForum");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForum_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteForum dbInteraction = new DINT_WebSiteForum(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteForum.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteForum.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteForum_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteForum");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForum_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteForum dbInteraction = new DINT_WebSiteForum(oSystem.cnCon);
                        List<DEF_WebSiteForum.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteForum.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteForumViewModel recRecord = new WebSiteForumViewModel();
                                recRecord.WebSiteForum = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteForum.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteForum.sParentID;

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteForum dbInteraction = new DINT_WebSiteForum(oSystem.cnCon);
                        List<DEF_WebSiteForum.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteForum.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteForumViewModel recRecord = new WebSiteForumViewModel();
                                recRecord.WebSiteForum = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteForum.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteForum.sParentID;

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteForum_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteForum");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForum_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";

                    //DEF_WebSiteForum.RecordObject recRecord = new DEF_WebSiteForum.RecordObject();

                    ACMSDBView.WebSiteForumViewModel recRecord = new WebSiteForumViewModel();

                    recRecord.WebSiteForum.iParentID = _iParentID;
                    recRecord.WebSiteForum.sParentID = _sParentID;


                    recRecord.Get_WebSiteQuestionair(oSystem.cnCon);



                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteForum_AddUpdate(ACMSDBView.WebSiteForumViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteForum");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForum_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteForum.ID == null) || (_rec.WebSiteForum.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteForum.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSiteForum.iParentID;
                            ViewBag.sParentID = _rec.WebSiteForum.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteForum dbInteraction = new DINT_WebSiteForum(oSystem.cnCon);

                                _rec.WebSiteForum.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteForum.dtDateCreated = DateTime.Now;
                                _rec.WebSiteForum.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteForum);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteForum_Details", new { key = _rec.WebSiteForum.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteForum.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteForum dbInteraction = new DINT_WebSiteForum(oSystem.cnCon);
                                    _rec.WebSiteForum.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteForum);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteForum_Details", new { id = _rec.WebSiteForum.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteForum_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteForum");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteForum dbInteraction = new DINT_WebSiteForum(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteForum.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteForum.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteForum_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteForum_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteForumiAnnouncements

        string sWebSiteForumiAnnouncements_Details = "/views/Forms/WebSiteForumiAnnouncements_Details.cshtml";
        string sWebSiteForumiAnnouncements_List = "/views/Forms/WebSiteForumiAnnouncements_List.cshtml";


        public ActionResult WebSiteForumiAnnouncements_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteForumiAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumiAnnouncements_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteForumiAnnouncements dbInteraction = new DINT_WebSiteForumiAnnouncements(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteForumiAnnouncements.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteForumiAnnouncements.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteForumiAnnouncements_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteForumiAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumiAnnouncements_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteForumiAnnouncements dbInteraction = new DINT_WebSiteForumiAnnouncements(oSystem.cnCon);
                        List<DEF_WebSiteForumiAnnouncements.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteForumiAnnouncements.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteForumiAnnouncementsViewModel recRecord = new WebSiteForumiAnnouncementsViewModel();
                                recRecord.WebSiteForumiAnnouncements = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteForumiAnnouncements.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteForumiAnnouncements.sParentID;

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteForumiAnnouncements dbInteraction = new DINT_WebSiteForumiAnnouncements(oSystem.cnCon);
                        List<DEF_WebSiteForumiAnnouncements.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteForumiAnnouncements.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteForumiAnnouncementsViewModel recRecord = new WebSiteForumiAnnouncementsViewModel();
                                recRecord.WebSiteForumiAnnouncements = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteForumiAnnouncements.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteForumiAnnouncements.sParentID;

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteForumiAnnouncements_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteForumiAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumiAnnouncements_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    //DEF_WebSiteForumiAnnouncements.RecordObject recRecord = new DEF_WebSiteForumiAnnouncements.RecordObject();

                    ACMSDBView.WebSiteForumiAnnouncementsViewModel recRecord = new WebSiteForumiAnnouncementsViewModel();

                    recRecord.WebSiteForumiAnnouncements.iParentID = _iParentID;
                    recRecord.WebSiteForumiAnnouncements.sParentID = _sParentID;


                    recRecord.Get_WebSiteQuestionair(oSystem.cnCon);



                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteForumiAnnouncements_AddUpdate(ACMSDBView.WebSiteForumiAnnouncementsViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteForumiAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumiAnnouncements_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteForumiAnnouncements.ID == null) || (_rec.WebSiteForumiAnnouncements.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteForumiAnnouncements.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSiteForumiAnnouncements.iParentID;
                            ViewBag.sParentID = _rec.WebSiteForumiAnnouncements.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteForumiAnnouncements dbInteraction = new DINT_WebSiteForumiAnnouncements(oSystem.cnCon);

                                _rec.WebSiteForumiAnnouncements.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteForumiAnnouncements.dtDateCreated = DateTime.Now;
                                _rec.WebSiteForumiAnnouncements.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteForumiAnnouncements);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteForumiAnnouncements_Details", new { key = _rec.WebSiteForumiAnnouncements.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteForumiAnnouncements.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteForumiAnnouncements dbInteraction = new DINT_WebSiteForumiAnnouncements(oSystem.cnCon);
                                    _rec.WebSiteForumiAnnouncements.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteForumiAnnouncements);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteForumiAnnouncements_Details", new { id = _rec.WebSiteForumiAnnouncements.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteForumiAnnouncements_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteForumiAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteForumiAnnouncements dbInteraction = new DINT_WebSiteForumiAnnouncements(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteForumiAnnouncements.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteForumiAnnouncements.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteForumiAnnouncements_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteForumiAnnouncements_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteForumTopiAnnouncements

        string sWebSiteForumTopiAnnouncements_Details = "/views/Forms/WebSiteForumTopiAnnouncements_Details.cshtml";
        string sWebSiteForumTopiAnnouncements_List = "/views/Forms/WebSiteForumTopiAnnouncements_List.cshtml";


        public ActionResult WebSiteForumTopiAnnouncements_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteForumTopiAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopiAnnouncements_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteForumTopiAnnouncements dbInteraction = new DINT_WebSiteForumTopiAnnouncements(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteForumTopiAnnouncements.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteForumTopiAnnouncements.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteForumTopiAnnouncements_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteForumTopiAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopiAnnouncements_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteForumTopiAnnouncements dbInteraction = new DINT_WebSiteForumTopiAnnouncements(oSystem.cnCon);
                        List<DEF_WebSiteForumTopiAnnouncements.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteForumTopiAnnouncements.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteForumTopiAnnouncementsViewModel recRecord = new WebSiteForumTopiAnnouncementsViewModel();
                                recRecord.WebSiteForumTopiAnnouncements = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteForumTopiAnnouncements.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteForumTopiAnnouncements.sParentID;


                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteForumTopiAnnouncements dbInteraction = new DINT_WebSiteForumTopiAnnouncements(oSystem.cnCon);
                        List<DEF_WebSiteForumTopiAnnouncements.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteForumTopiAnnouncements.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteForumTopiAnnouncementsViewModel recRecord = new WebSiteForumTopiAnnouncementsViewModel();
                                recRecord.WebSiteForumTopiAnnouncements = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteForumTopiAnnouncements.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteForumTopiAnnouncements.sParentID;


                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteForumTopiAnnouncements_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteForumTopiAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopiAnnouncements_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";

                    ACMSDBView.WebSiteForumTopiAnnouncementsViewModel recRecord = new WebSiteForumTopiAnnouncementsViewModel();
                    //DEF_WebSiteForumTopiAnnouncements.RecordObject recRecord = new DEF_WebSiteForumTopiAnnouncements.RecordObject();


                    recRecord.WebSiteForumTopiAnnouncements.iParentID = _iParentID;
                    recRecord.WebSiteForumTopiAnnouncements.sParentID = _sParentID;


                    recRecord.Get_WebSiteQuestionair(oSystem.cnCon);



                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteForumTopiAnnouncements_AddUpdate(ACMSDBView.WebSiteForumTopiAnnouncementsViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteForumTopiAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopiAnnouncements_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteForumTopiAnnouncements.ID == null) || (_rec.WebSiteForumTopiAnnouncements.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteForumTopiAnnouncements.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSiteForumTopiAnnouncements.iParentID;
                            ViewBag.sParentID = _rec.WebSiteForumTopiAnnouncements.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteForumTopiAnnouncements dbInteraction = new DINT_WebSiteForumTopiAnnouncements(oSystem.cnCon);

                                _rec.WebSiteForumTopiAnnouncements.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteForumTopiAnnouncements.dtDateCreated = DateTime.Now;
                                _rec.WebSiteForumTopiAnnouncements.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteForumTopiAnnouncements);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteForumTopiAnnouncements_Details", new { key = _rec.WebSiteForumTopiAnnouncements.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteForumTopiAnnouncements.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteForumTopiAnnouncements dbInteraction = new DINT_WebSiteForumTopiAnnouncements(oSystem.cnCon);
                                    _rec.WebSiteForumTopiAnnouncements.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteForumTopiAnnouncements);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteForumTopiAnnouncements_Details", new { id = _rec.WebSiteForumTopiAnnouncements.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteForumTopiAnnouncements_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteForumTopiAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteForumTopiAnnouncements dbInteraction = new DINT_WebSiteForumTopiAnnouncements(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteForumTopiAnnouncements.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteForumTopiAnnouncements.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteForumTopiAnnouncements_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteForumTopiAnnouncements_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteForumTopicEvents

        string sWebSiteForumTopicEvents_Details = "/views/Forms/WebSiteForumTopicEvents_Details.cshtml";
        string sWebSiteForumTopicEvents_List = "/views/Forms/WebSiteForumTopicEvents_List.cshtml";


        public ActionResult WebSiteForumTopicEvents_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteForumTopicEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopicEvents_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteForumTopicEvents dbInteraction = new DINT_WebSiteForumTopicEvents(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteForumTopicEvents.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteForumTopicEvents.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteForumTopicEvents_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteForumTopicEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopicEvents_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteForumTopicEvents dbInteraction = new DINT_WebSiteForumTopicEvents(oSystem.cnCon);
                        List<DEF_WebSiteForumTopicEvents.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteForumTopicEvents.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteForumTopicEvents dbInteraction = new DINT_WebSiteForumTopicEvents(oSystem.cnCon);
                        List<DEF_WebSiteForumTopicEvents.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteForumTopicEvents.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteForumTopicEvents_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteForumTopicEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopicEvents_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteForumTopicEvents.RecordObject recRecord = new DEF_WebSiteForumTopicEvents.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteForumTopicEvents_AddUpdate(DEF_WebSiteForumTopicEvents.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteForumTopicEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopicEvents_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteForumTopicEvents dbInteraction = new DINT_WebSiteForumTopicEvents(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteForumTopicEvents_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteForumTopicEvents dbInteraction = new DINT_WebSiteForumTopicEvents(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteForumTopicEvents_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteForumTopicEvents_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteForumTopicEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteForumTopicEvents dbInteraction = new DINT_WebSiteForumTopicEvents(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteForumTopicEvents.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteForumTopicEvents.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteForumTopicEvents_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteForumTopicEvents_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteForumTopicPosts

        string sWebSiteForumTopicPosts_Details = "/views/Forms/WebSiteForumTopicPosts_Details.cshtml";
        string sWebSiteForumTopicPosts_List = "/views/Forms/WebSiteForumTopicPosts_List.cshtml";


        public ActionResult WebSiteForumTopicPosts_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteForumTopicPosts");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopicPosts_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteForumTopicPosts dbInteraction = new DINT_WebSiteForumTopicPosts(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteForumTopicPosts.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteForumTopicPosts.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteForumTopicPosts_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteForumTopicPosts");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopicPosts_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteForumTopicPosts dbInteraction = new DINT_WebSiteForumTopicPosts(oSystem.cnCon);
                        List<DEF_WebSiteForumTopicPosts.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteForumTopicPosts.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteForumTopicPostsViewModel recRecord = new WebSiteForumTopicPostsViewModel();
                                recRecord.WebSiteForumTopicPosts = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteForumTopicPosts.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteForumTopicPosts.sParentID;

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteForumTopicPosts dbInteraction = new DINT_WebSiteForumTopicPosts(oSystem.cnCon);
                        List<DEF_WebSiteForumTopicPosts.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteForumTopicPosts.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteForumTopicPostsViewModel recRecord = new WebSiteForumTopicPostsViewModel();
                                recRecord.WebSiteForumTopicPosts = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteForumTopicPosts.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteForumTopicPosts.sParentID;

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteForumTopicPosts_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteForumTopicPosts");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopicPosts_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";

                    ACMSDBView.WebSiteForumTopicPostsViewModel recRecord = new WebSiteForumTopicPostsViewModel();
                    //DEF_WebSiteForumTopicPosts.RecordObject recRecord = new DEF_WebSiteForumTopicPosts.RecordObject();


                    recRecord.WebSiteForumTopicPosts.iParentID = _iParentID;
                    recRecord.WebSiteForumTopicPosts.sParentID = _sParentID;



                    recRecord.Get_WebSiteQuestionair(oSystem.cnCon);


                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteForumTopicPosts_AddUpdate(ACMSDBView.WebSiteForumTopicPostsViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteForumTopicPosts");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopicPosts_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteForumTopicPosts.ID == null) || (_rec.WebSiteForumTopicPosts.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteForumTopicPosts.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSiteForumTopicPosts.iParentID;
                            ViewBag.sParentID = _rec.WebSiteForumTopicPosts.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteForumTopicPosts dbInteraction = new DINT_WebSiteForumTopicPosts(oSystem.cnCon);

                                _rec.WebSiteForumTopicPosts.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteForumTopicPosts.dtDateCreated = DateTime.Now;
                                _rec.WebSiteForumTopicPosts.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteForumTopicPosts);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteForumTopicPosts_Details", new { key = _rec.WebSiteForumTopicPosts.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteForumTopicPosts.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteForumTopicPosts dbInteraction = new DINT_WebSiteForumTopicPosts(oSystem.cnCon);
                                    _rec.WebSiteForumTopicPosts.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteForumTopicPosts);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteForumTopicPosts_Details", new { id = _rec.WebSiteForumTopicPosts.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteForumTopicPosts_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteForumTopicPosts");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteForumTopicPosts dbInteraction = new DINT_WebSiteForumTopicPosts(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteForumTopicPosts.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteForumTopicPosts.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteForumTopicPosts_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteForumTopicPosts_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteForumTopicPostsResponses

        string sWebSiteForumTopicPostsResponses_Details = "/views/Forms/WebSiteForumTopicPostsResponses_Details.cshtml";
        string sWebSiteForumTopicPostsResponses_List = "/views/Forms/WebSiteForumTopicPostsResponses_List.cshtml";


        public ActionResult WebSiteForumTopicPostsResponses_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteForumTopicPostsResponses");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopicPostsResponses_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteForumTopicPostsResponses dbInteraction = new DINT_WebSiteForumTopicPostsResponses(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteForumTopicPostsResponses.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteForumTopicPostsResponses.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteForumTopicPostsResponses_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteForumTopicPostsResponses");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopicPostsResponses_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteForumTopicPostsResponses dbInteraction = new DINT_WebSiteForumTopicPostsResponses(oSystem.cnCon);
                        List<DEF_WebSiteForumTopicPostsResponses.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteForumTopicPostsResponses.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteForumTopicPostsResponses dbInteraction = new DINT_WebSiteForumTopicPostsResponses(oSystem.cnCon);
                        List<DEF_WebSiteForumTopicPostsResponses.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteForumTopicPostsResponses.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteForumTopicPostsResponses_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteForumTopicPostsResponses");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopicPostsResponses_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteForumTopicPostsResponses.RecordObject recRecord = new DEF_WebSiteForumTopicPostsResponses.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteForumTopicPostsResponses_AddUpdate(DEF_WebSiteForumTopicPostsResponses.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteForumTopicPostsResponses");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopicPostsResponses_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteForumTopicPostsResponses dbInteraction = new DINT_WebSiteForumTopicPostsResponses(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteForumTopicPostsResponses_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteForumTopicPostsResponses dbInteraction = new DINT_WebSiteForumTopicPostsResponses(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteForumTopicPostsResponses_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteForumTopicPostsResponses_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteForumTopicPostsResponses");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteForumTopicPostsResponses dbInteraction = new DINT_WebSiteForumTopicPostsResponses(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteForumTopicPostsResponses.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteForumTopicPostsResponses.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteForumTopicPostsResponses_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteForumTopicPostsResponses_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteForumTopics

        string sWebSiteForumTopics_Details = "/views/Forms/WebSiteForumTopics_Details.cshtml";
        string sWebSiteForumTopics_List = "/views/Forms/WebSiteForumTopics_List.cshtml";


        public ActionResult WebSiteForumTopics_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteForumTopics");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopics_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteForumTopics dbInteraction = new DINT_WebSiteForumTopics(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteForumTopics.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteForumTopics.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteForumTopics_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteForumTopics");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopics_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteForumTopics dbInteraction = new DINT_WebSiteForumTopics(oSystem.cnCon);
                        List<DEF_WebSiteForumTopics.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteForumTopics.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteForumTopicsViewModel recRecord = new ACMSDBView.WebSiteForumTopicsViewModel();
                                recRecord.WebSiteForumTopics = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteForumTopics.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteForumTopics.sParentID;

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteForumTopics dbInteraction = new DINT_WebSiteForumTopics(oSystem.cnCon);
                        List<DEF_WebSiteForumTopics.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteForumTopics.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteForumTopicsViewModel recRecord = new ACMSDBView.WebSiteForumTopicsViewModel();
                                recRecord.WebSiteForumTopics = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteForumTopics.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteForumTopics.sParentID;

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteForumTopics_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteForumTopics");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopics_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";

                    ACMSDBView.WebSiteForumTopicsViewModel recRecord = new ACMSDBView.WebSiteForumTopicsViewModel();
                    //DEF_WebSiteForumTopics.RecordObject recRecord = new DEF_WebSiteForumTopics.RecordObject();


                    recRecord.WebSiteForumTopics.iParentID = _iParentID;
                    recRecord.WebSiteForumTopics.sParentID = _sParentID;


                    recRecord.Get_WebSiteQuestionair(oSystem.cnCon);



                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteForumTopics_AddUpdate(ACMSDBView.WebSiteForumTopicsViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteForumTopics");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteForumTopics_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteForumTopics.ID == null) || (_rec.WebSiteForumTopics.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteForumTopics.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSiteForumTopics.iParentID;
                            ViewBag.sParentID = _rec.WebSiteForumTopics.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteForumTopics dbInteraction = new DINT_WebSiteForumTopics(oSystem.cnCon);

                                _rec.WebSiteForumTopics.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteForumTopics.dtDateCreated = DateTime.Now;
                                _rec.WebSiteForumTopics.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteForumTopics);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteForumTopics_Details", new { key = _rec.WebSiteForumTopics.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteForumTopics.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteForumTopics dbInteraction = new DINT_WebSiteForumTopics(oSystem.cnCon);
                                    _rec.WebSiteForumTopics.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteForumTopics);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteForumTopics_Details", new { id = _rec.WebSiteForumTopics.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteForumTopics_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteForumTopics");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteForumTopics dbInteraction = new DINT_WebSiteForumTopics(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteForumTopics.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteForumTopics.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteForumTopics_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteForumTopics_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteIPFilters

        string sWebSiteIPFilters_Details = "/views/Forms/WebSiteIPFilters_Details.cshtml";
        string sWebSiteIPFilters_List = "/views/Forms/WebSiteIPFilters_List.cshtml";

        public ActionResult WebSiteIPFilters_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteIPFilters_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteIPFilters_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteIPFilters dbInteraction = new DINT_WebSiteIPFilters(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteIPFilters.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;


                    if (_iParentID > 0)
                    {
                        pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        if (_iParentID > 0)
                        {
                            pParameter = new DataParameter("sIP", "'%" + Search + "%'", "string", 11, "sIP", " LIKE ", " AND ");
                            lstParameters.Add(pParameter);
                            iTotalRows = dbInteraction.GetRowCount(lstParameters);
                        }
                        else
                        {
                            pParameter = new DataParameter("sIP", "'%" + Search + "%'", "string", 11, "sIP", " LIKE ", "");
                            lstParameters.Add(pParameter);
                            iTotalRows = dbInteraction.GetRowCount(lstParameters);
                        }
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteIPFilters.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteIPFilters_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteIPFilters_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteIPFilters_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteIPFilters dbInteraction = new DINT_WebSiteIPFilters(oSystem.cnCon);
                        List<DEF_WebSiteIPFilters.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteIPFilters.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteIPFilters dbInteraction = new DINT_WebSiteIPFilters(oSystem.cnCon);
                        List<DEF_WebSiteIPFilters.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteIPFilters.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        //
        public ActionResult WebSiteIPFilters_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteIPFilters_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteIPFilters_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteIPFilters.RecordObject recRecord = new DEF_WebSiteIPFilters.RecordObject();

                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;


                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteIPFilters_AddUpdate(DEF_WebSiteIPFilters.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteIPFilters_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteIPFilters_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteIPFilters dbInteraction = new DINT_WebSiteIPFilters(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                //List<DataParameter> lstParameters = new List<DataParameter>();
                                //DataParameter pParameter = new DataParameter("sControl", "'" + _rec.WebSitePage.sControl.ToString() + "'", "sControl", 3, "sControl", " = ", "");
                                //lstParameters.Add(pParameter);

                                //List<DEF_WebSiteIPFilters.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                                //if (dbSearch != null)
                                //{
                                //  if (dbSearch.Count > 0)
                                //  {
                                //      _rec = dbSearch[0];
                                //      ViewBag.iParentID = _rec.iParentID;
                                //      ViewBag.sParentID = _rec.sParentID;
                                //  }
                                //}


                                oSystem.CloseDataConnection();
                                //return RedirectToAction("WebSiteIPFilters_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                #endregion
                                return RedirectToAction("WebSiteIPFilters_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteIPFilters dbInteraction = new DINT_WebSiteIPFilters(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;
                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSiteIPFilters_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    oSystem.CloseDataConnection();
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);
                                }
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteIPFilters_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteIPFilters_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteIPFilters dbInteraction = new DINT_WebSiteIPFilters(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteIPFilters.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteIPFilters.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        //iParentID = recRecord.iParentID;
                                        //sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteIPFilters_List", new { _iParentID = iParentID, _sParentID = sParentID });
                        //return RedirectToAction("WebSiteIPFilters_List");
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteIPFilters_List", new { _iParentID = iParentID, _sParentID = sParentID });
                        //return RedirectToAction("WebSiteIPFilters_List");
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSite_Leads

        string sWebSite_Leads_Details = "/views/Forms/WebSite_Leads_Details.cshtml";
        string sWebSite_Leads_List = "/views/Forms/WebSite_Leads_List.cshtml";


        public ActionResult WebSite_Leads_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSite_Leads");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_Leads_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSite_Leads dbInteraction = new DINT_WebSite_Leads(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSite_Leads.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSite_Leads.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSite_Leads_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSite_Leads");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_Leads_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSite_Leads dbInteraction = new DINT_WebSite_Leads(oSystem.cnCon);
                        List<DEF_WebSite_Leads.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSite_Leads.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSite_LeadsViewModel recRecord = new WebSite_LeadsViewModel();
                                recRecord.WebSite_Leads = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSite_Leads.iParentID;
                                ViewBag.sParentID = recRecord.WebSite_Leads.sParentID;

                                recRecord.Get_Countries(oSystem.cnCon);
                                recRecord.Get_States(oSystem.cnCon, recRecord.WebSite_Leads.iCountryID);

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSite_Leads dbInteraction = new DINT_WebSite_Leads(oSystem.cnCon);
                        List<DEF_WebSite_Leads.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSite_Leads.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSite_LeadsViewModel recRecord = new WebSite_LeadsViewModel();
                                recRecord.WebSite_Leads = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSite_Leads.iParentID;
                                ViewBag.sParentID = recRecord.WebSite_Leads.sParentID;

                                recRecord.Get_Countries(oSystem.cnCon);
                                recRecord.Get_States(oSystem.cnCon, recRecord.WebSite_Leads.iCountryID);



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSite_Leads_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSite_Leads");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_Leads_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    //DEF_WebSite_Leads.RecordObject recRecord = new DEF_WebSite_Leads.RecordObject();

                    ACMSDBView.WebSite_LeadsViewModel recRecord = new WebSite_LeadsViewModel();

                    recRecord.WebSite_Leads.iParentID = _iParentID;
                    recRecord.WebSite_Leads.sParentID = _sParentID;

                    recRecord.Get_Countries(oSystem.cnCon);
                    recRecord.Get_States(oSystem.cnCon);






                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSite_Leads_AddUpdate(DEF_WebSite_Leads.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSite_Leads");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_Leads_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSite_Leads dbInteraction = new DINT_WebSite_Leads(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSite_Leads_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSite_Leads dbInteraction = new DINT_WebSite_Leads(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSite_Leads_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSite_Leads_Delete(int id)
        {
            Set_Client_NavSettings("WebSite_Leads");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSite_Leads dbInteraction = new DINT_WebSite_Leads(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSite_Leads.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSite_Leads.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSite_Leads_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSite_Leads_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteAdGroupAds

        string sWebSiteAdGroupAds_Details = "/views/Forms/WebSiteAdGroupAds_Details.cshtml";
        string sWebSiteAdGroupAds_List = "/views/Forms/WebSiteAdGroupAds_List.cshtml";


        public ActionResult WebSiteAdGroupAds_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteAdGroupAds");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAdGroupAds_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteAdGroupAds dbInteraction = new DINT_WebSiteAdGroupAds(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteAdGroupAds.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteAdGroupAds.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAdGroupAds_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteAdGroupAds");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAdGroupAds_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteAdGroupAds dbInteraction = new DINT_WebSiteAdGroupAds(oSystem.cnCon);
                        List<DEF_WebSiteAdGroupAds.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAdGroupAds.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteAdGroupAds dbInteraction = new DINT_WebSiteAdGroupAds(oSystem.cnCon);
                        List<DEF_WebSiteAdGroupAds.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAdGroupAds.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteAdGroupAds_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteAdGroupAds");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAdGroupAds_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteAdGroupAds.RecordObject recRecord = new DEF_WebSiteAdGroupAds.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;
                    recRecord.dtAdExpOn = DateTime.Parse("01/01/1901");





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteAdGroupAds_AddUpdate(DEF_WebSiteAdGroupAds.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteAdGroupAds");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAdGroupAds_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteAdGroupAds dbInteraction = new DINT_WebSiteAdGroupAds(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteAdGroupAds_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteAdGroupAds dbInteraction = new DINT_WebSiteAdGroupAds(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteAdGroupAds_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAdGroupAds_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteAdGroupAds");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteAdGroupAds dbInteraction = new DINT_WebSiteAdGroupAds(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteAdGroupAds.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAdGroupAds.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteAdGroupAds_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteAdGroupAds_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteAdvertisementGroup

        string sWebSiteAdvertisementGroup_Details = "/views/Forms/WebSiteAdvertisementGroup_Details.cshtml";
        string sWebSiteAdvertisementGroup_List = "/views/Forms/WebSiteAdvertisementGroup_List.cshtml";


        public ActionResult WebSiteAdvertisementGroup_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteAdvertisementGroup");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAdvertisementGroup_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteAdvertisementGroup dbInteraction = new DINT_WebSiteAdvertisementGroup(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteAdvertisementGroup.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteAdvertisementGroup.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAdvertisementGroup_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteAdvertisementGroup");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAdvertisementGroup_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteAdvertisementGroup dbInteraction = new DINT_WebSiteAdvertisementGroup(oSystem.cnCon);
                        List<DEF_WebSiteAdvertisementGroup.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAdvertisementGroup.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteAdvertisementGroup dbInteraction = new DINT_WebSiteAdvertisementGroup(oSystem.cnCon);
                        List<DEF_WebSiteAdvertisementGroup.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAdvertisementGroup.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteAdvertisementGroup_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteAdvertisementGroup");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAdvertisementGroup_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteAdvertisementGroup.RecordObject recRecord = new DEF_WebSiteAdvertisementGroup.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;
                    recRecord.dtAdGrpExpOn = DateTime.Parse("01/01/1901");





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteAdvertisementGroup_AddUpdate(DEF_WebSiteAdvertisementGroup.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteAdvertisementGroup");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAdvertisementGroup_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteAdvertisementGroup dbInteraction = new DINT_WebSiteAdvertisementGroup(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteAdvertisementGroup_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteAdvertisementGroup dbInteraction = new DINT_WebSiteAdvertisementGroup(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteAdvertisementGroup_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAdvertisementGroup_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteAdvertisementGroup");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteAdvertisementGroup dbInteraction = new DINT_WebSiteAdvertisementGroup(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteAdvertisementGroup.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAdvertisementGroup.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteAdvertisementGroup_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteAdvertisementGroup_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteModules
        public ActionResult WebSiteModules_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteModules_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteModules_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteModules dbInteraction = new DINT_WebSiteModules(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteModules.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sName", "'" + Search + "'", "string", 10, "sName", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteModules.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteModules_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteModules_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteModules_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteModules dbInteraction = new DINT_WebSiteModules(oSystem.cnCon);
                        List<DEF_WebSiteModules.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteModules.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteModules dbInteraction = new DINT_WebSiteModules(oSystem.cnCon);
                        List<DEF_WebSiteModules.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteModules.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteModules_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteModules_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteModules_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteModules.RecordObject recRecord = new DEF_WebSiteModules.RecordObject();
                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;
                    oSystem.CloseDataConnection();
                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteModules_AddUpdate(DEF_WebSiteModules.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteModules_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteModules_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteModules dbInteraction = new DINT_WebSiteModules(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSiteModules_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteModules dbInteraction = new DINT_WebSiteModules(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;
                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSiteModules_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteModules_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteModules_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteModules dbInteraction = new DINT_WebSiteModules(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteModules.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteModules.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteModules_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteModules_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteNavigation
        public ActionResult WebSiteNavigation_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteNavigation_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteNavigation_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteNavigation dbInteraction = new DINT_WebSiteNavigation(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteNavigation.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sDisplayName", "'%" + Search + "%'", "string", 10, "sDisplayName", " LIKE ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteNavigation.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteNavigation_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteNavigation_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteNavigation_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteNavigation dbInteraction = new DINT_WebSiteNavigation(oSystem.cnCon);
                        List<DEF_WebSiteNavigation.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.WebSiteNavigationViewModel recRecord = new WebSiteNavigationViewModel();
                                recRecord.GetView(oSystem.cnCon, dbSearch[0].ID);
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.Navigation.iParentID;
                                ViewBag.sParentID = recRecord.Navigation.sParentID;


                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteNavigation dbInteraction = new DINT_WebSiteNavigation(oSystem.cnCon);
                        List<DEF_WebSiteNavigation.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.WebSiteNavigationViewModel recRecord = new WebSiteNavigationViewModel();
                                recRecord.GetView(oSystem.cnCon, dbSearch[0].ID);
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.Navigation.iParentID;
                                ViewBag.sParentID = recRecord.Navigation.sParentID;
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteNavigation_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteNavigation_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteNavigation_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    ACMSDBView.WebSiteNavigationViewModel recRecord = new WebSiteNavigationViewModel();
                    recRecord.Navigation = new DEF_WebSiteNavigation.RecordObject();

                    recRecord.Navigation.iParentID = _iParentID;
                    recRecord.Navigation.sParentID = _sParentID;

                    recRecord.Get_NavigationList(oSystem.cnCon, _iParentID);
                    recRecord.Get_PagesList(oSystem.cnCon, _iParentID);

                    oSystem.CloseDataConnection();
                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteNavigation_AddUpdate(ACMSDBView.WebSiteNavigationViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteNavigation_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                int iUserID = 0;
                string sUserID = "";
                #region Set Current User info to veriables to be used for record tracking
                try
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView != null)
                        {
                            if (oSystem.CurrentUser.UserView.User != null)
                            {
                                if (oSystem.CurrentUser.UserView.User.ID > 0)
                                {
                                    iUserID = oSystem.CurrentUser.UserView.User.ID;
                                    sUserID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName + "(" + oSystem.CurrentUser.UserView.User.sUserName + ")";
                                }
                            }
                        }
                    }
                }
                catch
                {

                }
                #endregion

                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteNavigation_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.Navigation.ID == null) || (_rec.Navigation.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.Navigation.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.Navigation.iParentID;
                            ViewBag.sParentID = _rec.Navigation.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                bool bProcessError = false;
                                DINT_WebSiteNavigation dbInteraction = new DINT_WebSiteNavigation(oSystem.cnCon);

                                List<DEF_WebSiteNavigation.RecordObject> dbSearch = null;
                                List<DataParameter> lstParameters = new List<DataParameter>();
                                DataParameter pParameter = null;

                                //check for duplicate
                                bool bDuplicateFound = false;
                                lstParameters = new List<DataParameter>();
                                pParameter = new DataParameter("sNavigationIdentifyer", "'" + _rec.Navigation.sNavigationIdentifyer + "'", "string", 1, "sNavigationIdentifyer", " = ", "");
                                lstParameters.Add(pParameter);

                                dbSearch = dbInteraction.Get(lstParameters);
                                if (dbSearch != null)
                                {
                                    if (dbSearch.Count > 0)
                                    {
                                        bDuplicateFound = true;
                                    }
                                }

                                if (bDuplicateFound == false)
                                {
                                    _rec.Navigation.sControl = Guid.NewGuid().ToString();
                                    _rec.Navigation.dtDateCreated = DateTime.Now;
                                    _rec.Navigation.dtLastUpdated = DateTime.Now;

                                    _rec.Navigation.iCreatedByID = iUserID;
                                    _rec.Navigation.sCreatedByID = sUserID;
                                    _rec.Navigation.iUpdatedByID = iUserID;
                                    _rec.Navigation.sUpdatedByID = sUserID;

                                    _rec.Get_NavigationList(oSystem.cnCon, _rec.Navigation.iPageID);
                                    _rec.Get_PagesList(oSystem.cnCon, _rec.Navigation.iPageID);
                                    if (_rec.Navigation.iPageID > 0)
                                    {
                                        foreach (SelectListItem oRec in _rec.Pages)
                                        {
                                            if (oRec.Value == _rec.Navigation.iPageID.ToString())
                                            {
                                                _rec.Navigation.sPageID = oRec.Text;
                                            }
                                        }
                                    }

                                    dbInteraction.Insert_SQL(_rec.Navigation);
                                    //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.bSaved = false;
                                    ViewBag.sErrorMessage = "A duplicate navigation was found!";
                                    bProcessError = true;
                                }


                                oSystem.CloseDataConnection();

                                if (bProcessError == false)
                                {
                                    return RedirectToAction("WebSiteNavigation_Details", new { key = _rec.Navigation.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_sViewToLoad, _rec);
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.iParentID = _rec.Navigation.iParentID;
                                    ViewBag.sParentID = _rec.Navigation.sParentID;


                                    oSystem.CloseDataConnection();

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);
                                }
                                #endregion
                            }
                            else
                            {
                                if (_rec.Navigation.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    bool bProcessError = false;
                                    DINT_WebSiteNavigation dbInteraction = new DINT_WebSiteNavigation(oSystem.cnCon);

                                    List<DEF_WebSiteNavigation.RecordObject> dbSearch = null;
                                    List<DataParameter> lstParameters = new List<DataParameter>();
                                    DataParameter pParameter = null;

                                    //check for duplicate
                                    bool bDuplicateFound = false;
                                    lstParameters = new List<DataParameter>();
                                    pParameter = new DataParameter("sNavigationIdentifyer", "'" + _rec.Navigation.sNavigationIdentifyer + "'", "string", 1, "sNavigationIdentifyer", " = ", "");
                                    lstParameters.Add(pParameter);

                                    dbSearch = dbInteraction.Get(lstParameters);
                                    if (dbSearch != null)
                                    {
                                        if (dbSearch.Count > 0)
                                        {
                                            if (dbSearch[0].ID != _rec.Navigation.ID)
                                            {
                                                bDuplicateFound = true;
                                            }
                                        }
                                    }


                                    if (bDuplicateFound == false)
                                    {
                                        _rec.Navigation.dtLastUpdated = DateTime.Now;

                                        _rec.Navigation.iUpdatedByID = iUserID;
                                        _rec.Navigation.sUpdatedByID = sUserID;

                                        _rec.Get_NavigationList(oSystem.cnCon, _rec.Navigation.iParentID);
                                        _rec.Get_PagesList(oSystem.cnCon, _rec.Navigation.iParentID);
                                        if (_rec.Navigation.iPageID > 0)
                                        {
                                            foreach (SelectListItem oRec in _rec.Pages)
                                            {
                                                if (oRec.Value == _rec.Navigation.iPageID.ToString())
                                                {
                                                    _rec.Navigation.sPageID = oRec.Text;
                                                }
                                            }
                                        }


                                        dbInteraction.Update_SQL(_rec.Navigation);

                                    }
                                    else
                                    {
                                        ViewBag.bError = true;
                                        ViewBag.bSaved = false;
                                        ViewBag.sErrorMessage = "A duplicate navigation was found!";
                                        bProcessError = true;
                                    }

                                    oSystem.CloseDataConnection();


                                    if (bProcessError == false)
                                    {
                                        //return View(_sViewToLoad, _rec);
                                        return RedirectToAction("WebSiteNavigation_Details", new { id = _rec.Navigation.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                        //return View(_rec);
                                    }
                                    else
                                    {
                                        ViewBag.iParentID = _rec.Navigation.iParentID;
                                        ViewBag.sParentID = _rec.Navigation.sParentID;


                                        oSystem.CloseDataConnection();

                                        oPage.DataModelsPrimary = _rec;
                                        oPage.DataModelsSub.Add(oSystem);
                                        oPage.AuthenticatedUser = true;
                                        oPage.PartialViewToLoad = _sViewToLoad;
                                        return View(sModuleBase + sBasePage, oPage);
                                    }
                                    #endregion

                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteNavigation_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteNavigation_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteNavigation dbInteraction = new DINT_WebSiteNavigation(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteNavigation.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteNavigation.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteNavigation_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteNavigation_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePage
        public ActionResult WebSitePage_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSitePage_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePage_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePage dbInteraction = new DINT_WebSitePage(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePage.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sPageName", "'%" + Search + "%'", "string", 10, "sPageName", " LIKE ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePage.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePage_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePage_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePage_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePage dbInteraction = new DINT_WebSitePage(oSystem.cnCon);
                        List<DEF_WebSitePage.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.WebSitePageViewModel recRecord = new ACMSDBView.WebSitePageViewModel();

                                recRecord.GetView(oSystem.cnCon, dbSearch[0].ID, dbSearch[0].iLanguageID);
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                recRecord.Get_Languages(oSystem.cnCon);
                                recRecord.Get_SiteTemplatesList(oSystem.cnCon, 1);

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);
                                if (recRecord.WebSitePage.iSiteTemplateID > 0)
                                {
                                    recRecord.Get_SiteTemplatesPages(oSystem.cnCon, recRecord.WebSitePage.iSiteTemplateID);
                                }

                                ViewBag.iParentID = recRecord.WebSitePage.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePage.sParentID;

                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePage dbInteraction = new DINT_WebSitePage(oSystem.cnCon);
                        List<DEF_WebSitePage.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.WebSitePageViewModel recRecord = new ACMSDBView.WebSitePageViewModel();

                                recRecord.GetView(oSystem.cnCon, dbSearch[0].ID, dbSearch[0].iLanguageID);
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                recRecord.Get_Languages(oSystem.cnCon);
                                recRecord.Get_SiteTemplatesList(oSystem.cnCon, 1);

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);
                                if (recRecord.WebSitePage.iSiteTemplateID > 0)
                                {
                                    recRecord.Get_SiteTemplatesPages(oSystem.cnCon, recRecord.WebSitePage.iSiteTemplateID);
                                }

                                ViewBag.iParentID = recRecord.WebSitePage.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePage.sParentID;

                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePage_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSitePage_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePage_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";

                    ACMSDBView.WebSitePageViewModel recRecord = new ACMSDBView.WebSitePageViewModel();
                    recRecord.WebSitePage = new DEF_WebSitePage.RecordObject();
                    recRecord.WebSitePage.iParentID = _iParentID;
                    recRecord.WebSitePage.sParentID = _sParentID;

                    recRecord.WebSitePage.dtEnd = DateTime.Parse("01/01/1901");
                    recRecord.WebSitePage.dtStart = DateTime.Parse("01/01/1901");
                    recRecord.WebSitePage.bIsLive = true;

                    recRecord.WebSitePage.iLanguageID = 205;
                    recRecord.WebSitePage.sLanguageID = "United States English";


                    recRecord.Get_WebSiteQuestionair(oSystem.cnCon);
                    recRecord.Get_SiteTemplatesList(oSystem.cnCon, _iParentID);

                    recRecord.Get_Languages(oSystem.cnCon);
                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePage_AddUpdate(ACMSDBView.WebSitePageViewModel _rec)
        {
            Set_Client_NavSettings("WebSitePage_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                int iUserID = 0;
                string sUserID = "";
                #region Set Current User info to veriables to be used for record tracking
                try
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView != null)
                        {
                            if (oSystem.CurrentUser.UserView.User != null)
                            {
                                if (oSystem.CurrentUser.UserView.User.ID > 0)
                                {
                                    iUserID = oSystem.CurrentUser.UserView.User.ID;
                                    sUserID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName + "(" + oSystem.CurrentUser.UserView.User.sUserName + ")";
                                }
                            }
                        }
                    }
                }
                catch
                {

                }
                #endregion

                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePage_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSitePage.ID == null) || (_rec.WebSitePage.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSitePage.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            bool bProcessError = false;
                            ViewBag.iParentID = _rec.WebSitePage.iParentID;
                            ViewBag.sParentID = _rec.WebSitePage.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePage dbInteraction = new DINT_WebSitePage(oSystem.cnCon);
                                List<DataParameter> lstParameters = new List<DataParameter>();
                                DataParameter pParameter = new DataParameter("sPageName", "'" + _rec.WebSitePage.sPageName.ToString() + "'", "sPageName", 3, "sPageName", " = ", "");
                                lstParameters.Add(pParameter);

                                //Check for duplicate page name
                                bool bDuplicatePageName = false;
                                List<DEF_WebSitePage.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                                if (dbSearch != null)
                                {
                                    if (dbSearch.Count > 0)
                                    {
                                        bDuplicatePageName = true;
                                    }
                                }

                                if (bDuplicatePageName == false)
                                {
                                    //check for duplicate navigation
                                    bool bDuplicateNavigation = false;
                                    #region Check for duplicate Navigation
                                    DINT_WebSiteNavigation dbWebSiteNavigation = new DINT_WebSiteNavigation(oSystem.cnCon);
                                    List<DEF_WebSiteNavigation.RecordObject> lstWebSiteNavigation = null;
                                    if (!String.IsNullOrEmpty(_rec.WebSitePage.sNavLinkID))
                                    {
                                        lstParameters = new List<DataParameter>();
                                        pParameter = new DataParameter("sNavigationIdentifyer", "'" + _rec.WebSitePage.sNavLinkID + "'", "string", 1, "sNavigationIdentifyer", " = ", "");
                                        lstParameters.Add(pParameter);

                                        lstWebSiteNavigation = dbWebSiteNavigation.Get(lstParameters);
                                        if (lstWebSiteNavigation != null)
                                        {
                                            if (lstWebSiteNavigation.Count > 0)
                                            {
                                                bDuplicateNavigation = true;
                                            }
                                        }
                                    }
                                    #endregion

                                    if (bDuplicateNavigation == false)
                                    {
                                        //create new record
                                        _rec.WebSitePage.sControl = Guid.NewGuid().ToString();
                                        _rec.WebSitePage.dtDateCreated = DateTime.Now;
                                        _rec.WebSitePage.dtLastUpdated = DateTime.Now;
                                        _rec.WebSitePage.iCreatedByID = iUserID;
                                        _rec.WebSitePage.sCreatedByID = sUserID;
                                        _rec.WebSitePage.iUpdatedByID = iUserID;
                                        _rec.WebSitePage.sUpdatedByID = sUserID;

                                        dbInteraction.Insert_SQL(_rec.WebSitePage);

                                        //_rec.Get_SiteTemplatesList(oSystem.cnCon, _rec.WebSitePage.iParentID);

                                        lstParameters = new List<DataParameter>();
                                        pParameter = new DataParameter("sControl", "'" + _rec.WebSitePage.sControl.ToString() + "'", "sControl", 3, "sControl", " = ", "");
                                        lstParameters.Add(pParameter);


                                        dbSearch = dbInteraction.Get(lstParameters);
                                        if (dbSearch != null)
                                        {
                                            if (dbSearch.Count > 0)
                                            {
                                                _rec.WebSitePage = dbSearch[0];
                                                ViewBag.iParentID = _rec.WebSitePage.iParentID;
                                                ViewBag.sParentID = _rec.WebSitePage.sParentID;

                                                //now create and link navigation item
                                                DEF_WebSiteNavigation.RecordObject recWebSiteNavigation = new DEF_WebSiteNavigation.RecordObject();
                                                recWebSiteNavigation.sControl = Guid.NewGuid().ToString();
                                                recWebSiteNavigation.dtDateCreated = DateTime.Now;
                                                recWebSiteNavigation.dtLastUpdated = DateTime.Now;

                                                recWebSiteNavigation.iUpdatedByID = iUserID;
                                                recWebSiteNavigation.sUpdatedByID = sUserID;
                                                recWebSiteNavigation.iCreatedByID = iUserID;
                                                recWebSiteNavigation.sCreatedByID = sUserID;

                                                recWebSiteNavigation.bDisabled = false;
                                                recWebSiteNavigation.bAnyActiveMemberShip = false;
                                                recWebSiteNavigation.bHidden = false;
                                                recWebSiteNavigation.bRestrictAccess = false;
                                                recWebSiteNavigation.iDisplayIndex = 0;
                                                recWebSiteNavigation.iScreenID = 0;
                                                recWebSiteNavigation.sScreenID = "";
                                                recWebSiteNavigation.iParentNavID = 0;
                                                recWebSiteNavigation.sParentNavID = "";
                                                recWebSiteNavigation.iNavigationTypeID = 1;
                                                recWebSiteNavigation.sNavigationTypeID = "Link";

                                                recWebSiteNavigation.iMemberShipID = _rec.WebSitePage.iMemberShipID;
                                                recWebSiteNavigation.sMemberShipID = _rec.WebSitePage.sMemberShipID;


                                                recWebSiteNavigation.iParentID = _rec.WebSitePage.iParentID;
                                                recWebSiteNavigation.sParentID = _rec.WebSitePage.sParentID;
                                                recWebSiteNavigation.iLanguageID = _rec.WebSitePage.iLanguageID;
                                                recWebSiteNavigation.sLanguageID = _rec.WebSitePage.sLanguageID;
                                                recWebSiteNavigation.iPageID = _rec.WebSitePage.ID;
                                                recWebSiteNavigation.sPageID = _rec.WebSitePage.sPageName;
                                                recWebSiteNavigation.sNavigationIdentifyer = _rec.WebSitePage.sNavLinkID;
                                                recWebSiteNavigation.sDisplayName = _rec.WebSitePage.sPageName;

                                                dbWebSiteNavigation.Insert_SQL(recWebSiteNavigation);


                                                lstWebSiteNavigation = null;

                                                lstParameters = new List<DataParameter>();
                                                pParameter = new DataParameter("sControl", "'" + recWebSiteNavigation.sControl + "'", "string", 1, "sControl", " = ", "");
                                                lstParameters.Add(pParameter);

                                                lstWebSiteNavigation = dbWebSiteNavigation.Get(lstParameters);
                                                if (lstWebSiteNavigation != null)
                                                {
                                                    if (lstWebSiteNavigation.Count > 0)
                                                    {
                                                        _rec.WebSitePage.iNavLinkID = lstWebSiteNavigation[0].ID;
                                                        dbInteraction.Update_SQL(_rec.WebSitePage);
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                ViewBag.bError = true;
                                                ViewBag.bSaved = false;
                                                ViewBag.sErrorMessage = "Error occured attempting to save your record!";
                                                bProcessError = true;
                                            }
                                        }
                                        else
                                        {
                                            ViewBag.bError = true;
                                            ViewBag.bSaved = false;
                                            ViewBag.sErrorMessage = "Error occured attempting to save your record!";
                                            bProcessError = true;
                                        }
                                    }
                                    else
                                    {
                                        ViewBag.bError = true;
                                        ViewBag.bSaved = false;
                                        ViewBag.sErrorMessage = "Duplicate Navigation Found, Please Try A Differeing Page Name!";
                                        bProcessError = true;
                                    }
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.bSaved = false;
                                    ViewBag.sErrorMessage = "Duplicate Page Name Found, Please Try A Differeing Page Name!";
                                    bProcessError = true;

                                }

                                oSystem.CloseDataConnection();
                                if (bProcessError == false)
                                {
                                    //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });

                                    return RedirectToAction("WebSitePage_Details", new { key = _rec.WebSitePage.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.iParentID = _rec.WebSitePage.iParentID;
                                    ViewBag.sParentID = _rec.WebSitePage.sParentID;

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);
                                }
                                #endregion
                            }
                            else
                            {
                                if (_rec.WebSitePage.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();

                                    DINT_WebSitePage dbInteraction = new DINT_WebSitePage(oSystem.cnCon);
                                    //Check for duplicate page name
                                    List<DataParameter> lstParameters = new List<DataParameter>();
                                    DataParameter pParameter = new DataParameter("sPageName", "'" + _rec.WebSitePage.sPageName.ToString() + "'", "sPageName", 3, "sPageName", " = ", "");
                                    lstParameters.Add(pParameter);

                                    //Check for duplicate page name other than it's self
                                    bool bDuplicatePageName = false;
                                    List<DEF_WebSitePage.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                                    if (dbSearch != null)
                                    {
                                        if (dbSearch.Count > 0)
                                        {
                                            if (dbSearch[0].ID != _rec.WebSitePage.ID)
                                            {
                                                bDuplicatePageName = true;
                                            }
                                        }
                                    }

                                    if (bDuplicatePageName == false)
                                    {
                                        //check for duplicate navigation
                                        bool bDuplicateNavigation = false;
                                        #region Check for duplicate Navigation
                                        DINT_WebSiteNavigation dbWebSiteNavigation = new DINT_WebSiteNavigation(oSystem.cnCon);
                                        List<DEF_WebSiteNavigation.RecordObject> lstWebSiteNavigation = null;
                                        if (!String.IsNullOrEmpty(_rec.WebSitePage.sNavLinkID))
                                        {
                                            lstParameters = new List<DataParameter>();
                                            pParameter = new DataParameter("sNavigationIdentifyer", "'" + _rec.WebSitePage.sNavLinkID + "'", "string", 1, "sNavigationIdentifyer", " = ", "");
                                            lstParameters.Add(pParameter);

                                            pParameter = new DataParameter("ID", "'" + _rec.WebSitePage.iNavLinkID + "'", "int", 1, "ID", " = ", " or ");
                                            lstParameters.Add(pParameter);

                                            lstWebSiteNavigation = dbWebSiteNavigation.Get(lstParameters);
                                            if (lstWebSiteNavigation != null)
                                            {
                                                if (lstWebSiteNavigation.Count > 0)
                                                {
                                                    try
                                                    {
                                                        int iNavUpdateRowIndex = 0;
                                                        int iNavListCounter = 0;
                                                        foreach (DEF_WebSiteNavigation.RecordObject oNR in lstWebSiteNavigation)
                                                        {
                                                            if (oNR.ID != _rec.WebSitePage.iNavLinkID)
                                                            {
                                                                bDuplicateNavigation = true;
                                                            }
                                                            else if (oNR.ID == _rec.WebSitePage.iNavLinkID)
                                                            {
                                                                iNavUpdateRowIndex = iNavListCounter;
                                                            }
                                                            iNavListCounter++;
                                                        }

                                                        if (bDuplicateNavigation == false)
                                                        {
                                                            if (_rec.WebSitePage.sNavLinkID != lstWebSiteNavigation[iNavUpdateRowIndex].sNavigationIdentifyer)
                                                            {
                                                                if (_rec.WebSitePage.iNavLinkID == lstWebSiteNavigation[iNavUpdateRowIndex].ID)
                                                                {
                                                                    lstWebSiteNavigation[iNavUpdateRowIndex].sNavigationIdentifyer = _rec.WebSitePage.sNavLinkID;
                                                                    lstWebSiteNavigation[iNavUpdateRowIndex].sDisplayName = _rec.WebSitePage.sPageName;
                                                                    dbWebSiteNavigation.Update_SQL(lstWebSiteNavigation[iNavUpdateRowIndex]);
                                                                }
                                                            }
                                                        }
                                                    }
                                                    catch
                                                    {
                                                    }
                                                }
                                            }
                                        }
                                        #endregion

                                        if (bDuplicateNavigation == false)
                                        {
                                            //Create an copy as an history record
                                            DINT_WebSitePage_History dbWebSitePage_History = new DINT_WebSitePage_History(oSystem.cnCon);
                                            DEF_WebSitePage_History.RecordObject rec_WebSitePage_History = new DEF_WebSitePage_History.RecordObject();
                                            rec_WebSitePage_History.sControl = Guid.NewGuid().ToString();
                                            rec_WebSitePage_History.iParentID = _rec.WebSitePage.ID;
                                            rec_WebSitePage_History.sParentID = _rec.WebSitePage.sPageName;

                                            rec_WebSitePage_History.dtDateCreated = DateTime.Now;
                                            rec_WebSitePage_History.dtLastUpdated = DateTime.Now;
                                            rec_WebSitePage_History.iCreatedByID = iUserID;
                                            rec_WebSitePage_History.sCreatedByID = sUserID;
                                            rec_WebSitePage_History.iUpdatedByID = iUserID;
                                            rec_WebSitePage_History.sUpdatedByID = sUserID;

                                            #region Transfer old values from old record found using the duplicate check
                                            try
                                            {
                                                if (dbSearch != null)
                                                {
                                                    if (dbSearch.Count > 0)
                                                    {
                                                        foreach (DEF_WebSitePage.RecordObject oR in dbSearch)
                                                        {
                                                            if (oR.ID == dbSearch[0].ID)
                                                            {
                                                                rec_WebSitePage_History.bIsLive = oR.bIsLive;
                                                                rec_WebSitePage_History.bLoadPartialPage = oR.bLoadPartialPage;
                                                                rec_WebSitePage_History.bRestrictAccess = oR.bLoadPartialPage;
                                                                rec_WebSitePage_History.dtEnd = oR.dtEnd;
                                                                rec_WebSitePage_History.dtStart = oR.dtStart;
                                                                rec_WebSitePage_History.sClassification = oR.sClassification;
                                                                rec_WebSitePage_History.sLoadIncludeURI = oR.sLoadIncludeURI; ;
                                                                rec_WebSitePage_History.sMetaTags = oR.sMetaTags;
                                                                rec_WebSitePage_History.sKeyWords = oR.sKeyWords;
                                                                rec_WebSitePage_History.sPageDescription = oR.sPageDescription;
                                                                rec_WebSitePage_History.sPageNavigationName = oR.sPageNavigationName;
                                                                rec_WebSitePage_History.sPageNavigationURL = oR.sPageNavigationURL;
                                                                rec_WebSitePage_History.sPageName = oR.sPageName;
                                                                rec_WebSitePage_History.sPageTitle = oR.sPageTitle;
                                                                rec_WebSitePage_History.sSiteTempalteURL = oR.sSiteTempalteURL;
                                                                rec_WebSitePage_History.sSiteTemplateURI = oR.sSiteTemplateURI;
                                                                rec_WebSitePage_History.iLanguageID = oR.iLanguageID;
                                                                rec_WebSitePage_History.sLanguageID = oR.sLanguageID;
                                                                rec_WebSitePage_History.sNavLinkID = oR.sNavLinkID;
                                                                rec_WebSitePage_History.iNavLinkID = oR.iNavLinkID;
                                                                rec_WebSitePage_History.sSiteTemplateID = oR.sSiteTemplateID;
                                                                rec_WebSitePage_History.iSiteTemplateID = oR.iSiteTemplateID;
                                                                rec_WebSitePage_History.sSiteTemplatePageID = oR.sSiteTemplatePageID;
                                                                rec_WebSitePage_History.iSiteTemplatePageID = oR.iSiteTemplatePageID;
                                                                rec_WebSitePage_History.iZoneID = oR.iZoneID;
                                                                rec_WebSitePage_History.sZoneID = oR.sZoneID;


                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                            catch
                                            {

                                            }
                                            #endregion

                                            dbWebSitePage_History.Insert_SQL(rec_WebSitePage_History);

                                            //update record with new values
                                            _rec.WebSitePage.dtLastUpdated = DateTime.Now;
                                            _rec.WebSitePage.iUpdatedByID = iUserID;
                                            _rec.WebSitePage.sUpdatedByID = sUserID;

                                            dbInteraction.Update_SQL(_rec.WebSitePage);

                                            //_rec.Get_SiteTemplatesList(oSystem.cnCon, _rec.WebSitePage.iParentID);
                                        }
                                        else
                                        {
                                            ViewBag.bError = true;
                                            ViewBag.bSaved = false;
                                            ViewBag.sErrorMessage = "Error occured attempting to save your record!";
                                            bProcessError = true;
                                        }
                                    }
                                    else
                                    {
                                        ViewBag.bError = true;
                                        ViewBag.bSaved = false;
                                        ViewBag.sErrorMessage = "Duplicate Page Name Found, Please Try A Differeing Page Name!";
                                        bProcessError = true;
                                    }
                                    oSystem.CloseDataConnection();



                                    if (bProcessError == false)
                                    {
                                        return RedirectToAction("WebSitePage_Details", new { id = _rec.WebSitePage.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    }
                                    else
                                    {
                                        ViewBag.iParentID = _rec.WebSitePage.iParentID;
                                        ViewBag.sParentID = _rec.WebSitePage.sParentID;

                                        oSystem.CloseDataConnection();

                                        oPage.DataModelsPrimary = _rec;
                                        oPage.DataModelsSub.Add(oSystem);
                                        oPage.AuthenticatedUser = true;
                                        oPage.PartialViewToLoad = _sViewToLoad;
                                        return View(sModuleBase + sBasePage, oPage);
                                    }
                                    #endregion                                    
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePage_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePage_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePage dbInteraction = new DINT_WebSitePage(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePage.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePage.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSitePage_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSitePage_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePage_History

        string sWebSitePage_History_Details = "/views/Forms/WebSitePage_History_Details.cshtml";
        string sWebSitePage_History_List = "/views/Forms/WebSitePage_History_List.cshtml";


        public ActionResult WebSitePage_History_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSitePage_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePage_History_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePage_History dbInteraction = new DINT_WebSitePage_History(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePage_History.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePage_History.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePage_History_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePage_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePage_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePage_History dbInteraction = new DINT_WebSitePage_History(oSystem.cnCon);
                        List<DEF_WebSitePage_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePage_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePage_History dbInteraction = new DINT_WebSitePage_History(oSystem.cnCon);
                        List<DEF_WebSitePage_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePage_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }


        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePage_History_Restore(DEF_WebSitePage_History.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSitePage_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                int iUserID = 0;
                string sUserID = "";
                #region Set Current User info to veriables to be used for record tracking
                try
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView != null)
                        {
                            if (oSystem.CurrentUser.UserView.User != null)
                            {
                                if (oSystem.CurrentUser.UserView.User.ID > 0)
                                {
                                    iUserID = oSystem.CurrentUser.UserView.User.ID;
                                    sUserID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName + "(" + oSystem.CurrentUser.UserView.User.sUserName + ")";
                                }
                            }
                        }
                    }
                }
                catch
                {

                }
                #endregion

                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePage_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID > 0))
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;


                            #region
                            ViewBag.bError = false;
                            ViewBag.bAddNew = false;
                            ViewBag.bSaved = true;
                            ViewBag.sErrorMessage = "";
                            oSystem.OpenDataConnection();


                            DINT_WebSitePage dbInteraction = new DINT_WebSitePage(oSystem.cnCon);
                            DEF_WebSitePage.RecordObject _rec_Restor = null;

                            List<DEF_WebSitePage.RecordObject> lstSearch = null;
                            List<DataParameter> lstParameters = new List<DataParameter>();
                            DataParameter pParameter = null;


                            pParameter = new DataParameter("ID", "'" + _rec.iParentID + "'", "string", 1, "ID", " = ", "");
                            lstParameters.Add(pParameter);


                            lstSearch = dbInteraction.Get(lstParameters);

                            DINT_WebSitePage_History dbWebSitePage_History = new DINT_WebSitePage_History(oSystem.cnCon);
                            DEF_WebSitePage_History.RecordObject rec_WebSitePage_History = new DEF_WebSitePage_History.RecordObject();
                            rec_WebSitePage_History.sControl = Guid.NewGuid().ToString();
                            rec_WebSitePage_History.iParentID = _rec.iParentID;
                            rec_WebSitePage_History.sParentID = _rec.sParentID;

                            rec_WebSitePage_History.dtDateCreated = DateTime.Now;
                            rec_WebSitePage_History.dtLastUpdated = DateTime.Now;
                            rec_WebSitePage_History.iCreatedByID = iUserID;
                            rec_WebSitePage_History.sCreatedByID = sUserID;
                            rec_WebSitePage_History.iUpdatedByID = iUserID;
                            rec_WebSitePage_History.sUpdatedByID = sUserID;

                            #region Transfer old values from old record found using the duplicate check
                            try
                            {
                                if (lstSearch != null)
                                {
                                    if (lstSearch.Count > 0)
                                    {
                                        foreach (DEF_WebSitePage.RecordObject oR in lstSearch)
                                        {
                                            if (oR.ID == _rec.iParentID)
                                            {
                                                rec_WebSitePage_History.sPageName = oR.sPageName;
                                                rec_WebSitePage_History.sPageNavigationName = oR.sPageNavigationName;
                                                rec_WebSitePage_History.sPageNavigationURL = oR.sPageNavigationURL;
                                                rec_WebSitePage_History.sPageTitle = oR.sPageTitle;
                                                rec_WebSitePage_History.sMetaTags = oR.sMetaTags;
                                                rec_WebSitePage_History.sClassification = oR.sClassification;
                                                rec_WebSitePage_History.sPageDescription = oR.sPageDescription;
                                                rec_WebSitePage_History.sKeyWords = oR.sKeyWords;
                                                rec_WebSitePage_History.bIsLive = oR.bIsLive;
                                                rec_WebSitePage_History.dtStart = oR.dtStart;
                                                rec_WebSitePage_History.dtEnd = oR.dtEnd;
                                                rec_WebSitePage_History.iSiteTemplateID = oR.iSiteTemplateID;
                                                rec_WebSitePage_History.sSiteTemplateID = oR.sSiteTemplateID;
                                                rec_WebSitePage_History.sSiteTemplateURI = oR.sSiteTemplateURI;
                                                rec_WebSitePage_History.sSiteTempalteURL = oR.sSiteTempalteURL;
                                                rec_WebSitePage_History.sLoadIncludeURI = oR.sLoadIncludeURI;
                                                rec_WebSitePage_History.bLoadPartialPage = oR.bLoadPartialPage;
                                                rec_WebSitePage_History.iZoneID = oR.iZoneID;
                                                rec_WebSitePage_History.sZoneID = oR.sZoneID;
                                                rec_WebSitePage_History.bRestrictAccess = oR.bRestrictAccess;
                                                rec_WebSitePage_History.iLanguageID = oR.iLanguageID;
                                                rec_WebSitePage_History.sLanguageID = oR.sLanguageID;
                                                rec_WebSitePage_History.iSiteTemplatePageID = oR.iSiteTemplatePageID;
                                                rec_WebSitePage_History.sSiteTemplatePageID = oR.sSiteTemplatePageID;
                                                rec_WebSitePage_History.iNavLinkID = oR.iNavLinkID;
                                                rec_WebSitePage_History.sNavLinkID = oR.sNavLinkID;
                                                rec_WebSitePage_History.iMemberShipID = oR.iMemberShipID;
                                                rec_WebSitePage_History.sMemberShipID = oR.sMemberShipID;
                                                rec_WebSitePage_History.bAnyActiveMemberShip = oR.bAnyActiveMemberShip;

                                                _rec_Restor = oR;
                                            }
                                        }
                                    }
                                }
                            }
                            catch
                            {

                            }
                            #endregion

                            dbWebSitePage_History.Insert_SQL(rec_WebSitePage_History);


                            //restor values
                            _rec_Restor.sPageName = _rec.sPageName;
                            _rec_Restor.sPageNavigationName = _rec.sPageNavigationName;
                            _rec_Restor.sPageNavigationURL = _rec.sPageNavigationURL;
                            _rec_Restor.sPageTitle = _rec.sPageTitle;
                            _rec_Restor.sMetaTags = _rec.sMetaTags;
                            _rec_Restor.sClassification = _rec.sClassification;
                            _rec_Restor.sPageDescription = _rec.sPageDescription;
                            _rec_Restor.sKeyWords = _rec.sKeyWords;
                            _rec_Restor.bIsLive = _rec.bIsLive;
                            _rec_Restor.dtStart = _rec.dtStart;
                            _rec_Restor.dtEnd = _rec.dtEnd;
                            _rec_Restor.iSiteTemplateID = _rec.iSiteTemplateID;
                            _rec_Restor.sSiteTemplateID = _rec.sSiteTemplateID;
                            _rec_Restor.sSiteTemplateURI = _rec.sSiteTemplateURI;
                            _rec_Restor.sSiteTempalteURL = _rec.sSiteTempalteURL;
                            _rec_Restor.sLoadIncludeURI = _rec.sLoadIncludeURI;
                            _rec_Restor.bLoadPartialPage = _rec.bLoadPartialPage;
                            _rec_Restor.iZoneID = _rec.iZoneID;
                            _rec_Restor.sZoneID = _rec.sZoneID;
                            _rec_Restor.bRestrictAccess = _rec.bRestrictAccess;
                            _rec_Restor.iLanguageID = _rec.iLanguageID;
                            _rec_Restor.sLanguageID = _rec.sLanguageID;
                            _rec_Restor.iSiteTemplatePageID = _rec.iSiteTemplatePageID;
                            _rec_Restor.sSiteTemplatePageID = _rec.sSiteTemplatePageID;
                            _rec_Restor.iNavLinkID = _rec.iNavLinkID;
                            _rec_Restor.sNavLinkID = _rec.sNavLinkID;
                            _rec_Restor.iMemberShipID = _rec.iMemberShipID;
                            _rec_Restor.sMemberShipID = _rec.sMemberShipID;
                            _rec_Restor.bAnyActiveMemberShip = _rec.bAnyActiveMemberShip;

                            _rec_Restor.dtLastUpdated = DateTime.Now;
                            _rec_Restor.iUpdatedByID = iUserID;
                            _rec_Restor.sUpdatedByID = sUserID;

                            dbInteraction.Update_SQL(_rec_Restor);

                            oSystem.CloseDataConnection();
                            #endregion
                            return RedirectToAction("WebSitePage_Details", new { id = _rec_Restor.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePage_History_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSitePage_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePage_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSitePage_History.RecordObject recRecord = new DEF_WebSitePage_History.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePage_History_AddUpdate(DEF_WebSitePage_History.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSitePage_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePage_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePage_History dbInteraction = new DINT_WebSitePage_History(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSitePage_History_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePage_History dbInteraction = new DINT_WebSitePage_History(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSitePage_History_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePage_History_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePage_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePage_History dbInteraction = new DINT_WebSitePage_History(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePage_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePage_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSitePage_History_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSitePage_History_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePageComments

        string sWebSitePageComments_Details = "/views/Forms/WebSitePageComments_Details.cshtml";
        string sWebSitePageComments_List = "/views/Forms/WebSitePageComments_List.cshtml";


        public ActionResult WebSitePageComments_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSitePageComments");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageComments_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePageComments dbInteraction = new DINT_WebSitePageComments(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePageComments.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePageComments.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageComments_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePageComments");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageComments_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageComments dbInteraction = new DINT_WebSitePageComments(oSystem.cnCon);
                        List<DEF_WebSitePageComments.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageComments.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageComments dbInteraction = new DINT_WebSitePageComments(oSystem.cnCon);
                        List<DEF_WebSitePageComments.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageComments.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSitePageComments_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSitePageComments");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageComments_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSitePageComments.RecordObject recRecord = new DEF_WebSitePageComments.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageComments_AddUpdate(DEF_WebSitePageComments.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSitePageComments");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageComments_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePageComments dbInteraction = new DINT_WebSitePageComments(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSitePageComments_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePageComments dbInteraction = new DINT_WebSitePageComments(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSitePageComments_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageComments_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePageComments");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePageComments dbInteraction = new DINT_WebSitePageComments(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePageComments.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageComments.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSitePageComments_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSitePageComments_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePageiAnnouncements

        string sWebSitePageiAnnouncements_Details = "/views/Forms/WebSitePageiAnnouncements_Details.cshtml";
        string sWebSitePageiAnnouncements_List = "/views/Forms/WebSitePageiAnnouncements_List.cshtml";


        public ActionResult WebSitePageiAnnouncements_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSitePageiAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageiAnnouncements_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePageiAnnouncements dbInteraction = new DINT_WebSitePageiAnnouncements(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePageiAnnouncements.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePageiAnnouncements.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageiAnnouncements_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePageiAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageiAnnouncements_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageiAnnouncements dbInteraction = new DINT_WebSitePageiAnnouncements(oSystem.cnCon);
                        List<DEF_WebSitePageiAnnouncements.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSitePageiAnnouncements.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSitePageiAnnouncementsViewModel recRecord = new WebSitePageiAnnouncementsViewModel();
                                recRecord.WebSitePageiAnnouncements = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSitePageiAnnouncements.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePageiAnnouncements.sParentID;

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageiAnnouncements dbInteraction = new DINT_WebSitePageiAnnouncements(oSystem.cnCon);
                        List<DEF_WebSitePageiAnnouncements.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSitePageiAnnouncements.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSitePageiAnnouncementsViewModel recRecord = new WebSitePageiAnnouncementsViewModel();
                                recRecord.WebSitePageiAnnouncements = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSitePageiAnnouncements.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePageiAnnouncements.sParentID;

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSitePageiAnnouncements_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSitePageiAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageiAnnouncements_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";

                    ACMSDBView.WebSitePageiAnnouncementsViewModel recRecord = new WebSitePageiAnnouncementsViewModel();
                    //DEF_WebSitePageiAnnouncements.RecordObject recRecord = new DEF_WebSitePageiAnnouncements.RecordObject();


                    recRecord.WebSitePageiAnnouncements.iParentID = _iParentID;
                    recRecord.WebSitePageiAnnouncements.sParentID = _sParentID;

                    recRecord.Get_WebSiteQuestionair(oSystem.cnCon);




                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageiAnnouncements_AddUpdate(ACMSDBView.WebSitePageiAnnouncementsViewModel _rec)
        {
            Set_Client_NavSettings("WebSitePageiAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageiAnnouncements_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSitePageiAnnouncements.ID == null) || (_rec.WebSitePageiAnnouncements.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSitePageiAnnouncements.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSitePageiAnnouncements.iParentID;
                            ViewBag.sParentID = _rec.WebSitePageiAnnouncements.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePageiAnnouncements dbInteraction = new DINT_WebSitePageiAnnouncements(oSystem.cnCon);

                                _rec.WebSitePageiAnnouncements.sControl = Guid.NewGuid().ToString();
                                _rec.WebSitePageiAnnouncements.dtDateCreated = DateTime.Now;
                                _rec.WebSitePageiAnnouncements.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSitePageiAnnouncements);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSitePageiAnnouncements_Details", new { key = _rec.WebSitePageiAnnouncements.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSitePageiAnnouncements.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePageiAnnouncements dbInteraction = new DINT_WebSitePageiAnnouncements(oSystem.cnCon);
                                    _rec.WebSitePageiAnnouncements.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSitePageiAnnouncements);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSitePageiAnnouncements_Details", new { id = _rec.WebSitePageiAnnouncements.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageiAnnouncements_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePageiAnnouncements");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePageiAnnouncements dbInteraction = new DINT_WebSitePageiAnnouncements(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePageiAnnouncements.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageiAnnouncements.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSitePageiAnnouncements_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSitePageiAnnouncements_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePageProperties
        public ActionResult WebSitePageProperties_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSitePageProperties_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageProperties_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePageProperties dbInteraction = new DINT_WebSitePageProperties(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePageProperties.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sFieldName", "'" + Search + "'", "string", 10, "sFieldName", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePageProperties.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageProperties_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePageProperties_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageProperties dbInteraction = new DINT_WebSitePageProperties(oSystem.cnCon);
                        List<DEF_WebSitePageProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageProperties dbInteraction = new DINT_WebSitePageProperties(oSystem.cnCon);
                        List<DEF_WebSitePageProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageProperties_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSitePageProperties_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSitePageProperties.RecordObject recRecord = new DEF_WebSitePageProperties.RecordObject();
                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;
                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageProperties_AddUpdate(DEF_WebSitePageProperties.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSitePageProperties_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePageProperties dbInteraction = new DINT_WebSitePageProperties(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSitePageProperties_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePageProperties dbInteraction = new DINT_WebSitePageProperties(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;
                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSitePageProperties_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageProperties_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePageProperties_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePageProperties dbInteraction = new DINT_WebSitePageProperties(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePageProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSitePageProperties_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSitePageProperties_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePageRoles
        public ActionResult WebSitePageRoles_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSitePageRoles_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageRoles_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePageRoles dbInteraction = new DINT_WebSitePageRoles(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePageRoles.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sRoleID", "'" + Search + "'", "string", 11, "sRoleID", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePageRoles.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);


                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageRoles_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePageRoles_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageRoles dbInteraction = new DINT_WebSitePageRoles(oSystem.cnCon);
                        List<DEF_WebSitePageRoles.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.WebSitePageRolesViewModel recRecord = new WebSitePageRolesViewModel();
                                recRecord.GetView(oSystem.cnCon, dbSearch[0].ID);
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSitePageRoles.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePageRoles.sParentID;

                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageRoles dbInteraction = new DINT_WebSitePageRoles(oSystem.cnCon);
                        List<DEF_WebSitePageRoles.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.WebSitePageRolesViewModel recRecord = new WebSitePageRolesViewModel();
                                recRecord.GetView(oSystem.cnCon, dbSearch[0].ID);
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSitePageRoles.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePageRoles.sParentID;

                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageRoles_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSitePageRoles_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    ACMSDBView.WebSitePageRolesViewModel recRecord = new ACMSDBView.WebSitePageRolesViewModel();
                    recRecord.WebSitePageRoles = new DEF_WebSitePageRoles.RecordObject();
                    recRecord.WebSitePageRoles.iParentID = _iParentID;
                    recRecord.WebSitePageRoles.sParentID = _sParentID;

                    recRecord.Get_RolesList(oSystem.cnCon);
                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        public ActionResult WebSitePageRoles_AddUpdate(ACMSDBView.WebSitePageRolesViewModel _rec)
        {
            Set_Client_NavSettings("WebSitePageRoles_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSitePageRoles.ID == null) || (_rec.WebSitePageRoles.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSitePageRoles.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSitePageRoles.iParentID;
                            ViewBag.sParentID = _rec.WebSitePageRoles.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePageRoles dbInteraction = new DINT_WebSitePageRoles(oSystem.cnCon);

                                _rec.WebSitePageRoles.sControl = Guid.NewGuid().ToString();
                                _rec.WebSitePageRoles.dtDateCreated = DateTime.Now;
                                _rec.WebSitePageRoles.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSitePageRoles);

                                _rec.Get_RolesList(oSystem.cnCon);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSitePageRoles_Details", new { key = _rec.WebSitePageRoles.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.WebSitePageRoles.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePageRoles dbInteraction = new DINT_WebSitePageRoles(oSystem.cnCon);

                                    _rec.WebSitePageRoles.dtLastUpdated = DateTime.Now;
                                    dbInteraction.Update_SQL(_rec.WebSitePageRoles);

                                    _rec.Get_RolesList(oSystem.cnCon);


                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSitePageRoles_Details", new { id = _rec.WebSitePageRoles.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageRoles_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePageRoles_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePageRoles dbInteraction = new DINT_WebSitePageRoles(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePageRoles.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageRoles.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSitePageRoles_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSitePageRoles_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePageTemplates
        public ActionResult WebSitePageTemplates_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSitePageTemplates_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;

                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplates_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();

                    DINT_WebSitePageTemplates dbInteraction = new DINT_WebSitePageTemplates(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePageTemplates.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();

                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sName", "'%" + Search + "%'", "string", 10, "sName", " LIKE ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePageTemplates.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageTemplates_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePageTemplates_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplates_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageTemplates dbInteraction = new DINT_WebSitePageTemplates(oSystem.cnCon);
                        List<DEF_WebSitePageTemplates.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.WebSitePageTemplatesViewModel recRecord = new WebSitePageTemplatesViewModel();
                                recRecord.GetView(oSystem.cnCon, dbSearch[0].ID);
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSitePageTemplates.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePageTemplates.sParentID;

                                recRecord.Get_Languages(oSystem.cnCon);

                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageTemplates dbInteraction = new DINT_WebSitePageTemplates(oSystem.cnCon);
                        List<DEF_WebSitePageTemplates.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.WebSitePageTemplatesViewModel recRecord = new WebSitePageTemplatesViewModel();
                                recRecord.GetView(oSystem.cnCon, dbSearch[0].ID);
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSitePageTemplates.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePageTemplates.sParentID;

                                recRecord.Get_Languages(oSystem.cnCon);

                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageTemplates_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSitePageTemplates_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplates_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    ACMSDBView.WebSitePageTemplatesViewModel recRecord = new ACMSDBView.WebSitePageTemplatesViewModel();
                    recRecord.WebSitePageTemplates = new DEF_WebSitePageTemplates.RecordObject();
                    recRecord.WebSitePageTemplates.iParentID = _iParentID;
                    recRecord.WebSitePageTemplates.sParentID = _sParentID;

                    recRecord.WebSitePageTemplates.iLanguageID = 205;
                    recRecord.WebSitePageTemplates.sLanguageID = "United States English";



                    recRecord.Get_Languages(oSystem.cnCon);
                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageTemplates_AddUpdate(ACMSDBView.WebSitePageTemplatesViewModel _rec)
        {
            Set_Client_NavSettings("WebSitePageTemplates_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                int iUserID = 0;
                string sUserID = "";
                #region Set Current User info to veriables to be used for record tracking
                try
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView != null)
                        {
                            if (oSystem.CurrentUser.UserView.User != null)
                            {
                                if (oSystem.CurrentUser.UserView.User.ID > 0)
                                {
                                    iUserID = oSystem.CurrentUser.UserView.User.ID;
                                    sUserID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName + "(" + oSystem.CurrentUser.UserView.User.sUserName + ")";
                                }
                            }
                        }
                    }
                }
                catch
                {

                }
                #endregion
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplates_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSitePageTemplates.ID == null) || (_rec.WebSitePageTemplates.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSitePageTemplates.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSitePageTemplates.iParentID;
                            ViewBag.sParentID = _rec.WebSitePageTemplates.sParentID;

                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePageTemplates dbInteraction = new DINT_WebSitePageTemplates(oSystem.cnCon);

                                _rec.WebSitePageTemplates.sControl = Guid.NewGuid().ToString();
                                _rec.WebSitePageTemplates.dtDateCreated = DateTime.Now;
                                _rec.WebSitePageTemplates.dtLastUpdated = DateTime.Now;
                                _rec.WebSitePageTemplates.iCreatedByID = iUserID;
                                _rec.WebSitePageTemplates.sCreatedByID = sUserID;
                                _rec.WebSitePageTemplates.iUpdatedByID = iUserID;
                                _rec.WebSitePageTemplates.sUpdatedByID = sUserID;

                                dbInteraction.Insert_SQL(_rec.WebSitePageTemplates);







                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSitePageTemplates_Details", new { key = _rec.WebSitePageTemplates.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.WebSitePageTemplates.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePageTemplates dbInteraction = new DINT_WebSitePageTemplates(oSystem.cnCon);

                                    _rec.WebSitePageTemplates.dtLastUpdated = DateTime.Now;
                                    _rec.WebSitePageTemplates.iUpdatedByID = iUserID;
                                    _rec.WebSitePageTemplates.sUpdatedByID = sUserID;

                                    dbInteraction.Update_SQL(_rec.WebSitePageTemplates);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSitePageTemplates_Details", new { id = _rec.WebSitePageTemplates.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageTemplates_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePageTemplates_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePageTemplates dbInteraction = new DINT_WebSitePageTemplates(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePageTemplates.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageTemplates.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSitePageTemplates_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSitePageTemplates_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public JsonResult GetTemplats()
        {
            try
            {
                if (oSystem.OpenDataConnection())
                {
                    DINT_WebSitePageTemplates dbInteraction = new DINT_WebSitePageTemplates(oSystem.cnCon);

                    List<DEF_WebSitePageTemplates.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();

                    //DataParameter pParameter = new DataParameter("iParentID", "'" + _iTemplateID + "'", "int", 1, "iParentID", " = ", "");
                    //lstParameters.Add(pParameter);

                    dbSearch = dbInteraction.Get(lstParameters);
                    List<SelectListItem> SiteTemplates = new List<SelectListItem>();

                    if (dbSearch != null)
                    {
                        foreach (DEF_WebSitePageTemplates.RecordObject oV in dbSearch)
                        {
                            SiteTemplates.Add(new SelectListItem { Selected = false, Text = oV.sName, Value = oV.ID.ToString() });
                        }


                    }


                    var oResponse = Json(SiteTemplates);
                    return oResponse;
                }


                var oResponseError = Json(new { RESPONSE = "ERROR" });
                return oResponseError;
            }
            catch
            {
                var oResponseError1 = Json(new { RESPONSE = "ERROR" });
                return oResponseError1;
            }
        }
        #endregion

        #region Form WebSitePageTemplatesPage
        string sWebSitePageTemplatesPage_Details = "/views/Forms/WebSitePageTemplatesPage_Details.cshtml";
        string sWebSitePageTemplatesPage_List = "/views/Forms/WebSitePageTemplatesPage_List.cshtml";

        public ActionResult WebSitePageTemplatesPage_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {

            Set_Client_NavSettings("WebSitePageTemplatesPage_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplatesPage_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePageTemplatesPage dbInteraction = new DINT_WebSitePageTemplatesPage(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePageTemplatesPage.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    if (_iParentID > 0)
                    {
                        pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        if (_iParentID > 0)
                        {
                            pParameter = new DataParameter("sName", "'%" + Search + "%'", "string", 11, "sName", " LIKE ", " AND ");
                            lstParameters.Add(pParameter);
                            iTotalRows = dbInteraction.GetRowCount(lstParameters);
                        }
                        else
                        {
                            pParameter = new DataParameter("sName", "'%" + Search + "%'", "string", 11, "sName", " LIKE ", "");
                            lstParameters.Add(pParameter);
                            iTotalRows = dbInteraction.GetRowCount(lstParameters);
                        }
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePageTemplatesPage.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageTemplatesPage_Details(int id = 0, string key = "", bool _UseParameterResults = false,
            bool _AddNew = false, bool _Saved = false)
        {

            Set_Client_NavSettings("WebSitePageTemplatesPage_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplatesPage_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageTemplatesPage dbInteraction = new DINT_WebSitePageTemplatesPage(oSystem.cnCon);
                        List<DEF_WebSitePageTemplatesPage.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSitePageTemplatesPage.RecordObject recRecord = dbSearch[0];

                                ACMSDBView.WebSitePageTemplatesPageViewModel recRecord = new WebSitePageTemplatesPageViewModel();
                                recRecord.WebSitePageTemplatesPage = dbSearch[0];

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSitePageTemplatesPage.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePageTemplatesPage.sParentID;

                                recRecord.Get_Languages(oSystem.cnCon);
                                recRecord.Get_Templates(oSystem.cnCon);

                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageTemplatesPage dbInteraction = new DINT_WebSitePageTemplatesPage(oSystem.cnCon);
                        List<DEF_WebSitePageTemplatesPage.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSitePageTemplatesPage.RecordObject recRecord = dbSearch[0];

                                ACMSDBView.WebSitePageTemplatesPageViewModel recRecord = new WebSitePageTemplatesPageViewModel();
                                recRecord.WebSitePageTemplatesPage = dbSearch[0];

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSitePageTemplatesPage.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePageTemplatesPage.sParentID;

                                recRecord.Get_Languages(oSystem.cnCon);
                                recRecord.Get_Templates(oSystem.cnCon);

                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageTemplatesPage_Create(int _iParentID = 0, string _sParentID = "")
        {

            Set_Client_NavSettings("WebSitePageTemplatesPage_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplatesPage_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";


                    ACMSDBView.WebSitePageTemplatesPageViewModel recRecord = new WebSitePageTemplatesPageViewModel();
                    //DEF_WebSitePageTemplatesPage.RecordObject recRecord = new DEF_WebSitePageTemplatesPage.RecordObject();

                    recRecord.WebSitePageTemplatesPage.iParentID = _iParentID;
                    recRecord.WebSitePageTemplatesPage.sParentID = _sParentID;

                    recRecord.WebSitePageTemplatesPage.iLanguageID = 205;
                    recRecord.WebSitePageTemplatesPage.sLanguageID = "United States English";



                    recRecord.Get_Languages(oSystem.cnCon);
                    recRecord.Get_Templates(oSystem.cnCon);


                    oSystem.CloseDataConnection();

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageTemplatesPage_AddUpdate(ACMSDBView.WebSitePageTemplatesPageViewModel _rec)
        {

            Set_Client_NavSettings("WebSitePageTemplatesPage_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                int iUserID = 0;
                string sUserID = "";
                #region Set Current User info to veriables to be used for record tracking
                try
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView != null)
                        {
                            if (oSystem.CurrentUser.UserView.User != null)
                            {
                                if (oSystem.CurrentUser.UserView.User.ID > 0)
                                {
                                    iUserID = oSystem.CurrentUser.UserView.User.ID;
                                    sUserID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName + "(" + oSystem.CurrentUser.UserView.User.sUserName + ")";
                                }
                            }
                        }
                    }
                }
                catch
                {

                }
                #endregion
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplatesPage_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSitePageTemplatesPage.ID == null) || (_rec.WebSitePageTemplatesPage.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSitePageTemplatesPage.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSitePageTemplatesPage.iParentID;
                            ViewBag.sParentID = _rec.WebSitePageTemplatesPage.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePageTemplatesPage dbInteraction = new DINT_WebSitePageTemplatesPage(oSystem.cnCon);


                                _rec.WebSitePageTemplatesPage.sControl = Guid.NewGuid().ToString();
                                _rec.WebSitePageTemplatesPage.dtDateCreated = DateTime.Now;
                                _rec.WebSitePageTemplatesPage.dtLastUpdated = DateTime.Now;
                                _rec.WebSitePageTemplatesPage.iCreatedByID = iUserID;
                                _rec.WebSitePageTemplatesPage.sCreatedByID = sUserID;
                                _rec.WebSitePageTemplatesPage.iUpdatedByID = iUserID;
                                _rec.WebSitePageTemplatesPage.sUpdatedByID = sUserID;


                                dbInteraction.Insert_SQL(_rec.WebSitePageTemplatesPage);



                                oSystem.CloseDataConnection();

                                #endregion
                                return RedirectToAction("WebSitePageTemplatesPage_Details", new { key = _rec.WebSitePageTemplatesPage.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.WebSitePageTemplatesPage.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePageTemplatesPage dbInteraction = new DINT_WebSitePageTemplatesPage(oSystem.cnCon);

                                    #region pull old record and make an history record of it's values before updateding with new values
                                    List<DataParameter> lstParameters = new List<DataParameter>();
                                    DataParameter pParameter = new DataParameter("sControl", "'" + _rec.WebSitePageTemplatesPage.sControl.ToString() + "'", "sControl", 3, "sControl", " = ", "");
                                    lstParameters.Add(pParameter);

                                    List<DEF_WebSitePageTemplatesPage.RecordObject> lstSearch = dbInteraction.Get(lstParameters);
                                    if (lstSearch != null)
                                    {
                                        if (lstSearch.Count > 0)
                                        {
                                            try
                                            {
                                                DINT_WebSitePageTemplatesPage_History dbWebSitePageTemplatesPage_History = new DINT_WebSitePageTemplatesPage_History(oSystem.cnCon);
                                                DEF_WebSitePageTemplatesPage_History.RecordObject rec_WebSitePageTemplatesPage_History = new DEF_WebSitePageTemplatesPage_History.RecordObject();
                                                rec_WebSitePageTemplatesPage_History.sControl = Guid.NewGuid().ToString();
                                                rec_WebSitePageTemplatesPage_History.iParentID = _rec.WebSitePageTemplatesPage.ID;
                                                rec_WebSitePageTemplatesPage_History.sParentID = _rec.WebSitePageTemplatesPage.sName;

                                                rec_WebSitePageTemplatesPage_History.dtDateCreated = DateTime.Now;
                                                rec_WebSitePageTemplatesPage_History.dtLastUpdated = DateTime.Now;
                                                rec_WebSitePageTemplatesPage_History.iCreatedByID = iUserID;
                                                rec_WebSitePageTemplatesPage_History.sCreatedByID = sUserID;
                                                rec_WebSitePageTemplatesPage_History.iUpdatedByID = iUserID;
                                                rec_WebSitePageTemplatesPage_History.sUpdatedByID = sUserID;

                                                foreach (DEF_WebSitePageTemplatesPage.RecordObject oR in lstSearch)
                                                {
                                                    if (oR.ID == _rec.WebSitePageTemplatesPage.ID)
                                                    {
                                                        rec_WebSitePageTemplatesPage_History.sName = oR.sName;
                                                        rec_WebSitePageTemplatesPage_History.sDescription = oR.sDescription;
                                                        rec_WebSitePageTemplatesPage_History.sTemplateBody = oR.sTemplateBody;
                                                        rec_WebSitePageTemplatesPage_History.sThumbNailImageURL = oR.sThumbNailImageURL;
                                                        rec_WebSitePageTemplatesPage_History.sVersion = oR.sVersion;
                                                        rec_WebSitePageTemplatesPage_History.iLanguageID = oR.iLanguageID;
                                                        rec_WebSitePageTemplatesPage_History.sLanguageID = oR.sLanguageID;
                                                    }

                                                }
                                                dbWebSitePageTemplatesPage_History.Insert_SQL(rec_WebSitePageTemplatesPage_History);
                                            }
                                            catch { }
                                        }
                                    }
                                    #endregion

                                    _rec.WebSitePageTemplatesPage.dtLastUpdated = DateTime.Now;
                                    _rec.WebSitePageTemplatesPage.iUpdatedByID = iUserID;
                                    _rec.WebSitePageTemplatesPage.sUpdatedByID = sUserID;

                                    dbInteraction.Update_SQL(_rec.WebSitePageTemplatesPage);

                                    oSystem.CloseDataConnection();
                                    #endregion

                                    return RedirectToAction("WebSitePageTemplatesPage_Details", new { id = _rec.WebSitePageTemplatesPage.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    oSystem.CloseDataConnection();
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);
                                }
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageTemplatesPage_Delete(int id)
        {

            Set_Client_NavSettings("WebSitePageTemplatesPage_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePageTemplatesPage dbInteraction = new DINT_WebSitePageTemplatesPage(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePageTemplatesPage.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageTemplatesPage.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        //iParentID = recRecord.iParentID;
                                        //sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSitePageTemplatesPage_List", new { _iParentID = iParentID, _sParentID = sParentID });
                        //return RedirectToAction("WebSitePageTemplatesPage_List");
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSitePageTemplatesPage_List", new { _iParentID = iParentID, _sParentID = sParentID });
                        //return RedirectToAction("WebSitePageTemplatesPage_List");
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public JsonResult GetTemplatePage(int _ParentID)
        {
            try
            {
                if (_ParentID > 0)
                {
                    if (oSystem.OpenDataConnection())
                    {
                        DINT_WebSitePageTemplatesPage dbInteraction = new DINT_WebSitePageTemplatesPage(oSystem.cnCon);

                        List<DEF_WebSitePageTemplatesPage.RecordObject> dbSearch = null;
                        List<DataParameter> lstParameters = new List<DataParameter>();

                        DataParameter pParameter = new DataParameter("iParentID", "'" + _ParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);

                        dbSearch = dbInteraction.Get(lstParameters);
                        List<SelectListItem> SiteTemplatesPages = new List<SelectListItem>();

                        if (dbSearch != null)
                        {
                            foreach (DEF_WebSitePageTemplatesPage.RecordObject oV in dbSearch)
                            {
                                SiteTemplatesPages.Add(new SelectListItem { Selected = false, Text = oV.sName, Value = oV.ID.ToString() });
                            }


                        }


                        var oResponse = Json(SiteTemplatesPages);
                        return oResponse;
                    }

                }
                var oResponseError = Json(new { RESPONSE = "ERROR" });
                return oResponseError;
            }
            catch
            {
                var oResponseError1 = Json(new { RESPONSE = "ERROR" });
                return oResponseError1;
            }
        }
        #endregion

        #region Form WebSitePageTemplatesPage_History

        string sWebSitePageTemplatesPage_History_Details = "/views/Forms/WebSitePageTemplatesPage_History_Details.cshtml";
        string sWebSitePageTemplatesPage_History_List = "/views/Forms/WebSitePageTemplatesPage_History_List.cshtml";


        public ActionResult WebSitePageTemplatesPage_History_List(FormCollection fc, string Search, int page = 1)

        {
            Set_Client_NavSettings("WebSitePageTemplatesPage_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplatesPage_History_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePageTemplatesPage_History dbInteraction = new DINT_WebSitePageTemplatesPage_History(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePageTemplatesPage_History.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePageTemplatesPage_History.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageTemplatesPage_History_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePageTemplatesPage_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplatesPage_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageTemplatesPage_History dbInteraction = new DINT_WebSitePageTemplatesPage_History(oSystem.cnCon);
                        List<DEF_WebSitePageTemplatesPage_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageTemplatesPage_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageTemplatesPage_History dbInteraction = new DINT_WebSitePageTemplatesPage_History(oSystem.cnCon);
                        List<DEF_WebSitePageTemplatesPage_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageTemplatesPage_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSitePageTemplatesPage_History_Create()

        {
            Set_Client_NavSettings("WebSitePageTemplatesPage_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process




                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplatesPage_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSitePageTemplatesPage_History.RecordObject recRecord = new DEF_WebSitePageTemplatesPage_History.RecordObject();








                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageTemplatesPage_History_Restore(DEF_WebSitePageTemplatesPage_History.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSitePageTemplatesPage_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                int iUserID = 0;
                string sUserID = "";
                #region Set Current User info to veriables to be used for record tracking
                try
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView != null)
                        {
                            if (oSystem.CurrentUser.UserView.User != null)
                            {
                                if (oSystem.CurrentUser.UserView.User.ID > 0)
                                {
                                    iUserID = oSystem.CurrentUser.UserView.User.ID;
                                    sUserID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName + "(" + oSystem.CurrentUser.UserView.User.sUserName + ")";
                                }
                            }
                        }
                    }
                }
                catch
                {

                }
                #endregion

                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplatesPage_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID > 0))
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;


                            #region
                            ViewBag.bError = false;
                            ViewBag.bAddNew = false;
                            ViewBag.bSaved = true;
                            ViewBag.sErrorMessage = "";
                            oSystem.OpenDataConnection();


                            DINT_WebSitePageTemplatesPage dbInteraction = new DINT_WebSitePageTemplatesPage(oSystem.cnCon);
                            DEF_WebSitePageTemplatesPage.RecordObject _rec_Restor = null;

                            List<DEF_WebSitePageTemplatesPage.RecordObject> lstSearch = null;
                            List<DataParameter> lstParameters = new List<DataParameter>();
                            DataParameter pParameter = null;


                            pParameter = new DataParameter("ID", "'" + _rec.iParentID + "'", "string", 1, "ID", " = ", "");
                            lstParameters.Add(pParameter);


                            lstSearch = dbInteraction.Get(lstParameters);

                            DINT_WebSitePageTemplatesPage_History dbWebSitePageTemplatesPage_History = new DINT_WebSitePageTemplatesPage_History(oSystem.cnCon);
                            DEF_WebSitePageTemplatesPage_History.RecordObject rec_WebSitePageTemplatesPage_History = new DEF_WebSitePageTemplatesPage_History.RecordObject();
                            rec_WebSitePageTemplatesPage_History.sControl = Guid.NewGuid().ToString();
                            rec_WebSitePageTemplatesPage_History.iParentID = _rec.iParentID;
                            rec_WebSitePageTemplatesPage_History.sParentID = _rec.sParentID;

                            rec_WebSitePageTemplatesPage_History.dtDateCreated = DateTime.Now;
                            rec_WebSitePageTemplatesPage_History.dtLastUpdated = DateTime.Now;
                            rec_WebSitePageTemplatesPage_History.iCreatedByID = iUserID;
                            rec_WebSitePageTemplatesPage_History.sCreatedByID = sUserID;
                            rec_WebSitePageTemplatesPage_History.iUpdatedByID = iUserID;
                            rec_WebSitePageTemplatesPage_History.sUpdatedByID = sUserID;

                            #region Transfer old values from old record found using the duplicate check
                            try
                            {
                                if (lstSearch != null)
                                {
                                    if (lstSearch.Count > 0)
                                    {
                                        foreach (DEF_WebSitePageTemplatesPage.RecordObject oR in lstSearch)
                                        {
                                            if (oR.ID == _rec.iParentID)
                                            {
                                                rec_WebSitePageTemplatesPage_History.sName = oR.sName;
                                                rec_WebSitePageTemplatesPage_History.sDescription = oR.sDescription;
                                                rec_WebSitePageTemplatesPage_History.sThumbNailImageURL = oR.sThumbNailImageURL;
                                                rec_WebSitePageTemplatesPage_History.sVersion = oR.sVersion;
                                                rec_WebSitePageTemplatesPage_History.sTemplateBody = oR.sTemplateBody;
                                                rec_WebSitePageTemplatesPage_History.iLanguageID = oR.iLanguageID;
                                                rec_WebSitePageTemplatesPage_History.sLanguageID = oR.sLanguageID;

                                                _rec_Restor = oR;
                                            }
                                        }
                                    }
                                }
                            }
                            catch
                            {

                            }
                            #endregion

                            dbWebSitePageTemplatesPage_History.Insert_SQL(rec_WebSitePageTemplatesPage_History);


                            //restor values
                            _rec_Restor.sName = _rec.sName;
                            _rec_Restor.sDescription = _rec.sDescription;
                            _rec_Restor.sThumbNailImageURL = _rec.sThumbNailImageURL;
                            _rec_Restor.sVersion = _rec.sVersion;
                            _rec_Restor.sTemplateBody = _rec.sTemplateBody;
                            _rec_Restor.iLanguageID = _rec.iLanguageID;
                            _rec_Restor.sLanguageID = _rec.sLanguageID;

                            _rec_Restor.dtLastUpdated = DateTime.Now;
                            _rec_Restor.iUpdatedByID = iUserID;
                            _rec_Restor.sUpdatedByID = sUserID;

                            dbInteraction.Update_SQL(_rec_Restor);

                            oSystem.CloseDataConnection();
                            #endregion
                            return RedirectToAction("WebSitePageTemplatesPage_Details", new { id = _rec_Restor.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public ActionResult WebSitePageTemplatesPage_History_AddUpdate(DEF_WebSitePageTemplatesPage_History.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSitePageTemplatesPage_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplatesPage_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {




                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePageTemplatesPage_History dbInteraction = new DINT_WebSitePageTemplatesPage_History(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSitePageTemplatesPage_History_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePageTemplatesPage_History dbInteraction = new DINT_WebSitePageTemplatesPage_History(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSitePageTemplatesPage_History_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageTemplatesPage_History_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePageTemplatesPage_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePageTemplatesPage_History dbInteraction = new DINT_WebSitePageTemplatesPage_History(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePageTemplatesPage_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageTemplatesPage_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {




                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSitePageTemplatesPage_History_List");


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSitePageTemplatesPage_History_List");

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePageTemplateZones
        public ActionResult WebSitePageTemplateZones_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSitePageTemplateZones_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZones_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePageTemplateZones dbInteraction = new DINT_WebSitePageTemplateZones(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePageTemplateZones.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sName", "'" + Search + "'", "string", 10, "sName", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePageTemplateZones.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageTemplateZones_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePageTemplateZones_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZones_DetailsWYSIWYG;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageTemplateZones dbInteraction = new DINT_WebSitePageTemplateZones(oSystem.cnCon);
                        List<DEF_WebSitePageTemplateZones.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSitePageTemplateZones.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSitePageTemplateZonesViewModel recRecord = new WebSitePageTemplateZonesViewModel();
                                recRecord.WebSitePageTemplateZones = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                ViewBag.iParentID = recRecord.WebSitePageTemplateZones.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePageTemplateZones.sParentID;

                                recRecord.Get_Languages(oSystem.cnCon);

                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageTemplateZones dbInteraction = new DINT_WebSitePageTemplateZones(oSystem.cnCon);
                        List<DEF_WebSitePageTemplateZones.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSitePageTemplateZones.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSitePageTemplateZonesViewModel recRecord = new WebSitePageTemplateZonesViewModel();
                                recRecord.WebSitePageTemplateZones = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                ViewBag.iParentID = recRecord.WebSitePageTemplateZones.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePageTemplateZones.sParentID;

                                recRecord.Get_Languages(oSystem.cnCon);

                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageTemplateZones_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSitePageTemplateZones_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZones_DetailsWYSIWYG;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    //DEF_WebSitePageTemplateZones.RecordObject recRecord = new DEF_WebSitePageTemplateZones.RecordObject();
                    ACMSDBView.WebSitePageTemplateZonesViewModel recRecord = new WebSitePageTemplateZonesViewModel();
                    recRecord.Get_Languages(oSystem.cnCon);

                    recRecord.WebSitePageTemplateZones.iParentID = _iParentID;
                    recRecord.WebSitePageTemplateZones.sParentID = _sParentID;

                    recRecord.WebSitePageTemplateZones.iLanguageID = 205;
                    recRecord.WebSitePageTemplateZones.sLanguageID = "United States English";




                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);


                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        public JsonResult GetTemplatZones(int _iTemplateID)
        {
            try
            {
                if (oSystem.OpenDataConnection())
                {
                    if (_iTemplateID > 0)
                    {

                        DINT_WebSitePageTemplateZones dbInteraction = new DINT_WebSitePageTemplateZones(oSystem.cnCon);

                        List<DEF_WebSitePageTemplateZones.RecordObject> dbSearch = null;
                        List<DataParameter> lstParameters = new List<DataParameter>();

                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iTemplateID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);

                        dbSearch = dbInteraction.Get(lstParameters);
                        List<SelectListItem> SiteTemplates = new List<SelectListItem>();

                        if (dbSearch != null)
                        {
                            foreach (DEF_WebSitePageTemplateZones.RecordObject oV in dbSearch)
                            {
                                SiteTemplates.Add(new SelectListItem { Selected = false, Text = oV.sName, Value = oV.ID.ToString() });
                            }


                        }


                        var oResponse = Json(SiteTemplates);
                        return oResponse;
                    }
                }


                var oResponseError = Json(new { RESPONSE = "ERROR" });
                return oResponseError;
            }
            catch
            {
                var oResponseError1 = Json(new { RESPONSE = "ERROR" });
                return oResponseError1;
            }
        }
        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageTemplateZones_AddUpdate(ACMSDBView.WebSitePageTemplateZonesViewModel _rec)
        {
            Set_Client_NavSettings("WebSitePageTemplateZones_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                int iUserID = 0;
                string sUserID = "";
                #region Set Current User info to veriables to be used for record tracking
                try
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView != null)
                        {
                            if (oSystem.CurrentUser.UserView.User != null)
                            {
                                if (oSystem.CurrentUser.UserView.User.ID > 0)
                                {
                                    iUserID = oSystem.CurrentUser.UserView.User.ID;
                                    sUserID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName + "(" + oSystem.CurrentUser.UserView.User.sUserName + ")";
                                }
                            }
                        }
                    }
                }
                catch
                {

                }
                #endregion


                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZones_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSitePageTemplateZones.ID == null) || (_rec.WebSitePageTemplateZones.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSitePageTemplateZones.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSitePageTemplateZones.iParentID;
                            ViewBag.sParentID = _rec.WebSitePageTemplateZones.sParentID;

                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePageTemplateZones dbInteraction = new DINT_WebSitePageTemplateZones(oSystem.cnCon);

                                _rec.WebSitePageTemplateZones.sControl = Guid.NewGuid().ToString();
                                _rec.WebSitePageTemplateZones.dtDateCreated = DateTime.Now;
                                _rec.WebSitePageTemplateZones.dtLastUpdated = DateTime.Now;

                                _rec.WebSitePageTemplateZones.iCreatedByID = iUserID;
                                _rec.WebSitePageTemplateZones.sCreatedByID = sUserID;
                                _rec.WebSitePageTemplateZones.iUpdatedByID = iUserID;
                                _rec.WebSitePageTemplateZones.sUpdatedByID = sUserID;

                                dbInteraction.Insert_SQL(_rec.WebSitePageTemplateZones);



                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSitePageTemplateZones_Details", new { key = _rec.WebSitePageTemplateZones.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.WebSitePageTemplateZones.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePageTemplateZones dbInteraction = new DINT_WebSitePageTemplateZones(oSystem.cnCon);

                                    #region pull old record and make an history record of it's values before updateding with new values
                                    List<DataParameter> lstParameters = new List<DataParameter>();
                                    DataParameter pParameter = new DataParameter("sControl", "'" + _rec.WebSitePageTemplateZones.sControl.ToString() + "'", "sControl", 3, "sControl", " = ", "");
                                    lstParameters.Add(pParameter);

                                    List<DEF_WebSitePageTemplateZones.RecordObject> lstSearch = dbInteraction.Get(lstParameters);
                                    if (lstSearch != null)
                                    {
                                        if (lstSearch.Count > 0)
                                        {
                                            try
                                            {
                                                DINT_WebSitePageTemplateZones_History dbWebSitePageTemplateZones_History = new DINT_WebSitePageTemplateZones_History(oSystem.cnCon);
                                                DEF_WebSitePageTemplateZones_History.RecordObject rec_WebSitePageTemplateZones_History = new DEF_WebSitePageTemplateZones_History.RecordObject();
                                                rec_WebSitePageTemplateZones_History.sControl = Guid.NewGuid().ToString();
                                                rec_WebSitePageTemplateZones_History.iParentID = _rec.WebSitePageTemplateZones.ID;
                                                rec_WebSitePageTemplateZones_History.sParentID = _rec.WebSitePageTemplateZones.sName;

                                                rec_WebSitePageTemplateZones_History.dtDateCreated = DateTime.Now;
                                                rec_WebSitePageTemplateZones_History.dtLastUpdated = DateTime.Now;
                                                rec_WebSitePageTemplateZones_History.iCreatedByID = iUserID;
                                                rec_WebSitePageTemplateZones_History.sCreatedByID = sUserID;
                                                rec_WebSitePageTemplateZones_History.iUpdatedByID = iUserID;
                                                rec_WebSitePageTemplateZones_History.sUpdatedByID = sUserID;

                                                foreach (DEF_WebSitePageTemplateZones.RecordObject oR in lstSearch)
                                                {
                                                    if (oR.ID == _rec.WebSitePageTemplateZones.ID)
                                                    {
                                                        rec_WebSitePageTemplateZones_History.sName = oR.sName;
                                                        rec_WebSitePageTemplateZones_History.sCodeName = oR.sCodeName;
                                                        rec_WebSitePageTemplateZones_History.sDefaultValue = oR.sDefaultValue;
                                                        rec_WebSitePageTemplateZones_History.iTypeID = oR.iTypeID;
                                                        rec_WebSitePageTemplateZones_History.sTypeID = oR.sTypeID;
                                                        rec_WebSitePageTemplateZones_History.iLanguageID = oR.iLanguageID;
                                                        rec_WebSitePageTemplateZones_History.sLanguageID = oR.sLanguageID;
                                                        rec_WebSitePageTemplateZones_History.bPrimaryContentArea = oR.bPrimaryContentArea;
                                                    }
                                                }

                                                dbWebSitePageTemplateZones_History.Insert_SQL(rec_WebSitePageTemplateZones_History);
                                            }
                                            catch { }
                                        }
                                    }
                                    #endregion

                                    _rec.WebSitePageTemplateZones.dtLastUpdated = DateTime.Now;
                                    _rec.WebSitePageTemplateZones.iUpdatedByID = iUserID;
                                    _rec.WebSitePageTemplateZones.sUpdatedByID = sUserID;

                                    dbInteraction.Update_SQL(_rec.WebSitePageTemplateZones);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSitePageTemplateZones_Details", new { id = _rec.WebSitePageTemplateZones.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageTemplateZones_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePageTemplateZones_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePageTemplateZones dbInteraction = new DINT_WebSitePageTemplateZones(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePageTemplateZones.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageTemplateZones.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSitePageTemplateZones_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSitePageTemplateZones_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePageTemplateZones_History

        string sWebSitePageTemplateZones_History_Details = "/views/Forms/WebSitePageTemplateZones_History_Details.cshtml";
        string sWebSitePageTemplateZones_History_List = "/views/Forms/WebSitePageTemplateZones_History_List.cshtml";


        public ActionResult WebSitePageTemplateZones_History_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSitePageTemplateZones_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZones_History_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePageTemplateZones_History dbInteraction = new DINT_WebSitePageTemplateZones_History(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePageTemplateZones_History.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePageTemplateZones_History.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageTemplateZones_History_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePageTemplateZones_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZones_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageTemplateZones_History dbInteraction = new DINT_WebSitePageTemplateZones_History(oSystem.cnCon);
                        List<DEF_WebSitePageTemplateZones_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageTemplateZones_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageTemplateZones_History dbInteraction = new DINT_WebSitePageTemplateZones_History(oSystem.cnCon);
                        List<DEF_WebSitePageTemplateZones_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageTemplateZones_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSitePageTemplateZones_History_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSitePageTemplateZones_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZones_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSitePageTemplateZones_History.RecordObject recRecord = new DEF_WebSitePageTemplateZones_History.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageTemplateZones_History_Restore(DEF_WebSitePageTemplateZones_History.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSitePageTemplateZones_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                int iUserID = 0;
                string sUserID = "";
                #region Set Current User info to veriables to be used for record tracking
                try
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView != null)
                        {
                            if (oSystem.CurrentUser.UserView.User != null)
                            {
                                if (oSystem.CurrentUser.UserView.User.ID > 0)
                                {
                                    iUserID = oSystem.CurrentUser.UserView.User.ID;
                                    sUserID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName + "(" + oSystem.CurrentUser.UserView.User.sUserName + ")";
                                }
                            }
                        }
                    }
                }
                catch
                {

                }
                #endregion

                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZones_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID > 0))
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;


                            #region
                            ViewBag.bError = false;
                            ViewBag.bAddNew = false;
                            ViewBag.bSaved = true;
                            ViewBag.sErrorMessage = "";
                            oSystem.OpenDataConnection();


                            DINT_WebSitePageTemplateZones dbInteraction = new DINT_WebSitePageTemplateZones(oSystem.cnCon);
                            DEF_WebSitePageTemplateZones.RecordObject _rec_Restor = null;

                            List<DEF_WebSitePageTemplateZones.RecordObject> lstSearch = null;
                            List<DataParameter> lstParameters = new List<DataParameter>();
                            DataParameter pParameter = null;


                            pParameter = new DataParameter("ID", "'" + _rec.iParentID + "'", "string", 1, "ID", " = ", "");
                            lstParameters.Add(pParameter);


                            lstSearch = dbInteraction.Get(lstParameters);

                            DINT_WebSitePageTemplateZones_History dbWebSitePageTemplateZones_History = new DINT_WebSitePageTemplateZones_History(oSystem.cnCon);
                            DEF_WebSitePageTemplateZones_History.RecordObject rec_WebSitePageTemplateZones_History = new DEF_WebSitePageTemplateZones_History.RecordObject();
                            rec_WebSitePageTemplateZones_History.sControl = Guid.NewGuid().ToString();
                            rec_WebSitePageTemplateZones_History.iParentID = _rec.iParentID;
                            rec_WebSitePageTemplateZones_History.sParentID = _rec.sParentID;

                            rec_WebSitePageTemplateZones_History.dtDateCreated = DateTime.Now;
                            rec_WebSitePageTemplateZones_History.dtLastUpdated = DateTime.Now;
                            rec_WebSitePageTemplateZones_History.iCreatedByID = iUserID;
                            rec_WebSitePageTemplateZones_History.sCreatedByID = sUserID;
                            rec_WebSitePageTemplateZones_History.iUpdatedByID = iUserID;
                            rec_WebSitePageTemplateZones_History.sUpdatedByID = sUserID;

                            #region Transfer old values from old record found using the duplicate check
                            try
                            {
                                if (lstSearch != null)
                                {
                                    if (lstSearch.Count > 0)
                                    {
                                        foreach (DEF_WebSitePageTemplateZones.RecordObject oR in lstSearch)
                                        {
                                            if (oR.ID == _rec.iParentID)
                                            {
                                                rec_WebSitePageTemplateZones_History.sName = oR.sName;
                                                rec_WebSitePageTemplateZones_History.iTypeID = oR.iTypeID;
                                                rec_WebSitePageTemplateZones_History.sTypeID = oR.sTypeID;
                                                rec_WebSitePageTemplateZones_History.sCodeName = oR.sCodeName;
                                                rec_WebSitePageTemplateZones_History.sDefaultValue = oR.sDefaultValue;
                                                rec_WebSitePageTemplateZones_History.iLanguageID = oR.iLanguageID;
                                                rec_WebSitePageTemplateZones_History.sLanguageID = oR.sLanguageID;
                                                rec_WebSitePageTemplateZones_History.bPrimaryContentArea = oR.bPrimaryContentArea;

                                                _rec_Restor = oR;
                                            }
                                        }
                                    }
                                }
                            }
                            catch
                            {

                            }
                            #endregion

                            dbWebSitePageTemplateZones_History.Insert_SQL(rec_WebSitePageTemplateZones_History);


                            //restor values
                            _rec_Restor.sName = _rec.sName;
                            _rec_Restor.iTypeID = _rec.iTypeID;
                            _rec_Restor.sTypeID = _rec.sTypeID;
                            _rec_Restor.sCodeName = _rec.sCodeName;
                            _rec_Restor.sDefaultValue = _rec.sDefaultValue;
                            _rec_Restor.iLanguageID = _rec.iLanguageID;
                            _rec_Restor.sLanguageID = _rec.sLanguageID;
                            _rec_Restor.bPrimaryContentArea = _rec.bPrimaryContentArea;

                            _rec_Restor.dtLastUpdated = DateTime.Now;
                            _rec_Restor.iUpdatedByID = iUserID;
                            _rec_Restor.sUpdatedByID = sUserID;

                            dbInteraction.Update_SQL(_rec_Restor);

                            oSystem.CloseDataConnection();
                            #endregion
                            return RedirectToAction("WebSitePageTemplateZones_Details", new { id = _rec_Restor.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageTemplateZones_History_AddUpdate(DEF_WebSitePageTemplateZones_History.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSitePageTemplateZones_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZones_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePageTemplateZones_History dbInteraction = new DINT_WebSitePageTemplateZones_History(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSitePageTemplateZones_History_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePageTemplateZones_History dbInteraction = new DINT_WebSitePageTemplateZones_History(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSitePageTemplateZones_History_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageTemplateZones_History_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePageTemplateZones_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePageTemplateZones_History dbInteraction = new DINT_WebSitePageTemplateZones_History(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePageTemplateZones_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageTemplateZones_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSitePageTemplateZones_History_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSitePageTemplateZones_History_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePageZoneContent
        public ActionResult WebSitePageZoneContent_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSitePageZoneContent_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZoneContent_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePageZoneContent dbInteraction = new DINT_WebSitePageZoneContent(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePageZoneContent.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        DataParameter pParameter = new DataParameter("sZoneID", "'" + Search + "'", "string", 11, "sZoneID", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePageZoneContent.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageZoneContent_Details(int id = 0, string _ViewType = "N", string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePageZoneContent_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZoneContent_Details;
                    if (_ViewType != "N")
                    {
                        sLocalDefaultView = sModuleBase + sWebSitePageTemplateZones_DetailsWYSIWYG;
                    }

                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageZoneContent dbInteraction = new DINT_WebSitePageZoneContent(oSystem.cnCon);
                        List<DEF_WebSitePageZoneContent.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                int iTemplateID = 0;
                                lstParameters = new List<DataParameter>();
                                pParameter = new DataParameter("ID", dbSearch[0].iParentID.ToString(), "int", 0, "ID", " = ", "");
                                lstParameters.Add(pParameter);

                                DINT_WebSitePage dbWebSitePage = new DINT_WebSitePage(oSystem.cnCon);
                                List<DEF_WebSitePage.RecordObject> lsrWebSitePage = dbWebSitePage.Get(lstParameters);
                                if (lsrWebSitePage != null)
                                {
                                    if (lsrWebSitePage.Count > 0)
                                    {
                                        iTemplateID = lsrWebSitePage[0].iSiteTemplatePageID;
                                    }
                                }
                                ACMSDBView.WebSitePageZoneContentViewModel recRecord = new WebSitePageZoneContentViewModel();
                                recRecord.GetView(oSystem.cnCon, dbSearch[0].ID, iTemplateID);
                                recRecord.Get_WebSitePageTemplateZonesContent(oSystem.cnCon, recRecord.WebSitePageZoneContent.iZoneID);

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSitePageZoneContent.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePageZoneContent.sParentID;


                                recRecord.Get_Languages(oSystem.cnCon);
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageZoneContent dbInteraction = new DINT_WebSitePageZoneContent(oSystem.cnCon);
                        List<DEF_WebSitePageZoneContent.RecordObject> dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                int iTemplateID = 0;
                                lstParameters = new List<DataParameter>();
                                pParameter = new DataParameter("ID", dbSearch[0].iParentID.ToString(), "int", 0, "ID", " = ", "");
                                lstParameters.Add(pParameter);

                                DINT_WebSitePage dbWebSitePage = new DINT_WebSitePage(oSystem.cnCon);
                                List<DEF_WebSitePage.RecordObject> lsrWebSitePage = dbWebSitePage.Get(lstParameters);
                                if (lsrWebSitePage != null)
                                {
                                    if (lsrWebSitePage.Count > 0)
                                    {
                                        iTemplateID = lsrWebSitePage[0].iSiteTemplatePageID;
                                    }
                                }
                                ACMSDBView.WebSitePageZoneContentViewModel recRecord = new WebSitePageZoneContentViewModel();
                                recRecord.GetView(oSystem.cnCon, dbSearch[0].ID, iTemplateID);
                                recRecord.Get_WebSitePageTemplateZonesContent(oSystem.cnCon, recRecord.WebSitePageZoneContent.iZoneID);

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSitePageZoneContent.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePageZoneContent.sParentID;
                                recRecord.Get_Languages(oSystem.cnCon);
                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageZoneContent_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSitePageZoneContent_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZoneContent_Details;

                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";

                    ACMSDBView.WebSitePageZoneContentViewModel recRecord = new ACMSDBView.WebSitePageZoneContentViewModel();
                    recRecord.WebSitePageZoneContent = new DEF_WebSitePageZoneContent.RecordObject();
                    if (_iParentID > 0)
                    {
                        int iTemplateID = 0;
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", _iParentID.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePage dbWebSitePage = new DINT_WebSitePage(oSystem.cnCon);
                        List<DEF_WebSitePage.RecordObject> lsrWebSitePage = dbWebSitePage.Get(lstParameters);
                        if (lsrWebSitePage != null)
                        {
                            if (lsrWebSitePage.Count > 0)
                            {
                                iTemplateID = lsrWebSitePage[0].iSiteTemplatePageID;
                                recRecord.Get_WebSitePageTemplateZonesList(oSystem.cnCon, iTemplateID);
                                //recRecord.Get_WebSitePageTemplateZonesContent(oSystem.cnCon, 0);
                            }
                            else
                            {
                                iTemplateID = 1;
                                recRecord.Get_WebSitePageTemplateZonesList(oSystem.cnCon, iTemplateID);
                                //recRecord.Get_WebSitePageTemplateZonesContent(oSystem.cnCon, 0);

                            }
                        }
                        else
                        {
                            iTemplateID = 1;
                            recRecord.Get_WebSitePageTemplateZonesList(oSystem.cnCon, iTemplateID);
                            //recRecord.Get_WebSitePageTemplateZonesContent(oSystem.cnCon, 0);
                        }

                        recRecord.Get_Languages(oSystem.cnCon);
                        recRecord.WebSitePageZoneContent.iParentID = _iParentID;
                        recRecord.WebSitePageZoneContent.sParentID = _sParentID;

                        recRecord.WebSitePageZoneContent.iLanguageID = 205;
                        recRecord.WebSitePageZoneContent.sLanguageID = "United States English";


                        oPage.DataModelsPrimary = recRecord;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    else
                    {
                        return RedirectToAction("Index");
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }

            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageZoneContent_AddUpdate(ACMSDBView.WebSitePageZoneContentViewModel _rec, string _sViewType = "N")
        {
            Set_Client_NavSettings("WebSitePageZoneContent_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                int iUserID = 0;
                string sUserID = "";
                #region Set Current User info to veriables to be used for record tracking
                try
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView != null)
                        {
                            if (oSystem.CurrentUser.UserView.User != null)
                            {
                                if (oSystem.CurrentUser.UserView.User.ID > 0)
                                {
                                    iUserID = oSystem.CurrentUser.UserView.User.ID;
                                    sUserID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName + "(" + oSystem.CurrentUser.UserView.User.sUserName + ")";
                                }
                            }
                        }
                    }
                }
                catch
                {

                }
                #endregion

                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZoneContent_Details;
                    if (_sViewType != "N")
                    {
                        sLocalDefaultView = sModuleBase + sWebSitePageTemplateZones_DetailsWYSIWYG;
                    }

                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (_rec != null)
                    {
                        if ((_rec.WebSitePageZoneContent.ID == null) || (_rec.WebSitePageZoneContent.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSitePageZoneContent.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSitePageZoneContent.iParentID;
                            ViewBag.sParentID = _rec.WebSitePageZoneContent.sParentID;

                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                int iTemplateID = 0;
                                List<DataParameter> lstParameters = new List<DataParameter>();
                                DataParameter pParameter = new DataParameter("ID", _rec.WebSitePageZoneContent.iParentID.ToString(), "int", 0, "ID", " = ", "");
                                lstParameters.Add(pParameter);

                                DINT_WebSitePage dbWebSitePage = new DINT_WebSitePage(oSystem.cnCon);
                                List<DEF_WebSitePage.RecordObject> lsrWebSitePage = dbWebSitePage.Get(lstParameters);
                                if (lsrWebSitePage != null)
                                {
                                    if (lsrWebSitePage.Count > 0)
                                    {
                                        iTemplateID = lsrWebSitePage[0].iSiteTemplateID;
                                        _rec.Get_WebSitePageTemplateZonesList(oSystem.cnCon, iTemplateID);
                                    }
                                }


                                DINT_WebSitePageZoneContent dbInteraction = new DINT_WebSitePageZoneContent(oSystem.cnCon);

                                _rec.WebSitePageZoneContent.sControl = Guid.NewGuid().ToString();
                                _rec.WebSitePageZoneContent.dtDateCreated = DateTime.Now;
                                _rec.WebSitePageZoneContent.dtLastUpdated = DateTime.Now;

                                if (_rec.WebSitePageZoneContent.iZoneID > 0)
                                {
                                    _rec.WebSitePageZoneContent.sZoneID = _rec.GetZoneName(_rec.WebSitePageZoneContent.iZoneID);
                                    _rec.Get_WebSitePageTemplateZonesContent(oSystem.cnCon, _rec.WebSitePageZoneContent.iZoneID);
                                    if (_rec.WebSitePageZoneContent.iContentZoneID > 0)
                                    {
                                        foreach (SelectListItem oV in _rec.WebSitePageTemplateZonesContent)
                                        {
                                            if (oV.Value == _rec.WebSitePageZoneContent.iContentZoneID.ToString())
                                            {
                                                _rec.WebSitePageZoneContent.sContentZoneID = oV.Text;
                                            }
                                        }
                                    }
                                }


                                dbInteraction.Insert_SQL(_rec.WebSitePageZoneContent);


                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSitePageZoneContent_Details", new { key = _rec.WebSitePageZoneContent.sControl, _ViewType = _sViewType, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.WebSitePageZoneContent.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    int iTemplateID = 0;
                                    List<DataParameter> lstParameters = new List<DataParameter>();
                                    DataParameter pParameter = null;
                                    lstParameters.Add(pParameter);

                                    DINT_WebSitePageZoneContent dbInteraction = new DINT_WebSitePageZoneContent(oSystem.cnCon);
                                    DINT_WebSitePage dbWebSitePage = new DINT_WebSitePage(oSystem.cnCon);

                                    #region pull old record and make an history record of it's values before updateding with new values
                                    lstParameters = new List<DataParameter>();
                                    pParameter = new DataParameter("sControl", "'" + _rec.WebSitePageZoneContent.sControl.ToString() + "'", "sControl", 3, "sControl", " = ", "");
                                    lstParameters.Add(pParameter);

                                    List<DEF_WebSitePageZoneContent.RecordObject> lstSearch = dbInteraction.Get(lstParameters);
                                    if (lstSearch != null)
                                    {
                                        if (lstSearch.Count > 0)
                                        {
                                            try
                                            {
                                                DINT_WebSitePageZoneContent_History dbWebSitePageZoneContent_History = new DINT_WebSitePageZoneContent_History(oSystem.cnCon);
                                                DEF_WebSitePageZoneContent_History.RecordObject rec_WebSitePageZoneContent_History = new DEF_WebSitePageZoneContent_History.RecordObject();
                                                rec_WebSitePageZoneContent_History.sControl = Guid.NewGuid().ToString();
                                                rec_WebSitePageZoneContent_History.iParentID = _rec.WebSitePageZoneContent.ID;
                                                rec_WebSitePageZoneContent_History.sParentID = _rec.WebSitePageZoneContent.sZoneID;

                                                rec_WebSitePageZoneContent_History.dtDateCreated = DateTime.Now;
                                                rec_WebSitePageZoneContent_History.dtLastUpdated = DateTime.Now;
                                                rec_WebSitePageZoneContent_History.iCreatedByID = iUserID;
                                                rec_WebSitePageZoneContent_History.sCreatedByID = sUserID;
                                                rec_WebSitePageZoneContent_History.iUpdatedByID = iUserID;
                                                rec_WebSitePageZoneContent_History.sUpdatedByID = sUserID;

                                                foreach (DEF_WebSitePageZoneContent.RecordObject oR in lstSearch)
                                                {
                                                    if (oR.ID == _rec.WebSitePageZoneContent.ID)
                                                    {
                                                        rec_WebSitePageZoneContent_History.sName = oR.sName;
                                                        rec_WebSitePageZoneContent_History.iZoneID = oR.iZoneID;
                                                        rec_WebSitePageZoneContent_History.sZoneID = oR.sZoneID;
                                                        rec_WebSitePageZoneContent_History.sContent = oR.sContent;
                                                        rec_WebSitePageZoneContent_History.sLoadIncludeURI = oR.sLoadIncludeURI;
                                                        rec_WebSitePageZoneContent_History.bLoadPartialPage = oR.bLoadPartialPage;
                                                        rec_WebSitePageZoneContent_History.iContentZoneID = oR.iContentZoneID;
                                                        rec_WebSitePageZoneContent_History.sContentZoneID = oR.sContentZoneID;
                                                        rec_WebSitePageZoneContent_History.iLanguageID = oR.iLanguageID;
                                                        rec_WebSitePageZoneContent_History.sLanguageID = oR.sLanguageID;
                                                    }
                                                }
                                                dbWebSitePageZoneContent_History.Insert_SQL(rec_WebSitePageZoneContent_History);
                                            }
                                            catch { }
                                        }
                                    }
                                    #endregion

                                    lstParameters = new List<DataParameter>();
                                    pParameter = new DataParameter("ID", _rec.WebSitePageZoneContent.iParentID.ToString(), "int", 0, "ID", " = ", "");
                                    lstParameters.Add(pParameter);

                                    List<DEF_WebSitePage.RecordObject> lsrWebSitePage = dbWebSitePage.Get(lstParameters);
                                    if (lsrWebSitePage != null)
                                    {
                                        if (lsrWebSitePage.Count > 0)
                                        {
                                            iTemplateID = lsrWebSitePage[0].iSiteTemplateID;
                                            _rec.Get_WebSitePageTemplateZonesList(oSystem.cnCon, iTemplateID);
                                        }
                                    }


                                    _rec.WebSitePageZoneContent.dtLastUpdated = DateTime.Now;

                                    if (_rec.WebSitePageZoneContent.iZoneID > 0)
                                    {
                                        _rec.WebSitePageZoneContent.sZoneID = _rec.GetZoneName(_rec.WebSitePageZoneContent.iZoneID);
                                        _rec.Get_WebSitePageTemplateZonesContent(oSystem.cnCon, _rec.WebSitePageZoneContent.iZoneID);
                                        if (_rec.WebSitePageZoneContent.iContentZoneID > 0)
                                        {
                                            foreach (SelectListItem oV in _rec.WebSitePageTemplateZonesContent)
                                            {
                                                if (oV.Value == _rec.WebSitePageZoneContent.iContentZoneID.ToString())
                                                {
                                                    _rec.WebSitePageZoneContent.sContentZoneID = oV.Text;
                                                }
                                            }
                                        }
                                    }

                                    dbInteraction.Update_SQL(_rec.WebSitePageZoneContent);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSitePageZoneContent_Details", new { id = _rec.WebSitePageZoneContent.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);

                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageZoneContent_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePageZoneContent_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePageZoneContent dbInteraction = new DINT_WebSitePageZoneContent(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePageZoneContent.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageZoneContent.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSitePageZoneContent_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSitePageZoneContent_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePageZoneContent_History

        string sWebSitePageZoneContent_History_Details = "/views/Forms/WebSitePageZoneContent_History_Details.cshtml";
        string sWebSitePageZoneContent_History_List = "/views/Forms/WebSitePageZoneContent_History_List.cshtml";


        public ActionResult WebSitePageZoneContent_History_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSitePageZoneContent_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZoneContent_History_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePageZoneContent_History dbInteraction = new DINT_WebSitePageZoneContent_History(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePageZoneContent_History.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePageZoneContent_History.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageZoneContent_History_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePageZoneContent_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZoneContent_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageZoneContent_History dbInteraction = new DINT_WebSitePageZoneContent_History(oSystem.cnCon);
                        List<DEF_WebSitePageZoneContent_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageZoneContent_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageZoneContent_History dbInteraction = new DINT_WebSitePageZoneContent_History(oSystem.cnCon);
                        List<DEF_WebSitePageZoneContent_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageZoneContent_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSitePageZoneContent_History_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSitePageZoneContent_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZoneContent_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSitePageZoneContent_History.RecordObject recRecord = new DEF_WebSitePageZoneContent_History.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageZoneContent_History_Restore(DEF_WebSitePageZoneContent_History.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSitePageZoneContent_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                int iUserID = 0;
                string sUserID = "";
                #region Set Current User info to veriables to be used for record tracking
                try
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView != null)
                        {
                            if (oSystem.CurrentUser.UserView.User != null)
                            {
                                if (oSystem.CurrentUser.UserView.User.ID > 0)
                                {
                                    iUserID = oSystem.CurrentUser.UserView.User.ID;
                                    sUserID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName + "(" + oSystem.CurrentUser.UserView.User.sUserName + ")";
                                }
                            }
                        }
                    }
                }
                catch
                {

                }
                #endregion

                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZoneContent_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID > 0))
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;


                            #region
                            ViewBag.bError = false;
                            ViewBag.bAddNew = false;
                            ViewBag.bSaved = true;
                            ViewBag.sErrorMessage = "";
                            oSystem.OpenDataConnection();


                            DINT_WebSitePageZoneContent dbInteraction = new DINT_WebSitePageZoneContent(oSystem.cnCon);
                            DEF_WebSitePageZoneContent.RecordObject _rec_Restor = null;

                            List<DEF_WebSitePageZoneContent.RecordObject> lstSearch = null;
                            List<DataParameter> lstParameters = new List<DataParameter>();
                            DataParameter pParameter = null;


                            pParameter = new DataParameter("ID", "'" + _rec.iParentID + "'", "string", 1, "ID", " = ", "");
                            lstParameters.Add(pParameter);


                            lstSearch = dbInteraction.Get(lstParameters);

                            DINT_WebSitePageZoneContent_History dbWebSitePageZoneContent_History = new DINT_WebSitePageZoneContent_History(oSystem.cnCon);
                            DEF_WebSitePageZoneContent_History.RecordObject rec_WebSitePageZoneContent_History = new DEF_WebSitePageZoneContent_History.RecordObject();
                            rec_WebSitePageZoneContent_History.sControl = Guid.NewGuid().ToString();
                            rec_WebSitePageZoneContent_History.iParentID = _rec.iParentID;
                            rec_WebSitePageZoneContent_History.sParentID = _rec.sParentID;

                            rec_WebSitePageZoneContent_History.dtDateCreated = DateTime.Now;
                            rec_WebSitePageZoneContent_History.dtLastUpdated = DateTime.Now;
                            rec_WebSitePageZoneContent_History.iCreatedByID = iUserID;
                            rec_WebSitePageZoneContent_History.sCreatedByID = sUserID;
                            rec_WebSitePageZoneContent_History.iUpdatedByID = iUserID;
                            rec_WebSitePageZoneContent_History.sUpdatedByID = sUserID;

                            #region Transfer old values from old record found using the duplicate check
                            try
                            {
                                if (lstSearch != null)
                                {
                                    if (lstSearch.Count > 0)
                                    {
                                        foreach (DEF_WebSitePageZoneContent.RecordObject oR in lstSearch)
                                        {
                                            if (oR.ID == _rec.iParentID)
                                            {
                                                rec_WebSitePageZoneContent_History.iZoneID = oR.iZoneID;
                                                rec_WebSitePageZoneContent_History.sZoneID = oR.sZoneID;
                                                rec_WebSitePageZoneContent_History.sName = oR.sName;
                                                rec_WebSitePageZoneContent_History.sContent = oR.sContent;
                                                rec_WebSitePageZoneContent_History.sLoadIncludeURI = oR.sLoadIncludeURI;
                                                rec_WebSitePageZoneContent_History.bLoadPartialPage = oR.bLoadPartialPage;
                                                rec_WebSitePageZoneContent_History.iContentZoneID = oR.iContentZoneID;
                                                rec_WebSitePageZoneContent_History.sContentZoneID = oR.sContentZoneID;
                                                rec_WebSitePageZoneContent_History.iLanguageID = oR.iLanguageID;
                                                rec_WebSitePageZoneContent_History.sLanguageID = oR.sLanguageID;

                                                _rec_Restor = oR;
                                            }
                                        }
                                    }
                                }
                            }
                            catch
                            {

                            }
                            #endregion

                            dbWebSitePageZoneContent_History.Insert_SQL(rec_WebSitePageZoneContent_History);


                            //restor values
                            _rec_Restor.iZoneID = _rec.iZoneID;
                            _rec_Restor.sZoneID = _rec.sZoneID;
                            _rec_Restor.sName = _rec.sName;
                            _rec_Restor.sContent = _rec.sContent;
                            _rec_Restor.sLoadIncludeURI = _rec.sLoadIncludeURI;
                            _rec_Restor.bLoadPartialPage = _rec.bLoadPartialPage;
                            _rec_Restor.iContentZoneID = _rec.iContentZoneID;
                            _rec_Restor.sContentZoneID = _rec.sContentZoneID;
                            _rec_Restor.iLanguageID = _rec.iLanguageID;
                            _rec_Restor.sLanguageID = _rec.sLanguageID;

                            _rec_Restor.dtLastUpdated = DateTime.Now;
                            _rec_Restor.iUpdatedByID = iUserID;
                            _rec_Restor.sUpdatedByID = sUserID;

                            dbInteraction.Update_SQL(_rec_Restor);

                            oSystem.CloseDataConnection();
                            #endregion
                            return RedirectToAction("WebSitePageZoneContent_Details", new { id = _rec_Restor.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }


        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageZoneContent_History_AddUpdate(DEF_WebSitePageZoneContent_History.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSitePageZoneContent_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZoneContent_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePageZoneContent_History dbInteraction = new DINT_WebSitePageZoneContent_History(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSitePageZoneContent_History_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePageZoneContent_History dbInteraction = new DINT_WebSitePageZoneContent_History(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSitePageZoneContent_History_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageZoneContent_History_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePageZoneContent_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePageZoneContent_History dbInteraction = new DINT_WebSitePageZoneContent_History(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePageZoneContent_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageZoneContent_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSitePageZoneContent_History_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSitePageZoneContent_History_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteProperties
        public ActionResult WebSiteProperties_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteProperties_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteProperties_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteProperties dbInteraction = new DINT_WebSiteProperties(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteProperties.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }

                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sFieldName", "'" + Search + "'", "string", 10, "sFieldName", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteProperties.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);


                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteProperties_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteProperties_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteProperties dbInteraction = new DINT_WebSiteProperties(oSystem.cnCon);
                        List<DEF_WebSiteProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;

                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 1, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteProperties dbInteraction = new DINT_WebSiteProperties(oSystem.cnCon);
                        List<DEF_WebSiteProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;

                                oSystem.CloseDataConnection();
                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteProperties_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteProperties_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteProperties.RecordObject recRecord = new DEF_WebSiteProperties.RecordObject();
                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteProperties_AddUpdate(DEF_WebSiteProperties.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteProperties_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteProperties_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;

                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteProperties dbInteraction = new DINT_WebSiteProperties(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);

                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSiteProperties_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteProperties dbInteraction = new DINT_WebSiteProperties(oSystem.cnCon);

                                    _rec.dtLastUpdated = DateTime.Now;
                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSiteProperties_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteProperties_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteProperties_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteProperties dbInteraction = new DINT_WebSiteProperties(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteProperties.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteProperties.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteProperties_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteProperties_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteScreenRoles
        public ActionResult WebSiteScreenRoles_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteScreenRoles_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteScreenRoles_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteScreenRoles dbInteraction = new DINT_WebSiteScreenRoles(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteScreenRoles.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sRoleID", "'%" + Search + "%'", "string", 11, "sRoleID", " LIKE ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteScreenRoles.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteScreenRoles_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteScreenRoles_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteScreenRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        ACMSDBView.WebSiteScreenRolesViewModel recRecord = new WebSiteScreenRolesViewModel();

                        if (recRecord.GetView(oSystem.cnCon, id))
                        {
                            ViewBag.iParentID = recRecord.WebSiteScreenRoles.iParentID;
                            ViewBag.sParentID = recRecord.WebSiteScreenRoles.sParentID;
                            oSystem.CloseDataConnection();

                            oPage.DataModelsPrimary = recRecord;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }

                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "int", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteScreenRoles dbInteraction = new DINT_WebSiteScreenRoles(oSystem.cnCon);
                        List<DEF_WebSiteScreenRoles.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.WebSiteScreenRolesViewModel recRecord = new WebSiteScreenRolesViewModel();
                                recRecord.WebSiteScreenRoles = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                recRecord.Get_RolesList(oSystem.cnCon);

                                ViewBag.iParentID = recRecord.WebSiteScreenRoles.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteScreenRoles.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteScreenRoles_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteScreenRoles_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteScreenRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";

                    ACMSDBView.WebSiteScreenRolesViewModel recRecord = new WebSiteScreenRolesViewModel();

                    recRecord.WebSiteScreenRoles.iParentID = _iParentID;
                    recRecord.WebSiteScreenRoles.sParentID = _sParentID;

                    recRecord.Get_RolesList(oSystem.cnCon);

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        public ActionResult WebSiteScreenRoles_AddUpdate(ACMSDBView.WebSiteScreenRolesViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteScreenRoles_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteScreenRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if (_rec.WebSiteScreenRoles != null)
                        {
                            if ((_rec.WebSiteScreenRoles.ID == null) || (_rec.WebSiteScreenRoles.ID == 0))
                            {
                                ViewBag.bAddNew = true;
                                _rec.WebSiteScreenRoles.ID = -1;
                                ModelState.Remove("ID");
                            }

                            if (ModelState.IsValid)
                            {
                                ViewBag.iParentID = _rec.WebSiteScreenRoles.iParentID;
                                ViewBag.sParentID = _rec.WebSiteScreenRoles.sParentID;
                                if (ViewBag.bAddNew == true)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();

                                    DINT_WebSiteScreenRoles dbInteraction = new DINT_WebSiteScreenRoles(oSystem.cnCon);

                                    _rec.WebSiteScreenRoles.sControl = Guid.NewGuid().ToString();
                                    _rec.WebSiteScreenRoles.dtDateCreated = DateTime.Now;
                                    _rec.WebSiteScreenRoles.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Insert_SQL(_rec.WebSiteScreenRoles);

                                    _rec.Get_RolesList(oSystem.cnCon);


                                    oSystem.CloseDataConnection();
                                    //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                    #endregion
                                    return RedirectToAction("WebSiteScreenRoles_Details", new { key = _rec.WebSiteScreenRoles.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_sViewToLoad, _rec);
                                    //return View(_rec);
                                }
                                else
                                {
                                    if (_rec.WebSiteScreenRoles.ID > 0)
                                    {
                                        #region
                                        ViewBag.bError = false;
                                        ViewBag.bAddNew = false;
                                        ViewBag.bSaved = true;
                                        ViewBag.sErrorMessage = "";
                                        oSystem.OpenDataConnection();


                                        DINT_WebSiteScreenRoles dbInteraction = new DINT_WebSiteScreenRoles(oSystem.cnCon);

                                        _rec.WebSiteScreenRoles.dtLastUpdated = DateTime.Now;
                                        dbInteraction.Update_SQL(_rec.WebSiteScreenRoles);

                                        oSystem.CloseDataConnection();
                                        #endregion
                                        //return View(_sViewToLoad, _rec);
                                        return RedirectToAction("WebSiteScreenRoles_Details", new { id = _rec.WebSiteScreenRoles.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                        //return View(_rec);
                                    }
                                    else
                                    {
                                        ViewBag.bError = true;
                                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";


                                        oPage.DataModelsPrimary = _rec;
                                        oPage.DataModelsSub.Add(oSystem);
                                        oPage.AuthenticatedUser = true;
                                        oPage.PartialViewToLoad = _sViewToLoad;
                                        return View(sModuleBase + sBasePage, oPage);
                                    }
                                }
                            }
                            else
                            {
                                ViewBag.bError = true;
                                ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                oPage.DataModelsPrimary = _rec;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteScreenRoles_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteScreenRoles_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteScreenRoles dbInteraction = new DINT_WebSiteScreenRoles(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteScreenRoles.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteScreenRoles.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteScreenRoles_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteScreenRoles_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteScreen
        public ActionResult WebSiteScreen_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteScreen_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteScreen_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteScreen dbInteraction = new DINT_WebSiteScreen(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteScreen.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sScreenName", "'%" + Search + "%'", "string", 10, "sScreenName", " LIKE ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteScreen.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteScreen_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteScreen_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteScreen_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        WebSiteScreenViewModel recRecord = new WebSiteScreenViewModel();
                        if (recRecord.GetView(oSystem.cnCon, id))
                        {
                            ViewBag.iParentID = recRecord.WebSiteScreen.iParentID;
                            ViewBag.sParentID = recRecord.WebSiteScreen.sParentID;
                            oSystem.CloseDataConnection();

                            oPage.DataModelsPrimary = recRecord;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteScreen dbInteraction = new DINT_WebSiteScreen(oSystem.cnCon);
                        List<DEF_WebSiteScreen.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                WebSiteScreenViewModel recRecord = new WebSiteScreenViewModel();
                                recRecord.WebSiteScreen = dbSearch[0];
                                if (recRecord.WebSiteScreen == null)
                                {
                                    return HttpNotFound();
                                }
                                recRecord.Get_WebSitePageTemplates(oSystem.cnCon);
                                if (recRecord.WebSiteScreen.iSiteTemplateID > 0)
                                {
                                    recRecord.Get_WebSitePageTemplateZones(oSystem.cnCon, recRecord.WebSiteScreen.iSiteTemplateID);
                                }
                                ViewBag.iParentID = recRecord.WebSiteScreen.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteScreen.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteScreen_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteScreen_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteScreen_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    WebSiteScreenViewModel recRecord = new WebSiteScreenViewModel();

                    recRecord.WebSiteScreen.iParentID = _iParentID;
                    recRecord.WebSiteScreen.sParentID = _sParentID;

                    recRecord.Get_WebSitePageTemplates(oSystem.cnCon);

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteScreen_AddUpdate(ACMSDBView.WebSiteScreenViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteScreen_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();


            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteScreen_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if (_rec.WebSiteScreen != null)
                        {
                            if ((_rec.WebSiteScreen.ID == null) || (_rec.WebSiteScreen.ID == 0))
                            {
                                ViewBag.bAddNew = true;
                                _rec.WebSiteScreen.ID = -1;
                                ModelState.Remove("ID");
                            }

                            if (ModelState.IsValid)
                            {
                                ViewBag.iParentID = _rec.WebSiteScreen.iParentID;
                                ViewBag.sParentID = _rec.WebSiteScreen.sParentID;
                                if (ViewBag.bAddNew == true)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();

                                    DINT_WebSiteScreen dbInteraction = new DINT_WebSiteScreen(oSystem.cnCon);

                                    _rec.WebSiteScreen.sControl = Guid.NewGuid().ToString();
                                    _rec.WebSiteScreen.dtDateCreated = DateTime.Now;
                                    _rec.WebSiteScreen.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Insert_SQL(_rec.WebSiteScreen);


                                    _rec.Get_WebSitePageTemplates(oSystem.cnCon);
                                    if (_rec.WebSiteScreen.iSiteTemplateID > 0)
                                    {
                                        _rec.Get_WebSitePageTemplateZones(oSystem.cnCon, _rec.WebSiteScreen.iSiteTemplateID);
                                    }

                                    oSystem.CloseDataConnection();
                                    //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                    #endregion
                                    return RedirectToAction("WebSiteScreen_Details", new { key = _rec.WebSiteScreen.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_sViewToLoad, _rec);
                                    //return View(_rec);
                                }
                                else
                                {
                                    if (_rec.WebSiteScreen.ID > 0)
                                    {
                                        #region
                                        ViewBag.bError = false;
                                        ViewBag.bAddNew = false;
                                        ViewBag.bSaved = true;
                                        ViewBag.sErrorMessage = "";
                                        oSystem.OpenDataConnection();


                                        DINT_WebSiteScreen dbInteraction = new DINT_WebSiteScreen(oSystem.cnCon);

                                        _rec.WebSiteScreen.dtLastUpdated = DateTime.Now;
                                        dbInteraction.Update_SQL(_rec.WebSiteScreen);


                                        _rec.Get_WebSitePageTemplates(oSystem.cnCon);
                                        if (_rec.WebSiteScreen.iSiteTemplateID > 0)
                                        {
                                            _rec.Get_WebSitePageTemplateZones(oSystem.cnCon, _rec.WebSiteScreen.iSiteTemplateID);
                                        }
                                        oSystem.CloseDataConnection();
                                        #endregion
                                        //return View(_sViewToLoad, _rec);
                                        return RedirectToAction("WebSiteScreen_Details", new { id = _rec.WebSiteScreen.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                        //return View(_rec);
                                    }
                                    else
                                    {
                                        ViewBag.bError = true;
                                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                        oPage.DataModelsPrimary = _rec;
                                        oPage.DataModelsSub.Add(oSystem);
                                        oPage.AuthenticatedUser = true;
                                        oPage.PartialViewToLoad = _sViewToLoad;
                                        return View(sModuleBase + sBasePage, oPage);
                                    }
                                }
                            }
                            else
                            {
                                ViewBag.bError = true;
                                ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                                oPage.DataModelsPrimary = _rec;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        //return RedirectToAction("StatesDetails", new { id = 0, _bOverrideScreenMessage = true });
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteScreen_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteScreen_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteScreen dbInteraction = new DINT_WebSiteScreen(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteScreen.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteScreen.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteScreen_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteScreen_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteRole
        public ActionResult WebSiteRole_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteRole_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteRole_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteRole dbInteraction = new DINT_WebSiteRole(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteRole.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sRoleID", "'%" + Search + "%'", "string", 11, "sRoleID", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);

                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteRole.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteRole_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteRole_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteRole_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        ACMSDBView.WebSiteRoleViewModel recRecord = new WebSiteRoleViewModel();
                        if (recRecord.GetView(oSystem.cnCon, id))
                        {
                            ViewBag.iParentID = recRecord.WebSiteRole.iParentID;
                            ViewBag.sParentID = recRecord.WebSiteRole.sParentID;
                            oSystem.CloseDataConnection();

                            oPage.DataModelsPrimary = recRecord;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteRole dbInteraction = new DINT_WebSiteRole(oSystem.cnCon);
                        List<DEF_WebSiteRole.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.WebSiteRoleViewModel recRecord = new WebSiteRoleViewModel();
                                recRecord.WebSiteRole = dbSearch[0];
                                if (recRecord.WebSiteRole == null)
                                {
                                    return HttpNotFound();
                                }

                                ViewBag.iParentID = recRecord.WebSiteRole.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteRole.sParentID;

                                recRecord.Get_RolesList(oSystem.cnCon);

                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteRole_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteRole_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteRole_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    ACMSDBView.WebSiteRoleViewModel recRecord = new WebSiteRoleViewModel();

                    recRecord.Get_RolesList(oSystem.cnCon);

                    recRecord.WebSiteRole.iParentID = _iParentID;
                    recRecord.WebSiteRole.sParentID = _sParentID;


                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        public ActionResult WebSiteRole_AddUpdate(ACMSDBView.WebSiteRoleViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteRole_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteRole_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if (_rec.WebSiteRole != null)
                        {
                            if ((_rec.WebSiteRole.ID == null) || (_rec.WebSiteRole.ID == 0))
                            {
                                ViewBag.bAddNew = true;
                                _rec.WebSiteRole.ID = -1;
                                ModelState.Remove("ID");
                            }

                            if (ModelState.IsValid)
                            {
                                ViewBag.iParentID = _rec.WebSiteRole.iParentID;
                                ViewBag.sParentID = _rec.WebSiteRole.sParentID;
                                if (ViewBag.bAddNew == true)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();

                                    DINT_WebSiteRole dbInteraction = new DINT_WebSiteRole(oSystem.cnCon);

                                    _rec.WebSiteRole.sControl = Guid.NewGuid().ToString();
                                    _rec.WebSiteRole.dtDateCreated = DateTime.Now;
                                    _rec.WebSiteRole.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Insert_SQL(_rec.WebSiteRole);

                                    _rec.Get_RolesList(oSystem.cnCon);

                                    oSystem.CloseDataConnection();
                                    //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                    #endregion
                                    return RedirectToAction("WebSiteRole_Details", new { key = _rec.WebSiteRole.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_sViewToLoad, _rec);
                                    //return View(_rec);
                                }
                                else
                                {
                                    if (_rec.WebSiteRole.ID > 0)
                                    {
                                        #region
                                        ViewBag.bError = false;
                                        ViewBag.bAddNew = false;
                                        ViewBag.bSaved = true;
                                        ViewBag.sErrorMessage = "";
                                        oSystem.OpenDataConnection();

                                        DINT_WebSiteRole dbInteraction = new DINT_WebSiteRole(oSystem.cnCon);

                                        _rec.WebSiteRole.dtLastUpdated = DateTime.Now;
                                        dbInteraction.Update_SQL(_rec.WebSiteRole);

                                        _rec.Get_RolesList(oSystem.cnCon);

                                        oSystem.CloseDataConnection();
                                        #endregion
                                        //return View(_sViewToLoad, _rec);
                                        return RedirectToAction("WebSiteRole_Details", new { id = _rec.WebSiteRole.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                        //return View(_rec);
                                    }
                                    else
                                    {
                                        ViewBag.bError = true;
                                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                        oPage.DataModelsPrimary = _rec;
                                        oPage.DataModelsSub.Add(oSystem);
                                        oPage.AuthenticatedUser = true;
                                        oPage.PartialViewToLoad = _sViewToLoad;
                                        return View(sModuleBase + sBasePage, oPage);

                                    }
                                }
                            }
                            else
                            {
                                ViewBag.bError = true;
                                ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                                oPage.DataModelsPrimary = _rec;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteRole_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteRole_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteRole dbInteraction = new DINT_WebSiteRole(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteRole.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteRole.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteRole_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteRole_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteEventCalendar
        string sWebSiteEventCalendar_Details = "/views/Forms/WebSiteEventCalendar_Details.cshtml";
        string sWebSiteEventCalendar_List = "/views/Forms/WebSiteEventCalendar_List.cshtml";


        public ActionResult WebSiteEventCalendar_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteEventCalendar");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEventCalendar_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteEventCalendar dbInteraction = new DINT_WebSiteEventCalendar(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteEventCalendar.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteEventCalendar.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEventCalendar_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteEventCalendar");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEventCalendar_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEventCalendar dbInteraction = new DINT_WebSiteEventCalendar(oSystem.cnCon);
                        List<DEF_WebSiteEventCalendar.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteEventCalendar.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteEventCalendarViewModel recRecord = new WebSiteEventCalendarViewModel();
                                recRecord.WebSiteEventCalendar = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteEventCalendar.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteEventCalendar.sParentID;

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEventCalendar dbInteraction = new DINT_WebSiteEventCalendar(oSystem.cnCon);
                        List<DEF_WebSiteEventCalendar.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteEventCalendar.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteEventCalendarViewModel recRecord = new WebSiteEventCalendarViewModel();
                                recRecord.WebSiteEventCalendar = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteEventCalendar.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteEventCalendar.sParentID;

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEventCalendar_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteEventCalendar");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEventCalendar_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";

                    ACMSDBView.WebSiteEventCalendarViewModel recRecord = new WebSiteEventCalendarViewModel();
                    //DEF_WebSiteEventCalendar.RecordObject recRecord = new DEF_WebSiteEventCalendar.RecordObject();


                    recRecord.WebSiteEventCalendar.iParentID = _iParentID;
                    recRecord.WebSiteEventCalendar.sParentID = _sParentID;


                    recRecord.WebSiteEventCalendar.dtDateOfEvent = DateTime.Parse("01/01/1901");
                    recRecord.WebSiteEventCalendar.dtFirstDateOfRegistrations = DateTime.Parse("01/01/1901");
                    recRecord.WebSiteEventCalendar.dtLastDateOfRegistrations = DateTime.Parse("01/01/1901");
                    recRecord.WebSiteEventCalendar.dtEarlyBirdRegistrations = DateTime.Parse("01/01/1901");


                    recRecord.Get_WebSiteQuestionair(oSystem.cnCon);

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteEventCalendar_AddUpdate(ACMSDBView.WebSiteEventCalendarViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteEventCalendar");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEventCalendar_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteEventCalendar.ID == null) || (_rec.WebSiteEventCalendar.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteEventCalendar.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSiteEventCalendar.iParentID;
                            ViewBag.sParentID = _rec.WebSiteEventCalendar.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteEventCalendar dbInteraction = new DINT_WebSiteEventCalendar(oSystem.cnCon);

                                _rec.WebSiteEventCalendar.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteEventCalendar.dtDateCreated = DateTime.Now;
                                _rec.WebSiteEventCalendar.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteEventCalendar);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteEventCalendar_Details", new { key = _rec.WebSiteEventCalendar.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteEventCalendar.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteEventCalendar dbInteraction = new DINT_WebSiteEventCalendar(oSystem.cnCon);
                                    _rec.WebSiteEventCalendar.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteEventCalendar);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteEventCalendar_Details", new { id = _rec.WebSiteEventCalendar.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEventCalendar_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteEventCalendar");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteEventCalendar dbInteraction = new DINT_WebSiteEventCalendar(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteEventCalendar.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEventCalendar.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteEventCalendar_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteEventCalendar_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }


        [HttpPost]
        public JsonResult WebSiteEventCalendar_DownLoadAttendeeList(int Id)
        {
            Set_ViewBag_UserInfo_Defaults();
            string sRESPONSE = "false";
            string sRESPONSEMESSAGE = "Error";
            string sDownLoadURL = "";

            if (oSystem.OpenDataConnection())
            {
                #region
                if (oSystem.GetCurrentUser())
                {
                    if (Id > 0)
                    {
                        try
                        {
                            DINT_WebSiteEventCalendarUsers odbWebSiteEventCalendarUsers = new DINT_WebSiteEventCalendarUsers(oSystem.cnCon);



                            List<DataParameter> lstParameters = new List<DataParameter>();
                            DataParameter pParameter = null;

                            pParameter = new DataParameter("iParentID", "'" + Id + "'", "int", 1, "iParentID", " = ", "");
                            lstParameters.Add(pParameter);



                            List<DEF_WebSiteEventCalendarUsers.RecordObject> lstWebSiteEventCalendarUsers = odbWebSiteEventCalendarUsers.Get(lstParameters);

                            if (lstWebSiteEventCalendarUsers != null)
                            {
                                if (lstWebSiteEventCalendarUsers.Count > 0)
                                {
                                    string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
                                    string sRootPath = Request.PhysicalApplicationPath.ToString();
                                    string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();

                                    string sDownLoadFileName = Id + DateTime.Now.ToShortDateString() + DateTime.Now.ToShortTimeString();
                                    sDownLoadFileName = sDownLoadFileName.Replace("/", "");
                                    sDownLoadFileName = sDownLoadFileName.Replace(":", "");
                                    sDownLoadFileName = sDownLoadFileName.Replace(" ", "");
                                    sDownLoadFileName = sDownLoadFileName.Replace("-", "");
                                    sDownLoadFileName = sDownLoadFileName.Replace("\\", "");




                                    System.IO.TextWriter swWriter = new StreamWriter(sRootPath + "Uploads\\" + sDownLoadFileName + ".csv");

                                    swWriter.WriteLine("First Name, Last Name, Email, Phone, Status, RefCode");
                                    try
                                    {
                                        foreach (DEF_WebSiteEventCalendarUsers.RecordObject oU in lstWebSiteEventCalendarUsers)
                                        {
                                            //swWriter.WriteLine("First Name, Last Name, Email, Phone, Status, RefCode");
                                            swWriter.WriteLine(oU.sFName + "," + oU.sLName + "," + oU.sPrimaryEMail + "," + oU.sPrimaryPhone + "," + oU.sStatusID + "," + oU.sPaymentRef);
                                        }
                                    }
                                    catch (Exception ss1)
                                    {

                                    }
                                    swWriter.Flush();
                                    swWriter.Close();
                                    swWriter.Dispose();
                                    swWriter = null;


                                    sRESPONSE = "true";
                                    sRESPONSEMESSAGE = "";
                                    //sDownLoadURL = sBaseULR + "Uploads/" + sDownLoadFileName;
                                    sDownLoadURL = "Uploads/" + sDownLoadFileName;
                                }
                                else
                                {
                                    sRESPONSE = "false";
                                    sRESPONSEMESSAGE = "No attendees to print out!";
                                }
                            }
                            else
                            {
                                sRESPONSE = "false";
                                sRESPONSEMESSAGE = "No attendees to print out!";
                            }
                        }
                        catch
                        {
                            sRESPONSE = "false";
                            sRESPONSEMESSAGE = "Sorry could not find any records!";
                        }
                    }
                    else
                    {
                        sRESPONSE = "false";
                        sRESPONSEMESSAGE = "Invalid Event ID!";
                    }
                }
                else
                {
                    sRESPONSE = "false";
                    sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                }
                #endregion

            }
            oSystem.CloseDataConnection();
            var oResponse = Json(new { RESPONSE = sRESPONSE, MESSAGE = sRESPONSEMESSAGE, DOWNLOADURL = sDownLoadURL });
            return oResponse;
        }

        #endregion

        #region Form WebSiteEventCalendarPictures

        string sWebSiteEventCalendarPictures_Details = "/views/Forms/WebSiteEventCalendarPictures_Details.cshtml";
        string sWebSiteEventCalendarPictures_List = "/views/Forms/WebSiteEventCalendarPictures_List.cshtml";


        public ActionResult WebSiteEventCalendarPictures_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteEventCalendarPictures");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEventCalendarPictures_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteEventCalendarPictures dbInteraction = new DINT_WebSiteEventCalendarPictures(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteEventCalendarPictures.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteEventCalendarPictures.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEventCalendarPictures_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteEventCalendarPictures");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEventCalendarPictures_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEventCalendarPictures dbInteraction = new DINT_WebSiteEventCalendarPictures(oSystem.cnCon);
                        List<DEF_WebSiteEventCalendarPictures.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEventCalendarPictures.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEventCalendarPictures dbInteraction = new DINT_WebSiteEventCalendarPictures(oSystem.cnCon);
                        List<DEF_WebSiteEventCalendarPictures.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEventCalendarPictures.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEventCalendarPictures_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteEventCalendarPictures");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEventCalendarPictures_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteEventCalendarPictures.RecordObject recRecord = new DEF_WebSiteEventCalendarPictures.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteEventCalendarPictures_AddUpdate(FormCollection fc, HttpPostedFileBase UploadFiles, DEF_WebSiteEventCalendarPictures.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteEventCalendarPictures");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            string sFileUploadResults = "";
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEventCalendarPictures_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;

                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteEventCalendarPictures dbInteraction = new DINT_WebSiteEventCalendarPictures(oSystem.cnCon);

                                #region Upload file
                                bool bFileUploadError = false;
                                string sImageURL = "";
                                try
                                {
                                    if (UploadFiles != null)
                                    {
                                        if (UploadFiles.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles.FileName))
                                            {
                                                string sOriginalfileName = Path.GetFileName(UploadFiles.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName);
                                                    sImageURL = "Uploads/" + sOriginalfileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName;
                                                    _rec.sImageURL = sImageURL;
                                                    bFileUploadError = false;
                                                }
                                                else
                                                {
                                                    string sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL = "Uploads/" + sPrefix + sOriginalfileName;
                                                    UploadFiles.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName;
                                                    _rec.sImageURL = sImageURL;
                                                    bFileUploadError = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage = "Sorry something went wrong in attempting to upload your file";
                                    bFileUploadError = false;
                                }
                                #endregion

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);

                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteEventCalendarPictures_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteEventCalendarPictures dbInteraction = new DINT_WebSiteEventCalendarPictures(oSystem.cnCon);

                                    #region Upload file
                                    bool bFileUploadError = false;
                                    string sImageURL = "";
                                    try
                                    {
                                        if (UploadFiles != null)
                                        {
                                            if (UploadFiles.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles.FileName))
                                                {
                                                    string sOriginalfileName = Path.GetFileName(UploadFiles.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName);
                                                        sImageURL = "Uploads/" + UploadFiles.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName;
                                                        _rec.sImageURL = sImageURL;
                                                        bFileUploadError = false;
                                                    }
                                                    else
                                                    {
                                                        string sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL = "Uploads/" + sPrefix + sOriginalfileName;
                                                        UploadFiles.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName;
                                                        _rec.sImageURL = sImageURL;
                                                        bFileUploadError = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage = "Sorry something went wrong in attempting to upload your file";
                                        bFileUploadError = false;
                                    }
                                    #endregion

                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteEventCalendarPictures_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEventCalendarPictures_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteEventCalendarPictures");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteEventCalendarPictures dbInteraction = new DINT_WebSiteEventCalendarPictures(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteEventCalendarPictures.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEventCalendarPictures.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteEventCalendarPictures_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteEventCalendarPictures_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteEventCalendarSponsors

        string sWebSiteEventCalendarSponsors_Details = "/views/Forms/WebSiteEventCalendarSponsors_Details.cshtml";
        string sWebSiteEventCalendarSponsors_List = "/views/Forms/WebSiteEventCalendarSponsors_List.cshtml";


        public ActionResult WebSiteEventCalendarSponsors_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteEventCalendarSponsors");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEventCalendarSponsors_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteEventCalendarSponsors dbInteraction = new DINT_WebSiteEventCalendarSponsors(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteEventCalendarSponsors.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteEventCalendarSponsors.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEventCalendarSponsors_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteEventCalendarSponsors");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEventCalendarSponsors_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEventCalendarSponsors dbInteraction = new DINT_WebSiteEventCalendarSponsors(oSystem.cnCon);
                        List<DEF_WebSiteEventCalendarSponsors.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteEventCalendarSponsors.RecordObject recRecord = dbSearch[0];
                                AriesCMS.Models.WebSiteEventCalendarSponsorsDBView recRecord = new Models.WebSiteEventCalendarSponsorsDBView();
                                recRecord.WebSiteEventCalendarSponsors = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                recRecord.Get_WebSiteSponsors(oSystem.cnCon);
                                ViewBag.iParentID = recRecord.WebSiteEventCalendarSponsors.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteEventCalendarSponsors.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEventCalendarSponsors dbInteraction = new DINT_WebSiteEventCalendarSponsors(oSystem.cnCon);
                        List<DEF_WebSiteEventCalendarSponsors.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteEventCalendarSponsors.RecordObject recRecord = dbSearch[0];
                                AriesCMS.Models.WebSiteEventCalendarSponsorsDBView recRecord = new Models.WebSiteEventCalendarSponsorsDBView();
                                recRecord.WebSiteEventCalendarSponsors = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                recRecord.Get_WebSiteSponsors(oSystem.cnCon);
                                ViewBag.iParentID = recRecord.WebSiteEventCalendarSponsors.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteEventCalendarSponsors.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteEventCalendarSponsors_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteEventCalendarSponsors");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEventCalendarSponsors_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    //DEF_WebSiteEventCalendarSponsors.RecordObject recRecord = new DEF_WebSiteEventCalendarSponsors.RecordObject();

                    AriesCMS.Models.WebSiteEventCalendarSponsorsDBView recRecord = new Models.WebSiteEventCalendarSponsorsDBView();

                    recRecord.Get_WebSiteSponsors(oSystem.cnCon);

                    recRecord.WebSiteEventCalendarSponsors.iParentID = _iParentID;
                    recRecord.WebSiteEventCalendarSponsors.sParentID = _sParentID;
                    recRecord.WebSiteEventCalendarSponsors.dtLastUpdated = DateTime.Parse("01/01/1901");





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteEventCalendarSponsors_AddUpdate(AriesCMS.Models.WebSiteEventCalendarSponsorsDBView _rec)
        {
            Set_Client_NavSettings("WebSiteEventCalendarSponsors");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEventCalendarSponsors_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteEventCalendarSponsors.ID == null) || (_rec.WebSiteEventCalendarSponsors.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteEventCalendarSponsors.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSiteEventCalendarSponsors.iParentID;
                            ViewBag.sParentID = _rec.WebSiteEventCalendarSponsors.sParentID;


                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteEventCalendarSponsors dbInteraction = new DINT_WebSiteEventCalendarSponsors(oSystem.cnCon);

                                _rec.WebSiteEventCalendarSponsors.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteEventCalendarSponsors.dtDateCreated = DateTime.Now;
                                _rec.WebSiteEventCalendarSponsors.dtLastUpdated = DateTime.Now;

                                _rec.Get_WebSiteSponsors(oSystem.cnCon);

                                foreach (DEF_WebSiteSponsors.RecordObject oR in _rec.lstWebSiteSponsors)
                                {
                                    if (oR.ID == _rec.WebSiteEventCalendarSponsors.iSponsorID)
                                    {
                                        _rec.WebSiteEventCalendarSponsors.sName = oR.sName;
                                        _rec.WebSiteEventCalendarSponsors.iSponsorShipTypeID = oR.iSponsorShipTypeID;
                                        _rec.WebSiteEventCalendarSponsors.sSponsorShipTypeID = oR.sSponsorShipTypeID;
                                        _rec.WebSiteEventCalendarSponsors.sImageURL = oR.sImageURL;
                                        _rec.WebSiteEventCalendarSponsors.sImageURL2 = oR.sImageURL2;
                                        _rec.WebSiteEventCalendarSponsors.sImageURL3 = oR.sImageURL3;
                                        _rec.WebSiteEventCalendarSponsors.sListingDescription = oR.sListingDescription;
                                        _rec.WebSiteEventCalendarSponsors.sLargerListingDescription = oR.sLargerListingDescription;
                                        _rec.WebSiteEventCalendarSponsors.sDetailsDescription = oR.sDetailsDescription;
                                        _rec.WebSiteEventCalendarSponsors.iAssociatedUserID = oR.iAssociatedUserID;
                                        _rec.WebSiteEventCalendarSponsors.sAssociatedUserID = oR.sAssociatedUserID;
                                    }
                                }
                                dbInteraction.Insert_SQL(_rec.WebSiteEventCalendarSponsors);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteEventCalendarSponsors_Details", new { key = _rec.WebSiteEventCalendarSponsors.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteEventCalendarSponsors.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteEventCalendarSponsors dbInteraction = new DINT_WebSiteEventCalendarSponsors(oSystem.cnCon);
                                    _rec.WebSiteEventCalendarSponsors.dtLastUpdated = DateTime.Now;

                                    _rec.Get_WebSiteSponsors(oSystem.cnCon);

                                    foreach (DEF_WebSiteSponsors.RecordObject oR in _rec.lstWebSiteSponsors)
                                    {
                                        if (oR.ID == _rec.WebSiteEventCalendarSponsors.iSponsorID)
                                        {
                                            _rec.WebSiteEventCalendarSponsors.sName = oR.sName;
                                            _rec.WebSiteEventCalendarSponsors.iSponsorShipTypeID = oR.iSponsorShipTypeID;
                                            _rec.WebSiteEventCalendarSponsors.sSponsorShipTypeID = oR.sSponsorShipTypeID;
                                            _rec.WebSiteEventCalendarSponsors.sImageURL = oR.sImageURL;
                                            _rec.WebSiteEventCalendarSponsors.sImageURL2 = oR.sImageURL2;
                                            _rec.WebSiteEventCalendarSponsors.sImageURL3 = oR.sImageURL3;
                                            _rec.WebSiteEventCalendarSponsors.sListingDescription = oR.sListingDescription;
                                            _rec.WebSiteEventCalendarSponsors.sLargerListingDescription = oR.sLargerListingDescription;
                                            _rec.WebSiteEventCalendarSponsors.sDetailsDescription = oR.sDetailsDescription;
                                            _rec.WebSiteEventCalendarSponsors.iAssociatedUserID = oR.iAssociatedUserID;
                                            _rec.WebSiteEventCalendarSponsors.sAssociatedUserID = oR.sAssociatedUserID;
                                        }
                                    }

                                    dbInteraction.Update_SQL(_rec.WebSiteEventCalendarSponsors);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteEventCalendarSponsors_Details", new { id = _rec.WebSiteEventCalendarSponsors.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEventCalendarSponsors_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteEventCalendarSponsors");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteEventCalendarSponsors dbInteraction = new DINT_WebSiteEventCalendarSponsors(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteEventCalendarSponsors.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEventCalendarSponsors.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteEventCalendarSponsors_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteEventCalendarSponsors_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteEventCalendarUsers

        string sWebSiteEventCalendarUsers_Details = "/views/Forms/WebSiteEventCalendarUsers_Details.cshtml";
        string sWebSiteEventCalendarUsers_List = "/views/Forms/WebSiteEventCalendarUsers_List.cshtml";


        public ActionResult WebSiteEventCalendarUsers_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteEventCalendarUsers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEventCalendarUsers_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteEventCalendarUsers dbInteraction = new DINT_WebSiteEventCalendarUsers(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteEventCalendarUsers.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteEventCalendarUsers.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEventCalendarUsers_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteEventCalendarUsers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEventCalendarUsers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEventCalendarUsers dbInteraction = new DINT_WebSiteEventCalendarUsers(oSystem.cnCon);
                        List<DEF_WebSiteEventCalendarUsers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEventCalendarUsers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEventCalendarUsers dbInteraction = new DINT_WebSiteEventCalendarUsers(oSystem.cnCon);
                        List<DEF_WebSiteEventCalendarUsers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEventCalendarUsers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEventCalendarUsers_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteEventCalendarUsers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEventCalendarUsers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteEventCalendarUsers.RecordObject recRecord = new DEF_WebSiteEventCalendarUsers.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;
                    recRecord.dtLastUpdated = DateTime.Parse("01/01/1901");




                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteEventCalendarUsers_AddUpdate(DEF_WebSiteEventCalendarUsers.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteEventCalendarUsers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEventCalendarUsers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteEventCalendarUsers dbInteraction = new DINT_WebSiteEventCalendarUsers(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteEventCalendarUsers_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteEventCalendarUsers dbInteraction = new DINT_WebSiteEventCalendarUsers(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteEventCalendarUsers_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEventCalendarUsers_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteEventCalendarUsers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteEventCalendarUsers dbInteraction = new DINT_WebSiteEventCalendarUsers(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteEventCalendarUsers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEventCalendarUsers.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteEventCalendarUsers_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteEventCalendarUsers_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteNavigationRoles
        public ActionResult WebSiteNavigationRoles_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteNavigationRoles_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteNavigationRoles_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteNavigationRoles dbInteraction = new DINT_WebSiteNavigationRoles(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteNavigationRoles.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sRoleID", "'%" + Search + "%'", "string", 11, "sRoleID", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteNavigationRoles.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteNavigationRoles_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteNavigationRoles_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteNavigationRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        ACMSDBView.WebSiteNavigationRolesViewModel recRecord = new WebSiteNavigationRolesViewModel();

                        if (recRecord.GetView(oSystem.cnCon, id))
                        {
                            ViewBag.iParentID = recRecord.WebSiteNavigationRoles.iParentID;
                            ViewBag.sParentID = recRecord.WebSiteNavigationRoles.sParentID;
                            oSystem.CloseDataConnection();

                            oPage.DataModelsPrimary = recRecord;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteNavigationRoles dbInteraction = new DINT_WebSiteNavigationRoles(oSystem.cnCon);
                        List<DEF_WebSiteNavigationRoles.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.WebSiteNavigationRolesViewModel recRecord = new WebSiteNavigationRolesViewModel();
                                recRecord.WebSiteNavigationRoles = dbSearch[0];
                                if (recRecord.WebSiteNavigationRoles == null)
                                {
                                    return HttpNotFound();
                                }

                                ViewBag.iParentID = recRecord.WebSiteNavigationRoles.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteNavigationRoles.sParentID;

                                recRecord.Get_RolesList(oSystem.cnCon);

                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteNavigationRoles_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteNavigationRoles_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteNavigationRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";

                    ACMSDBView.WebSiteNavigationRolesViewModel recRecord = new WebSiteNavigationRolesViewModel();

                    recRecord.WebSiteNavigationRoles.iParentID = _iParentID;
                    recRecord.WebSiteNavigationRoles.sParentID = _sParentID;

                    recRecord.Get_RolesList(oSystem.cnCon);

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteNavigationRoles_AddUpdate(ACMSDBView.WebSiteNavigationRolesViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteNavigationRoles_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteNavigationRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if (_rec.WebSiteNavigationRoles != null)
                        {
                            if ((_rec.WebSiteNavigationRoles.ID == null) || (_rec.WebSiteNavigationRoles.ID == 0))
                            {
                                ViewBag.bAddNew = true;
                                _rec.WebSiteNavigationRoles.ID = -1;
                                ModelState.Remove("ID");
                            }

                            if (ModelState.IsValid)
                            {
                                ViewBag.iParentID = _rec.WebSiteNavigationRoles.iParentID;
                                ViewBag.sParentID = _rec.WebSiteNavigationRoles.sParentID;
                                if (ViewBag.bAddNew == true)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();

                                    DINT_WebSiteNavigationRoles dbInteraction = new DINT_WebSiteNavigationRoles(oSystem.cnCon);

                                    _rec.WebSiteNavigationRoles.sControl = Guid.NewGuid().ToString();
                                    _rec.WebSiteNavigationRoles.dtDateCreated = DateTime.Now;
                                    _rec.WebSiteNavigationRoles.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Insert_SQL(_rec.WebSiteNavigationRoles);

                                    _rec.Get_RolesList(oSystem.cnCon);

                                    oSystem.CloseDataConnection();
                                    //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                    #endregion
                                    return RedirectToAction("WebSiteNavigationRoles_Details", new { key = _rec.WebSiteNavigationRoles.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_sViewToLoad, _rec);
                                    //return View(_rec);
                                }
                                else
                                {
                                    if (_rec.WebSiteNavigationRoles.ID > 0)
                                    {
                                        #region
                                        ViewBag.bError = false;
                                        ViewBag.bAddNew = false;
                                        ViewBag.bSaved = true;
                                        ViewBag.sErrorMessage = "";
                                        oSystem.OpenDataConnection();


                                        DINT_WebSiteNavigationRoles dbInteraction = new DINT_WebSiteNavigationRoles(oSystem.cnCon);

                                        _rec.WebSiteNavigationRoles.dtLastUpdated = DateTime.Now;
                                        dbInteraction.Update_SQL(_rec.WebSiteNavigationRoles);

                                        _rec.Get_RolesList(oSystem.cnCon);

                                        oSystem.CloseDataConnection();
                                        #endregion
                                        //return View(_sViewToLoad, _rec.WebSiteNavigationRoles);
                                        return RedirectToAction("WebSiteNavigationRoles_Details", new { id = _rec.WebSiteNavigationRoles.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                        //return View(_rec);
                                    }
                                    else
                                    {
                                        ViewBag.bError = true;
                                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                        oPage.DataModelsPrimary = _rec;
                                        oPage.DataModelsSub.Add(oSystem);
                                        oPage.AuthenticatedUser = true;
                                        oPage.PartialViewToLoad = _sViewToLoad;
                                        return View(sModuleBase + sBasePage, oPage);

                                    }
                                }
                            }
                            else
                            {
                                ViewBag.bError = true;
                                ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                                oPage.DataModelsPrimary = _rec;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteNavigationRoles_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteNavigationRoles_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteNavigationRoles dbInteraction = new DINT_WebSiteNavigationRoles(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteNavigationRoles.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteNavigationRoles.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteNavigationRoles_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteNavigationRoles_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteBlogRoles
        public ActionResult WebSiteBlogRoles_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteBlogRoles_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogRoles_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteBlogRoles dbInteraction = new DINT_WebSiteBlogRoles(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteBlogRoles.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sRoleID", "'%" + Search + "%'", "string", 11, "sRoleID", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);

                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        dbSearch = new List<DEF_WebSiteBlogRoles.RecordObject>();
                        ViewBag.iNumberOfPages = 0;
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogRoles_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteBlogRoles_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        ACMSDBView.WebSiteBlogRolesViewModel recRecord = new WebSiteBlogRolesViewModel();
                        if (recRecord.GetView(oSystem.cnCon, id))
                        {
                            ViewBag.iParentID = recRecord.WebSiteBlogRoles.iParentID;
                            ViewBag.sParentID = recRecord.WebSiteBlogRoles.sParentID;

                            recRecord.Get_RolesList(oSystem.cnCon);

                            oSystem.CloseDataConnection();

                            oPage.DataModelsPrimary = recRecord;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteBlogRoles dbInteraction = new DINT_WebSiteBlogRoles(oSystem.cnCon);
                        List<DEF_WebSiteBlogRoles.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.WebSiteBlogRolesViewModel recRecord = new WebSiteBlogRolesViewModel();
                                recRecord.WebSiteBlogRoles = dbSearch[0];
                                if (recRecord.WebSiteBlogRoles == null)
                                {
                                    return HttpNotFound();
                                }
                                recRecord.Get_RolesList(oSystem.cnCon);

                                ViewBag.iParentID = recRecord.WebSiteBlogRoles.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteBlogRoles.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogRoles_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteBlogRoles_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    ACMSDBView.WebSiteBlogRolesViewModel recRecord = new WebSiteBlogRolesViewModel();

                    recRecord.Get_RolesList(oSystem.cnCon);

                    recRecord.WebSiteBlogRoles.iParentID = _iParentID;
                    recRecord.WebSiteBlogRoles.sParentID = _sParentID;

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteBlogRoles_AddUpdate(ACMSDBView.WebSiteBlogRolesViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteBlogRoles_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogRoles_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if (_rec.WebSiteBlogRoles != null)
                        {
                            if ((_rec.WebSiteBlogRoles.ID == null) || (_rec.WebSiteBlogRoles.ID == 0))
                            {
                                ViewBag.bAddNew = true;
                                _rec.WebSiteBlogRoles.ID = -1;
                                ModelState.Remove("ID");
                            }

                            if (ModelState.IsValid)
                            {
                                ViewBag.iParentID = _rec.WebSiteBlogRoles.iParentID;
                                ViewBag.sParentID = _rec.WebSiteBlogRoles.sParentID;
                                if (ViewBag.bAddNew == true)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();

                                    DINT_WebSiteBlogRoles dbInteraction = new DINT_WebSiteBlogRoles(oSystem.cnCon);

                                    _rec.WebSiteBlogRoles.sControl = Guid.NewGuid().ToString();
                                    _rec.WebSiteBlogRoles.dtDateCreated = DateTime.Now;
                                    _rec.WebSiteBlogRoles.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Insert_SQL(_rec.WebSiteBlogRoles);

                                    _rec.Get_RolesList(oSystem.cnCon);

                                    oSystem.CloseDataConnection();
                                    //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                    #endregion
                                    return RedirectToAction("WebSiteBlogRoles_Details", new { key = _rec.WebSiteBlogRoles.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_sViewToLoad, _rec);
                                    //return View(_rec);
                                }
                                else
                                {
                                    if (_rec.WebSiteBlogRoles.ID > 0)
                                    {
                                        #region
                                        ViewBag.bError = false;
                                        ViewBag.bAddNew = false;
                                        ViewBag.bSaved = true;
                                        ViewBag.sErrorMessage = "";
                                        oSystem.OpenDataConnection();


                                        DINT_WebSiteBlogRoles dbInteraction = new DINT_WebSiteBlogRoles(oSystem.cnCon);

                                        _rec.WebSiteBlogRoles.dtLastUpdated = DateTime.Now;
                                        dbInteraction.Update_SQL(_rec.WebSiteBlogRoles);

                                        _rec.Get_RolesList(oSystem.cnCon);

                                        oSystem.CloseDataConnection();
                                        #endregion
                                        //return View(_sViewToLoad, _rec);
                                        return RedirectToAction("WebSiteBlogRoles_Details", new { id = _rec.WebSiteBlogRoles.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                        //return View(_rec);
                                    }
                                    else
                                    {
                                        ViewBag.bError = true;
                                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                        oPage.DataModelsPrimary = _rec;
                                        oPage.DataModelsSub.Add(oSystem);
                                        oPage.AuthenticatedUser = true;
                                        oPage.PartialViewToLoad = _sViewToLoad;
                                        return View(sModuleBase + sBasePage, oPage);

                                    }
                                }
                            }
                            else
                            {
                                ViewBag.bError = true;
                                ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                                oPage.DataModelsPrimary = _rec;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);

                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);

                        }

                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogRoles_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteBlogRoles_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteBlogRoles dbInteraction = new DINT_WebSiteBlogRoles(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteBlogRoles.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlogRoles.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteBlogRoles_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteBlogRoles_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteBlogEntryRole
        public ActionResult WebSiteBlogEntryRole_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteBlogEntryRole_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogEntryRole_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteBlogEntryRole dbInteraction = new DINT_WebSiteBlogEntryRole(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteBlogEntryRole.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sRoleID", "'%" + Search + "%'", "string", 11, "sRoleID", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);

                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteBlogEntryRole.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogEntryRole_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteBlogEntryRole_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogEntryRole_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        ACMSDBView.WebSiteBlogEntryRoleViewModel recRecord = new WebSiteBlogEntryRoleViewModel();
                        if (recRecord.GetView(oSystem.cnCon, id))
                        {
                            ViewBag.iParentID = recRecord.WebSiteBlogEntryRole.iParentID;
                            ViewBag.sParentID = recRecord.WebSiteBlogEntryRole.sParentID;
                            recRecord.Get_RolesList(oSystem.cnCon);
                            oSystem.CloseDataConnection();

                            oPage.DataModelsPrimary = recRecord;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }

                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteBlogEntryRole dbInteraction = new DINT_WebSiteBlogEntryRole(oSystem.cnCon);
                        List<DEF_WebSiteBlogEntryRole.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.WebSiteBlogEntryRoleViewModel recRecord = new WebSiteBlogEntryRoleViewModel();
                                recRecord.WebSiteBlogEntryRole = dbSearch[0];
                                if (recRecord.WebSiteBlogEntryRole == null)
                                {
                                    return HttpNotFound();
                                }

                                ViewBag.iParentID = recRecord.WebSiteBlogEntryRole.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteBlogEntryRole.sParentID;

                                recRecord.Get_RolesList(oSystem.cnCon);

                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogEntryRole_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteBlogEntryRole_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogEntryRole_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    ACMSDBView.WebSiteBlogEntryRoleViewModel recRecord = new WebSiteBlogEntryRoleViewModel();

                    recRecord.WebSiteBlogEntryRole.iParentID = _iParentID;
                    recRecord.WebSiteBlogEntryRole.sParentID = _sParentID;

                    recRecord.Get_RolesList(oSystem.cnCon);

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteBlogEntryRole_AddUpdate(ACMSDBView.WebSiteBlogEntryRoleViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteBlogEntryRole_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteBlogEntryRole_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if (_rec.WebSiteBlogEntryRole != null)
                        {
                            if ((_rec.WebSiteBlogEntryRole.ID == null) || (_rec.WebSiteBlogEntryRole.ID == 0))
                            {
                                ViewBag.bAddNew = true;
                                _rec.WebSiteBlogEntryRole.ID = -1;
                                ModelState.Remove("ID");
                            }

                            if (ModelState.IsValid)
                            {
                                ViewBag.iParentID = _rec.WebSiteBlogEntryRole.iParentID;
                                ViewBag.sParentID = _rec.WebSiteBlogEntryRole.sParentID;
                                if (ViewBag.bAddNew == true)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();

                                    DINT_WebSiteBlogEntryRole dbInteraction = new DINT_WebSiteBlogEntryRole(oSystem.cnCon);

                                    _rec.WebSiteBlogEntryRole.sControl = Guid.NewGuid().ToString();
                                    _rec.WebSiteBlogEntryRole.dtDateCreated = DateTime.Now;
                                    _rec.WebSiteBlogEntryRole.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Insert_SQL(_rec.WebSiteBlogEntryRole);

                                    _rec.Get_RolesList(oSystem.cnCon);

                                    oSystem.CloseDataConnection();
                                    //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                    #endregion
                                    return RedirectToAction("WebSiteBlogEntryRole_Details", new { key = _rec.WebSiteBlogEntryRole.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_sViewToLoad, _rec);
                                    //return View(_rec);
                                }
                                else
                                {
                                    if (_rec.WebSiteBlogEntryRole.ID > 0)
                                    {
                                        #region
                                        ViewBag.bError = false;
                                        ViewBag.bAddNew = false;
                                        ViewBag.bSaved = true;
                                        ViewBag.sErrorMessage = "";
                                        oSystem.OpenDataConnection();


                                        DINT_WebSiteBlogEntryRole dbInteraction = new DINT_WebSiteBlogEntryRole(oSystem.cnCon);

                                        _rec.WebSiteBlogEntryRole.dtLastUpdated = DateTime.Now;
                                        dbInteraction.Update_SQL(_rec.WebSiteBlogEntryRole);

                                        _rec.Get_RolesList(oSystem.cnCon);

                                        oSystem.CloseDataConnection();
                                        #endregion
                                        //return View(_sViewToLoad, _rec);
                                        return RedirectToAction("WebSiteBlogEntryRole_Details", new { id = _rec.WebSiteBlogEntryRole.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                        //return View(_rec);
                                    }
                                    else
                                    {
                                        ViewBag.bError = true;
                                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                        oPage.DataModelsPrimary = _rec;
                                        oPage.DataModelsSub.Add(oSystem);
                                        oPage.AuthenticatedUser = true;
                                        oPage.PartialViewToLoad = _sViewToLoad;
                                        return View(sModuleBase + sBasePage, oPage);
                                    }
                                }
                            }
                            else
                            {
                                ViewBag.bError = true;
                                ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                oPage.DataModelsPrimary = _rec;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);

                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSiteBlogEntryRole_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteBlogEntryRole_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                int iParentID = 0;
                string sParentID = "";

                #region if ParentID is less than or equal to zero see if it was included in the form
                try
                {
                    if (Request.Form["_iParentID"] != null)
                    {
                        try
                        {
                            iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                            sParentID = Request.Form["_sParentID"].ToString();
                        }
                        catch
                        {
                        }
                    }
                }
                catch
                {
                }
                #endregion


                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteBlogEntryRole dbInteraction = new DINT_WebSiteBlogEntryRole(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteBlogEntryRole.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);

                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteBlogEntryRole.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSiteBlogEntryRole_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSiteBlogEntryRole_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteEMailCampaign

        string sWebSiteEMailCampaign_Details = "/views/Forms/WebSiteEMailCampaign_Details.cshtml";
        string sWebSiteEMailCampaign_List = "/views/Forms/WebSiteEMailCampaign_List.cshtml";


        public ActionResult WebSiteEMailCampaign_List(FormCollection fc, string Search, int page = 1)
        {
            Set_Client_NavSettings("WebSiteEMailCampaign");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEMailCampaign_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteEMailCampaign dbInteraction = new DINT_WebSiteEMailCampaign(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteEMailCampaign.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteEMailCampaign.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEMailCampaign_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteEMailCampaign");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEMailCampaign_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEMailCampaign dbInteraction = new DINT_WebSiteEMailCampaign(oSystem.cnCon);
                        List<DEF_WebSiteEMailCampaign.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteEMailCampaign.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteEMailCampaignViewModel recRecord = new ACMSDBView.WebSiteEMailCampaignViewModel();
                                recRecord.WebSiteEMailCampaign = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                recRecord.Get_WebSiteBlogEntry(oSystem.cnCon);
                                recRecord.Get_WebSiteAnnouncements(oSystem.cnCon);
                                recRecord.Get_WebSiteForumiAnnouncements(oSystem.cnCon);
                                recRecord.Get_WebSitePage(oSystem.cnCon);
                                recRecord.Get_WebSiteEventCalendar(oSystem.cnCon);
                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEMailCampaign dbInteraction = new DINT_WebSiteEMailCampaign(oSystem.cnCon);
                        List<DEF_WebSiteEMailCampaign.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteEMailCampaign.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteEMailCampaignViewModel recRecord = new ACMSDBView.WebSiteEMailCampaignViewModel();
                                recRecord.WebSiteEMailCampaign = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                recRecord.Get_WebSiteBlogEntry(oSystem.cnCon);
                                recRecord.Get_WebSiteAnnouncements(oSystem.cnCon);
                                recRecord.Get_WebSiteForumiAnnouncements(oSystem.cnCon);
                                recRecord.Get_WebSitePage(oSystem.cnCon);
                                recRecord.Get_WebSiteEventCalendar(oSystem.cnCon);
                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }


        public ActionResult WebSiteEMailCampaign_Create()
        {
            Set_Client_NavSettings("WebSiteEMailCampaign");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEMailCampaign_Details;

                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    //DEF_WebSiteEMailCampaign.RecordObject recRecord = new DEF_WebSiteEMailCampaign.RecordObject();
                    ACMSDBView.WebSiteEMailCampaignViewModel recRecord = new ACMSDBView.WebSiteEMailCampaignViewModel();

                    recRecord.WebSiteEMailCampaign.dtRunAt = DateTime.Now;
                    recRecord.WebSiteEMailCampaign.dtSecondRunAt = DateTime.Now;

                    recRecord.Get_WebSiteBlogEntry(oSystem.cnCon);
                    recRecord.Get_WebSiteAnnouncements(oSystem.cnCon);
                    recRecord.Get_WebSiteForumiAnnouncements(oSystem.cnCon);
                    recRecord.Get_WebSitePage(oSystem.cnCon);
                    recRecord.Get_WebSiteEventCalendar(oSystem.cnCon);
                    recRecord.Get_WebSiteQuestionair(oSystem.cnCon);


                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteEMailCampaign_AddUpdate(ACMSDBView.WebSiteEMailCampaignViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteEMailCampaign");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEMailCampaign_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec.WebSiteEMailCampaign != null)
                    {
                        if ((_rec.WebSiteEMailCampaign.ID == null) || (_rec.WebSiteEMailCampaign.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteEMailCampaign.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {

                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteEMailCampaign dbInteraction = new DINT_WebSiteEMailCampaign(oSystem.cnCon);

                                _rec.WebSiteEMailCampaign.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteEMailCampaign.dtDateCreated = DateTime.Now;
                                _rec.WebSiteEMailCampaign.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteEMailCampaign);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteEMailCampaign_Details", new { key = _rec.WebSiteEMailCampaign.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteEMailCampaign.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteEMailCampaign dbInteraction = new DINT_WebSiteEMailCampaign(oSystem.cnCon);
                                    _rec.WebSiteEMailCampaign.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteEMailCampaign);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteEMailCampaign_Details", new { id = _rec.WebSiteEMailCampaign.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEMailCampaign_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteEMailCampaign");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteEMailCampaign dbInteraction = new DINT_WebSiteEMailCampaign(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteEMailCampaign.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEMailCampaign.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {




                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteEMailCampaign_List");


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteEMailCampaign_List");

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }


        [HttpPost]
        public JsonResult WebSiteEMailCampaign_ProcessSend(int Id)
        {
            Set_ViewBag_UserInfo_Defaults();
            string sRESPONSE = "false";
            string sRESPONSEMESSAGE = "Error";

            if (oSystem.OpenDataConnection())
            {
                #region
                if (oSystem.GetCurrentUser())
                {
                    if (Id > 0)
                    {
                        try
                        {

                            oSystem.SendMarketing_Campiag(Id);
                            sRESPONSE = "true";

                        }
                        catch
                        {
                            sRESPONSE = "false";
                            sRESPONSEMESSAGE = "Sorry could not find any records!";
                        }
                    }
                    else
                    {
                        sRESPONSE = "false";
                        sRESPONSEMESSAGE = "Invalid Campaign ID!";
                    }
                }
                else
                {
                    sRESPONSE = "false";
                    sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                }
                #endregion

            }
            oSystem.CloseDataConnection();
            var oResponse = Json(new { RESPONSE = sRESPONSE, MESSAGE = sRESPONSEMESSAGE });
            return oResponse;
        }


        [HttpPost]
        public JsonResult WebSiteEMailCampaign_TestSend(int Id, string _ToEmail, string _ToCellPhone, string _ToFName, string _ToLName)
        {
            Set_ViewBag_UserInfo_Defaults();
            string sRESPONSE = "false";
            string sRESPONSEMESSAGE = "Error";

            if (oSystem.OpenDataConnection())
            {
                #region
                if (oSystem.GetCurrentUser())
                {
                    if (Id > 0)
                    {
                        try
                        {
                            List<DataParameter> lstParameters = new List<DataParameter>();
                            DataParameter pParameter = null;

                            DINT_WebSiteEMailCampaign dbUWebSiteEMailCampaign = new DINT_WebSiteEMailCampaign(oSystem.cnCon);

                            lstParameters = new List<DataParameter>();
                            pParameter = null;
                            pParameter = new DataParameter("ID", "'" + Id + "'", "int", 11, "ID", " = ", "");
                            lstParameters.Add(pParameter);


                            List<DEF_WebSiteEMailCampaign.RecordObject> lstWebSiteEMailCampaign = dbUWebSiteEMailCampaign.Get(lstParameters);

                            if (lstWebSiteEMailCampaign != null)
                            {
                                if (lstWebSiteEMailCampaign.Count > 0)
                                {

                                    //Linked Calendar Event
                                    DEF_WebSiteEventCalendar.RecordObject rec_WebSiteEventCalendar = null;
                                    #region WebSiteEventCalendar
                                    if (lstWebSiteEMailCampaign[0].iLink_WebCalEvntID > 0)
                                    {
                                        DINT_WebSiteEventCalendar dbWebSiteEventCalendar = new DINT_WebSiteEventCalendar(oSystem.cnCon);

                                        lstParameters = new List<DataParameter>();
                                        pParameter = null;
                                        pParameter = new DataParameter("ID", "'" + lstWebSiteEMailCampaign[0].iLink_WebCalEvntID + "'", "int", 11, "ID", " = ", "");
                                        lstParameters.Add(pParameter);

                                        List<DEF_WebSiteEventCalendar.RecordObject> lstWebSiteEventCalendar = dbWebSiteEventCalendar.Get(lstParameters);
                                        if (lstWebSiteEventCalendar != null)
                                        {
                                            rec_WebSiteEventCalendar = lstWebSiteEventCalendar[0];
                                        }
                                    }
                                    #endregion

                                    DEF_WebSiteBlogEntry.RecordObject rec_WebSiteBlogEntry = null;
                                    #region WebSiteBlogEntry
                                    if (lstWebSiteEMailCampaign[0].iLink_BlogEntryID > 0)
                                    {
                                        DINT_WebSiteBlogEntry dbWebSiteBlogEntry = new DINT_WebSiteBlogEntry(oSystem.cnCon);

                                        lstParameters = new List<DataParameter>();
                                        pParameter = null;
                                        pParameter = new DataParameter("ID", "'" + lstWebSiteEMailCampaign[0].iLink_BlogEntryID + "'", "int", 11, "ID", " = ", "");
                                        lstParameters.Add(pParameter);

                                        List<DEF_WebSiteBlogEntry.RecordObject> lstWebSiteBlogEntry = dbWebSiteBlogEntry.Get(lstParameters);
                                        if (rec_WebSiteBlogEntry != null)
                                        {
                                            rec_WebSiteBlogEntry = lstWebSiteBlogEntry[0];
                                        }
                                    }
                                    #endregion

                                    DEF_WebSiteAnnouncements.RecordObject rec_WebSiteAnnouncements = null;
                                    #region WebSiteAnnouncements
                                    if (lstWebSiteEMailCampaign[0].iLink_AnnouncementID > 0)
                                    {
                                        DINT_WebSiteAnnouncements dbWebSiteAnnouncements = new DINT_WebSiteAnnouncements(oSystem.cnCon);

                                        lstParameters = new List<DataParameter>();
                                        pParameter = null;
                                        pParameter = new DataParameter("ID", "'" + lstWebSiteEMailCampaign[0].iLink_AnnouncementID + "'", "int", 11, "ID", " = ", "");
                                        lstParameters.Add(pParameter);

                                        List<DEF_WebSiteAnnouncements.RecordObject> lstWebSiteAnnouncements = dbWebSiteAnnouncements.Get(lstParameters);
                                        if (rec_WebSiteAnnouncements != null)
                                        {
                                            rec_WebSiteAnnouncements = lstWebSiteAnnouncements[0];
                                        }
                                    }
                                    #endregion

                                    DEF_WebSiteForumiAnnouncements.RecordObject rec_WebSiteForumiAnnouncements = null;
                                    #region WebSiteForumiAnnouncements
                                    if (lstWebSiteEMailCampaign[0].iLink_FrumAnnouncID > 0)
                                    {
                                        DINT_WebSiteForumiAnnouncements dbWebSiteForumiAnnouncements = new DINT_WebSiteForumiAnnouncements(oSystem.cnCon);

                                        lstParameters = new List<DataParameter>();
                                        pParameter = null;
                                        pParameter = new DataParameter("ID", "'" + lstWebSiteEMailCampaign[0].iLink_FrumAnnouncID + "'", "int", 11, "ID", " = ", "");
                                        lstParameters.Add(pParameter);

                                        List<DEF_WebSiteForumiAnnouncements.RecordObject> lstWebSiteForumiAnnouncements = dbWebSiteForumiAnnouncements.Get(lstParameters);
                                        if (rec_WebSiteForumiAnnouncements != null)
                                        {
                                            rec_WebSiteForumiAnnouncements = lstWebSiteForumiAnnouncements[0];
                                        }
                                    }
                                    #endregion

                                    DEF_WebSitePage.RecordObject rec_WebSitePage = null;
                                    #region WebSitePage
                                    if (lstWebSiteEMailCampaign[0].iLink_WebPgID > 0)
                                    {
                                        DINT_WebSitePage dbWebSitePage = new DINT_WebSitePage(oSystem.cnCon);

                                        lstParameters = new List<DataParameter>();
                                        pParameter = null;
                                        pParameter = new DataParameter("ID", "'" + lstWebSiteEMailCampaign[0].iLink_WebPgID + "'", "int", 11, "ID", " = ", "");
                                        lstParameters.Add(pParameter);

                                        List<DEF_WebSitePage.RecordObject> lstWebSitePage = dbWebSitePage.Get(lstParameters);
                                        if (lstWebSitePage != null)
                                        {
                                            rec_WebSitePage = lstWebSitePage[0];
                                        }
                                    }
                                    #endregion



                                    string sMessage = oSystem.Parse_Marketing_Message(lstWebSiteEMailCampaign[0].sHTML1, _ToFName, _ToLName, _ToEmail, _ToCellPhone, "", rec_WebSiteEventCalendar, rec_WebSiteBlogEntry, rec_WebSiteAnnouncements, rec_WebSiteForumiAnnouncements, rec_WebSitePage);
                                    string sSubject = oSystem.Parse_Marketing_Message(lstWebSiteEMailCampaign[0].sSubjectLine1, _ToFName, _ToLName, _ToEmail, _ToCellPhone, "", rec_WebSiteEventCalendar, rec_WebSiteBlogEntry, rec_WebSiteAnnouncements, rec_WebSiteForumiAnnouncements, rec_WebSitePage);

                                    oSystem.SendMessage(lstWebSiteEMailCampaign[0].sFromEmail, lstWebSiteEMailCampaign[0].sFromName, _ToEmail, _ToFName + " " + _ToLName, sSubject, sMessage);


                                    sRESPONSE = "true";
                                    sRESPONSEMESSAGE = "";
                                }
                                else
                                {
                                    sRESPONSE = "false";
                                    sRESPONSEMESSAGE = "Sorry could not find any records!";
                                }
                            }
                            else
                            {
                                sRESPONSE = "false";
                                sRESPONSEMESSAGE = "Sorry could not find any records!";
                            }

                        }
                        catch
                        {
                            sRESPONSE = "false";
                            sRESPONSEMESSAGE = "Sorry could not find any records!";
                        }
                    }
                    else
                    {
                        sRESPONSE = "false";
                        sRESPONSEMESSAGE = "Invalid Campaign ID!";
                    }
                }
                else
                {
                    sRESPONSE = "false";
                    sRESPONSEMESSAGE = "System error occured please contact system administrator!";
                }
                #endregion

            }
            oSystem.CloseDataConnection();
            var oResponse = Json(new { RESPONSE = sRESPONSE, MESSAGE = sRESPONSEMESSAGE });
            return oResponse;
        }


        #endregion

        #region Form WebSiteEMailCampaignMembers

        string sWebSiteEMailCampaignMembers_Details = "/views/Forms/WebSiteEMailCampaignMembers_Details.cshtml";
        string sWebSiteEMailCampaignMembers_List = "/views/Forms/WebSiteEMailCampaignMembers_List.cshtml";


        public ActionResult WebSiteEMailCampaignMembers_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteEMailCampaignMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEMailCampaignMembers_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteEMailCampaignMembers dbInteraction = new DINT_WebSiteEMailCampaignMembers(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteEMailCampaignMembers.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteEMailCampaignMembers.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEMailCampaignMembers_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteEMailCampaignMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEMailCampaignMembers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEMailCampaignMembers dbInteraction = new DINT_WebSiteEMailCampaignMembers(oSystem.cnCon);
                        List<DEF_WebSiteEMailCampaignMembers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEMailCampaignMembers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEMailCampaignMembers dbInteraction = new DINT_WebSiteEMailCampaignMembers(oSystem.cnCon);
                        List<DEF_WebSiteEMailCampaignMembers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEMailCampaignMembers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteEMailCampaignMembers_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteEMailCampaignMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEMailCampaignMembers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteEMailCampaignMembers.RecordObject recRecord = new DEF_WebSiteEMailCampaignMembers.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public ActionResult WebSiteEMailCampaignMembers_AddUpdate(DEF_WebSiteEMailCampaignMembers.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteEMailCampaignMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEMailCampaignMembers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteEMailCampaignMembers dbInteraction = new DINT_WebSiteEMailCampaignMembers(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteEMailCampaignMembers_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteEMailCampaignMembers dbInteraction = new DINT_WebSiteEMailCampaignMembers(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteEMailCampaignMembers_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEMailCampaignMembers_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteEMailCampaignMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteEMailCampaignMembers dbInteraction = new DINT_WebSiteEMailCampaignMembers(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteEMailCampaignMembers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEMailCampaignMembers.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteEMailCampaignMembers_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteEMailCampaignMembers_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteEMailCampaignMessage

        string sWebSiteEMailCampaignMessage_Details = "/views/Forms/WebSiteEMailCampaignMessage_Details.cshtml";
        string sWebSiteEMailCampaignMessage_List = "/views/Forms/WebSiteEMailCampaignMessage_List.cshtml";


        public ActionResult WebSiteEMailCampaignMessage_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteEMailCampaignMessage");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEMailCampaignMessage_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteEMailCampaignMessage dbInteraction = new DINT_WebSiteEMailCampaignMessage(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteEMailCampaignMessage.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteEMailCampaignMessage.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEMailCampaignMessage_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteEMailCampaignMessage");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEMailCampaignMessage_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEMailCampaignMessage dbInteraction = new DINT_WebSiteEMailCampaignMessage(oSystem.cnCon);
                        List<DEF_WebSiteEMailCampaignMessage.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEMailCampaignMessage.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEMailCampaignMessage dbInteraction = new DINT_WebSiteEMailCampaignMessage(oSystem.cnCon);
                        List<DEF_WebSiteEMailCampaignMessage.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEMailCampaignMessage.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteEMailCampaignMessage_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteEMailCampaignMessage");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEMailCampaignMessage_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteEMailCampaignMessage.RecordObject recRecord = new DEF_WebSiteEMailCampaignMessage.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public ActionResult WebSiteEMailCampaignMessage_AddUpdate(DEF_WebSiteEMailCampaignMessage.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteEMailCampaignMessage");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEMailCampaignMessage_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteEMailCampaignMessage dbInteraction = new DINT_WebSiteEMailCampaignMessage(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteEMailCampaignMessage_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteEMailCampaignMessage dbInteraction = new DINT_WebSiteEMailCampaignMessage(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteEMailCampaignMessage_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEMailCampaignMessage_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteEMailCampaignMessage");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteEMailCampaignMessage dbInteraction = new DINT_WebSiteEMailCampaignMessage(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteEMailCampaignMessage.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEMailCampaignMessage.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteEMailCampaignMessage_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteEMailCampaignMessage_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteEMailCampaignLists

        string sWebSiteEMailCampaignLists_Details = "/views/Forms/WebSiteEMailCampaignLists_Details.cshtml";
        string sWebSiteEMailCampaignLists_List = "/views/Forms/WebSiteEMailCampaignLists_List.cshtml";


        public ActionResult WebSiteEMailCampaignLists_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteEMailCampaignLists");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEMailCampaignLists_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteEMailCampaignLists dbInteraction = new DINT_WebSiteEMailCampaignLists(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteEMailCampaignLists.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteEMailCampaignLists.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEMailCampaignLists_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteEMailCampaignLists");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEMailCampaignLists_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEMailCampaignLists dbInteraction = new DINT_WebSiteEMailCampaignLists(oSystem.cnCon);
                        List<DEF_WebSiteEMailCampaignLists.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteEMailCampaignLists.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteEMailCampaignListsViewModel recRecord = new ACMSDBView.WebSiteEMailCampaignListsViewModel();
                                recRecord.WebSiteEMailCampaignLists = dbSearch[0];

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteEMailCampaignLists.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteEMailCampaignLists.sParentID;

                                recRecord.Get_WebMarketingLists(oSystem.cnCon);

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEMailCampaignLists dbInteraction = new DINT_WebSiteEMailCampaignLists(oSystem.cnCon);
                        List<DEF_WebSiteEMailCampaignLists.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                ACMSDBView.WebSiteEMailCampaignListsViewModel recRecord = new ACMSDBView.WebSiteEMailCampaignListsViewModel();
                                recRecord.WebSiteEMailCampaignLists = dbSearch[0];

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteEMailCampaignLists.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteEMailCampaignLists.sParentID;

                                recRecord.Get_WebMarketingLists(oSystem.cnCon);



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteEMailCampaignLists_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteEMailCampaignLists");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEMailCampaignLists_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    ACMSDBView.WebSiteEMailCampaignListsViewModel recRecord = new WebSiteEMailCampaignListsViewModel();


                    recRecord.WebSiteEMailCampaignLists.iParentID = _iParentID;
                    recRecord.WebSiteEMailCampaignLists.sParentID = _sParentID;

                    recRecord.WebSiteEMailCampaignLists.dtLastsendouton = DateTime.Parse("01/01/1901");
                    recRecord.WebSiteEMailCampaignLists.dtsentouton = DateTime.Parse("01/01/1901");

                    recRecord.Get_WebMarketingLists(oSystem.cnCon);



                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public ActionResult WebSiteEMailCampaignLists_AddUpdate(ACMSDBView.WebSiteEMailCampaignListsViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteEMailCampaignLists");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEMailCampaignLists_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteEMailCampaignLists.ID == null) || (_rec.WebSiteEMailCampaignLists.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteEMailCampaignLists.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSiteEMailCampaignLists.iParentID;
                            ViewBag.sParentID = _rec.WebSiteEMailCampaignLists.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteEMailCampaignLists dbInteraction = new DINT_WebSiteEMailCampaignLists(oSystem.cnCon);

                                _rec.WebSiteEMailCampaignLists.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteEMailCampaignLists.dtDateCreated = DateTime.Now;
                                _rec.WebSiteEMailCampaignLists.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteEMailCampaignLists);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteEMailCampaignLists_Details", new { key = _rec.WebSiteEMailCampaignLists.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteEMailCampaignLists.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteEMailCampaignLists dbInteraction = new DINT_WebSiteEMailCampaignLists(oSystem.cnCon);
                                    _rec.WebSiteEMailCampaignLists.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteEMailCampaignLists);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteEMailCampaignLists_Details", new { id = _rec.WebSiteEMailCampaignLists.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEMailCampaignLists_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteEMailCampaignLists");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteEMailCampaignLists dbInteraction = new DINT_WebSiteEMailCampaignLists(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteEMailCampaignLists.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEMailCampaignLists.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteEMailCampaignLists_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteEMailCampaignLists_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePageZone
        public ActionResult WebSitePageZone_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSitePageZone_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZone_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePageZone dbInteraction = new DINT_WebSitePageZone(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePageZone.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sName", "'" + Search + "'", "string", 10, "sName", " = ", "");
                        lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);

                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePageZone.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageZone_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePageZone_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZone_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageZone dbInteraction = new DINT_WebSitePageZone(oSystem.cnCon);
                        List<DEF_WebSitePageZone.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSitePageZone.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSitePageZoneViewModel recRecord = new WebSitePageZoneViewModel();

                                int iTemplateID = 0;
                                lstParameters = new List<DataParameter>();
                                pParameter = new DataParameter("ID", dbSearch[0].iParentID.ToString(), "int", 0, "ID", " = ", "");
                                lstParameters.Add(pParameter);

                                DINT_WebSitePage dbWebSitePage = new DINT_WebSitePage(oSystem.cnCon);
                                List<DEF_WebSitePage.RecordObject> lsrWebSitePage = dbWebSitePage.Get(lstParameters);
                                if (lsrWebSitePage != null)
                                {
                                    if (lsrWebSitePage.Count > 0)
                                    {
                                        iTemplateID = lsrWebSitePage[0].iSiteTemplatePageID;
                                    }
                                }

                                recRecord.GetView(oSystem.cnCon, dbSearch[0].ID);
                                recRecord.Get_WebSitePageTemplateZonesList(oSystem.cnCon, iTemplateID);
                                recRecord.Get_Languages(oSystem.cnCon);

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSitePageZone.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePageZone.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageZone dbInteraction = new DINT_WebSitePageZone(oSystem.cnCon);
                        List<DEF_WebSitePageZone.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSitePageZone.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSitePageZoneViewModel recRecord = new WebSitePageZoneViewModel();

                                int iTemplateID = 0;
                                lstParameters = new List<DataParameter>();
                                pParameter = new DataParameter("ID", dbSearch[0].iParentID.ToString(), "int", 0, "ID", " = ", "");
                                lstParameters.Add(pParameter);

                                DINT_WebSitePage dbWebSitePage = new DINT_WebSitePage(oSystem.cnCon);
                                List<DEF_WebSitePage.RecordObject> lsrWebSitePage = dbWebSitePage.Get(lstParameters);
                                if (lsrWebSitePage != null)
                                {
                                    if (lsrWebSitePage.Count > 0)
                                    {
                                        iTemplateID = lsrWebSitePage[0].iSiteTemplatePageID;
                                    }
                                }

                                recRecord.GetView(oSystem.cnCon, dbSearch[0].ID);
                                recRecord.Get_WebSitePageTemplateZonesList(oSystem.cnCon, iTemplateID);
                                recRecord.Get_Languages(oSystem.cnCon);

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSitePageZone.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePageZone.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageZone_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSitePageZone_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZone_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";

                    ACMSDBView.WebSitePageZoneViewModel recRecord = new WebSitePageZoneViewModel();
                    if (_iParentID > 0)
                    {
                        int iTemplateID = 0;
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", _iParentID.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePage dbWebSitePage = new DINT_WebSitePage(oSystem.cnCon);
                        List<DEF_WebSitePage.RecordObject> lsrWebSitePage = dbWebSitePage.Get(lstParameters);
                        if (lsrWebSitePage != null)
                        {
                            if (lsrWebSitePage.Count > 0)
                            {
                                iTemplateID = lsrWebSitePage[0].iSiteTemplatePageID;
                                recRecord.Get_WebSitePageTemplateZonesList(oSystem.cnCon, iTemplateID);
                            }
                            else
                            {
                                iTemplateID = 1;
                                recRecord.Get_WebSitePageTemplateZonesList(oSystem.cnCon, iTemplateID);
                            }
                        }
                        else
                        {
                            iTemplateID = 1;
                            recRecord.Get_WebSitePageTemplateZonesList(oSystem.cnCon, iTemplateID);
                        }

                        recRecord.WebSitePageZone.iParentID = _iParentID;
                        recRecord.WebSitePageZone.sParentID = _sParentID;
                    }


                    recRecord.WebSitePageZone.iLanguageID = 205;
                    recRecord.WebSitePageZone.sLanguageID = "United States English";

                    recRecord.Get_Languages(oSystem.cnCon);

                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageZone_AddUpdate(ACMSDBView.WebSitePageZoneViewModel _rec)
        {
            Set_Client_NavSettings("WebSitePageZone_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                int iUserID = 0;
                string sUserID = "";
                #region Set Current User info to veriables to be used for record tracking
                try
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView != null)
                        {
                            if (oSystem.CurrentUser.UserView.User != null)
                            {
                                if (oSystem.CurrentUser.UserView.User.ID > 0)
                                {
                                    iUserID = oSystem.CurrentUser.UserView.User.ID;
                                    sUserID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName + "(" + oSystem.CurrentUser.UserView.User.sUserName + ")";
                                }
                            }
                        }
                    }
                }
                catch
                {

                }
                #endregion

                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZone_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSitePageZone.ID == null) || (_rec.WebSitePageZone.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSitePageZone.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSitePageZone.iParentID;
                            ViewBag.sParentID = _rec.WebSitePageZone.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePageZone dbInteraction = new DINT_WebSitePageZone(oSystem.cnCon);

                                _rec.WebSitePageZone.sControl = Guid.NewGuid().ToString();
                                _rec.WebSitePageZone.dtDateCreated = DateTime.Now;
                                _rec.WebSitePageZone.dtLastUpdated = DateTime.Now;
                                _rec.WebSitePageZone.iCreatedByID = iUserID;
                                _rec.WebSitePageZone.sCreatedByID = sUserID;
                                _rec.WebSitePageZone.iUpdatedByID = iUserID;
                                _rec.WebSitePageZone.sUpdatedByID = sUserID;


                                List<DataParameter> lstParameters = new List<DataParameter>();
                                DataParameter pParameter = new DataParameter("ID", _rec.WebSitePageZone.iZoneID.ToString(), "int", 0, "ID", " = ", "");
                                lstParameters.Add(pParameter);

                                DINT_WebSitePageTemplateZones dbWebSitePageTemplateZones = new DINT_WebSitePageTemplateZones(oSystem.cnCon);
                                List<DEF_WebSitePageTemplateZones.RecordObject> lsrWebSitePageTemplateZones = dbWebSitePageTemplateZones.Get(lstParameters);
                                if (lsrWebSitePageTemplateZones != null)
                                {
                                    if (lsrWebSitePageTemplateZones.Count > 0)
                                    {
                                        if (lsrWebSitePageTemplateZones[0].ID == _rec.WebSitePageZone.iZoneID)
                                        {
                                            _rec.WebSitePageZone.sZoneID = lsrWebSitePageTemplateZones[0].sName;
                                        }
                                    }
                                }


                                dbInteraction.Insert_SQL(_rec.WebSitePageZone);


                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSitePageZone_Details", new { key = _rec.WebSitePageZone.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.WebSitePageZone.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePageZone dbInteraction = new DINT_WebSitePageZone(oSystem.cnCon);

                                    #region pull old record and make an history record of it's values before updateding with new values
                                    List<DataParameter> lstParameters = new List<DataParameter>();
                                    DataParameter pParameter = new DataParameter("sControl", "'" + _rec.WebSitePageZone.sControl.ToString() + "'", "sControl", 3, "sControl", " = ", "");
                                    lstParameters.Add(pParameter);

                                    List<DEF_WebSitePageZone.RecordObject> lstSearch = dbInteraction.Get(lstParameters);
                                    if (lstSearch != null)
                                    {
                                        if (lstSearch.Count > 0)
                                        {
                                            try
                                            {
                                                DINT_WebSitePageZone_History dbWebSitePageZone_History = new DINT_WebSitePageZone_History(oSystem.cnCon);
                                                DEF_WebSitePageZone_History.RecordObject rec_WebSitePageZone_History = new DEF_WebSitePageZone_History.RecordObject();
                                                rec_WebSitePageZone_History.sControl = Guid.NewGuid().ToString();
                                                rec_WebSitePageZone_History.iParentID = _rec.WebSitePageZone.ID;
                                                rec_WebSitePageZone_History.sParentID = _rec.WebSitePageZone.sZoneID;

                                                rec_WebSitePageZone_History.dtDateCreated = DateTime.Now;
                                                rec_WebSitePageZone_History.dtLastUpdated = DateTime.Now;
                                                rec_WebSitePageZone_History.iCreatedByID = iUserID;
                                                rec_WebSitePageZone_History.sCreatedByID = sUserID;
                                                rec_WebSitePageZone_History.iUpdatedByID = iUserID;
                                                rec_WebSitePageZone_History.sUpdatedByID = sUserID;

                                                foreach (DEF_WebSitePageZone.RecordObject oR in lstSearch)
                                                {
                                                    if (oR.ID == _rec.WebSitePageZone.ID)
                                                    {
                                                        rec_WebSitePageZone_History.sName = oR.sName;
                                                        rec_WebSitePageZone_History.iZoneID = oR.iZoneID;
                                                        rec_WebSitePageZone_History.sZoneID = oR.sZoneID;
                                                        rec_WebSitePageZone_History.sContent = oR.sContent;
                                                        rec_WebSitePageZone_History.sLoadIncludeURI = oR.sLoadIncludeURI;
                                                        rec_WebSitePageZone_History.bLoadPartialPage = oR.bLoadPartialPage;
                                                        rec_WebSitePageZone_History.iLanguageID = oR.iLanguageID;
                                                        rec_WebSitePageZone_History.sLanguageID = oR.sLanguageID;
                                                    }
                                                }

                                                dbWebSitePageZone_History.Insert_SQL(rec_WebSitePageZone_History);
                                            }
                                            catch { }
                                        }
                                    }
                                    #endregion

                                    _rec.WebSitePageZone.iUpdatedByID = iUserID;
                                    _rec.WebSitePageZone.sUpdatedByID = sUserID;
                                    _rec.WebSitePageZone.dtLastUpdated = DateTime.Now;


                                    lstParameters = new List<DataParameter>();
                                    pParameter = new DataParameter("ID", _rec.WebSitePageZone.iZoneID.ToString(), "int", 0, "ID", " = ", "");
                                    lstParameters.Add(pParameter);

                                    DINT_WebSitePageTemplateZones dbWebSitePageTemplateZones = new DINT_WebSitePageTemplateZones(oSystem.cnCon);
                                    List<DEF_WebSitePageTemplateZones.RecordObject> lsrWebSitePageTemplateZones = dbWebSitePageTemplateZones.Get(lstParameters);
                                    if (lsrWebSitePageTemplateZones != null)
                                    {
                                        if (lsrWebSitePageTemplateZones.Count > 0)
                                        {
                                            if (lsrWebSitePageTemplateZones[0].ID == _rec.WebSitePageZone.iZoneID)
                                            {
                                                _rec.WebSitePageZone.sZoneID = lsrWebSitePageTemplateZones[0].sName;
                                            }
                                        }
                                    }



                                    dbInteraction.Update_SQL(_rec.WebSitePageZone);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    //return View(_sViewToLoad, _rec);
                                    return RedirectToAction("WebSitePageZone_Details", new { id = _rec.WebSitePageZone.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageZone_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePageZone_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePageZone dbInteraction = new DINT_WebSitePageZone(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePageZone.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageZone.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSitePageZone_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSitePageZone_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePageZone_History

        string sWebSitePageZone_History_Details = "/views/Forms/WebSitePageZone_History_Details.cshtml";
        string sWebSitePageZone_History_List = "/views/Forms/WebSitePageZone_History_List.cshtml";


        public ActionResult WebSitePageZone_History_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSitePageZone_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZone_History_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePageZone_History dbInteraction = new DINT_WebSitePageZone_History(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePageZone_History.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePageZone_History.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageZone_History_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePageZone_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZone_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageZone_History dbInteraction = new DINT_WebSitePageZone_History(oSystem.cnCon);
                        List<DEF_WebSitePageZone_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageZone_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageZone_History dbInteraction = new DINT_WebSitePageZone_History(oSystem.cnCon);
                        List<DEF_WebSitePageZone_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageZone_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSitePageZone_History_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSitePageZone_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZone_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSitePageZone_History.RecordObject recRecord = new DEF_WebSitePageZone_History.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageZone_History_Restore(DEF_WebSitePageZone_History.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSitePageZone_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                int iUserID = 0;
                string sUserID = "";
                #region Set Current User info to veriables to be used for record tracking
                try
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView != null)
                        {
                            if (oSystem.CurrentUser.UserView.User != null)
                            {
                                if (oSystem.CurrentUser.UserView.User.ID > 0)
                                {
                                    iUserID = oSystem.CurrentUser.UserView.User.ID;
                                    sUserID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName + "(" + oSystem.CurrentUser.UserView.User.sUserName + ")";
                                }
                            }
                        }
                    }
                }
                catch
                {

                }
                #endregion

                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZone_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID > 0))
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;


                            #region
                            ViewBag.bError = false;
                            ViewBag.bAddNew = false;
                            ViewBag.bSaved = true;
                            ViewBag.sErrorMessage = "";
                            oSystem.OpenDataConnection();


                            DINT_WebSitePageZone dbInteraction = new DINT_WebSitePageZone(oSystem.cnCon);
                            DEF_WebSitePageZone.RecordObject _rec_Restor = null;

                            List<DEF_WebSitePageZone.RecordObject> lstSearch = null;
                            List<DataParameter> lstParameters = new List<DataParameter>();
                            DataParameter pParameter = null;


                            pParameter = new DataParameter("ID", "'" + _rec.iParentID + "'", "string", 1, "ID", " = ", "");
                            lstParameters.Add(pParameter);


                            lstSearch = dbInteraction.Get(lstParameters);

                            DINT_WebSitePageZone_History dbWebSitePageZone_History = new DINT_WebSitePageZone_History(oSystem.cnCon);
                            DEF_WebSitePageZone_History.RecordObject rec_WebSitePageZone_History = new DEF_WebSitePageZone_History.RecordObject();
                            rec_WebSitePageZone_History.sControl = Guid.NewGuid().ToString();
                            rec_WebSitePageZone_History.iParentID = _rec.iParentID;
                            rec_WebSitePageZone_History.sParentID = _rec.sParentID;

                            rec_WebSitePageZone_History.dtDateCreated = DateTime.Now;
                            rec_WebSitePageZone_History.dtLastUpdated = DateTime.Now;
                            rec_WebSitePageZone_History.iCreatedByID = iUserID;
                            rec_WebSitePageZone_History.sCreatedByID = sUserID;
                            rec_WebSitePageZone_History.iUpdatedByID = iUserID;
                            rec_WebSitePageZone_History.sUpdatedByID = sUserID;

                            #region Transfer old values from old record found using the duplicate check
                            try
                            {
                                if (lstSearch != null)
                                {
                                    if (lstSearch.Count > 0)
                                    {
                                        foreach (DEF_WebSitePageZone.RecordObject oR in lstSearch)
                                        {
                                            if (oR.ID == _rec.iParentID)
                                            {
                                                rec_WebSitePageZone_History.iZoneID = oR.iZoneID;
                                                rec_WebSitePageZone_History.sZoneID = oR.sZoneID;
                                                rec_WebSitePageZone_History.sName = oR.sName;
                                                rec_WebSitePageZone_History.sContent = oR.sContent;
                                                rec_WebSitePageZone_History.sLoadIncludeURI = oR.sLoadIncludeURI;
                                                rec_WebSitePageZone_History.bLoadPartialPage = oR.bLoadPartialPage;
                                                rec_WebSitePageZone_History.iLanguageID = oR.iLanguageID;
                                                rec_WebSitePageZone_History.sLanguageID = oR.sLanguageID;

                                                _rec_Restor = oR;
                                            }
                                        }
                                    }
                                }
                            }
                            catch
                            {

                            }
                            #endregion

                            dbWebSitePageZone_History.Insert_SQL(rec_WebSitePageZone_History);


                            //restor values
                            _rec_Restor.iZoneID = _rec.iZoneID;
                            _rec_Restor.sZoneID = _rec.sZoneID;
                            _rec_Restor.sName = _rec.sName;
                            _rec_Restor.sContent = _rec.sContent;
                            _rec_Restor.sLoadIncludeURI = _rec.sLoadIncludeURI;
                            _rec_Restor.bLoadPartialPage = _rec.bLoadPartialPage;
                            _rec_Restor.iLanguageID = _rec.iLanguageID;
                            _rec_Restor.sLanguageID = _rec.sLanguageID;

                            _rec_Restor.dtLastUpdated = DateTime.Now;
                            _rec_Restor.iUpdatedByID = iUserID;
                            _rec_Restor.sUpdatedByID = sUserID;

                            dbInteraction.Update_SQL(_rec_Restor);

                            oSystem.CloseDataConnection();
                            #endregion
                            return RedirectToAction("WebSitePageZone_Details", new { id = _rec_Restor.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageZone_History_AddUpdate(DEF_WebSitePageZone_History.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSitePageZone_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageZone_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePageZone_History dbInteraction = new DINT_WebSitePageZone_History(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSitePageZone_History_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePageZone_History dbInteraction = new DINT_WebSitePageZone_History(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSitePageZone_History_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageZone_History_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePageZone_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePageZone_History dbInteraction = new DINT_WebSitePageZone_History(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePageZone_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageZone_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSitePageZone_History_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSitePageZone_History_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePageTemplateZonesContent
        public ActionResult WebSitePageTemplateZonesContent_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSitePageTemplateZonesContent_List");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZonesContent_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePageTemplateZonesContent dbInteraction = new DINT_WebSitePageTemplateZonesContent(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePageTemplateZonesContent.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    if (_iParentID > 0)
                    {
                        DataParameter pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                        lstParameters.Add(pParameter);
                    }


                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;

                        lstParameters = new List<DataParameter>();
                        //DataParameter pParameter = new DataParameter("sName", "'" + Search + "'", "string", 10, "sName", " = ", "");
                        //lstParameters.Add(pParameter);
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }
                    else
                    {
                        iTotalRows = dbInteraction.GetRowCount(lstParameters);
                    }

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);

                        oSystem.CloseDataConnection();

                        var dbres = dbSearch.OrderBy(s => s.ID);

                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePageTemplateZonesContent.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageTemplateZonesContent_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePageTemplateZonesContent_Details");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZonesContent_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageTemplateZonesContent dbInteraction = new DINT_WebSitePageTemplateZonesContent(oSystem.cnCon);
                        List<DEF_WebSitePageTemplateZonesContent.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSitePageTemplateZonesContent.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSitePageTemplateZonesContentViewModel recRecord = new WebSitePageTemplateZonesContentViewModel();

                                int iTemplateID = dbSearch[0].iParentID;

                                recRecord.GetView(oSystem.cnCon, dbSearch[0].ID);

                                recRecord.Get_WebSitePageTemplateZonesList(oSystem.cnCon, iTemplateID);

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                recRecord.Get_Languages(oSystem.cnCon);

                                ViewBag.iParentID = recRecord.WebSitePageTemplateZonesContent.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePageTemplateZonesContent.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }
                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageTemplateZonesContent dbInteraction = new DINT_WebSitePageTemplateZonesContent(oSystem.cnCon);
                        List<DEF_WebSitePageTemplateZonesContent.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSitePageTemplateZonesContent.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSitePageTemplateZonesContentViewModel recRecord = new WebSitePageTemplateZonesContentViewModel();

                                int iTemplateID = dbSearch[0].iParentID;

                                recRecord.GetView(oSystem.cnCon, dbSearch[0].ID);

                                recRecord.Get_WebSitePageTemplateZonesList(oSystem.cnCon, iTemplateID);

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                recRecord.Get_Languages(oSystem.cnCon);
                                ViewBag.iParentID = recRecord.WebSitePageTemplateZonesContent.iParentID;
                                ViewBag.sParentID = recRecord.WebSitePageTemplateZonesContent.sParentID;
                                oSystem.CloseDataConnection();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                return View(sModuleBase + sBasePage, oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        public JsonResult GetTemplatZonesContent(int _iTemplateZoneID)
        {
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            try
            {
                if (oSystem.OpenDataConnection())
                {
                    if (oSystem.GetCurrentUser())
                    {
                        Set_ViewBag_Global();
                        Set_ViewBag_UserInfo();
                    }

                    if (_iTemplateZoneID > 0)
                    {

                        DINT_WebSitePageTemplateZonesContent dbInteraction = new DINT_WebSitePageTemplateZonesContent(oSystem.cnCon);

                        List<DEF_WebSitePageTemplateZonesContent.RecordObject> dbSearch = null;
                        List<DataParameter> lstParameters = new List<DataParameter>();

                        DataParameter pParameter = new DataParameter("iContentZoneID", "'" + _iTemplateZoneID + "'", "int", 17, "iContentZoneID", " = ", "");
                        lstParameters.Add(pParameter);

                        dbSearch = dbInteraction.Get(lstParameters);
                        List<SelectListItem> ReturnList = new List<SelectListItem>();

                        if (dbSearch != null)
                        {
                            foreach (DEF_WebSitePageTemplateZonesContent.RecordObject oV in dbSearch)
                            {
                                ReturnList.Add(new SelectListItem { Selected = false, Text = oV.sName, Value = oV.ID.ToString() });
                            }


                        }


                        var oResponse = Json(ReturnList);
                        return oResponse;
                    }
                }


                var oResponseError = Json(new { RESPONSE = "ERROR" });
                return oResponseError;
            }
            catch
            {
                var oResponseError1 = Json(new { RESPONSE = "ERROR" });
                return oResponseError1;
            }
        }
        public ActionResult WebSitePageTemplateZonesContent_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSitePageTemplateZonesContent_Create");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZonesContent_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    //DEF_WebSitePageTemplateZonesContent.RecordObject recRecord = new DEF_WebSitePageTemplateZonesContent.RecordObject();

                    //recRecord.iParentID = _iParentID;
                    //recRecord.sParentID = _sParentID;

                    ACMSDBView.WebSitePageTemplateZonesContentViewModel recRecord = new WebSitePageTemplateZonesContentViewModel();
                    if (_iParentID > 0)
                    {
                        recRecord.Get_WebSitePageTemplateZonesList(oSystem.cnCon, _iParentID);
                        recRecord.Get_Languages(oSystem.cnCon);
                        recRecord.WebSitePageTemplateZonesContent.iParentID = _iParentID;
                        recRecord.WebSitePageTemplateZonesContent.sParentID = _sParentID;

                    }


                    recRecord.WebSitePageTemplateZonesContent.iLanguageID = 205;
                    recRecord.WebSitePageTemplateZonesContent.sLanguageID = "United States English";



                    recRecord.Get_Languages(oSystem.cnCon);
                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    return View(sModuleBase + sBasePage, oPage);
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageTemplateZonesContent_AddUpdate(ACMSDBView.WebSitePageTemplateZonesContentViewModel _rec)
        {
            Set_Client_NavSettings("WebSitePageTemplateZonesContent_AddUpdate");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                int iUserID = 0;
                string sUserID = "";
                #region Set Current User info to veriables to be used for record tracking
                try
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView != null)
                        {
                            if (oSystem.CurrentUser.UserView.User != null)
                            {
                                if (oSystem.CurrentUser.UserView.User.ID > 0)
                                {
                                    iUserID = oSystem.CurrentUser.UserView.User.ID;
                                    sUserID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName + "(" + oSystem.CurrentUser.UserView.User.sUserName + ")";
                                }
                            }
                        }
                    }
                }
                catch
                {

                }
                #endregion

                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZonesContent_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSitePageTemplateZonesContent.ID == null) || (_rec.WebSitePageTemplateZonesContent.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSitePageTemplateZonesContent.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSitePageTemplateZonesContent.iParentID;
                            ViewBag.sParentID = _rec.WebSitePageTemplateZonesContent.sParentID;
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePageTemplateZonesContent dbInteraction = new DINT_WebSitePageTemplateZonesContent(oSystem.cnCon);

                                _rec.WebSitePageTemplateZonesContent.sControl = Guid.NewGuid().ToString();
                                _rec.WebSitePageTemplateZonesContent.dtDateCreated = DateTime.Now;
                                _rec.WebSitePageTemplateZonesContent.dtLastUpdated = DateTime.Now;
                                _rec.WebSitePageTemplateZonesContent.iCreatedByID = iUserID;
                                _rec.WebSitePageTemplateZonesContent.sCreatedByID = sUserID;
                                _rec.WebSitePageTemplateZonesContent.iUpdatedByID = iUserID;
                                _rec.WebSitePageTemplateZonesContent.sUpdatedByID = sUserID;

                                _rec.Get_WebSitePageTemplateZonesList(oSystem.cnCon, _rec.WebSitePageTemplateZonesContent.iParentID);

                                _rec.WebSitePageTemplateZonesContent.sContentZoneID = _rec.GetZoneName(_rec.WebSitePageTemplateZonesContent.iContentZoneID);




                                dbInteraction.Insert_SQL(_rec.WebSitePageTemplateZonesContent);



                                oSystem.CloseDataConnection();
                                //return RedirectToAction("StatesDetails", new { id = _rec.ID, _bOverrideScreenMessage = true });
                                #endregion
                                return RedirectToAction("WebSitePageTemplateZonesContent_Details", new { key = _rec.WebSitePageTemplateZonesContent.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                //return View(_sViewToLoad, _rec);
                                //return View(_rec);
                            }
                            else
                            {
                                if (_rec.WebSitePageTemplateZonesContent.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePageTemplateZonesContent dbInteraction = new DINT_WebSitePageTemplateZonesContent(oSystem.cnCon);

                                    #region pull old record and make an history record of it's values before updateding with new values
                                    List<DataParameter> lstParameters = new List<DataParameter>();
                                    DataParameter pParameter = new DataParameter("sControl", "'" + _rec.WebSitePageTemplateZonesContent.sControl.ToString() + "'", "sControl", 3, "sControl", " = ", "");
                                    lstParameters.Add(pParameter);

                                    List<DEF_WebSitePageTemplateZonesContent.RecordObject> lstSearch = dbInteraction.Get(lstParameters);
                                    if (lstSearch != null)
                                    {
                                        if (lstSearch.Count > 0)
                                        {
                                            try
                                            {
                                                DINT_WebSitePageTemplateZonesContent_History dbWebSitePageTemplateZonesContent_History = new DINT_WebSitePageTemplateZonesContent_History(oSystem.cnCon);
                                                DEF_WebSitePageTemplateZonesContent_History.RecordObject rec_WebSitePageTemplateZonesContent_History = new DEF_WebSitePageTemplateZonesContent_History.RecordObject();
                                                rec_WebSitePageTemplateZonesContent_History.sControl = Guid.NewGuid().ToString();
                                                rec_WebSitePageTemplateZonesContent_History.iParentID = _rec.WebSitePageTemplateZonesContent.ID;
                                                rec_WebSitePageTemplateZonesContent_History.sParentID = _rec.WebSitePageTemplateZonesContent.sName;

                                                rec_WebSitePageTemplateZonesContent_History.dtDateCreated = DateTime.Now;
                                                rec_WebSitePageTemplateZonesContent_History.dtLastUpdated = DateTime.Now;
                                                rec_WebSitePageTemplateZonesContent_History.iCreatedByID = iUserID;
                                                rec_WebSitePageTemplateZonesContent_History.sCreatedByID = sUserID;
                                                rec_WebSitePageTemplateZonesContent_History.iUpdatedByID = iUserID;
                                                rec_WebSitePageTemplateZonesContent_History.sUpdatedByID = sUserID;

                                                foreach (DEF_WebSitePageTemplateZonesContent.RecordObject oR in lstSearch)
                                                {
                                                    if (oR.ID == _rec.WebSitePageTemplateZonesContent.ID)
                                                    {
                                                        rec_WebSitePageTemplateZonesContent_History.sName = oR.sName;
                                                        rec_WebSitePageTemplateZonesContent_History.iTypeID = oR.iTypeID;
                                                        rec_WebSitePageTemplateZonesContent_History.sTypeID = oR.sTypeID;
                                                        rec_WebSitePageTemplateZonesContent_History.sCodeName = oR.sCodeName;
                                                        rec_WebSitePageTemplateZonesContent_History.sDefaultValue = oR.sDefaultValue;
                                                        rec_WebSitePageTemplateZonesContent_History.iLanguageID = oR.iLanguageID;
                                                        rec_WebSitePageTemplateZonesContent_History.sLanguageID = oR.sLanguageID;
                                                        rec_WebSitePageTemplateZonesContent_History.bPrimaryContentArea = oR.bPrimaryContentArea;
                                                    }
                                                }

                                                dbWebSitePageTemplateZonesContent_History.Insert_SQL(rec_WebSitePageTemplateZonesContent_History);
                                            }
                                            catch { }
                                        }
                                    }
                                    #endregion

                                    _rec.WebSitePageTemplateZonesContent.iUpdatedByID = iUserID;
                                    _rec.WebSitePageTemplateZonesContent.sUpdatedByID = sUserID;
                                    _rec.WebSitePageTemplateZonesContent.dtLastUpdated = DateTime.Now;

                                    _rec.Get_WebSitePageTemplateZonesList(oSystem.cnCon, _rec.WebSitePageTemplateZonesContent.iParentID);

                                    _rec.WebSitePageTemplateZonesContent.sContentZoneID = _rec.GetZoneName(_rec.WebSitePageTemplateZonesContent.iContentZoneID);

                                    dbInteraction.Update_SQL(_rec.WebSitePageTemplateZonesContent);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSitePageTemplateZonesContent_Details", new { id = _rec.WebSitePageTemplateZonesContent.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                    //return View(_sViewToLoad, _rec);
                                    //return View(_rec);
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    return View(sModuleBase + sBasePage, oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";
                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            return View(sModuleBase + sBasePage, oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        return View(sModuleBase + sBasePage, oPage);
                    }
                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        public ActionResult WebSitePageTemplateZonesContent_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePageTemplateZonesContent_Delete");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();

                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePageTemplateZonesContent dbInteraction = new DINT_WebSitePageTemplateZonesContent(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePageTemplateZonesContent.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageTemplateZonesContent.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {
                                        //ViewBag.iParentID = recRecord.iParentID;
                                        //ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;
                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }

                        return RedirectToAction("WebSitePageTemplateZonesContent_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }
                    else
                    {
                        return RedirectToAction("WebSitePageTemplateZonesContent_List", new { _iParentID = iParentID, _sParentID = sParentID });
                    }

                    #endregion
                }
                else
                {
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePageTemplateZonesContent_History

        string sWebSitePageTemplateZonesContent_History_Details = "/views/Forms/WebSitePageTemplateZonesContent_History_Details.cshtml";
        string sWebSitePageTemplateZonesContent_History_List = "/views/Forms/WebSitePageTemplateZonesContent_History_List.cshtml";


        public ActionResult WebSitePageTemplateZonesContent_History_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSitePageTemplateZonesContent_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZonesContent_History_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePageTemplateZonesContent_History dbInteraction = new DINT_WebSitePageTemplateZonesContent_History(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePageTemplateZonesContent_History.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePageTemplateZonesContent_History.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageTemplateZonesContent_History_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePageTemplateZonesContent_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZonesContent_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageTemplateZonesContent_History dbInteraction = new DINT_WebSitePageTemplateZonesContent_History(oSystem.cnCon);
                        List<DEF_WebSitePageTemplateZonesContent_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageTemplateZonesContent_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePageTemplateZonesContent_History dbInteraction = new DINT_WebSitePageTemplateZonesContent_History(oSystem.cnCon);
                        List<DEF_WebSitePageTemplateZonesContent_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageTemplateZonesContent_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSitePageTemplateZonesContent_History_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSitePageTemplateZonesContent_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZonesContent_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSitePageTemplateZonesContent_History.RecordObject recRecord = new DEF_WebSitePageTemplateZonesContent_History.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageTemplateZonesContent_History_Restore(DEF_WebSitePageTemplateZonesContent_History.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSitePageTemplateZonesContent_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                int iUserID = 0;
                string sUserID = "";
                #region Set Current User info to veriables to be used for record tracking
                try
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView != null)
                        {
                            if (oSystem.CurrentUser.UserView.User != null)
                            {
                                if (oSystem.CurrentUser.UserView.User.ID > 0)
                                {
                                    iUserID = oSystem.CurrentUser.UserView.User.ID;
                                    sUserID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName + "(" + oSystem.CurrentUser.UserView.User.sUserName + ")";
                                }
                            }
                        }
                    }
                }
                catch
                {

                }
                #endregion

                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZonesContent_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID > 0))
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;


                            #region
                            ViewBag.bError = false;
                            ViewBag.bAddNew = false;
                            ViewBag.bSaved = true;
                            ViewBag.sErrorMessage = "";
                            oSystem.OpenDataConnection();


                            DINT_WebSitePageTemplateZonesContent dbInteraction = new DINT_WebSitePageTemplateZonesContent(oSystem.cnCon);
                            DEF_WebSitePageTemplateZonesContent.RecordObject _rec_Restor = null;

                            List<DEF_WebSitePageTemplateZonesContent.RecordObject> lstSearch = null;
                            List<DataParameter> lstParameters = new List<DataParameter>();
                            DataParameter pParameter = null;


                            pParameter = new DataParameter("ID", "'" + _rec.iParentID + "'", "string", 1, "ID", " = ", "");
                            lstParameters.Add(pParameter);


                            lstSearch = dbInteraction.Get(lstParameters);

                            DINT_WebSitePageTemplateZonesContent_History dbWebSitePageTemplateZonesContent_History = new DINT_WebSitePageTemplateZonesContent_History(oSystem.cnCon);
                            DEF_WebSitePageTemplateZonesContent_History.RecordObject rec_WebSitePageTemplateZonesContent_History = new DEF_WebSitePageTemplateZonesContent_History.RecordObject();
                            rec_WebSitePageTemplateZonesContent_History.sControl = Guid.NewGuid().ToString();
                            rec_WebSitePageTemplateZonesContent_History.iParentID = _rec.iParentID;
                            rec_WebSitePageTemplateZonesContent_History.sParentID = _rec.sParentID;

                            rec_WebSitePageTemplateZonesContent_History.dtDateCreated = DateTime.Now;
                            rec_WebSitePageTemplateZonesContent_History.dtLastUpdated = DateTime.Now;
                            rec_WebSitePageTemplateZonesContent_History.iCreatedByID = iUserID;
                            rec_WebSitePageTemplateZonesContent_History.sCreatedByID = sUserID;
                            rec_WebSitePageTemplateZonesContent_History.iUpdatedByID = iUserID;
                            rec_WebSitePageTemplateZonesContent_History.sUpdatedByID = sUserID;

                            #region Transfer old values from old record found using the duplicate check
                            try
                            {
                                if (lstSearch != null)
                                {
                                    if (lstSearch.Count > 0)
                                    {
                                        foreach (DEF_WebSitePageTemplateZonesContent.RecordObject oR in lstSearch)
                                        {
                                            if (oR.ID == _rec.iParentID)
                                            {
                                                rec_WebSitePageTemplateZonesContent_History.sName = oR.sName;
                                                rec_WebSitePageTemplateZonesContent_History.iTypeID = oR.iTypeID;
                                                rec_WebSitePageTemplateZonesContent_History.sTypeID = oR.sTypeID;
                                                rec_WebSitePageTemplateZonesContent_History.sCodeName = oR.sCodeName;
                                                rec_WebSitePageTemplateZonesContent_History.sDefaultValue = oR.sDefaultValue;
                                                rec_WebSitePageTemplateZonesContent_History.iLanguageID = oR.iLanguageID;
                                                rec_WebSitePageTemplateZonesContent_History.sLanguageID = oR.sLanguageID;
                                                rec_WebSitePageTemplateZonesContent_History.iContentZoneID = oR.iContentZoneID;
                                                rec_WebSitePageTemplateZonesContent_History.sContentZoneID = oR.sContentZoneID;
                                                rec_WebSitePageTemplateZonesContent_History.bPrimaryContentArea = oR.bPrimaryContentArea;

                                                _rec_Restor = oR;
                                            }
                                        }
                                    }
                                }
                            }
                            catch
                            {

                            }
                            #endregion

                            dbWebSitePageTemplateZonesContent_History.Insert_SQL(rec_WebSitePageTemplateZonesContent_History);


                            //restor values
                            _rec_Restor.sName = _rec.sName;
                            _rec_Restor.iTypeID = _rec.iTypeID;
                            _rec_Restor.sTypeID = _rec.sTypeID;
                            _rec_Restor.sCodeName = _rec.sCodeName;
                            _rec_Restor.sDefaultValue = _rec.sDefaultValue;
                            _rec_Restor.iLanguageID = _rec.iLanguageID;
                            _rec_Restor.sLanguageID = _rec.sLanguageID;
                            _rec_Restor.iContentZoneID = _rec.iContentZoneID;
                            _rec_Restor.sContentZoneID = _rec.sContentZoneID;
                            _rec_Restor.bPrimaryContentArea = _rec.bPrimaryContentArea;

                            _rec_Restor.dtLastUpdated = DateTime.Now;
                            _rec_Restor.iUpdatedByID = iUserID;
                            _rec_Restor.sUpdatedByID = sUserID;

                            dbInteraction.Update_SQL(_rec_Restor);

                            oSystem.CloseDataConnection();
                            #endregion
                            return RedirectToAction("WebSitePageTemplateZonesContent_Details", new { id = _rec_Restor.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePageTemplateZonesContent_History_AddUpdate(DEF_WebSitePageTemplateZonesContent_History.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSitePageTemplateZonesContent_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePageTemplateZonesContent_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePageTemplateZonesContent_History dbInteraction = new DINT_WebSitePageTemplateZonesContent_History(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSitePageTemplateZonesContent_History_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePageTemplateZonesContent_History dbInteraction = new DINT_WebSitePageTemplateZonesContent_History(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSitePageTemplateZonesContent_History_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePageTemplateZonesContent_History_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePageTemplateZonesContent_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePageTemplateZonesContent_History dbInteraction = new DINT_WebSitePageTemplateZonesContent_History(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePageTemplateZonesContent_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePageTemplateZonesContent_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSitePageTemplateZonesContent_History_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSitePageTemplateZonesContent_History_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteJobApplicant

        string sWebSiteJobApplicant_Details = "/views/Forms/WebSiteJobApplicant_Details.cshtml";
        string sWebSiteJobApplicant_List = "/views/Forms/WebSiteJobApplicant_List.cshtml";


        public ActionResult WebSiteJobApplicant_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteJobApplicant");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJobApplicant_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteJobApplicant dbInteraction = new DINT_WebSiteJobApplicant(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteJobApplicant.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteJobApplicant.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteJobApplicant_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteJobApplicant");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJobApplicant_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteJobApplicant dbInteraction = new DINT_WebSiteJobApplicant(oSystem.cnCon);
                        List<DEF_WebSiteJobApplicant.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteJobApplicant.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteJobApplicant dbInteraction = new DINT_WebSiteJobApplicant(oSystem.cnCon);
                        List<DEF_WebSiteJobApplicant.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteJobApplicant.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteJobApplicant_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteJobApplicant");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJobApplicant_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteJobApplicant.RecordObject recRecord = new DEF_WebSiteJobApplicant.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteJobApplicant_AddUpdate(DEF_WebSiteJobApplicant.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteJobApplicant");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJobApplicant_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteJobApplicant dbInteraction = new DINT_WebSiteJobApplicant(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtDateUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteJobApplicant_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteJobApplicant dbInteraction = new DINT_WebSiteJobApplicant(oSystem.cnCon);
                                    _rec.dtDateUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteJobApplicant_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteJobApplicant_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteJobApplicant");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteJobApplicant dbInteraction = new DINT_WebSiteJobApplicant(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteJobApplicant.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteJobApplicant.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteJobApplicant_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteJobApplicant_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteJobEvents

        string sWebSiteJobEvents_Details = "/views/Forms/WebSiteJobEvents_Details.cshtml";
        string sWebSiteJobEvents_List = "/views/Forms/WebSiteJobEvents_List.cshtml";


        public ActionResult WebSiteJobEvents_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteJobEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJobEvents_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteJobEvents dbInteraction = new DINT_WebSiteJobEvents(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteJobEvents.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteJobEvents.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteJobEvents_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteJobEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJobEvents_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteJobEvents dbInteraction = new DINT_WebSiteJobEvents(oSystem.cnCon);
                        List<DEF_WebSiteJobEvents.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteJobEvents.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteJobEvents dbInteraction = new DINT_WebSiteJobEvents(oSystem.cnCon);
                        List<DEF_WebSiteJobEvents.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteJobEvents.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteJobEvents_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteJobEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJobEvents_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteJobEvents.RecordObject recRecord = new DEF_WebSiteJobEvents.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteJobEvents_AddUpdate(DEF_WebSiteJobEvents.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteJobEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJobEvents_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteJobEvents dbInteraction = new DINT_WebSiteJobEvents(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteJobEvents_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteJobEvents dbInteraction = new DINT_WebSiteJobEvents(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteJobEvents_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteJobEvents_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteJobEvents");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteJobEvents dbInteraction = new DINT_WebSiteJobEvents(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteJobEvents.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteJobEvents.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteJobEvents_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteJobEvents_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteJobs

        string sWebSiteJobs_Details = "/views/Forms/WebSiteJobs_Details.cshtml";
        string sWebSiteJobs_List = "/views/Forms/WebSiteJobs_List.cshtml";


        public ActionResult WebSiteJobs_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteJobs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJobs_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteJobs dbInteraction = new DINT_WebSiteJobs(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteJobs.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteJobs.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteJobs_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteJobs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJobs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteJobs dbInteraction = new DINT_WebSiteJobs(oSystem.cnCon);
                        List<DEF_WebSiteJobs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteJobs.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteJobsViewModel recRecord = new WebSiteJobsViewModel();
                                recRecord.WebSiteJobs = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteJobs.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteJobs.sParentID;

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteJobs dbInteraction = new DINT_WebSiteJobs(oSystem.cnCon);
                        List<DEF_WebSiteJobs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteJobs.RecordObject recRecord = dbSearch[0];
                                ACMSDBView.WebSiteJobsViewModel recRecord = new WebSiteJobsViewModel();
                                recRecord.WebSiteJobs = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteJobs.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteJobs.sParentID;

                                recRecord.Get_WebSiteQuestionair(oSystem.cnCon);



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteJobs_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteJobs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJobs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";

                    ACMSDBView.WebSiteJobsViewModel recRecord = new WebSiteJobsViewModel();
                    //DEF_WebSiteJobs.RecordObject recRecord = new DEF_WebSiteJobs.RecordObject();


                    recRecord.WebSiteJobs.iParentID = _iParentID;
                    recRecord.WebSiteJobs.sParentID = _sParentID;


                    recRecord.Get_WebSiteQuestionair(oSystem.cnCon);



                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteJobs_AddUpdate(ACMSDBView.WebSiteJobsViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteJobs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJobs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteJobs.ID == null) || (_rec.WebSiteJobs.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteJobs.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSiteJobs.iParentID;
                            ViewBag.sParentID = _rec.WebSiteJobs.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteJobs dbInteraction = new DINT_WebSiteJobs(oSystem.cnCon);

                                _rec.WebSiteJobs.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteJobs.dtDateCreated = DateTime.Now;
                                _rec.WebSiteJobs.dtDateUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteJobs);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteJobs_Details", new { key = _rec.WebSiteJobs.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteJobs.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteJobs dbInteraction = new DINT_WebSiteJobs(oSystem.cnCon);
                                    _rec.WebSiteJobs.dtDateUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteJobs);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteJobs_Details", new { id = _rec.WebSiteJobs.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteJobs_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteJobs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteJobs dbInteraction = new DINT_WebSiteJobs(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteJobs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteJobs.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteJobs_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteJobs_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSite_Messaging

        string sWebSite_Messaging_Details = "/views/Forms/WebSite_Messaging_Details.cshtml";
        string sWebSite_Messaging_List = "/views/Forms/WebSite_Messaging_List.cshtml";


        public ActionResult WebSite_Messaging_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSite_Messaging");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_Messaging_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSite_Messaging dbInteraction = new DINT_WebSite_Messaging(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSite_Messaging.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSite_Messaging.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSite_Messaging_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSite_Messaging");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_Messaging_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSite_Messaging dbInteraction = new DINT_WebSite_Messaging(oSystem.cnCon);
                        List<DEF_WebSite_Messaging.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSite_Messaging.RecordObject recRecord = dbSearch[0];
                                AriesCMS.Models.WebSite_MessagingDBView recRecord = new Models.WebSite_MessagingDBView();
                                recRecord.WebSite_Messaging = dbSearch[0];

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                recRecord.Get_CountryLanguages(oSystem.cnCon);

                                ViewBag.iParentID = recRecord.WebSite_Messaging.iParentID;
                                ViewBag.sParentID = recRecord.WebSite_Messaging.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSite_Messaging dbInteraction = new DINT_WebSite_Messaging(oSystem.cnCon);
                        List<DEF_WebSite_Messaging.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSite_Messaging.RecordObject recRecord = dbSearch[0];
                                AriesCMS.Models.WebSite_MessagingDBView recRecord = new Models.WebSite_MessagingDBView();
                                recRecord.WebSite_Messaging = dbSearch[0];

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                recRecord.Get_CountryLanguages(oSystem.cnCon);

                                ViewBag.iParentID = recRecord.WebSite_Messaging.iParentID;
                                ViewBag.sParentID = recRecord.WebSite_Messaging.sParentID;




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSite_Messaging_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSite_Messaging");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_Messaging_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    //DEF_WebSite_Messaging.RecordObject recRecord = new DEF_WebSite_Messaging.RecordObject();

                    AriesCMS.Models.WebSite_MessagingDBView recRecord = new Models.WebSite_MessagingDBView();
                    recRecord.Get_CountryLanguages(oSystem.cnCon);

                    recRecord.WebSite_Messaging.iParentID = _iParentID;
                    recRecord.WebSite_Messaging.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSite_Messaging_AddUpdate(AriesCMS.Models.WebSite_MessagingDBView _rec)
        {
            Set_Client_NavSettings("WebSite_Messaging");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                int iUserID = 0;
                string sUserID = "";
                #region Set Current User info to veriables to be used for record tracking
                try
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView != null)
                        {
                            if (oSystem.CurrentUser.UserView.User != null)
                            {
                                if (oSystem.CurrentUser.UserView.User.ID > 0)
                                {
                                    iUserID = oSystem.CurrentUser.UserView.User.ID;
                                    sUserID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName + "(" + oSystem.CurrentUser.UserView.User.sUserName + ")";
                                }
                            }
                        }
                    }
                }
                catch
                {

                }
                #endregion

                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_Messaging_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSite_Messaging.ID == null) || (_rec.WebSite_Messaging.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSite_Messaging.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSite_Messaging.iParentID;
                            ViewBag.sParentID = _rec.WebSite_Messaging.sParentID;

                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSite_Messaging dbInteraction = new DINT_WebSite_Messaging(oSystem.cnCon);

                                _rec.WebSite_Messaging.sControl = Guid.NewGuid().ToString();
                                _rec.WebSite_Messaging.dtDateCreated = DateTime.Now;
                                _rec.WebSite_Messaging.dtLastUpdated = DateTime.Now;
                                _rec.WebSite_Messaging.iCreatedByID = iUserID;
                                _rec.WebSite_Messaging.sCreatedByID = sUserID;
                                _rec.WebSite_Messaging.iUpdatedByID = iUserID;
                                _rec.WebSite_Messaging.sUpdatedByID = sUserID;

                                dbInteraction.Insert_SQL(_rec.WebSite_Messaging);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSite_Messaging_Details", new { key = _rec.WebSite_Messaging.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSite_Messaging.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSite_Messaging dbInteraction = new DINT_WebSite_Messaging(oSystem.cnCon);


                                    List<DEF_WebSite_Messaging.RecordObject> lstSearch = null;
                                    List<DataParameter> lstParameters = new List<DataParameter>();
                                    DataParameter pParameter = null;


                                    pParameter = new DataParameter("sControl", "'" + _rec.WebSite_Messaging.sControl + "'", "string", 1, "sControl", " = ", "");
                                    lstParameters.Add(pParameter);


                                    lstSearch = dbInteraction.Get(lstParameters);

                                    DINT_WebSite_Messaging_History dbWebSite_Messaging_History = new DINT_WebSite_Messaging_History(oSystem.cnCon);
                                    DEF_WebSite_Messaging_History.RecordObject rec_WebSite_Messaging_History = new DEF_WebSite_Messaging_History.RecordObject();
                                    rec_WebSite_Messaging_History.sControl = Guid.NewGuid().ToString();
                                    rec_WebSite_Messaging_History.iParentID = _rec.WebSite_Messaging.ID;
                                    rec_WebSite_Messaging_History.sParentID = _rec.WebSite_Messaging.sName;

                                    rec_WebSite_Messaging_History.dtDateCreated = DateTime.Now;
                                    rec_WebSite_Messaging_History.dtLastUpdated = DateTime.Now;
                                    rec_WebSite_Messaging_History.iCreatedByID = iUserID;
                                    rec_WebSite_Messaging_History.sCreatedByID = sUserID;
                                    rec_WebSite_Messaging_History.iUpdatedByID = iUserID;
                                    rec_WebSite_Messaging_History.sUpdatedByID = sUserID;

                                    #region Transfer old values from old record found using the duplicate check
                                    try
                                    {
                                        if (lstSearch != null)
                                        {
                                            if (lstSearch.Count > 0)
                                            {
                                                foreach (DEF_WebSite_Messaging.RecordObject oR in lstSearch)
                                                {
                                                    if (oR.ID == _rec.WebSite_Messaging.ID)
                                                    {
                                                        rec_WebSite_Messaging_History.sName = oR.sName;
                                                        rec_WebSite_Messaging_History.sContent = oR.sContent;
                                                        rec_WebSite_Messaging_History.sLoadIncludeURI = oR.sLoadIncludeURI;
                                                        rec_WebSite_Messaging_History.bLoadPartialPage = oR.bLoadPartialPage;
                                                        rec_WebSite_Messaging_History.iLanguageID = oR.iLanguageID;
                                                        rec_WebSite_Messaging_History.sLanguageID = oR.sLanguageID;
                                                        rec_WebSite_Messaging_History.sLoadIncludeURI = oR.sLoadIncludeURI;
                                                        rec_WebSite_Messaging_History.sSubject = oR.sSubject;
                                                        rec_WebSite_Messaging_History.sFromName = oR.sFromName;
                                                        rec_WebSite_Messaging_History.sFromEmail = oR.sFromEmail;
                                                        rec_WebSite_Messaging_History.sMessageBody = oR.sMessageBody;
                                                        rec_WebSite_Messaging_History.sAttachementURI1 = oR.sAttachementURI1;
                                                        rec_WebSite_Messaging_History.sAttachementURL1 = oR.sAttachementURL1;
                                                        rec_WebSite_Messaging_History.sAttachementURI2 = oR.sAttachementURI2;
                                                        rec_WebSite_Messaging_History.sAttachementURL2 = oR.sAttachementURL2;
                                                        rec_WebSite_Messaging_History.sAttachementURI3 = oR.sAttachementURI3;
                                                        rec_WebSite_Messaging_History.sAttachementURL3 = oR.sAttachementURL3;
                                                        rec_WebSite_Messaging_History.sAttachementURI4 = oR.sAttachementURI4;
                                                        rec_WebSite_Messaging_History.sAttachementURL4 = oR.sAttachementURL4;
                                                        rec_WebSite_Messaging_History.sAttachementURI5 = oR.sAttachementURI5;
                                                        rec_WebSite_Messaging_History.sAttachementURL5 = oR.sAttachementURL5;
                                                        rec_WebSite_Messaging_History.sAttachementURI6 = oR.sAttachementURI6;
                                                        rec_WebSite_Messaging_History.sAttachementURL6 = oR.sAttachementURL6;
                                                        rec_WebSite_Messaging_History.sAttachementURI7 = oR.sAttachementURI7;
                                                        rec_WebSite_Messaging_History.sAttachementURL7 = oR.sAttachementURL7;


                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {

                                    }
                                    #endregion

                                    dbWebSite_Messaging_History.Insert_SQL(rec_WebSite_Messaging_History);

                                    _rec.WebSite_Messaging.dtLastUpdated = DateTime.Now;
                                    _rec.WebSite_Messaging.iUpdatedByID = iUserID;
                                    _rec.WebSite_Messaging.sUpdatedByID = sUserID;

                                    dbInteraction.Update_SQL(_rec.WebSite_Messaging);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSite_Messaging_Details", new { id = _rec.WebSite_Messaging.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSite_Messaging_Delete(int id)
        {
            Set_Client_NavSettings("WebSite_Messaging");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSite_Messaging dbInteraction = new DINT_WebSite_Messaging(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSite_Messaging.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSite_Messaging.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSite_Messaging_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSite_Messaging_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSite_Messaging_History

        string sWebSite_Messaging_History_Details = "/views/Forms/WebSite_Messaging_History_Details.cshtml";
        string sWebSite_Messaging_History_List = "/views/Forms/WebSite_Messaging_History_List.cshtml";

        public ActionResult WebSite_Messaging_History_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSite_Messaging_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_Messaging_History_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSite_Messaging_History dbInteraction = new DINT_WebSite_Messaging_History(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSite_Messaging_History.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSite_Messaging_History.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSite_Messaging_History_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSite_Messaging_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_Messaging_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSite_Messaging_History dbInteraction = new DINT_WebSite_Messaging_History(oSystem.cnCon);
                        List<DEF_WebSite_Messaging_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSite_Messaging_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSite_Messaging_History dbInteraction = new DINT_WebSite_Messaging_History(oSystem.cnCon);
                        List<DEF_WebSite_Messaging_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSite_Messaging_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSite_Messaging_History_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSite_Messaging_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_Messaging_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSite_Messaging_History.RecordObject recRecord = new DEF_WebSite_Messaging_History.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSite_Messaging_History_Restore(DEF_WebSite_Messaging_History.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSite_Messaging_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                int iUserID = 0;
                string sUserID = "";
                #region Set Current User info to veriables to be used for record tracking
                try
                {
                    if (oSystem.CurrentUser != null)
                    {
                        if (oSystem.CurrentUser.UserView != null)
                        {
                            if (oSystem.CurrentUser.UserView.User != null)
                            {
                                if (oSystem.CurrentUser.UserView.User.ID > 0)
                                {
                                    iUserID = oSystem.CurrentUser.UserView.User.ID;
                                    sUserID = oSystem.CurrentUser.UserView.User.sFName + " " + oSystem.CurrentUser.UserView.User.sLName + "(" + oSystem.CurrentUser.UserView.User.sUserName + ")";
                                }
                            }
                        }
                    }
                }
                catch
                {

                }
                #endregion

                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_Messaging_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID > 0))
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;


                            #region
                            ViewBag.bError = false;
                            ViewBag.bAddNew = false;
                            ViewBag.bSaved = true;
                            ViewBag.sErrorMessage = "";
                            oSystem.OpenDataConnection();


                            DINT_WebSite_Messaging dbInteraction = new DINT_WebSite_Messaging(oSystem.cnCon);
                            DEF_WebSite_Messaging.RecordObject _rec_Restor = null;

                            List<DEF_WebSite_Messaging.RecordObject> lstSearch = null;
                            List<DataParameter> lstParameters = new List<DataParameter>();
                            DataParameter pParameter = null;


                            pParameter = new DataParameter("ID", "'" + _rec.iParentID + "'", "string", 1, "ID", " = ", "");
                            lstParameters.Add(pParameter);


                            lstSearch = dbInteraction.Get(lstParameters);

                            DINT_WebSite_Messaging_History dbWebSite_Messaging_History = new DINT_WebSite_Messaging_History(oSystem.cnCon);
                            DEF_WebSite_Messaging_History.RecordObject rec_WebSite_Messaging_History = new DEF_WebSite_Messaging_History.RecordObject();
                            rec_WebSite_Messaging_History.sControl = Guid.NewGuid().ToString();
                            rec_WebSite_Messaging_History.iParentID = _rec.iParentID;
                            rec_WebSite_Messaging_History.sParentID = _rec.sParentID;

                            rec_WebSite_Messaging_History.dtDateCreated = DateTime.Now;
                            rec_WebSite_Messaging_History.dtLastUpdated = DateTime.Now;
                            rec_WebSite_Messaging_History.iCreatedByID = iUserID;
                            rec_WebSite_Messaging_History.sCreatedByID = sUserID;
                            rec_WebSite_Messaging_History.iUpdatedByID = iUserID;
                            rec_WebSite_Messaging_History.sUpdatedByID = sUserID;

                            #region Transfer old values from old record found using the duplicate check
                            try
                            {
                                if (lstSearch != null)
                                {
                                    if (lstSearch.Count > 0)
                                    {
                                        foreach (DEF_WebSite_Messaging.RecordObject oR in lstSearch)
                                        {
                                            if (oR.ID == _rec.iParentID)
                                            {
                                                rec_WebSite_Messaging_History.sName = oR.sName;
                                                rec_WebSite_Messaging_History.sContent = oR.sContent;
                                                rec_WebSite_Messaging_History.sLoadIncludeURI = oR.sLoadIncludeURI;
                                                rec_WebSite_Messaging_History.bLoadPartialPage = oR.bLoadPartialPage;
                                                rec_WebSite_Messaging_History.iLanguageID = oR.iLanguageID;
                                                rec_WebSite_Messaging_History.sLanguageID = oR.sLanguageID;
                                                rec_WebSite_Messaging_History.sLoadIncludeURI = oR.sLoadIncludeURI;
                                                rec_WebSite_Messaging_History.sSubject = oR.sSubject;
                                                rec_WebSite_Messaging_History.sFromName = oR.sFromName;
                                                rec_WebSite_Messaging_History.sFromEmail = oR.sFromEmail;
                                                rec_WebSite_Messaging_History.sMessageBody = oR.sMessageBody;
                                                rec_WebSite_Messaging_History.sAttachementURI1 = oR.sAttachementURI1;
                                                rec_WebSite_Messaging_History.sAttachementURL1 = oR.sAttachementURL1;
                                                rec_WebSite_Messaging_History.sAttachementURI2 = oR.sAttachementURI2;
                                                rec_WebSite_Messaging_History.sAttachementURL2 = oR.sAttachementURL2;
                                                rec_WebSite_Messaging_History.sAttachementURI3 = oR.sAttachementURI3;
                                                rec_WebSite_Messaging_History.sAttachementURL3 = oR.sAttachementURL3;
                                                rec_WebSite_Messaging_History.sAttachementURI4 = oR.sAttachementURI4;
                                                rec_WebSite_Messaging_History.sAttachementURL4 = oR.sAttachementURL4;
                                                rec_WebSite_Messaging_History.sAttachementURI5 = oR.sAttachementURI5;
                                                rec_WebSite_Messaging_History.sAttachementURL5 = oR.sAttachementURL5;
                                                rec_WebSite_Messaging_History.sAttachementURI6 = oR.sAttachementURI6;
                                                rec_WebSite_Messaging_History.sAttachementURL6 = oR.sAttachementURL6;
                                                rec_WebSite_Messaging_History.sAttachementURI7 = oR.sAttachementURI7;
                                                rec_WebSite_Messaging_History.sAttachementURL7 = oR.sAttachementURL7;

                                                _rec_Restor = oR;
                                            }
                                        }
                                    }
                                }
                            }
                            catch
                            {

                            }
                            #endregion

                            dbWebSite_Messaging_History.Insert_SQL(rec_WebSite_Messaging_History);


                            //restor values
                            _rec_Restor.sName = _rec.sName;
                            _rec_Restor.sContent = _rec.sContent;
                            _rec_Restor.sLoadIncludeURI = _rec.sLoadIncludeURI;
                            _rec_Restor.bLoadPartialPage = _rec.bLoadPartialPage;
                            _rec_Restor.iLanguageID = _rec.iLanguageID;
                            _rec_Restor.sLanguageID = _rec.sLanguageID;
                            _rec_Restor.sLoadIncludeURI = _rec.sLoadIncludeURI;
                            _rec_Restor.sSubject = _rec.sSubject;
                            _rec_Restor.sFromName = _rec.sFromName;
                            _rec_Restor.sFromEmail = _rec.sFromEmail;
                            _rec_Restor.sMessageBody = _rec.sMessageBody;
                            _rec_Restor.sAttachementURI1 = _rec.sAttachementURI1;
                            _rec_Restor.sAttachementURL1 = _rec.sAttachementURL1;
                            _rec_Restor.sAttachementURI2 = _rec.sAttachementURI2;
                            _rec_Restor.sAttachementURL2 = _rec.sAttachementURL2;
                            _rec_Restor.sAttachementURI3 = _rec.sAttachementURI3;
                            _rec_Restor.sAttachementURL3 = _rec.sAttachementURL3;
                            _rec_Restor.sAttachementURI4 = _rec.sAttachementURI4;
                            _rec_Restor.sAttachementURL4 = _rec.sAttachementURL4;
                            _rec_Restor.sAttachementURI5 = _rec.sAttachementURI5;
                            _rec_Restor.sAttachementURL5 = _rec.sAttachementURL5;
                            _rec_Restor.sAttachementURI6 = _rec.sAttachementURI6;
                            _rec_Restor.sAttachementURL6 = _rec.sAttachementURL6;
                            _rec_Restor.sAttachementURI7 = _rec.sAttachementURI7;
                            _rec_Restor.sAttachementURL7 = _rec.sAttachementURL7;

                            _rec_Restor.dtLastUpdated = DateTime.Now;
                            _rec_Restor.iUpdatedByID = iUserID;
                            _rec_Restor.sUpdatedByID = sUserID;

                            dbInteraction.Update_SQL(_rec_Restor);

                            oSystem.CloseDataConnection();
                            #endregion
                            return RedirectToAction("WebSite_Messaging_Details", new { id = _rec_Restor.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSite_Messaging_History_AddUpdate(DEF_WebSite_Messaging_History.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSite_Messaging_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSite_Messaging_History_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSite_Messaging_History dbInteraction = new DINT_WebSite_Messaging_History(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSite_Messaging_History_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSite_Messaging_History dbInteraction = new DINT_WebSite_Messaging_History(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSite_Messaging_History_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSite_Messaging_History_Delete(int id)
        {
            Set_Client_NavSettings("WebSite_Messaging_History");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSite_Messaging_History dbInteraction = new DINT_WebSite_Messaging_History(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSite_Messaging_History.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSite_Messaging_History.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSite_Messaging_History_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSite_Messaging_History_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteMemberShips
        string sWebSiteMemberShips_Details = "/views/Forms/WebSiteMemberShips_Details.cshtml";
        string sWebSiteMemberShips_List = "/views/Forms/WebSiteMemberShips_List.cshtml";


        public ActionResult WebSiteMemberShips_List(FormCollection fc, string Search, int page = 1)

        {
            Set_Client_NavSettings("WebSiteMemberShips");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteMemberShips_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteMemberShips dbInteraction = new DINT_WebSiteMemberShips(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteMemberShips.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteMemberShips.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteMemberShips_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteMemberShips");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteMemberShips_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteMemberShips dbInteraction = new DINT_WebSiteMemberShips(oSystem.cnCon);
                        List<DEF_WebSiteMemberShips.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteMemberShips.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteMemberShips dbInteraction = new DINT_WebSiteMemberShips(oSystem.cnCon);
                        List<DEF_WebSiteMemberShips.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteMemberShips.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteMemberShips_Create()

        {
            Set_Client_NavSettings("WebSiteMemberShips");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process




                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteMemberShips_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteMemberShips.RecordObject recRecord = new DEF_WebSiteMemberShips.RecordObject();








                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteMemberShips_AddUpdate(FormCollection fc, HttpPostedFileBase UploadFiles1, HttpPostedFileBase UploadFiles2, HttpPostedFileBase UploadFiles3, DEF_WebSiteMemberShips.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteMemberShips");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            string sFileUploadResults = "";

            bool bFileUploadError1 = false;
            bool bFileUploadError2 = false;
            bool bFileUploadError3 = false;
            string sImageURL1 = "";
            string sImageURL2 = "";
            string sImageURL3 = "";
            string sPrefix = "";

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteMemberShips_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteMemberShips dbInteraction = new DINT_WebSiteMemberShips(oSystem.cnCon);

                                #region Upload file - Image Thumbnail
                                try
                                {
                                    if (UploadFiles1 != null)
                                    {
                                        if (UploadFiles1.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                            {
                                                string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                    _rec.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                    _rec.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Medium
                                try
                                {
                                    if (UploadFiles2 != null)
                                    {
                                        if (UploadFiles2.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                            {
                                                string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    sImageURL2 = "Uploads/" + UploadFiles2.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                    _rec.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                    _rec.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Large
                                try
                                {
                                    if (UploadFiles3 != null)
                                    {
                                        if (UploadFiles3.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                            {
                                                string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    sImageURL3 = "Uploads/" + UploadFiles3.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                    _rec.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                    UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                    _rec.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteMemberShips_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteMemberShips dbInteraction = new DINT_WebSiteMemberShips(oSystem.cnCon);

                                    #region Upload file - Image Thumbnail
                                    try
                                    {
                                        if (UploadFiles1 != null)
                                        {
                                            if (UploadFiles1.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                                {
                                                    string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                        sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                        _rec.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                        _rec.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Medium
                                    try
                                    {
                                        if (UploadFiles2 != null)
                                        {
                                            if (UploadFiles2.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                                {
                                                    string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                        sImageURL2 = "Uploads/" + UploadFiles2.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                        _rec.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                        _rec.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Large
                                    try
                                    {
                                        if (UploadFiles3 != null)
                                        {
                                            if (UploadFiles3.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                                {
                                                    string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                        sImageURL3 = "Uploads/" + UploadFiles3.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                        _rec.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                        UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                        _rec.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteMemberShips_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteMemberShips_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteMemberShips");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteMemberShips dbInteraction = new DINT_WebSiteMemberShips(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteMemberShips.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteMemberShips.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {




                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteMemberShips_List");


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteMemberShips_List");

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteMemberCats

        string sWebSiteMemberCats_Details = "/views/Forms/WebSiteMemberCats_Details.cshtml";
        string sWebSiteMemberCats_List = "/views/Forms/WebSiteMemberCats_List.cshtml";


        public ActionResult WebSiteMemberCats_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteMemberCats");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteMemberCats_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteMemberCats dbInteraction = new DINT_WebSiteMemberCats(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteMemberCats.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteMemberCats.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteMemberCats_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteMemberCats");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteMemberCats_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteMemberCats dbInteraction = new DINT_WebSiteMemberCats(oSystem.cnCon);
                        List<DEF_WebSiteMemberCats.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteMemberCats.RecordObject recRecord = dbSearch[0];
                                AriesCMS.Models.WebSiteMemberCatsDBView recRecord = new Models.WebSiteMemberCatsDBView();
                                recRecord.WebSiteMemberCats = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                recRecord.Get_WebSiteMemberShipsCategories(oSystem.cnCon);

                                ViewBag.iParentID = recRecord.WebSiteMemberCats.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteMemberCats.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteMemberCats dbInteraction = new DINT_WebSiteMemberCats(oSystem.cnCon);
                        List<DEF_WebSiteMemberCats.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteMemberCats.RecordObject recRecord = dbSearch[0];
                                AriesCMS.Models.WebSiteMemberCatsDBView recRecord = new Models.WebSiteMemberCatsDBView();
                                recRecord.WebSiteMemberCats = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                recRecord.Get_WebSiteMemberShipsCategories(oSystem.cnCon);

                                ViewBag.iParentID = recRecord.WebSiteMemberCats.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteMemberCats.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }


        public ActionResult WebSiteMemberCats_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteMemberCats");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteMemberCats_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    //DEF_WebSiteMemberCats.RecordObject recRecord = new DEF_WebSiteMemberCats.RecordObject();
                    AriesCMS.Models.WebSiteMemberCatsDBView recRecord = new Models.WebSiteMemberCatsDBView();

                    recRecord.WebSiteMemberCats.iParentID = _iParentID;
                    recRecord.WebSiteMemberCats.sParentID = _sParentID;

                    recRecord.Get_WebSiteMemberShipsCategories(oSystem.cnCon);




                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteMemberCats_AddUpdate(AriesCMS.Models.WebSiteMemberCatsDBView _rec)
        {
            Set_Client_NavSettings("WebSiteMemberCats");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteMemberCats_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteMemberCats.ID == null) || (_rec.WebSiteMemberCats.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteMemberCats.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSiteMemberCats.iParentID;
                            ViewBag.sParentID = _rec.WebSiteMemberCats.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteMemberCats dbInteraction = new DINT_WebSiteMemberCats(oSystem.cnCon);

                                _rec.WebSiteMemberCats.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteMemberCats.dtDateCreated = DateTime.Now;
                                _rec.WebSiteMemberCats.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteMemberCats);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteMemberCats_Details", new { key = _rec.WebSiteMemberCats.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteMemberCats.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteMemberCats dbInteraction = new DINT_WebSiteMemberCats(oSystem.cnCon);
                                    _rec.WebSiteMemberCats.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteMemberCats);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteMemberCats_Details", new { id = _rec.WebSiteMemberCats.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteMemberCats_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteMemberCats");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteMemberCats dbInteraction = new DINT_WebSiteMemberCats(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteMemberCats.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteMemberCats.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteMemberCats_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteMemberCats_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteMembers
        string sWebSiteMembers_Details = "/views/Forms/WebSiteMembers_Details.cshtml";
        string sWebSiteMembers_List = "/views/Forms/WebSiteMembers_List.cshtml";


        public ActionResult WebSiteMembers_List(FormCollection fc, string Search, int page = 1)
        {
            Set_Client_NavSettings("WebSiteMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteMembers_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteMembers dbInteraction = new DINT_WebSiteMembers(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteMembers.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteMembers.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteMembers_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteMembers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteMembers dbInteraction = new DINT_WebSiteMembers(oSystem.cnCon);
                        List<DEF_WebSiteMembers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteMembers.RecordObject recRecord = dbSearch[0];
                                AriesCMS.Models.WebSiteMembersDBView recRecord = new Models.WebSiteMembersDBView();
                                recRecord.WebSiteMembers = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                recRecord.Get_AssociatedUsers(oSystem.cnCon);
                                recRecord.Get_WebSiteMemberShips(oSystem.cnCon);



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteMembers dbInteraction = new DINT_WebSiteMembers(oSystem.cnCon);
                        List<DEF_WebSiteMembers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteMembers.RecordObject recRecord = dbSearch[0];
                                AriesCMS.Models.WebSiteMembersDBView recRecord = new Models.WebSiteMembersDBView();
                                recRecord.WebSiteMembers = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                recRecord.Get_AssociatedUsers(oSystem.cnCon);
                                recRecord.Get_WebSiteMemberShips(oSystem.cnCon);



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteMembers_Create()
        {
            Set_Client_NavSettings("WebSiteMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteMembers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    //DEF_WebSiteMembers.RecordObject recRecord = new DEF_WebSiteMembers.RecordObject();

                    AriesCMS.Models.WebSiteMembersDBView recRecord = new Models.WebSiteMembersDBView();
                    recRecord.WebSiteMembers = new DEF_WebSiteMembers.RecordObject();
                    recRecord.Get_AssociatedUsers(oSystem.cnCon);
                    recRecord.Get_WebSiteMemberShips(oSystem.cnCon);
                    recRecord.WebSiteMembers.dtMembershipExpOn = DateTime.Parse("01/01/1901");



                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteMembers_AddUpdate(FormCollection fc, HttpPostedFileBase UploadFiles1, HttpPostedFileBase UploadFiles2, HttpPostedFileBase UploadFiles3, AriesCMS.Models.WebSiteMembersDBView _rec)
        {
            Set_Client_NavSettings("WebSiteMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            string sFileUploadResults = "";

            bool bFileUploadError1 = false;
            bool bFileUploadError2 = false;
            bool bFileUploadError3 = false;
            string sImageURL1 = "";
            string sImageURL2 = "";
            string sImageURL3 = "";
            string sPrefix = "";

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteMembers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteMembers.ID == null) || (_rec.WebSiteMembers.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteMembers.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteMembers dbInteraction = new DINT_WebSiteMembers(oSystem.cnCon);

                                #region Upload file - Image Thumbnail
                                try
                                {
                                    if (UploadFiles1 != null)
                                    {
                                        if (UploadFiles1.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                            {
                                                string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                    _rec.WebSiteMembers.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                    _rec.WebSiteMembers.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Medium
                                try
                                {
                                    if (UploadFiles2 != null)
                                    {
                                        if (UploadFiles2.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                            {
                                                string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    sImageURL2 = "Uploads/" + sOriginalfileName2;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                    _rec.WebSiteMembers.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                    _rec.WebSiteMembers.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Large
                                try
                                {
                                    if (UploadFiles3 != null)
                                    {
                                        if (UploadFiles3.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                            {
                                                string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    sImageURL3 = "Uploads/" + sOriginalfileName3;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                    _rec.WebSiteMembers.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                    UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                    _rec.WebSiteMembers.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                _rec.WebSiteMembers.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteMembers.dtDateCreated = DateTime.Now;
                                _rec.WebSiteMembers.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteMembers);

                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteMembers_Details", new { key = _rec.WebSiteMembers.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteMembers.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteMembers dbInteraction = new DINT_WebSiteMembers(oSystem.cnCon);

                                    #region Upload file - Image Thumbnail
                                    try
                                    {
                                        if (UploadFiles1 != null)
                                        {
                                            if (UploadFiles1.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                                {
                                                    string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                        sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                        _rec.WebSiteMembers.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                        _rec.WebSiteMembers.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Medium
                                    try
                                    {
                                        if (UploadFiles2 != null)
                                        {
                                            if (UploadFiles2.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                                {
                                                    string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                        sImageURL2 = "Uploads/" + sOriginalfileName2;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                        _rec.WebSiteMembers.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                        _rec.WebSiteMembers.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Large
                                    try
                                    {
                                        if (UploadFiles3 != null)
                                        {
                                            if (UploadFiles3.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                                {
                                                    string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                        sImageURL3 = "Uploads/" + sOriginalfileName3;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                        _rec.WebSiteMembers.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                        UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                        _rec.WebSiteMembers.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    _rec.WebSiteMembers.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteMembers);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteMembers_Details", new { id = _rec.WebSiteMembers.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteMembers_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteMembers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteMembers dbInteraction = new DINT_WebSiteMembers(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteMembers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteMembers.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {




                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteMembers_List");


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteMembers_List");

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteMemberShipsCategories

        string sWebSiteMemberShipsCategories_Details = "/views/Forms/WebSiteMemberShipsCategories_Details.cshtml";
        string sWebSiteMemberShipsCategories_List = "/views/Forms/WebSiteMemberShipsCategories_List.cshtml";


        public ActionResult WebSiteMemberShipsCategories_List(FormCollection fc, string Search, int page = 1)

        {
            Set_Client_NavSettings("WebSiteMemberShipsCategories");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteMemberShipsCategories_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteMemberShipsCategories dbInteraction = new DINT_WebSiteMemberShipsCategories(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteMemberShipsCategories.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteMemberShipsCategories.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteMemberShipsCategories_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteMemberShipsCategories");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteMemberShipsCategories_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteMemberShipsCategories dbInteraction = new DINT_WebSiteMemberShipsCategories(oSystem.cnCon);
                        List<DEF_WebSiteMemberShipsCategories.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteMemberShipsCategories.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteMemberShipsCategories dbInteraction = new DINT_WebSiteMemberShipsCategories(oSystem.cnCon);
                        List<DEF_WebSiteMemberShipsCategories.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteMemberShipsCategories.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteMemberShipsCategories_Create()
        {
            Set_Client_NavSettings("WebSiteMemberShipsCategories");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteMemberShipsCategories_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteMemberShipsCategories.RecordObject recRecord = new DEF_WebSiteMemberShipsCategories.RecordObject();


                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteMemberShipsCategories_AddUpdate(DEF_WebSiteMemberShipsCategories.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteMemberShipsCategories");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteMemberShipsCategories_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {




                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteMemberShipsCategories dbInteraction = new DINT_WebSiteMemberShipsCategories(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteMemberShipsCategories_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteMemberShipsCategories dbInteraction = new DINT_WebSiteMemberShipsCategories(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteMemberShipsCategories_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteMemberShipsCategories_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteMemberShipsCategories");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteMemberShipsCategories dbInteraction = new DINT_WebSiteMemberShipsCategories(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteMemberShipsCategories.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteMemberShipsCategories.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {




                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteMemberShipsCategories_List");


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteMemberShipsCategories_List");

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteSponsors

        string sWebSiteSponsors_Details = "/views/Forms/WebSiteSponsors_Details.cshtml";
        string sWebSiteSponsors_List = "/views/Forms/WebSiteSponsors_List.cshtml";


        public ActionResult WebSiteSponsors_List(FormCollection fc, string Search, int page = 1)
        {
            Set_Client_NavSettings("WebSiteSponsors");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteSponsors_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteSponsors dbInteraction = new DINT_WebSiteSponsors(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteSponsors.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteSponsors.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteSponsors_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteSponsors");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteSponsors_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteSponsors dbInteraction = new DINT_WebSiteSponsors(oSystem.cnCon);
                        List<DEF_WebSiteSponsors.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteSponsors.RecordObject recRecord = dbSearch[0];
                                AriesCMS.Models.WebSiteSponsorsDBView recRecord = new Models.WebSiteSponsorsDBView();
                                recRecord.WebSiteSponsors = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                recRecord.Get_AssociatedUsers(oSystem.cnCon);
                                recRecord.Get_Sponsorshiptypes(oSystem.cnCon);


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteSponsors dbInteraction = new DINT_WebSiteSponsors(oSystem.cnCon);
                        List<DEF_WebSiteSponsors.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteSponsors.RecordObject recRecord = dbSearch[0];
                                AriesCMS.Models.WebSiteSponsorsDBView recRecord = new Models.WebSiteSponsorsDBView();
                                recRecord.WebSiteSponsors = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                recRecord.Get_AssociatedUsers(oSystem.cnCon);
                                recRecord.Get_Sponsorshiptypes(oSystem.cnCon);


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }


        public ActionResult WebSiteSponsors_Create()
        {
            Set_Client_NavSettings("WebSiteSponsors");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteSponsors_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    //DEF_WebSiteSponsors.RecordObject recRecord = new DEF_WebSiteSponsors.RecordObject();

                    AriesCMS.Models.WebSiteSponsorsDBView recRecord = new Models.WebSiteSponsorsDBView();
                    recRecord.WebSiteSponsors = new DEF_WebSiteSponsors.RecordObject();

                    recRecord.WebSiteSponsors.dtSpnsshipExpOn = DateTime.Parse("01/01/1901");
                    recRecord.Get_AssociatedUsers(oSystem.cnCon);
                    recRecord.Get_Sponsorshiptypes(oSystem.cnCon);


                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteSponsors_AddUpdate(FormCollection fc, HttpPostedFileBase UploadFiles1, HttpPostedFileBase UploadFiles2, HttpPostedFileBase UploadFiles3, AriesCMS.Models.WebSiteSponsorsDBView _rec)
        {
            Set_Client_NavSettings("WebSiteSponsors");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            string sFileUploadResults = "";

            bool bFileUploadError1 = false;
            bool bFileUploadError2 = false;
            bool bFileUploadError3 = false;
            string sImageURL1 = "";
            string sImageURL2 = "";
            string sImageURL3 = "";
            string sPrefix = "";

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteSponsors_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteSponsors.ID == null) || (_rec.WebSiteSponsors.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteSponsors.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteSponsors dbInteraction = new DINT_WebSiteSponsors(oSystem.cnCon);

                                #region Upload file - Image Thumbnail
                                try
                                {
                                    if (UploadFiles1 != null)
                                    {
                                        if (UploadFiles1.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                            {
                                                string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                    _rec.WebSiteSponsors.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                    _rec.WebSiteSponsors.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Medium
                                try
                                {
                                    if (UploadFiles2 != null)
                                    {
                                        if (UploadFiles2.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                            {
                                                string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    sImageURL2 = "Uploads/" + UploadFiles2.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                    _rec.WebSiteSponsors.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                    _rec.WebSiteSponsors.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Large
                                try
                                {
                                    if (UploadFiles3 != null)
                                    {
                                        if (UploadFiles3.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                            {
                                                string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    sImageURL3 = "Uploads/" + UploadFiles3.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                    _rec.WebSiteSponsors.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                    UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                    _rec.WebSiteSponsors.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                    bFileUploadError1 = false;
                                }
                                #endregion


                                _rec.WebSiteSponsors.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteSponsors.dtDateCreated = DateTime.Now;
                                _rec.WebSiteSponsors.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteSponsors);

                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteSponsors_Details", new { key = _rec.WebSiteSponsors.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteSponsors.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteSponsors dbInteraction = new DINT_WebSiteSponsors(oSystem.cnCon);

                                    #region Upload file - Image Thumbnail
                                    try
                                    {
                                        if (UploadFiles1 != null)
                                        {
                                            if (UploadFiles1.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                                {
                                                    string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                        sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                        _rec.WebSiteSponsors.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                        _rec.WebSiteSponsors.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Medium
                                    try
                                    {
                                        if (UploadFiles2 != null)
                                        {
                                            if (UploadFiles2.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                                {
                                                    string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                        sImageURL2 = "Uploads/" + UploadFiles2.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                        _rec.WebSiteSponsors.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                        _rec.WebSiteSponsors.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Large
                                    try
                                    {
                                        if (UploadFiles3 != null)
                                        {
                                            if (UploadFiles3.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                                {
                                                    string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                        sImageURL3 = "Uploads/" + UploadFiles3.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                        _rec.WebSiteSponsors.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                        UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                        _rec.WebSiteSponsors.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion


                                    _rec.WebSiteSponsors.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteSponsors);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteSponsors_Details", new { id = _rec.WebSiteSponsors.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteSponsors_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteSponsors");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteSponsors dbInteraction = new DINT_WebSiteSponsors(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteSponsors.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteSponsors.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {




                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteSponsors_List");


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteSponsors_List");

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteSponsorShipTypes

        string sWebSiteSponsorShipTypes_Details = "/views/Forms/WebSiteSponsorShipTypes_Details.cshtml";
        string sWebSiteSponsorShipTypes_List = "/views/Forms/WebSiteSponsorShipTypes_List.cshtml";


        public ActionResult WebSiteSponsorShipTypes_List(FormCollection fc, string Search, int page = 1)
        {
            Set_Client_NavSettings("WebSiteSponsorShipTypes");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteSponsorShipTypes_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteSponsorShipTypes dbInteraction = new DINT_WebSiteSponsorShipTypes(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteSponsorShipTypes.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteSponsorShipTypes.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteSponsorShipTypes_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteSponsorShipTypes");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteSponsorShipTypes_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteSponsorShipTypes dbInteraction = new DINT_WebSiteSponsorShipTypes(oSystem.cnCon);
                        List<DEF_WebSiteSponsorShipTypes.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteSponsorShipTypes.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteSponsorShipTypes dbInteraction = new DINT_WebSiteSponsorShipTypes(oSystem.cnCon);
                        List<DEF_WebSiteSponsorShipTypes.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteSponsorShipTypes.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteSponsorShipTypes_Create()
        {
            Set_Client_NavSettings("WebSiteSponsorShipTypes");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process




                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteSponsorShipTypes_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteSponsorShipTypes.RecordObject recRecord = new DEF_WebSiteSponsorShipTypes.RecordObject();








                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteSponsorShipTypes_AddUpdate(FormCollection fc, HttpPostedFileBase UploadFiles1, HttpPostedFileBase UploadFiles2, HttpPostedFileBase UploadFiles3, DEF_WebSiteSponsorShipTypes.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteSponsorShipTypes");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            string sFileUploadResults = "";

            bool bFileUploadError1 = false;
            bool bFileUploadError2 = false;
            bool bFileUploadError3 = false;
            string sImageURL1 = "";
            string sImageURL2 = "";
            string sImageURL3 = "";
            string sPrefix = "";

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteSponsorShipTypes_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteSponsorShipTypes dbInteraction = new DINT_WebSiteSponsorShipTypes(oSystem.cnCon);

                                #region Upload file - Image Thumbnail
                                try
                                {
                                    if (UploadFiles1 != null)
                                    {
                                        if (UploadFiles1.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                            {
                                                string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                    _rec.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                    _rec.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Medium
                                try
                                {
                                    if (UploadFiles2 != null)
                                    {
                                        if (UploadFiles2.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                            {
                                                string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    sImageURL2 = "Uploads/" + UploadFiles2.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                    _rec.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                    _rec.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Large
                                try
                                {
                                    if (UploadFiles3 != null)
                                    {
                                        if (UploadFiles3.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                            {
                                                string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    sImageURL3 = "Uploads/" + UploadFiles3.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                    _rec.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                    UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                    _rec.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteSponsorShipTypes_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteSponsorShipTypes dbInteraction = new DINT_WebSiteSponsorShipTypes(oSystem.cnCon);

                                    #region Upload file - Image Thumbnail
                                    try
                                    {
                                        if (UploadFiles1 != null)
                                        {
                                            if (UploadFiles1.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                                {
                                                    string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                        sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                        _rec.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                        _rec.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Medium
                                    try
                                    {
                                        if (UploadFiles2 != null)
                                        {
                                            if (UploadFiles2.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                                {
                                                    string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                        sImageURL2 = "Uploads/" + UploadFiles2.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                        _rec.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                        _rec.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Large
                                    try
                                    {
                                        if (UploadFiles3 != null)
                                        {
                                            if (UploadFiles3.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                                {
                                                    string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                        sImageURL3 = "Uploads/" + UploadFiles3.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                        _rec.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                        UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                        _rec.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteSponsorShipTypes_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteSponsorShipTypes_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteSponsorShipTypes");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteSponsorShipTypes dbInteraction = new DINT_WebSiteSponsorShipTypes(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteSponsorShipTypes.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteSponsorShipTypes.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {




                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteSponsorShipTypes_List");


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteSponsorShipTypes_List");

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePartnerTypes

        string sWebSitePartnerTypes_Details = "/views/Forms/WebSitePartnerTypes_Details.cshtml";
        string sWebSitePartnerTypes_List = "/views/Forms/WebSitePartnerTypes_List.cshtml";


        public ActionResult WebSitePartnerTypes_List(FormCollection fc, string Search, int page = 1)
        {
            Set_Client_NavSettings("WebSitePartnerTypes");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePartnerTypes_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePartnerTypes dbInteraction = new DINT_WebSitePartnerTypes(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePartnerTypes.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePartnerTypes.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePartnerTypes_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePartnerTypes");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePartnerTypes_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePartnerTypes dbInteraction = new DINT_WebSitePartnerTypes(oSystem.cnCon);
                        List<DEF_WebSitePartnerTypes.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePartnerTypes.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePartnerTypes dbInteraction = new DINT_WebSitePartnerTypes(oSystem.cnCon);
                        List<DEF_WebSitePartnerTypes.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePartnerTypes.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }


        public ActionResult WebSitePartnerTypes_Create()
        {
            Set_Client_NavSettings("WebSitePartnerTypes");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process




                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePartnerTypes_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSitePartnerTypes.RecordObject recRecord = new DEF_WebSitePartnerTypes.RecordObject();








                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePartnerTypes_AddUpdate(FormCollection fc, HttpPostedFileBase UploadFiles1, HttpPostedFileBase UploadFiles2, HttpPostedFileBase UploadFiles3, DEF_WebSitePartnerTypes.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSitePartnerTypes");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            string sFileUploadResults = "";

            bool bFileUploadError1 = false;
            bool bFileUploadError2 = false;
            bool bFileUploadError3 = false;
            string sImageURL1 = "";
            string sImageURL2 = "";
            string sImageURL3 = "";
            string sPrefix = "";


            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePartnerTypes_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePartnerTypes dbInteraction = new DINT_WebSitePartnerTypes(oSystem.cnCon);

                                #region Upload file - Image Thumbnail
                                try
                                {
                                    if (UploadFiles1 != null)
                                    {
                                        if (UploadFiles1.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                            {
                                                string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                    _rec.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                    _rec.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Medium
                                try
                                {
                                    if (UploadFiles2 != null)
                                    {
                                        if (UploadFiles2.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                            {
                                                string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    sImageURL2 = "Uploads/" + UploadFiles2.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                    _rec.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                    _rec.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Large
                                try
                                {
                                    if (UploadFiles3 != null)
                                    {
                                        if (UploadFiles3.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                            {
                                                string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    sImageURL3 = "Uploads/" + UploadFiles3.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                    _rec.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                    UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                    _rec.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSitePartnerTypes_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePartnerTypes dbInteraction = new DINT_WebSitePartnerTypes(oSystem.cnCon);

                                    #region Upload file - Image Thumbnail
                                    try
                                    {
                                        if (UploadFiles1 != null)
                                        {
                                            if (UploadFiles1.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                                {
                                                    string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                        sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                        _rec.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                        _rec.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Medium
                                    try
                                    {
                                        if (UploadFiles2 != null)
                                        {
                                            if (UploadFiles2.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                                {
                                                    string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                        sImageURL2 = "Uploads/" + UploadFiles2.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                        _rec.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                        _rec.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Large
                                    try
                                    {
                                        if (UploadFiles3 != null)
                                        {
                                            if (UploadFiles3.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                                {
                                                    string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                        sImageURL3 = "Uploads/" + UploadFiles3.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                        _rec.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                        UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                        _rec.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion


                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSitePartnerTypes_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePartnerTypes_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePartnerTypes");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePartnerTypes dbInteraction = new DINT_WebSitePartnerTypes(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePartnerTypes.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePartnerTypes.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {




                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSitePartnerTypes_List");


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSitePartnerTypes_List");

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteAffiliates

        string sWebSiteAffiliates_Details = "/views/Forms/WebSiteAffiliates_Details.cshtml";
        string sWebSiteAffiliates_List = "/views/Forms/WebSiteAffiliates_List.cshtml";


        public ActionResult WebSiteAffiliates_List(FormCollection fc, string Search, int page = 1)
        {
            Set_Client_NavSettings("WebSiteAffiliates");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAffiliates_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteAffiliates dbInteraction = new DINT_WebSiteAffiliates(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteAffiliates.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteAffiliates.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAffiliates_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteAffiliates");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAffiliates_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteAffiliates dbInteraction = new DINT_WebSiteAffiliates(oSystem.cnCon);
                        List<DEF_WebSiteAffiliates.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteAffiliates.RecordObject recRecord = dbSearch[0];
                                AriesCMS.Models.WebSiteAffiliatesDBView recRecord = new Models.WebSiteAffiliatesDBView();
                                recRecord.WebSiteAffiliates = dbSearch[0];

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                recRecord.Get_AssociatedUsers(oSystem.cnCon);
                                recRecord.Get_WebSiteAffiliateTypes(oSystem.cnCon);


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteAffiliates dbInteraction = new DINT_WebSiteAffiliates(oSystem.cnCon);
                        List<DEF_WebSiteAffiliates.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteAffiliates.RecordObject recRecord = dbSearch[0];
                                AriesCMS.Models.WebSiteAffiliatesDBView recRecord = new Models.WebSiteAffiliatesDBView();
                                recRecord.WebSiteAffiliates = dbSearch[0];

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                recRecord.Get_AssociatedUsers(oSystem.cnCon);
                                recRecord.Get_WebSiteAffiliateTypes(oSystem.cnCon);




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAffiliates_Create()
        {
            Set_Client_NavSettings("WebSiteAffiliates");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process

                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAffiliates_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    //DEF_WebSiteAffiliates.RecordObject recRecord = new DEF_WebSiteAffiliates.RecordObject();

                    AriesCMS.Models.WebSiteAffiliatesDBView recRecord = new Models.WebSiteAffiliatesDBView();

                    recRecord.Get_AssociatedUsers(oSystem.cnCon);
                    recRecord.Get_WebSiteAffiliateTypes(oSystem.cnCon);





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteAffiliates_AddUpdate(FormCollection fc, HttpPostedFileBase UploadFiles1, HttpPostedFileBase UploadFiles2, HttpPostedFileBase UploadFiles3, AriesCMS.Models.WebSiteAffiliatesDBView _rec)
        {
            Set_Client_NavSettings("WebSiteAffiliates");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            string sFileUploadResults = "";

            bool bFileUploadError1 = false;
            bool bFileUploadError2 = false;
            bool bFileUploadError3 = false;
            string sImageURL1 = "";
            string sImageURL2 = "";
            string sImageURL3 = "";
            string sPrefix = "";



            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAffiliates_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteAffiliates.ID == null) || (_rec.WebSiteAffiliates.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteAffiliates.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteAffiliates dbInteraction = new DINT_WebSiteAffiliates(oSystem.cnCon);

                                #region Upload file - Image Thumbnail
                                try
                                {
                                    if (UploadFiles1 != null)
                                    {
                                        if (UploadFiles1.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                            {
                                                string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                    _rec.WebSiteAffiliates.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                    _rec.WebSiteAffiliates.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Medium
                                try
                                {
                                    if (UploadFiles2 != null)
                                    {
                                        if (UploadFiles2.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                            {
                                                string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    sImageURL2 = "Uploads/" + sOriginalfileName2;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                    _rec.WebSiteAffiliates.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                    _rec.WebSiteAffiliates.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Large
                                try
                                {
                                    if (UploadFiles3 != null)
                                    {
                                        if (UploadFiles3.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                            {
                                                string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    sImageURL3 = "Uploads/" + sOriginalfileName3;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                    _rec.WebSiteAffiliates.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                    UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                    _rec.WebSiteAffiliates.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                _rec.WebSiteAffiliates.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteAffiliates.dtDateCreated = DateTime.Now;
                                _rec.WebSiteAffiliates.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteAffiliates);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteAffiliates_Details", new { key = _rec.WebSiteAffiliates.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteAffiliates.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteAffiliates dbInteraction = new DINT_WebSiteAffiliates(oSystem.cnCon);

                                    #region Upload file - Image Thumbnail
                                    try
                                    {
                                        if (UploadFiles1 != null)
                                        {
                                            if (UploadFiles1.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                                {
                                                    string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                        sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                        _rec.WebSiteAffiliates.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                        _rec.WebSiteAffiliates.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Medium
                                    try
                                    {
                                        if (UploadFiles2 != null)
                                        {
                                            if (UploadFiles2.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                                {
                                                    string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                        sImageURL2 = "Uploads/" + sOriginalfileName2;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                        _rec.WebSiteAffiliates.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                        _rec.WebSiteAffiliates.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Large
                                    try
                                    {
                                        if (UploadFiles3 != null)
                                        {
                                            if (UploadFiles3.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                                {
                                                    string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                        sImageURL3 = "Uploads/" + sOriginalfileName3;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                        _rec.WebSiteAffiliates.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                        UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                        _rec.WebSiteAffiliates.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    _rec.WebSiteAffiliates.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteAffiliates);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteAffiliates_Details", new { id = _rec.WebSiteAffiliates.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAffiliates_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteAffiliates");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteAffiliates dbInteraction = new DINT_WebSiteAffiliates(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteAffiliates.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAffiliates.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {




                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteAffiliates_List");


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteAffiliates_List");

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteAffiliateTypes

        string sWebSiteAffiliateTypes_Details = "/views/Forms/WebSiteAffiliateTypes_Details.cshtml";
        string sWebSiteAffiliateTypes_List = "/views/Forms/WebSiteAffiliateTypes_List.cshtml";


        public ActionResult WebSiteAffiliateTypes_List(FormCollection fc, string Search, int page = 1)
        {
            Set_Client_NavSettings("WebSiteAffiliateTypes");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAffiliateTypes_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteAffiliateTypes dbInteraction = new DINT_WebSiteAffiliateTypes(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteAffiliateTypes.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteAffiliateTypes.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAffiliateTypes_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteAffiliateTypes");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAffiliateTypes_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteAffiliateTypes dbInteraction = new DINT_WebSiteAffiliateTypes(oSystem.cnCon);
                        List<DEF_WebSiteAffiliateTypes.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAffiliateTypes.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteAffiliateTypes dbInteraction = new DINT_WebSiteAffiliateTypes(oSystem.cnCon);
                        List<DEF_WebSiteAffiliateTypes.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAffiliateTypes.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }




                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteAffiliateTypes_Create()
        {
            Set_Client_NavSettings("WebSiteAffiliateTypes");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process




                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAffiliateTypes_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteAffiliateTypes.RecordObject recRecord = new DEF_WebSiteAffiliateTypes.RecordObject();








                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteAffiliateTypes_AddUpdate(FormCollection fc, HttpPostedFileBase UploadFiles1, HttpPostedFileBase UploadFiles2, HttpPostedFileBase UploadFiles3, DEF_WebSiteAffiliateTypes.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteAffiliateTypes");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            string sFileUploadResults = "";

            bool bFileUploadError1 = false;
            bool bFileUploadError2 = false;
            bool bFileUploadError3 = false;
            string sImageURL1 = "";
            string sImageURL2 = "";
            string sImageURL3 = "";
            string sPrefix = "";

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteAffiliateTypes_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteAffiliateTypes dbInteraction = new DINT_WebSiteAffiliateTypes(oSystem.cnCon);

                                #region Upload file - Image Thumbnail
                                try
                                {
                                    if (UploadFiles1 != null)
                                    {
                                        if (UploadFiles1.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                            {
                                                string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                    _rec.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                    _rec.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Medium
                                try
                                {
                                    if (UploadFiles2 != null)
                                    {
                                        if (UploadFiles2.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                            {
                                                string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    sImageURL2 = "Uploads/" + UploadFiles2.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                    _rec.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                    _rec.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Large
                                try
                                {
                                    if (UploadFiles3 != null)
                                    {
                                        if (UploadFiles3.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                            {
                                                string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    sImageURL3 = "Uploads/" + UploadFiles3.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                    _rec.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                    UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                    _rec.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteAffiliateTypes_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteAffiliateTypes dbInteraction = new DINT_WebSiteAffiliateTypes(oSystem.cnCon);

                                    #region Upload file - Image Thumbnail
                                    try
                                    {
                                        if (UploadFiles1 != null)
                                        {
                                            if (UploadFiles1.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                                {
                                                    string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                        sImageURL1 = "Uploads/" + sOriginalfileName1;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                        _rec.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                        _rec.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Medium
                                    try
                                    {
                                        if (UploadFiles2 != null)
                                        {
                                            if (UploadFiles2.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                                {
                                                    string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                        sImageURL2 = "Uploads/" + UploadFiles2.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                        _rec.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                        _rec.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Large
                                    try
                                    {
                                        if (UploadFiles3 != null)
                                        {
                                            if (UploadFiles3.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                                {
                                                    string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                        sImageURL3 = "Uploads/" + UploadFiles3.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                        _rec.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                        UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                        _rec.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteAffiliateTypes_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteAffiliateTypes_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteAffiliateTypes");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteAffiliateTypes dbInteraction = new DINT_WebSiteAffiliateTypes(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteAffiliateTypes.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteAffiliateTypes.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {




                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteAffiliateTypes_List");


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteAffiliateTypes_List");

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSitePartners

        string sWebSitePartners_Details = "/views/Forms/WebSitePartners_Details.cshtml";
        string sWebSitePartners_List = "/views/Forms/WebSitePartners_List.cshtml";


        public ActionResult WebSitePartners_List(FormCollection fc, string Search, int page = 1)
        {
            Set_Client_NavSettings("WebSitePartners");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePartners_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSitePartners dbInteraction = new DINT_WebSitePartners(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSitePartners.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSitePartners.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePartners_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSitePartners");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePartners_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePartners dbInteraction = new DINT_WebSitePartners(oSystem.cnCon);
                        List<DEF_WebSitePartners.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSitePartners.RecordObject recRecord = dbSearch[0];
                                AriesCMS.Models.WebSitePartnersDBView recRecord = new Models.WebSitePartnersDBView();
                                recRecord.WebSitePartners = dbSearch[0];


                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                recRecord.Get_AssociatedUsers(oSystem.cnCon);
                                recRecord.Get_WebSitePartnerTypes(oSystem.cnCon);


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSitePartners dbInteraction = new DINT_WebSitePartners(oSystem.cnCon);
                        List<DEF_WebSitePartners.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSitePartners.RecordObject recRecord = dbSearch[0];
                                AriesCMS.Models.WebSitePartnersDBView recRecord = new Models.WebSitePartnersDBView();
                                recRecord.WebSitePartners = dbSearch[0];


                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }

                                recRecord.Get_AssociatedUsers(oSystem.cnCon);
                                recRecord.Get_WebSitePartnerTypes(oSystem.cnCon);



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePartners_Create()
        {
            Set_Client_NavSettings("WebSitePartners");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePartners_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    //DEF_WebSitePartners.RecordObject recRecord = new DEF_WebSitePartners.RecordObject();
                    AriesCMS.Models.WebSitePartnersDBView recRecord = new Models.WebSitePartnersDBView();


                    recRecord.Get_WebSitePartnerTypes(oSystem.cnCon);
                    recRecord.Get_AssociatedUsers(oSystem.cnCon);




                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSitePartners_AddUpdate(FormCollection fc, HttpPostedFileBase UploadFiles1, HttpPostedFileBase UploadFiles2, HttpPostedFileBase UploadFiles3, AriesCMS.Models.WebSitePartnersDBView _rec)
        {
            Set_Client_NavSettings("WebSitePartners");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();

            string sBaseULR = Request.Url.Scheme + "://" + Request.Url.Authority + "/";
            string sRootPath = Request.PhysicalApplicationPath.ToString();
            string sRefURL = Request.UrlReferrer.AbsoluteUri.ToString();
            string sFileUploadResults = "";

            bool bFileUploadError1 = false;
            bool bFileUploadError2 = false;
            bool bFileUploadError3 = false;
            string sImageURL1 = "";
            string sImageURL2 = "";
            string sImageURL3 = "";
            string sPrefix = "";

            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSitePartners_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSitePartners.ID == null) || (_rec.WebSitePartners.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSitePartners.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSitePartners dbInteraction = new DINT_WebSitePartners(oSystem.cnCon);

                                #region Upload file - Image Thumbnail
                                try
                                {
                                    if (UploadFiles1 != null)
                                    {
                                        if (UploadFiles1.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                            {
                                                string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    sImageURL1 = "Uploads/" + UploadFiles1.FileName;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                    _rec.WebSitePartners.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                    _rec.WebSitePartners.sImageURL = sImageURL1;
                                                    bFileUploadError1 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Medium
                                try
                                {
                                    if (UploadFiles2 != null)
                                    {
                                        if (UploadFiles2.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                            {
                                                string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    sImageURL2 = "Uploads/" + sOriginalfileName2;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                    _rec.WebSitePartners.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                    UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                    _rec.WebSitePartners.sImageURL2 = sImageURL2;
                                                    bFileUploadError2 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                #region Upload file - Image Large
                                try
                                {
                                    if (UploadFiles3 != null)
                                    {
                                        if (UploadFiles3.ContentLength > 0)
                                        {
                                            if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                            {
                                                string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                if (!oFLCheck.Exists)
                                                {
                                                    UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    sImageURL3 = "Uploads/" + sOriginalfileName3;
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                    _rec.WebSitePartners.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                                else
                                                {
                                                    sPrefix = "";
                                                    sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                    sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                    sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                    UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                    sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                    _rec.WebSitePartners.sImageURL3 = sImageURL3;
                                                    bFileUploadError3 = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                catch
                                {
                                    ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                    bFileUploadError1 = false;
                                }
                                #endregion

                                _rec.WebSitePartners.sControl = Guid.NewGuid().ToString();
                                _rec.WebSitePartners.dtDateCreated = DateTime.Now;
                                _rec.WebSitePartners.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSitePartners);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSitePartners_Details", new { key = _rec.WebSitePartners.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSitePartners.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSitePartners dbInteraction = new DINT_WebSitePartners(oSystem.cnCon);

                                    #region Upload file - Image Thumbnail
                                    try
                                    {
                                        if (UploadFiles1 != null)
                                        {
                                            if (UploadFiles1.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles1.FileName))
                                                {
                                                    string sOriginalfileName1 = Path.GetFileName(UploadFiles1.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName1);
                                                        sImageURL1 = "Uploads/" + UploadFiles1.FileName;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName1;
                                                        _rec.WebSitePartners.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL1 = "Uploads/" + sPrefix + sOriginalfileName1;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName1);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName1;
                                                        _rec.WebSitePartners.sImageURL = sImageURL1;
                                                        bFileUploadError1 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Thumbnail file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Medium
                                    try
                                    {
                                        if (UploadFiles2 != null)
                                        {
                                            if (UploadFiles2.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles2.FileName))
                                                {
                                                    string sOriginalfileName2 = Path.GetFileName(UploadFiles2.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName2);
                                                        sImageURL2 = "Uploads/" + sOriginalfileName2;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName2;
                                                        _rec.WebSitePartners.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL2 = "Uploads/" + sPrefix + sOriginalfileName2;
                                                        UploadFiles1.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName2);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName2;
                                                        _rec.WebSitePartners.sImageURL2 = sImageURL2;
                                                        bFileUploadError2 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Medium file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion

                                    #region Upload file - Image Large
                                    try
                                    {
                                        if (UploadFiles3 != null)
                                        {
                                            if (UploadFiles3.ContentLength > 0)
                                            {
                                                if (!String.IsNullOrEmpty(UploadFiles3.FileName))
                                                {
                                                    string sOriginalfileName3 = Path.GetFileName(UploadFiles3.FileName);
                                                    FileInfo oFLCheck = new FileInfo(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                    if (!oFLCheck.Exists)
                                                    {
                                                        UploadFiles2.SaveAs(sRootPath + "Uploads\\" + sOriginalfileName3);
                                                        sImageURL3 = "Uploads/" + sOriginalfileName3;
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sOriginalfileName3;
                                                        _rec.WebSitePartners.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                    else
                                                    {
                                                        sPrefix = "";
                                                        sPrefix = DateTime.Now.ToShortTimeString() + DateTime.Now.ToShortDateString();
                                                        sPrefix = sPrefix.Replace("/", "").Replace(" ", "").Replace(":", "");
                                                        sImageURL3 = "Uploads/" + sPrefix + sOriginalfileName3;
                                                        UploadFiles3.SaveAs(sRootPath + "Uploads\\" + sPrefix + sOriginalfileName3);
                                                        sFileUploadResults = "File Uploaded! - " + "Themes\\" + sPrefix + sOriginalfileName3;
                                                        _rec.WebSitePartners.sImageURL3 = sImageURL3;
                                                        bFileUploadError3 = false;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    catch
                                    {
                                        ViewBag.sErrorMessage += "Sorry something went wrong in attempting to upload your Image Large file";
                                        bFileUploadError1 = false;
                                    }
                                    #endregion


                                    _rec.WebSitePartners.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSitePartners);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSitePartners_Details", new { id = _rec.WebSitePartners.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSitePartners_Delete(int id)
        {
            Set_Client_NavSettings("WebSitePartners");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSitePartners dbInteraction = new DINT_WebSitePartners(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSitePartners.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSitePartners.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {




                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSitePartners_List");


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSitePartners_List");

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form Affiliate_QuestAnswers

        string sAffiliate_QuestAnswers_Details = "/views/Forms/Affiliate_QuestAnswers_Details.cshtml";
        string sAffiliate_QuestAnswers_List = "/views/Forms/Affiliate_QuestAnswers_List.cshtml";


        public ActionResult Affiliate_QuestAnswers_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("Affiliate_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sAffiliate_QuestAnswers_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_Affiliate_QuestAnswers dbInteraction = new DINT_Affiliate_QuestAnswers(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_Affiliate_QuestAnswers.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_Affiliate_QuestAnswers.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Affiliate_QuestAnswers_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("Affiliate_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sAffiliate_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Affiliate_QuestAnswers dbInteraction = new DINT_Affiliate_QuestAnswers(oSystem.cnCon);
                        List<DEF_Affiliate_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Affiliate_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Affiliate_QuestAnswers dbInteraction = new DINT_Affiliate_QuestAnswers(oSystem.cnCon);
                        List<DEF_Affiliate_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Affiliate_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult Affiliate_QuestAnswers_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("Affiliate_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sAffiliate_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_Affiliate_QuestAnswers.RecordObject recRecord = new DEF_Affiliate_QuestAnswers.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult Affiliate_QuestAnswers_AddUpdate(DEF_Affiliate_QuestAnswers.RecordObject _rec)
        {
            Set_Client_NavSettings("Affiliate_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sAffiliate_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_Affiliate_QuestAnswers dbInteraction = new DINT_Affiliate_QuestAnswers(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("Affiliate_QuestAnswers_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_Affiliate_QuestAnswers dbInteraction = new DINT_Affiliate_QuestAnswers(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("Affiliate_QuestAnswers_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Affiliate_QuestAnswers_Delete(int id)
        {
            Set_Client_NavSettings("Affiliate_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_Affiliate_QuestAnswers dbInteraction = new DINT_Affiliate_QuestAnswers(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_Affiliate_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Affiliate_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("Affiliate_QuestAnswers_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("Affiliate_QuestAnswers_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteQuestionair

        string sWebSiteQuestionair_Details = "/views/Forms/WebSiteQuestionair_Details.cshtml";
        string sWebSiteQuestionair_List = "/views/Forms/WebSiteQuestionair_List.cshtml";


        public ActionResult WebSiteQuestionair_List(FormCollection fc, string Search, int page = 1)

        {
            Set_Client_NavSettings("WebSiteQuestionair");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteQuestionair_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteQuestionair dbInteraction = new DINT_WebSiteQuestionair(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteQuestionair.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteQuestionair.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteQuestionair_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteQuestionair");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteQuestionair_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteQuestionair dbInteraction = new DINT_WebSiteQuestionair(oSystem.cnCon);
                        List<DEF_WebSiteQuestionair.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteQuestionair.RecordObject recRecord = dbSearch[0];

                                ACMSDBView.WebSiteQuestionairViewModel recRecord = new WebSiteQuestionairViewModel();
                                recRecord.WebSiteQuestionair = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                recRecord.Get_WebSitePageTemplates(oSystem.cnCon);


                                if (recRecord.WebSiteQuestionair.iDefaultTemplateID > 0)
                                {
                                    recRecord.Get_WebSitePageTemplatesPage(oSystem.cnCon, recRecord.WebSiteQuestionair.iDefaultTemplateID);
                                }

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteQuestionair dbInteraction = new DINT_WebSiteQuestionair(oSystem.cnCon);
                        List<DEF_WebSiteQuestionair.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteQuestionair.RecordObject recRecord = dbSearch[0];

                                ACMSDBView.WebSiteQuestionairViewModel recRecord = new WebSiteQuestionairViewModel();
                                recRecord.WebSiteQuestionair = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                recRecord.Get_WebSitePageTemplates(oSystem.cnCon);


                                if (recRecord.WebSiteQuestionair.iDefaultTemplateID > 0)
                                {
                                    recRecord.Get_WebSitePageTemplatesPage(oSystem.cnCon, recRecord.WebSiteQuestionair.iDefaultTemplateID);
                                }


                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteQuestionair_Create()

        {
            Set_Client_NavSettings("WebSiteQuestionair");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process




                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteQuestionair_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    //DEF_WebSiteQuestionair.RecordObject recRecord = new DEF_WebSiteQuestionair.RecordObject();

                    ACMSDBView.WebSiteQuestionairViewModel recRecord = new WebSiteQuestionairViewModel();


                    recRecord.Get_WebSitePageTemplates(oSystem.cnCon);






                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteQuestionair_AddUpdate(ACMSDBView.WebSiteQuestionairViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteQuestionair");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteQuestionair_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteQuestionair.ID == null) || (_rec.WebSiteQuestionair.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteQuestionair.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {

                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteQuestionair dbInteraction = new DINT_WebSiteQuestionair(oSystem.cnCon);

                                _rec.WebSiteQuestionair.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteQuestionair.dtDateCreated = DateTime.Now;
                                _rec.WebSiteQuestionair.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteQuestionair);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteQuestionair_Details", new { key = _rec.WebSiteQuestionair.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteQuestionair.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteQuestionair dbInteraction = new DINT_WebSiteQuestionair(oSystem.cnCon);
                                    _rec.WebSiteQuestionair.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteQuestionair);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteQuestionair_Details", new { id = _rec.WebSiteQuestionair.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteQuestionair_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteQuestionair");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteQuestionair dbInteraction = new DINT_WebSiteQuestionair(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteQuestionair.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteQuestionair.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {




                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteQuestionair_List");


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteQuestionair_List");

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteQuest_Questions

        string sWebSiteQuest_Questions_Details = "/views/Forms/WebSiteQuest_Questions_Details.cshtml";
        string sWebSiteQuest_Questions_List = "/views/Forms/WebSiteQuest_Questions_List.cshtml";


        public ActionResult WebSiteQuest_Questions_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteQuest_Questions");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteQuest_Questions_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteQuest_Questions dbInteraction = new DINT_WebSiteQuest_Questions(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteQuest_Questions.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteQuest_Questions.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteQuest_Questions_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteQuest_Questions");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteQuest_Questions_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteQuest_Questions dbInteraction = new DINT_WebSiteQuest_Questions(oSystem.cnCon);
                        List<DEF_WebSiteQuest_Questions.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteQuest_Questions.RecordObject recRecord = dbSearch[0];

                                ACMSDBView.WebSiteQuest_QuestionsViewModel recRecord = new WebSiteQuest_QuestionsViewModel();
                                recRecord.WebSiteQuest_Questions = dbSearch[0];

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteQuest_Questions.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteQuest_Questions.sParentID;


                                recRecord.Build_AnswerControlType();

                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteQuest_Questions dbInteraction = new DINT_WebSiteQuest_Questions(oSystem.cnCon);
                        List<DEF_WebSiteQuest_Questions.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                //DEF_WebSiteQuest_Questions.RecordObject recRecord = dbSearch[0];

                                ACMSDBView.WebSiteQuest_QuestionsViewModel recRecord = new WebSiteQuest_QuestionsViewModel();
                                recRecord.WebSiteQuest_Questions = dbSearch[0];

                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.WebSiteQuest_Questions.iParentID;
                                ViewBag.sParentID = recRecord.WebSiteQuest_Questions.sParentID;


                                recRecord.Build_AnswerControlType();



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteQuest_Questions_Create(int _iParentID = 0, string _sParentID = "")
        {
            Set_Client_NavSettings("WebSiteQuest_Questions");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteQuest_Questions_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";

                    ACMSDBView.WebSiteQuest_QuestionsViewModel recRecord = new WebSiteQuest_QuestionsViewModel();

                    //DEF_WebSiteQuest_Questions.RecordObject recRecord = new DEF_WebSiteQuest_Questions.RecordObject();


                    recRecord.WebSiteQuest_Questions.iParentID = _iParentID;
                    recRecord.WebSiteQuest_Questions.sParentID = _sParentID;
                    recRecord.Build_AnswerControlType();




                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult WebSiteQuest_Questions_AddUpdate(ACMSDBView.WebSiteQuest_QuestionsViewModel _rec)
        {
            Set_Client_NavSettings("WebSiteQuest_Questions");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteQuest_Questions_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.WebSiteQuest_Questions.ID == null) || (_rec.WebSiteQuest_Questions.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.WebSiteQuest_Questions.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.WebSiteQuest_Questions.iParentID;
                            ViewBag.sParentID = _rec.WebSiteQuest_Questions.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteQuest_Questions dbInteraction = new DINT_WebSiteQuest_Questions(oSystem.cnCon);

                                _rec.WebSiteQuest_Questions.sControl = Guid.NewGuid().ToString();
                                _rec.WebSiteQuest_Questions.dtDateCreated = DateTime.Now;
                                _rec.WebSiteQuest_Questions.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec.WebSiteQuest_Questions);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteQuest_Questions_Details", new { key = _rec.WebSiteQuest_Questions.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.WebSiteQuest_Questions.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteQuest_Questions dbInteraction = new DINT_WebSiteQuest_Questions(oSystem.cnCon);
                                    _rec.WebSiteQuest_Questions.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec.WebSiteQuest_Questions);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteQuest_Questions_Details", new { id = _rec.WebSiteQuest_Questions.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteQuest_Questions_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteQuest_Questions");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteQuest_Questions dbInteraction = new DINT_WebSiteQuest_Questions(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteQuest_Questions.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteQuest_Questions.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteQuest_Questions_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteQuest_Questions_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form User_Questionairs

        string sUser_Questionairs_Details = "/views/Forms/User_Questionairs_Details.cshtml";
        string sUser_Questionairs_List = "/views/Forms/User_Questionairs_List.cshtml";


        public ActionResult User_Questionairs_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("User_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUser_Questionairs_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_User_Questionairs dbInteraction = new DINT_User_Questionairs(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_User_Questionairs.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_User_Questionairs.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult User_Questionairs_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("User_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUser_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_User_Questionairs dbInteraction = new DINT_User_Questionairs(oSystem.cnCon);
                        List<DEF_User_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_User_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_User_Questionairs dbInteraction = new DINT_User_Questionairs(oSystem.cnCon);
                        List<DEF_User_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_User_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult User_Questionairs_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("User_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUser_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_User_Questionairs.RecordObject recRecord = new DEF_User_Questionairs.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult User_Questionairs_AddUpdate(DEF_User_Questionairs.RecordObject _rec)
        {
            Set_Client_NavSettings("User_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUser_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_User_Questionairs dbInteraction = new DINT_User_Questionairs(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("User_Questionairs_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_User_Questionairs dbInteraction = new DINT_User_Questionairs(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("User_Questionairs_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult User_Questionairs_Delete(int id)
        {
            Set_Client_NavSettings("User_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_User_Questionairs dbInteraction = new DINT_User_Questionairs(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_User_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_User_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("User_Questionairs_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("User_Questionairs_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form User_QuestAnswers

        string sUser_QuestAnswers_Details = "/views/Forms/User_QuestAnswers_Details.cshtml";
        string sUser_QuestAnswers_List = "/views/Forms/User_QuestAnswers_List.cshtml";


        public ActionResult User_QuestAnswers_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("User_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUser_QuestAnswers_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_User_QuestAnswers dbInteraction = new DINT_User_QuestAnswers(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_User_QuestAnswers.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_User_QuestAnswers.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult User_QuestAnswers_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("User_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUser_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_User_QuestAnswers dbInteraction = new DINT_User_QuestAnswers(oSystem.cnCon);
                        List<DEF_User_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_User_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_User_QuestAnswers dbInteraction = new DINT_User_QuestAnswers(oSystem.cnCon);
                        List<DEF_User_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_User_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult User_QuestAnswers_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("User_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUser_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_User_QuestAnswers.RecordObject recRecord = new DEF_User_QuestAnswers.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult User_QuestAnswers_AddUpdate(DEF_User_QuestAnswers.RecordObject _rec)
        {
            Set_Client_NavSettings("User_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sUser_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_User_QuestAnswers dbInteraction = new DINT_User_QuestAnswers(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("User_QuestAnswers_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_User_QuestAnswers dbInteraction = new DINT_User_QuestAnswers(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("User_QuestAnswers_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult User_QuestAnswers_Delete(int id)
        {
            Set_Client_NavSettings("User_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_User_QuestAnswers dbInteraction = new DINT_User_QuestAnswers(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_User_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_User_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("User_QuestAnswers_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("User_QuestAnswers_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form Sponsor_Questionairs

        string sSponsor_Questionairs_Details = "/views/Forms/Sponsor_Questionairs_Details.cshtml";
        string sSponsor_Questionairs_List = "/views/Forms/Sponsor_Questionairs_List.cshtml";


        public ActionResult Sponsor_Questionairs_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("Sponsor_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sSponsor_Questionairs_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_Sponsor_Questionairs dbInteraction = new DINT_Sponsor_Questionairs(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_Sponsor_Questionairs.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_Sponsor_Questionairs.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Sponsor_Questionairs_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("Sponsor_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sSponsor_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Sponsor_Questionairs dbInteraction = new DINT_Sponsor_Questionairs(oSystem.cnCon);
                        List<DEF_Sponsor_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Sponsor_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Sponsor_Questionairs dbInteraction = new DINT_Sponsor_Questionairs(oSystem.cnCon);
                        List<DEF_Sponsor_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Sponsor_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult Sponsor_Questionairs_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("Sponsor_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sSponsor_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_Sponsor_Questionairs.RecordObject recRecord = new DEF_Sponsor_Questionairs.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult Sponsor_Questionairs_AddUpdate(DEF_Sponsor_Questionairs.RecordObject _rec)
        {
            Set_Client_NavSettings("Sponsor_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sSponsor_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_Sponsor_Questionairs dbInteraction = new DINT_Sponsor_Questionairs(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("Sponsor_Questionairs_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_Sponsor_Questionairs dbInteraction = new DINT_Sponsor_Questionairs(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("Sponsor_Questionairs_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Sponsor_Questionairs_Delete(int id)
        {
            Set_Client_NavSettings("Sponsor_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_Sponsor_Questionairs dbInteraction = new DINT_Sponsor_Questionairs(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_Sponsor_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Sponsor_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("Sponsor_Questionairs_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("Sponsor_Questionairs_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form Sponsor_QuestAnswers

        string sSponsor_QuestAnswers_Details = "/views/Forms/Sponsor_QuestAnswers_Details.cshtml";
        string sSponsor_QuestAnswers_List = "/views/Forms/Sponsor_QuestAnswers_List.cshtml";


        public ActionResult Sponsor_QuestAnswers_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("Sponsor_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sSponsor_QuestAnswers_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_Sponsor_QuestAnswers dbInteraction = new DINT_Sponsor_QuestAnswers(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_Sponsor_QuestAnswers.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_Sponsor_QuestAnswers.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Sponsor_QuestAnswers_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("Sponsor_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sSponsor_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Sponsor_QuestAnswers dbInteraction = new DINT_Sponsor_QuestAnswers(oSystem.cnCon);
                        List<DEF_Sponsor_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Sponsor_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Sponsor_QuestAnswers dbInteraction = new DINT_Sponsor_QuestAnswers(oSystem.cnCon);
                        List<DEF_Sponsor_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Sponsor_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult Sponsor_QuestAnswers_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("Sponsor_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sSponsor_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_Sponsor_QuestAnswers.RecordObject recRecord = new DEF_Sponsor_QuestAnswers.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult Sponsor_QuestAnswers_AddUpdate(DEF_Sponsor_QuestAnswers.RecordObject _rec)
        {
            Set_Client_NavSettings("Sponsor_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sSponsor_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_Sponsor_QuestAnswers dbInteraction = new DINT_Sponsor_QuestAnswers(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("Sponsor_QuestAnswers_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_Sponsor_QuestAnswers dbInteraction = new DINT_Sponsor_QuestAnswers(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("Sponsor_QuestAnswers_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Sponsor_QuestAnswers_Delete(int id)
        {
            Set_Client_NavSettings("Sponsor_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_Sponsor_QuestAnswers dbInteraction = new DINT_Sponsor_QuestAnswers(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_Sponsor_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Sponsor_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("Sponsor_QuestAnswers_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("Sponsor_QuestAnswers_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form Partner_Questionairs

        string sPartner_Questionairs_Details = "/views/Forms/Partner_Questionairs_Details.cshtml";
        string sPartner_Questionairs_List = "/views/Forms/Partner_Questionairs_List.cshtml";


        public ActionResult Partner_Questionairs_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("Partner_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sPartner_Questionairs_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_Partner_Questionairs dbInteraction = new DINT_Partner_Questionairs(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_Partner_Questionairs.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_Partner_Questionairs.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Partner_Questionairs_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("Partner_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sPartner_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Partner_Questionairs dbInteraction = new DINT_Partner_Questionairs(oSystem.cnCon);
                        List<DEF_Partner_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Partner_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Partner_Questionairs dbInteraction = new DINT_Partner_Questionairs(oSystem.cnCon);
                        List<DEF_Partner_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Partner_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult Partner_Questionairs_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("Partner_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sPartner_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_Partner_Questionairs.RecordObject recRecord = new DEF_Partner_Questionairs.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult Partner_Questionairs_AddUpdate(DEF_Partner_Questionairs.RecordObject _rec)
        {
            Set_Client_NavSettings("Partner_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sPartner_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_Partner_Questionairs dbInteraction = new DINT_Partner_Questionairs(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("Partner_Questionairs_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_Partner_Questionairs dbInteraction = new DINT_Partner_Questionairs(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("Partner_Questionairs_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Partner_Questionairs_Delete(int id)
        {
            Set_Client_NavSettings("Partner_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_Partner_Questionairs dbInteraction = new DINT_Partner_Questionairs(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_Partner_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Partner_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("Partner_Questionairs_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("Partner_Questionairs_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form Partner_QuestAnswers

        string sPartner_QuestAnswers_Details = "/views/Forms/Partner_QuestAnswers_Details.cshtml";
        string sPartner_QuestAnswers_List = "/views/Forms/Partner_QuestAnswers_List.cshtml";


        public ActionResult Partner_QuestAnswers_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("Partner_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sPartner_QuestAnswers_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_Partner_QuestAnswers dbInteraction = new DINT_Partner_QuestAnswers(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_Partner_QuestAnswers.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_Partner_QuestAnswers.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Partner_QuestAnswers_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("Partner_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sPartner_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Partner_QuestAnswers dbInteraction = new DINT_Partner_QuestAnswers(oSystem.cnCon);
                        List<DEF_Partner_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Partner_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Partner_QuestAnswers dbInteraction = new DINT_Partner_QuestAnswers(oSystem.cnCon);
                        List<DEF_Partner_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Partner_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult Partner_QuestAnswers_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("Partner_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sPartner_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_Partner_QuestAnswers.RecordObject recRecord = new DEF_Partner_QuestAnswers.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult Partner_QuestAnswers_AddUpdate(DEF_Partner_QuestAnswers.RecordObject _rec)
        {
            Set_Client_NavSettings("Partner_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sPartner_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_Partner_QuestAnswers dbInteraction = new DINT_Partner_QuestAnswers(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("Partner_QuestAnswers_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_Partner_QuestAnswers dbInteraction = new DINT_Partner_QuestAnswers(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("Partner_QuestAnswers_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Partner_QuestAnswers_Delete(int id)
        {
            Set_Client_NavSettings("Partner_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_Partner_QuestAnswers dbInteraction = new DINT_Partner_QuestAnswers(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_Partner_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Partner_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("Partner_QuestAnswers_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("Partner_QuestAnswers_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form Member_Questionairs

        string sMember_Questionairs_Details = "/views/Forms/Member_Questionairs_Details.cshtml";
        string sMember_Questionairs_List = "/views/Forms/Member_Questionairs_List.cshtml";


        public ActionResult Member_Questionairs_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("Member_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sMember_Questionairs_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_Member_Questionairs dbInteraction = new DINT_Member_Questionairs(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_Member_Questionairs.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_Member_Questionairs.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Member_Questionairs_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("Member_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sMember_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Member_Questionairs dbInteraction = new DINT_Member_Questionairs(oSystem.cnCon);
                        List<DEF_Member_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Member_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Member_Questionairs dbInteraction = new DINT_Member_Questionairs(oSystem.cnCon);
                        List<DEF_Member_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Member_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult Member_Questionairs_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("Member_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sMember_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_Member_Questionairs.RecordObject recRecord = new DEF_Member_Questionairs.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult Member_Questionairs_AddUpdate(DEF_Member_Questionairs.RecordObject _rec)
        {
            Set_Client_NavSettings("Member_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sMember_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_Member_Questionairs dbInteraction = new DINT_Member_Questionairs(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("Member_Questionairs_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_Member_Questionairs dbInteraction = new DINT_Member_Questionairs(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("Member_Questionairs_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Member_Questionairs_Delete(int id)
        {
            Set_Client_NavSettings("Member_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_Member_Questionairs dbInteraction = new DINT_Member_Questionairs(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_Member_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Member_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("Member_Questionairs_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("Member_Questionairs_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form Member_QuestAnswers

        string sMember_QuestAnswers_Details = "/views/Forms/Member_QuestAnswers_Details.cshtml";
        string sMember_QuestAnswers_List = "/views/Forms/Member_QuestAnswers_List.cshtml";


        public ActionResult Member_QuestAnswers_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("Member_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sMember_QuestAnswers_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_Member_QuestAnswers dbInteraction = new DINT_Member_QuestAnswers(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_Member_QuestAnswers.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_Member_QuestAnswers.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Member_QuestAnswers_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("Member_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sMember_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Member_QuestAnswers dbInteraction = new DINT_Member_QuestAnswers(oSystem.cnCon);
                        List<DEF_Member_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Member_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Member_QuestAnswers dbInteraction = new DINT_Member_QuestAnswers(oSystem.cnCon);
                        List<DEF_Member_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Member_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult Member_QuestAnswers_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("Member_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sMember_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_Member_QuestAnswers.RecordObject recRecord = new DEF_Member_QuestAnswers.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult Member_QuestAnswers_AddUpdate(DEF_Member_QuestAnswers.RecordObject _rec)
        {
            Set_Client_NavSettings("Member_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sMember_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_Member_QuestAnswers dbInteraction = new DINT_Member_QuestAnswers(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("Member_QuestAnswers_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_Member_QuestAnswers dbInteraction = new DINT_Member_QuestAnswers(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("Member_QuestAnswers_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Member_QuestAnswers_Delete(int id)
        {
            Set_Client_NavSettings("Member_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_Member_QuestAnswers dbInteraction = new DINT_Member_QuestAnswers(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_Member_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Member_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("Member_QuestAnswers_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("Member_QuestAnswers_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form Lead_Questionairs

        string sLead_Questionairs_Details = "/views/Forms/Lead_Questionairs_Details.cshtml";
        string sLead_Questionairs_List = "/views/Forms/Lead_Questionairs_List.cshtml";


        public ActionResult Lead_Questionairs_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("Lead_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sLead_Questionairs_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_Lead_Questionairs dbInteraction = new DINT_Lead_Questionairs(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_Lead_Questionairs.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_Lead_Questionairs.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Lead_Questionairs_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("Lead_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sLead_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Lead_Questionairs dbInteraction = new DINT_Lead_Questionairs(oSystem.cnCon);
                        List<DEF_Lead_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Lead_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Lead_Questionairs dbInteraction = new DINT_Lead_Questionairs(oSystem.cnCon);
                        List<DEF_Lead_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Lead_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult Lead_Questionairs_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("Lead_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sLead_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_Lead_Questionairs.RecordObject recRecord = new DEF_Lead_Questionairs.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult Lead_Questionairs_AddUpdate(DEF_Lead_Questionairs.RecordObject _rec)
        {
            Set_Client_NavSettings("Lead_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sLead_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_Lead_Questionairs dbInteraction = new DINT_Lead_Questionairs(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("Lead_Questionairs_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_Lead_Questionairs dbInteraction = new DINT_Lead_Questionairs(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("Lead_Questionairs_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Lead_Questionairs_Delete(int id)
        {
            Set_Client_NavSettings("Lead_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_Lead_Questionairs dbInteraction = new DINT_Lead_Questionairs(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_Lead_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Lead_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("Lead_Questionairs_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("Lead_Questionairs_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form Lead_QuestAnswers

        string sLead_QuestAnswers_Details = "/views/Forms/Lead_QuestAnswers_Details.cshtml";
        string sLead_QuestAnswers_List = "/views/Forms/Lead_QuestAnswers_List.cshtml";


        public ActionResult Lead_QuestAnswers_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("Lead_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sLead_QuestAnswers_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_Lead_QuestAnswers dbInteraction = new DINT_Lead_QuestAnswers(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_Lead_QuestAnswers.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_Lead_QuestAnswers.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Lead_QuestAnswers_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("Lead_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sLead_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Lead_QuestAnswers dbInteraction = new DINT_Lead_QuestAnswers(oSystem.cnCon);
                        List<DEF_Lead_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Lead_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Lead_QuestAnswers dbInteraction = new DINT_Lead_QuestAnswers(oSystem.cnCon);
                        List<DEF_Lead_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Lead_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult Lead_QuestAnswers_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("Lead_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sLead_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_Lead_QuestAnswers.RecordObject recRecord = new DEF_Lead_QuestAnswers.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult Lead_QuestAnswers_AddUpdate(DEF_Lead_QuestAnswers.RecordObject _rec)
        {
            Set_Client_NavSettings("Lead_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sLead_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_Lead_QuestAnswers dbInteraction = new DINT_Lead_QuestAnswers(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("Lead_QuestAnswers_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_Lead_QuestAnswers dbInteraction = new DINT_Lead_QuestAnswers(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("Lead_QuestAnswers_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Lead_QuestAnswers_Delete(int id)
        {
            Set_Client_NavSettings("Lead_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_Lead_QuestAnswers dbInteraction = new DINT_Lead_QuestAnswers(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_Lead_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Lead_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("Lead_QuestAnswers_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("Lead_QuestAnswers_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form Affiliate_Questionairs

        string sAffiliate_Questionairs_Details = "/views/Forms/Affiliate_Questionairs_Details.cshtml";
        string sAffiliate_Questionairs_List = "/views/Forms/Affiliate_Questionairs_List.cshtml";


        public ActionResult Affiliate_Questionairs_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("Affiliate_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sAffiliate_Questionairs_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_Affiliate_Questionairs dbInteraction = new DINT_Affiliate_Questionairs(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_Affiliate_Questionairs.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_Affiliate_Questionairs.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Affiliate_Questionairs_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("Affiliate_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sAffiliate_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Affiliate_Questionairs dbInteraction = new DINT_Affiliate_Questionairs(oSystem.cnCon);
                        List<DEF_Affiliate_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Affiliate_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_Affiliate_Questionairs dbInteraction = new DINT_Affiliate_Questionairs(oSystem.cnCon);
                        List<DEF_Affiliate_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Affiliate_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult Affiliate_Questionairs_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("Affiliate_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sAffiliate_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_Affiliate_Questionairs.RecordObject recRecord = new DEF_Affiliate_Questionairs.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        [ValidateInput(false)]
        public ActionResult Affiliate_Questionairs_AddUpdate(DEF_Affiliate_Questionairs.RecordObject _rec)
        {
            Set_Client_NavSettings("Affiliate_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sAffiliate_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_Affiliate_Questionairs dbInteraction = new DINT_Affiliate_Questionairs(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("Affiliate_Questionairs_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_Affiliate_Questionairs dbInteraction = new DINT_Affiliate_Questionairs(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("Affiliate_Questionairs_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult Affiliate_Questionairs_Delete(int id)
        {
            Set_Client_NavSettings("Affiliate_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_Affiliate_Questionairs dbInteraction = new DINT_Affiliate_Questionairs(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_Affiliate_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_Affiliate_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("Affiliate_Questionairs_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("Affiliate_Questionairs_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteEvCalUser_QuestAnswers

        string sWebSiteEvCalUser_QuestAnswers_Details = "/views/Forms/WebSiteEvCalUser_QuestAnswers_Details.cshtml";
        string sWebSiteEvCalUser_QuestAnswers_List = "/views/Forms/WebSiteEvCalUser_QuestAnswers_List.cshtml";


        public ActionResult WebSiteEvCalUser_QuestAnswers_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)
        {
            Set_Client_NavSettings("WebSiteEvCalUser_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEvCalUser_QuestAnswers_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteEvCalUser_QuestAnswers dbInteraction = new DINT_WebSiteEvCalUser_QuestAnswers(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteEvCalUser_QuestAnswers.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteEvCalUser_QuestAnswers.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEvCalUser_QuestAnswers_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteEvCalUser_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEvCalUser_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEvCalUser_QuestAnswers dbInteraction = new DINT_WebSiteEvCalUser_QuestAnswers(oSystem.cnCon);
                        List<DEF_WebSiteEvCalUser_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEvCalUser_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEvCalUser_QuestAnswers dbInteraction = new DINT_WebSiteEvCalUser_QuestAnswers(oSystem.cnCon);
                        List<DEF_WebSiteEvCalUser_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEvCalUser_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteEvCalUser_QuestAnswers_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteEvCalUser_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEvCalUser_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteEvCalUser_QuestAnswers.RecordObject recRecord = new DEF_WebSiteEvCalUser_QuestAnswers.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public ActionResult WebSiteEvCalUser_QuestAnswers_AddUpdate(DEF_WebSiteEvCalUser_QuestAnswers.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteEvCalUser_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEvCalUser_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteEvCalUser_QuestAnswers dbInteraction = new DINT_WebSiteEvCalUser_QuestAnswers(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteEvCalUser_QuestAnswers_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteEvCalUser_QuestAnswers dbInteraction = new DINT_WebSiteEvCalUser_QuestAnswers(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteEvCalUser_QuestAnswers_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEvCalUser_QuestAnswers_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteEvCalUser_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteEvCalUser_QuestAnswers dbInteraction = new DINT_WebSiteEvCalUser_QuestAnswers(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteEvCalUser_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEvCalUser_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteEvCalUser_QuestAnswers_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteEvCalUser_QuestAnswers_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteEvCalUser_Questionairs

        string sWebSiteEvCalUser_Questionairs_Details = "/views/Forms/WebSiteEvCalUser_Questionairs_Details.cshtml";
        string sWebSiteEvCalUser_Questionairs_List = "/views/Forms/WebSiteEvCalUser_Questionairs_List.cshtml";


        public ActionResult WebSiteEvCalUser_Questionairs_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteEvCalUser_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEvCalUser_Questionairs_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteEvCalUser_Questionairs dbInteraction = new DINT_WebSiteEvCalUser_Questionairs(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteEvCalUser_Questionairs.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteEvCalUser_Questionairs.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEvCalUser_Questionairs_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteEvCalUser_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEvCalUser_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEvCalUser_Questionairs dbInteraction = new DINT_WebSiteEvCalUser_Questionairs(oSystem.cnCon);
                        List<DEF_WebSiteEvCalUser_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEvCalUser_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteEvCalUser_Questionairs dbInteraction = new DINT_WebSiteEvCalUser_Questionairs(oSystem.cnCon);
                        List<DEF_WebSiteEvCalUser_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEvCalUser_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteEvCalUser_Questionairs_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteEvCalUser_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEvCalUser_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteEvCalUser_Questionairs.RecordObject recRecord = new DEF_WebSiteEvCalUser_Questionairs.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public ActionResult WebSiteEvCalUser_Questionairs_AddUpdate(DEF_WebSiteEvCalUser_Questionairs.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteEvCalUser_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteEvCalUser_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteEvCalUser_Questionairs dbInteraction = new DINT_WebSiteEvCalUser_Questionairs(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteEvCalUser_Questionairs_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteEvCalUser_Questionairs dbInteraction = new DINT_WebSiteEvCalUser_Questionairs(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteEvCalUser_Questionairs_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteEvCalUser_Questionairs_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteEvCalUser_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteEvCalUser_Questionairs dbInteraction = new DINT_WebSiteEvCalUser_Questionairs(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteEvCalUser_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteEvCalUser_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteEvCalUser_Questionairs_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteEvCalUser_Questionairs_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteJApp_QuestAnswers

        string sWebSiteJApp_QuestAnswers_Details = "/views/Forms/WebSiteJApp_QuestAnswers_Details.cshtml";
        string sWebSiteJApp_QuestAnswers_List = "/views/Forms/WebSiteJApp_QuestAnswers_List.cshtml";


        public ActionResult WebSiteJApp_QuestAnswers_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteJApp_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJApp_QuestAnswers_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteJApp_QuestAnswers dbInteraction = new DINT_WebSiteJApp_QuestAnswers(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteJApp_QuestAnswers.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteJApp_QuestAnswers.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteJApp_QuestAnswers_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteJApp_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJApp_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteJApp_QuestAnswers dbInteraction = new DINT_WebSiteJApp_QuestAnswers(oSystem.cnCon);
                        List<DEF_WebSiteJApp_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteJApp_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteJApp_QuestAnswers dbInteraction = new DINT_WebSiteJApp_QuestAnswers(oSystem.cnCon);
                        List<DEF_WebSiteJApp_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteJApp_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteJApp_QuestAnswers_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteJApp_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJApp_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteJApp_QuestAnswers.RecordObject recRecord = new DEF_WebSiteJApp_QuestAnswers.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public ActionResult WebSiteJApp_QuestAnswers_AddUpdate(DEF_WebSiteJApp_QuestAnswers.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteJApp_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJApp_QuestAnswers_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteJApp_QuestAnswers dbInteraction = new DINT_WebSiteJApp_QuestAnswers(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteJApp_QuestAnswers_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteJApp_QuestAnswers dbInteraction = new DINT_WebSiteJApp_QuestAnswers(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteJApp_QuestAnswers_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteJApp_QuestAnswers_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteJApp_QuestAnswers");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteJApp_QuestAnswers dbInteraction = new DINT_WebSiteJApp_QuestAnswers(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteJApp_QuestAnswers.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteJApp_QuestAnswers.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteJApp_QuestAnswers_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteJApp_QuestAnswers_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #region Form WebSiteJApp_Questionairs

        string sWebSiteJApp_Questionairs_Details = "/views/Forms/WebSiteJApp_Questionairs_Details.cshtml";
        string sWebSiteJApp_Questionairs_List = "/views/Forms/WebSiteJApp_Questionairs_List.cshtml";


        public ActionResult WebSiteJApp_Questionairs_List(FormCollection fc, string Search, int _iParentID = 0, string _sParentID = "", int page = 1)

        {
            Set_Client_NavSettings("WebSiteJApp_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    Set_ViewBag_Global();
                    Set_ViewBag_UserInfo();
                    #region Process
                    if (_iParentID <= 0)
                    {
                        #region if ParentID is less than or equal to zero see if it was included in the form
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                _iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                _sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                        #endregion
                    }

                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJApp_Questionairs_List;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sView"] != null)
                        {
                            _sViewToLoad = Session["_sView"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion

                    if (fc.AllKeys.Length > 0)
                    {
                        Search = fc["Search"].ToString();
                    }
                    oSystem.OpenDataConnection();
                    DINT_WebSiteJApp_Questionairs dbInteraction = new DINT_WebSiteJApp_Questionairs(oSystem.cnCon);
                    int iTotalRows = 0;

                    List<DEF_WebSiteJApp_Questionairs.RecordObject> dbSearch = null;
                    List<DataParameter> lstParameters = new List<DataParameter>();
                    DataParameter pParameter = null;
                    bool bParameterSet = false;
                    string sPRelationsToOthers = "";
                    //if (_iParentID > 0)
                    //{
                    pParameter = new DataParameter("iParentID", "'" + _iParentID + "'", "int", 1, "iParentID", " = ", "");
                    lstParameters.Add(pParameter);
                    bParameterSet = true;
                    //}



                    if (!String.IsNullOrEmpty(Search))
                    {
                        Search = Search.TrimEnd();
                        Search = Search.TrimStart();
                        ViewBag.bSearched = true;


                        bool bIsNumber = false;
                        bool bIsDate = false;
                        bool bIsBool = false;
                        #region Test For Number
                        try
                        {
                            int iTest = System.Convert.ToInt32(Search);
                            bIsNumber = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Date
                        try
                        {
                            DateTime dtTest = System.Convert.ToDateTime(Search);
                            bIsDate = true;
                        }
                        catch
                        {
                        }
                        #endregion
                        #region Test For Boolean
                        try
                        {
                            bool bTest = System.Convert.ToBoolean(Search);
                            bIsBool = true;
                        }
                        catch
                        {
                        }
                        #endregion


                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }
                        //if (_iParentID > 0)
                        //{
                        //if (bIsNumber == true)
                        //{
                        //}
                        //}
                        if (bParameterSet == true)
                        {
                            sPRelationsToOthers = " AND ";
                        }
                        else
                        {
                            sPRelationsToOthers = "";
                        }

                    }

                    iTotalRows = dbInteraction.GetRowCount(lstParameters);

                    ViewBag.iTotalRecordCount = iTotalRows;
                    int iMaxRows = 10;
                    if (iTotalRows > 0)
                    {
                        #region Page Management Calculation
                        if (page <= 0)
                        {
                            page = 1;
                        }

                        int iRow = 0;
                        int iNextTop = 0;
                        int iNumberOfPages = 0;
                        if (iTotalRows > iMaxRows)
                        {
                            iNumberOfPages = (iTotalRows / iMaxRows) + 1;
                        }
                        else
                        {
                            iNumberOfPages = 1;
                        }
                        ViewBag.iNumberOfPages = iNumberOfPages;
                        if (page <= iNumberOfPages)
                        {
                            if (page > 1)
                            {
                                iRow = ((page - 1) * iMaxRows) + 1;
                                ViewBag.iCurrentPage = page;
                                iNextTop = (page * iMaxRows);
                            }
                            else
                            {
                                iRow = 0;
                                ViewBag.iCurrentPage = 1;
                                iNextTop = page * iMaxRows;
                            }
                        }
                        else
                        {
                            page = iNumberOfPages;
                            iRow = ((page - 1) * iMaxRows) + 1;
                            ViewBag.iCurrentPage = iNumberOfPages;
                            iNextTop = iNumberOfPages * iMaxRows;
                        }
                        #endregion
                        dbSearch = dbInteraction.Get(lstParameters, iRow, iNextTop);


                        var dbres = dbSearch.OrderBy(s => s.ID);
                        oPage.DataModelsPrimary = dbres.ToList();
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    else
                    {
                        ViewBag.iNumberOfPages = 0;
                        dbSearch = new List<DEF_WebSiteJApp_Questionairs.RecordObject>();
                        oPage.DataModelsPrimary = dbSearch;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteJApp_Questionairs_Details(int id = 0, string key = "", bool _UseParameterResults = false, bool _AddNew = false, bool _Saved = false)
        {
            Set_Client_NavSettings("WebSiteJApp_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJApp_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (id > 0)
                    {
                        #region ID Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteJApp_Questionairs dbInteraction = new DINT_WebSiteJApp_Questionairs(oSystem.cnCon);
                        List<DEF_WebSiteJApp_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteJApp_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else if (!String.IsNullOrEmpty(key))
                    {
                        #region key Based pull
                        oSystem.OpenDataConnection();
                        ViewBag.bError = false;
                        ViewBag.bAddNew = false;
                        ViewBag.bSaved = false;
                        ViewBag.sErrorMessage = "";

                        if (_UseParameterResults == true)
                        {
                            ViewBag.bAddNew = _AddNew;
                            ViewBag.bSaved = _Saved;
                        }

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("sControl", "'" + key + "'", "string", 3, "sControl", " = ", "");
                        lstParameters.Add(pParameter);

                        DINT_WebSiteJApp_Questionairs dbInteraction = new DINT_WebSiteJApp_Questionairs(oSystem.cnCon);
                        List<DEF_WebSiteJApp_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteJApp_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord == null)
                                {
                                    return HttpNotFound();
                                }
                                ViewBag.iParentID = recRecord.iParentID;
                                ViewBag.sParentID = recRecord.sParentID;



                                oPage.DataModelsPrimary = recRecord;
                                oPage.DataModelsSub.Add(oSystem);
                                oPage.AuthenticatedUser = true;
                                oPage.PartialViewToLoad = _sViewToLoad;
                                oSystem.CloseDataConnection();
                                return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                            }
                            else
                            {
                                oSystem.CloseDataConnection();
                                return HttpNotFound();
                            }
                        }
                        else
                        {
                            oSystem.CloseDataConnection();
                            return HttpNotFound();
                        }
                        #endregion
                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return HttpNotFound();
                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }



        public ActionResult WebSiteJApp_Questionairs_Create(int _iParentID = 0, string _sParentID = "")

        {
            Set_Client_NavSettings("WebSiteJApp_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.iParentID = _iParentID;
                    ViewBag.sParentID = _sParentID;



                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJApp_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    ViewBag.bError = false;
                    ViewBag.bAddNew = true;
                    ViewBag.bSaved = false;
                    ViewBag.sErrorMessage = "";
                    DEF_WebSiteJApp_Questionairs.RecordObject recRecord = new DEF_WebSiteJApp_Questionairs.RecordObject();


                    recRecord.iParentID = _iParentID;
                    recRecord.sParentID = _sParentID;





                    oPage.DataModelsPrimary = recRecord;
                    oPage.DataModelsSub.Add(oSystem);
                    oPage.AuthenticatedUser = true;
                    oPage.PartialViewToLoad = _sViewToLoad;
                    oSystem.CloseDataConnection();
                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        [HttpPost]
        public ActionResult WebSiteJApp_Questionairs_AddUpdate(DEF_WebSiteJApp_Questionairs.RecordObject _rec)
        {
            Set_Client_NavSettings("WebSiteJApp_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {
                    #region Process
                    ViewBag.bLoggedIn = true;
                    string sLocalDefaultView = sModuleBase + sWebSiteJApp_Questionairs_Details;
                    #region If View is not set try to get it
                    if (String.IsNullOrEmpty(_sViewToLoad))
                    {
                        if (Session["_sViewDetails"] != null)
                        {
                            _sViewToLoad = Session["_sViewDetails"].ToString();
                        }
                        else
                        {
                            _sViewToLoad = sLocalDefaultView;
                        }
                    }
                    #endregion
                    if (_rec != null)
                    {
                        if ((_rec.ID == null) || (_rec.ID == 0))
                        {
                            ViewBag.bAddNew = true;
                            _rec.ID = -1;
                            ModelState.Remove("ID");
                        }

                        if (ModelState.IsValid)
                        {
                            ViewBag.iParentID = _rec.iParentID;
                            ViewBag.sParentID = _rec.sParentID;



                            if (ViewBag.bAddNew == true)
                            {
                                #region
                                ViewBag.bError = false;
                                ViewBag.bAddNew = false;
                                ViewBag.bSaved = true;
                                ViewBag.sErrorMessage = "";
                                oSystem.OpenDataConnection();

                                DINT_WebSiteJApp_Questionairs dbInteraction = new DINT_WebSiteJApp_Questionairs(oSystem.cnCon);

                                _rec.sControl = Guid.NewGuid().ToString();
                                _rec.dtDateCreated = DateTime.Now;
                                _rec.dtLastUpdated = DateTime.Now;

                                dbInteraction.Insert_SQL(_rec);



                                oSystem.CloseDataConnection();
                                #endregion
                                return RedirectToAction("WebSiteJApp_Questionairs_Details", new { key = _rec.sControl, _UseParameterResults = true, _AddNew = false, _Saved = true });
                            }
                            else
                            {
                                if (_rec.ID > 0)
                                {
                                    #region
                                    ViewBag.bError = false;
                                    ViewBag.bAddNew = false;
                                    ViewBag.bSaved = true;
                                    ViewBag.sErrorMessage = "";
                                    oSystem.OpenDataConnection();


                                    DINT_WebSiteJApp_Questionairs dbInteraction = new DINT_WebSiteJApp_Questionairs(oSystem.cnCon);
                                    _rec.dtLastUpdated = DateTime.Now;

                                    dbInteraction.Update_SQL(_rec);

                                    oSystem.CloseDataConnection();
                                    #endregion
                                    return RedirectToAction("WebSiteJApp_Questionairs_Details", new { id = _rec.ID, _UseParameterResults = true, _AddNew = false, _Saved = true });
                                }
                                else
                                {
                                    ViewBag.bError = true;
                                    ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                                    oPage.DataModelsPrimary = _rec;
                                    oPage.DataModelsSub.Add(oSystem);
                                    oPage.AuthenticatedUser = true;
                                    oPage.PartialViewToLoad = _sViewToLoad;
                                    oSystem.CloseDataConnection();
                                    return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                                }
                            }
                        }
                        else
                        {
                            ViewBag.bError = true;
                            ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                            oPage.DataModelsPrimary = _rec;
                            oPage.DataModelsSub.Add(oSystem);
                            oPage.AuthenticatedUser = true;
                            oPage.PartialViewToLoad = _sViewToLoad;
                            oSystem.CloseDataConnection();
                            return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                        }
                    }
                    else
                    {
                        ViewBag.bError = true;
                        ViewBag.sErrorMessage = "Please fill out the form completely, before re-submitting it.";

                        oPage.DataModelsPrimary = _rec;
                        oPage.DataModelsSub.Add(oSystem);
                        oPage.AuthenticatedUser = true;
                        oPage.PartialViewToLoad = _sViewToLoad;
                        oSystem.CloseDataConnection();
                        return View(sModuleBase + "/Views/Screens/Index.cshtml", oPage);
                    }
                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }

        public ActionResult WebSiteJApp_Questionairs_Delete(int id)
        {
            Set_Client_NavSettings("WebSiteJApp_Questionairs");
            Set_ViewBag_Global_Defaults();
            Set_ViewBag_UserInfo_Defaults();
            if (oSystem.GetCurrentUser())
            {
                Set_ViewBag_Global();
                Set_ViewBag_UserInfo();
                if (oSystem.CheckScreenAccessRights(iAccessRolesAllowed))
                {

                    int iParentID = 0;
                    string sParentID = "";

                    #region if ParentID is less than or equal to zero see if it was included in the form
                    try
                    {
                        if (Request.Form["_iParentID"] != null)
                        {
                            try
                            {
                                iParentID = System.Convert.ToInt32(Request.Form["_iParentID"].ToString());
                                sParentID = Request.Form["_sParentID"].ToString();
                            }
                            catch
                            {
                            }
                        }
                    }
                    catch
                    {
                    }
                    #endregion

                    #region Process
                    ViewBag.bLoggedIn = true;
                    ViewBag.bAddNew = false;
                    if (id > 0)
                    {
                        oSystem.OpenDataConnection();

                        DINT_WebSiteJApp_Questionairs dbInteraction = new DINT_WebSiteJApp_Questionairs(oSystem.cnCon);

                        List<DataParameter> lstParameters = new List<DataParameter>();
                        DataParameter pParameter = new DataParameter("ID", id.ToString(), "int", 0, "ID", " = ", "");
                        lstParameters.Add(pParameter);

                        List<DEF_WebSiteJApp_Questionairs.RecordObject> dbSearch;
                        dbSearch = dbInteraction.Get(lstParameters);
                        if (dbSearch != null)
                        {
                            if (dbSearch.Count > 0)
                            {
                                DEF_WebSiteJApp_Questionairs.RecordObject recRecord = dbSearch[0];
                                if (recRecord != null)
                                {
                                    if (recRecord.ID == id)
                                    {

                                        ViewBag.iParentID = recRecord.iParentID;
                                        ViewBag.sParentID = recRecord.sParentID;
                                        iParentID = recRecord.iParentID;
                                        sParentID = recRecord.sParentID;


                                        dbInteraction.Delete_SQL(recRecord);
                                    }
                                }
                            }
                        }
                        oSystem.CloseDataConnection();

                        return RedirectToAction("WebSiteJApp_Questionairs_List", new { _iParentID = iParentID, _sParentID = sParentID });


                    }
                    else
                    {
                        oSystem.CloseDataConnection();
                        return RedirectToAction("WebSiteJApp_Questionairs_List", new { _iParentID = iParentID, _sParentID = sParentID });

                    }

                    #endregion
                }
                else
                {
                    oSystem.CloseDataConnection();
                    //User does not have access to this area of the system
                    return Redirect("~/");
                }
            }
            else
            {
                oSystem.CloseDataConnection();
                return RedirectToAction("Index");
            }
        }
        #endregion

        #endregion

    }
}
